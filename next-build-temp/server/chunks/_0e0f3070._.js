module.exports=[91387,e=>{"use strict";var t=e.i(45709),r=e.i(44801);let a=[],i=0;function n(e){let t=String(e||"").trim().toLowerCase();return t&&t.includes("@")?t:""}async function o(){let e=Date.now();if(e-i<3e4&&Array.isArray(a))return a;let r=await (0,t.listUserAccounts)();return a=Array.isArray(r)?r:[],i=e,a}async function s(e=[]){let t=function(e=[]){let t=new Set;return e.forEach(e=>{let r=n(e);r&&t.add(r)}),t}(e),a=0===t.size,i=new Map;try{(await o()).forEach(e=>{let o=n(e?.email);o&&(a||t.has(o))&&i.set(o,{email:o,name:(0,r.formatPersonName)({firstName:e?.firstName,middleName:e?.middleName,lastName:e?.lastName,fallbackEmail:o,fallbackLabel:"User"}),avatarUrl:"string"==typeof e?.profilePhotoDataUrl?e.profilePhotoDataUrl:null})})}catch{}return t.forEach(e=>{i.has(e)||i.set(e,{email:e,name:(0,r.formatNameFromEmail)(e),avatarUrl:null})}),i}function l(e,t){let a=n(t);if(a&&e instanceof Map){let t=e.get(a);if(t)return t}if(a)return{email:a,name:(0,r.formatNameFromEmail)(a),avatarUrl:null};let i=String(t||"").trim();return i?{email:i,name:i,avatarUrl:null}:{email:"",name:"System",avatarUrl:null}}function d(e,t,{actorKey:r="by"}={}){return Array.isArray(e)?e.map(e=>{let a=l(t,e?.[r]);return{...e,[`${r}Name`]:a.name,[`${r}Email`]:a.email||String(e?.[r]||""),[`${r}Avatar`]:a.avatarUrl}}):[]}function c(e,t="by"){return Array.isArray(e)?e.map(e=>e?.[t]).filter(Boolean):[]}function u(e){if(!e||"object"!=typeof e)return[];let t=[e.createdBy,e.updatedBy];return Array.isArray(e.activityHistory)&&e.activityHistory.forEach(e=>{t.push(e?.by)}),Array.isArray(e.documents)&&e.documents.forEach(e=>{t.push(e?.uploadedBy)}),t.filter(Boolean)}function m(e,t){if(!e||"object"!=typeof e)return e;let r=l(t,e.createdBy),a=l(t,e.updatedBy),i=Array.isArray(e.activityHistory)?e.activityHistory.map(e=>{let r=l(t,e?.by);return{...e,byName:r.name,byEmail:r.email||String(e?.by||""),byAvatar:r.avatarUrl}}):[],n=Array.isArray(e.documents)?e.documents.map(e=>{let r=l(t,e?.uploadedBy);return{...e,uploadedByName:r.name,uploadedByEmail:r.email||String(e?.uploadedBy||""),uploadedByAvatar:r.avatarUrl}}):[];return{...e,createdByName:r.name,createdByEmail:r.email||String(e.createdBy||""),createdByAvatar:r.avatarUrl,updatedByName:a.name,updatedByEmail:a.email||String(e.updatedBy||""),updatedByAvatar:a.avatarUrl,activityHistory:i,documents:n}}function p(e){if(!e||"object"!=typeof e)return[];let t=[e.createdBy,e.updatedBy];return Array.isArray(e.versionHistory)&&e.versionHistory.forEach(e=>{t.push(e?.changedBy)}),Array.isArray(e.modificationLog)&&e.modificationLog.forEach(e=>{t.push(e?.by)}),Array.isArray(e.usageLogs)&&e.usageLogs.forEach(e=>{t.push(e?.by,e?.uploadedBy,e?.performedBy)}),t.filter(Boolean)}function y(e,t){if(!e||"object"!=typeof e)return e;let r=l(t,e.createdBy),a=l(t,e.updatedBy),i=Array.isArray(e.versionHistory)?e.versionHistory.map(e=>{let r=l(t,e?.changedBy);return{...e,changedByName:r.name,changedByEmail:r.email||String(e?.changedBy||""),changedByAvatar:r.avatarUrl}}):[],n=Array.isArray(e.modificationLog)?e.modificationLog.map(e=>{let r=l(t,e?.by);return{...e,byName:r.name,byEmail:r.email||String(e?.by||""),byAvatar:r.avatarUrl}}):[];return{...e,createdByName:r.name,createdByEmail:r.email||String(e.createdBy||""),createdByAvatar:r.avatarUrl,updatedByName:a.name,updatedByEmail:a.email||String(e.updatedBy||""),updatedByAvatar:a.avatarUrl,versionHistory:i,modificationLog:n}}e.s(["collectEmailsFromTrail",()=>c,"collectEmployeeActorValues",()=>u,"collectTemplateActorValues",()=>p,"createActorDirectory",()=>s,"enrichEmployeeRecordActors",()=>m,"enrichTemplateRecordActors",()=>y,"enrichTrailActors",()=>d,"resolveActor",()=>l])},21669,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),i=e.i(59756),n=e.i(61916),o=e.i(74677),s=e.i(69741),l=e.i(16795),d=e.i(87718),c=e.i(95169),u=e.i(47587),m=e.i(66012),p=e.i(70101),y=e.i(26937),h=e.i(10372),v=e.i(93695);e.i(52474);var f=e.i(220),g=e.i(89171),A=e.i(98189),E=e.i(96864),R=e.i(91387),B=e.i(32307),w=e.i(79120);function b(e){let t=new Date(e||"");return Number.isNaN(t.getTime())?null:t.getTime()}function x(e){return String(e||"").trim().toLowerCase()}function N(e){let t=x(e.module),r=x(e.activityName),a=x(e.requestPath);return t.includes("authentication")||r.includes("login")||a.includes("/auth/")?"login_history":t.includes("export")||r.includes("export")?"export_events":t.includes("template")||t.includes("document")||r.includes("document")?"document_access_logs":r.includes("updated")||r.includes("deleted")||r.includes("created")?"data_change_logs":"user_activity_logs"}function S(e){let t=String(e??"");return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replaceAll('"','""')}"`:t}function P(e){return Array.isArray(e)&&0!==e.length?e.map(e=>String(e||"").trim()).filter(Boolean).join(" | "):""}function U(e){return Array.isArray(e)&&0!==e.length?e.map(e=>{if(!e||"object"!=typeof e)return"";let t=String(e.name||"").trim(),r=String(e.type||"").trim(),a=String(e.id||"").trim();return[t,r?`[${r}]`:"",a?`#${a}`:""].filter(Boolean).join(" ")}).filter(Boolean).join(" | "):""}async function C(e){let t=await (0,A.authorizeApiRequest)(e,{requiredPermissions:["activity_log:view"],auditModule:"Activity Log",auditAction:"Audit logs list request"});if(t.error)return t.error;let{session:r}=t,a=x(e.nextUrl?.searchParams.get("q")),i=x(e.nextUrl?.searchParams.get("module")),n=x(e.nextUrl?.searchParams.get("status")),o=x(e.nextUrl?.searchParams.get("sensitivity")),s=x(e.nextUrl?.searchParams.get("category")),l=b(e.nextUrl?.searchParams.get("from")),d=b(e.nextUrl?.searchParams.get("to")),c=(0,w.parsePositiveInt)(e.nextUrl?.searchParams.get("page"),1,{min:1,max:1e5}),u=(0,w.parsePositiveInt)(e.nextUrl?.searchParams.get("pageSize"),25,{min:1,max:200}),m=(0,w.parsePositiveInt)(e.nextUrl?.searchParams.get("limit"),1200,{min:1,max:3e3}),p=String(e.nextUrl?.searchParams.get("export")||"").trim().toLowerCase(),y=await (0,E.listAuditEvents)({limit:m}),h=await (0,R.createActorDirectory)(y.map(e=>e.performedBy)),v=y.filter(e=>{let t=x(e.module),r=x(e.status),c=x(e.sensitivity),u=N(e),m=b(e.occurredAt||e.loggedAt),p=(0,R.resolveActor)(h,e.performedBy),y=x([e.activityName,e.module,e.performedBy,p.name,p.email,e.requestPath,e.requestMethod,e.sourceIp,e.browser,e.operatingSystem,e.deviceSummary,e.recordRef,P(e.changedFields),P(e.viewedFields),U(e.accessedDocuments)].join(" ")),v=!a||y.includes(a),f=!i||t.includes(i),g=!n||r.includes(n),A=!o||c.includes(o);return v&&f&&g&&A&&(!s||u===s)&&(!l||m&&m>=l)&&(!d||m&&m<=d)}).map(e=>{let t=(0,R.resolveActor)(h,e.performedBy);return{...e,performedByName:t.name,performedByAvatar:t.avatarUrl,performedByEmail:t.email||e.performedBy||""}});if("csv"===p){if(!(0,B.hasPermission)(r.role,"activity_log:export"))return g.NextResponse.json({message:"Forbidden."},{status:403});let t=v.map(e=>[e.id,e.activityName,e.status,e.module,e.performedByName,e.performedBy,e.sensitivity,e.occurredAt,e.loggedAt,e.requestPath,e.requestMethod,e.sourceIp,e.browser,e.operatingSystem,e.deviceSummary,e.recordRef,P(e.changedFields),P(e.viewedFields),U(e.accessedDocuments),N(e)].map(S).join(",")),a=`id,activityName,status,module,performedByName,performedBy,sensitivity,occurredAt,loggedAt,requestPath,requestMethod,sourceIp,browser,operatingSystem,deviceSummary,recordRef,changedFields,viewedFields,accessedDocuments,category
${t.join("\n")}
`;return await (0,w.logApiAudit)({request:e,module:"Activity Log",activityName:"Activity logs exported",status:"Completed",sensitivity:"Sensitive",performedBy:r.email,metadata:{exportedCount:v.length,format:"csv"}}),new g.NextResponse(a,{status:200,headers:{"Content-Type":"text/csv; charset=utf-8","Content-Disposition":`attachment; filename="clio-activity-logs-${Date.now()}.csv"`}})}let{data:f,pagination:C}=(0,w.paginateRows)(v,{page:c,pageSize:u}),_=f.map(e=>({...e,category:N(e)}));return await (0,w.logApiAudit)({request:e,module:"Activity Log",activityName:"Activity logs viewed",status:"Completed",sensitivity:"Sensitive",performedBy:r.email,metadata:{resultCount:_.length,totalMatched:v.length,hasFilters:!!(a||i||n||o||s||l||d)}}),g.NextResponse.json({records:_,pagination:C})}e.s(["GET",()=>C],629);var _=e.i(629);let T=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/hris/activity-logs/route",pathname:"/api/hris/activity-logs",filename:"route",bundlePath:""},distDir:"next-build-temp",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/hris/activity-logs/route.js",nextConfigOutput:"",userland:_}),{workAsyncStorage:q,workUnitAsyncStorage:H,serverHooks:j}=T;function D(){return(0,a.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:H})}async function I(e,t,a){T.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let g="/api/hris/activity-logs/route";g=g.replace(/\/index$/,"")||"/";let A=await T.prepare(e,t,{srcPage:g,multiZoneDraftMode:!1});if(!A)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:E,params:R,nextConfig:B,parsedUrl:w,isDraftMode:b,prerenderManifest:x,routerServerContext:N,isOnDemandRevalidate:S,revalidateOnlyGenerated:P,resolvedPathname:U,clientReferenceManifest:C,serverActionsManifest:_}=A,q=(0,s.normalizeAppPath)(g),H=!!(x.dynamicRoutes[q]||x.routes[U]),j=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,w,!1):t.end("This page could not be found"),null);if(H&&!b){let e=!!x.routes[U],t=x.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(B.experimental.adapterPath)return await j();throw new v.NoFallbackError}}let D=null;!H||T.isDev||b||(D="/index"===(D=U)?"/":D);let I=!0===T.isDev||!H,O=H&&!I;_&&C&&(0,o.setManifestsSingleton)({page:g,clientReferenceManifest:C,serverActionsManifest:_});let k=e.method||"GET",F=(0,n.getTracer)(),M=F.getActiveScopeSpan(),L={params:R,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!B.experimental.authInterrupts},cacheComponents:!!B.cacheComponents,supportsDynamicResponse:I,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:B.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,i)=>T.onRequestError(e,t,a,i,N)},sharedContext:{buildId:E}},$=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),V=d.NextRequestAdapter.fromNodeNextRequest($,(0,d.signalFromNodeResponse)(t));try{let o=async e=>T.handle(V,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=F.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${k} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${g}`)}),s=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var n,l;let d=async({previousCacheEntry:r})=>{try{if(!s&&S&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(i);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=L.renderOpts.collectedTags;if(!H)return await (0,m.sendResponse)($,K,n,L.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[h.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,a=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await T.onRequestError(e,t,{routerKind:"App Router",routePath:g,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:S})},!1,N),t}},c=await T.handleResponse({req:e,nextConfig:B,cacheKey:D,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:S,revalidateOnlyGenerated:P,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:s});if(!H)return null;if((null==c||null==(n=c.value)?void 0:n.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",S?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let v=(0,p.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&H||v.delete(h.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||v.get("Cache-Control")||v.set("Cache-Control",(0,y.getCacheControlHeader)(c.cacheControl)),await (0,m.sendResponse)($,K,new Response(c.value.body,{headers:v,status:c.value.status||200})),null};M?await l(M):await F.withPropagatedContext(e.headers,()=>F.trace(c.BaseServerSpan.handleRequest,{spanName:`${k} ${g}`,kind:n.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await T.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:S})},!1,N),H)throw t;return await (0,m.sendResponse)($,K,new Response(null,{status:500})),null}}e.s(["handler",()=>I,"patchFetch",()=>D,"routeModule",()=>T,"serverHooks",()=>j,"workAsyncStorage",()=>q,"workUnitAsyncStorage",()=>H],21669)},11072,e=>{e.v(t=>Promise.all(["server/chunks/src_lib_security-detection_4bdbe3ad.js","server/chunks/src_lib_hris-backend_4dbd0cdd.js","server/chunks/src_lib_7f61f828._.js"].map(t=>e.l(t))).then(()=>t(74405)))}];

//# sourceMappingURL=_0e0f3070._.js.map