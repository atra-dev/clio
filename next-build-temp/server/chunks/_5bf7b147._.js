module.exports=[91387,e=>{"use strict";var t=e.i(45709),a=e.i(44801);let r=[],i=0;function o(e){let t=String(e||"").trim().toLowerCase();return t&&t.includes("@")?t:""}async function n(){let e=Date.now();if(e-i<3e4&&Array.isArray(r))return r;let a=await (0,t.listUserAccounts)();return r=Array.isArray(a)?a:[],i=e,r}async function s(e=[]){let t=function(e=[]){let t=new Set;return e.forEach(e=>{let a=o(e);a&&t.add(a)}),t}(e),r=0===t.size,i=new Map;try{(await n()).forEach(e=>{let n=o(e?.email);n&&(r||t.has(n))&&i.set(n,{email:n,name:(0,a.formatPersonName)({firstName:e?.firstName,middleName:e?.middleName,lastName:e?.lastName,fallbackEmail:n,fallbackLabel:"User"}),avatarUrl:"string"==typeof e?.profilePhotoDataUrl?e.profilePhotoDataUrl:null})})}catch{}return t.forEach(e=>{i.has(e)||i.set(e,{email:e,name:(0,a.formatNameFromEmail)(e),avatarUrl:null})}),i}function l(e,t){let r=o(t);if(r&&e instanceof Map){let t=e.get(r);if(t)return t}if(r)return{email:r,name:(0,a.formatNameFromEmail)(r),avatarUrl:null};let i=String(t||"").trim();return i?{email:i,name:i,avatarUrl:null}:{email:"",name:"System",avatarUrl:null}}function u(e,t,{actorKey:a="by"}={}){return Array.isArray(e)?e.map(e=>{let r=l(t,e?.[a]);return{...e,[`${a}Name`]:r.name,[`${a}Email`]:r.email||String(e?.[a]||""),[`${a}Avatar`]:r.avatarUrl}}):[]}function d(e,t="by"){return Array.isArray(e)?e.map(e=>e?.[t]).filter(Boolean):[]}function c(e){if(!e||"object"!=typeof e)return[];let t=[e.createdBy,e.updatedBy];return Array.isArray(e.activityHistory)&&e.activityHistory.forEach(e=>{t.push(e?.by)}),Array.isArray(e.documents)&&e.documents.forEach(e=>{t.push(e?.uploadedBy)}),t.filter(Boolean)}function p(e,t){if(!e||"object"!=typeof e)return e;let a=l(t,e.createdBy),r=l(t,e.updatedBy),i=Array.isArray(e.activityHistory)?e.activityHistory.map(e=>{let a=l(t,e?.by);return{...e,byName:a.name,byEmail:a.email||String(e?.by||""),byAvatar:a.avatarUrl}}):[],o=Array.isArray(e.documents)?e.documents.map(e=>{let a=l(t,e?.uploadedBy);return{...e,uploadedByName:a.name,uploadedByEmail:a.email||String(e?.uploadedBy||""),uploadedByAvatar:a.avatarUrl}}):[];return{...e,createdByName:a.name,createdByEmail:a.email||String(e.createdBy||""),createdByAvatar:a.avatarUrl,updatedByName:r.name,updatedByEmail:r.email||String(e.updatedBy||""),updatedByAvatar:r.avatarUrl,activityHistory:i,documents:o}}function m(e){if(!e||"object"!=typeof e)return[];let t=[e.createdBy,e.updatedBy];return Array.isArray(e.versionHistory)&&e.versionHistory.forEach(e=>{t.push(e?.changedBy)}),Array.isArray(e.modificationLog)&&e.modificationLog.forEach(e=>{t.push(e?.by)}),Array.isArray(e.usageLogs)&&e.usageLogs.forEach(e=>{t.push(e?.by,e?.uploadedBy,e?.performedBy)}),t.filter(Boolean)}function y(e,t){if(!e||"object"!=typeof e)return e;let a=l(t,e.createdBy),r=l(t,e.updatedBy),i=Array.isArray(e.versionHistory)?e.versionHistory.map(e=>{let a=l(t,e?.changedBy);return{...e,changedByName:a.name,changedByEmail:a.email||String(e?.changedBy||""),changedByAvatar:a.avatarUrl}}):[],o=Array.isArray(e.modificationLog)?e.modificationLog.map(e=>{let a=l(t,e?.by);return{...e,byName:a.name,byEmail:a.email||String(e?.by||""),byAvatar:a.avatarUrl}}):[];return{...e,createdByName:a.name,createdByEmail:a.email||String(e.createdBy||""),createdByAvatar:a.avatarUrl,updatedByName:r.name,updatedByEmail:r.email||String(e.updatedBy||""),updatedByAvatar:r.avatarUrl,versionHistory:i,modificationLog:o}}e.s(["collectEmailsFromTrail",()=>d,"collectEmployeeActorValues",()=>c,"collectTemplateActorValues",()=>m,"createActorDirectory",()=>s,"enrichEmployeeRecordActors",()=>p,"enrichTemplateRecordActors",()=>y,"enrichTrailActors",()=>u,"resolveActor",()=>l])},28355,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),i=e.i(59756),o=e.i(61916),n=e.i(74677),s=e.i(69741),l=e.i(16795),u=e.i(87718),d=e.i(95169),c=e.i(47587),p=e.i(66012),m=e.i(70101),y=e.i(26937),f=e.i(10372),h=e.i(93695);e.i(52474);var v=e.i(220),A=e.i(89171),g=e.i(98189),R=e.i(91387),E=e.i(45787),w=e.i(79120);function B(e){return e&&"object"==typeof e?{id:e.id,templateName:e.templateName,category:e.category,classification:e.classification,version:e.version,status:e.status,contentRef:e.contentRef||"",updatedAt:e.updatedAt||null}:null}async function N(e){let t=await (0,g.authorizeApiRequest)(e,{requiredPermissions:["templates:view"],auditModule:"Template Repository",auditAction:"Template records list request"});if(t.error)return t.error;let{session:a}=t;try{let t=String(e.nextUrl?.searchParams.get("status")||"").trim().toLowerCase(),r=String(e.nextUrl?.searchParams.get("category")||"").trim().toLowerCase(),i=(await (0,E.listDocumentTemplatesBackend)()).filter(e=>{let a=!t||String(e.status||"").trim().toLowerCase().includes(t),i=!r||String(e.category||"").trim().toLowerCase().includes(r);return a&&i}),o=(0,w.isEmployeeRole)(a.role),n=o?i.filter(e=>"active"===String(e.status||"").trim().toLowerCase()).map(B).filter(Boolean):i;if(!o){let e=n.flatMap(e=>(0,R.collectTemplateActorValues)(e)),t=await (0,R.createActorDirectory)(e);n=n.map(e=>(0,R.enrichTemplateRecordActors)(e,t))}return await (0,w.logApiAudit)({request:e,module:"Template Repository",activityName:"Template records listed",status:"Completed",sensitivity:o?"Non-sensitive":"Sensitive",performedBy:a.email,metadata:{resultCount:n.length,hasStatusFilter:!!t,hasCategoryFilter:!!r,employeeScope:o}}),A.NextResponse.json({records:n})}catch(i){let t=i instanceof Error?i.message:"unknown_error",r=(0,w.mapBackendError)(t,"Unable to load templates.");return await (0,w.logApiAudit)({request:e,module:"Template Repository",activityName:"Template records list failed",status:"Failed",sensitivity:"Sensitive",performedBy:a.email,metadata:{reason:t}}),A.NextResponse.json({message:r.message},{status:r.status})}}async function b(e){let t=await (0,g.authorizeApiRequest)(e,{requiredPermissions:["templates:view"],auditModule:"Template Repository",auditAction:"Template create request"});if(t.error)return t.error;let{session:a}=t;if(!(0,w.canActorEditModule)({role:a.role,editPermission:"templates:edit",isSelfResource:!1}))return await (0,w.logApiAudit)({request:e,module:"Template Repository",activityName:"Template create blocked by permission policy",status:"Rejected",sensitivity:"Sensitive",performedBy:a.email,metadata:{role:a.role}}),A.NextResponse.json({message:"Forbidden."},{status:403});try{let t=await (0,w.parseJsonBody)(e),r=await (0,E.createDocumentTemplateBackend)(t,a.email);await (0,w.logApiAudit)({request:e,module:"Template Repository",activityName:"Template created",status:"Approved",sensitivity:"Sensitive",performedBy:a.email,metadata:{recordId:r.id,templateName:r.templateName||null,version:r.version||null}});let i=await (0,R.createActorDirectory)((0,R.collectTemplateActorValues)(r));return A.NextResponse.json({ok:!0,record:(0,R.enrichTemplateRecordActors)(r,i)},{status:201})}catch(i){let t=i instanceof Error?i.message:"unknown_error",r=(0,w.mapBackendError)(t,"Unable to create template.");return await (0,w.logApiAudit)({request:e,module:"Template Repository",activityName:"Template create failed",status:"Failed",sensitivity:"Sensitive",performedBy:a.email,metadata:{reason:t}}),A.NextResponse.json({message:r.message},{status:r.status})}}e.s(["GET",()=>N,"POST",()=>b],40356);var T=e.i(40356);let S=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/hris/templates/route",pathname:"/api/hris/templates",filename:"route",bundlePath:""},distDir:"next-build-temp",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/hris/templates/route.js",nextConfigOutput:"",userland:T}),{workAsyncStorage:C,workUnitAsyncStorage:x,serverHooks:U}=S;function P(){return(0,r.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:x})}async function _(e,t,r){S.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let A="/api/hris/templates/route";A=A.replace(/\/index$/,"")||"/";let g=await S.prepare(e,t,{srcPage:A,multiZoneDraftMode:!1});if(!g)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:R,params:E,nextConfig:w,parsedUrl:B,isDraftMode:N,prerenderManifest:b,routerServerContext:T,isOnDemandRevalidate:C,revalidateOnlyGenerated:x,resolvedPathname:U,clientReferenceManifest:P,serverActionsManifest:_}=g,k=(0,s.normalizeAppPath)(A),H=!!(b.dynamicRoutes[k]||b.routes[U]),O=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,B,!1):t.end("This page could not be found"),null);if(H&&!N){let e=!!b.routes[U],t=b.dynamicRoutes[k];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await O();throw new h.NoFallbackError}}let j=null;!H||S.isDev||N||(j="/index"===(j=U)?"/":j);let D=!0===S.isDev||!H,q=H&&!D;_&&P&&(0,n.setManifestsSingleton)({page:A,clientReferenceManifest:P,serverActionsManifest:_});let L=e.method||"GET",M=(0,o.getTracer)(),F=M.getActiveScopeSpan(),I={params:E,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,i)=>S.onRequestError(e,t,r,i,T)},sharedContext:{buildId:R}},$=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),V=u.NextRequestAdapter.fromNodeNextRequest($,(0,u.signalFromNodeResponse)(t));try{let n=async e=>S.handle(V,I).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=M.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${L} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${A}`)}),s=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var o,l;let u=async({previousCacheEntry:a})=>{try{if(!s&&C&&x&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await n(i);e.fetchMetrics=I.renderOpts.fetchMetrics;let l=I.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let u=I.renderOpts.collectedTags;if(!H)return await (0,p.sendResponse)($,K,o,I.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(o.headers);u&&(t[f.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==I.renderOpts.collectedRevalidate&&!(I.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&I.renderOpts.collectedRevalidate,r=void 0===I.renderOpts.collectedExpire||I.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:I.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await S.onRequestError(e,t,{routerKind:"App Router",routePath:A,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:C})},!1,T),t}},d=await S.handleResponse({req:e,nextConfig:w,cacheKey:j,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:x,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:s});if(!H)return null;if((null==d||null==(o=d.value)?void 0:o.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",C?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return s&&H||h.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,y.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)($,K,new Response(d.value.body,{headers:h,status:d.value.status||200})),null};F?await l(F):await M.withPropagatedContext(e.headers,()=>M.trace(d.BaseServerSpan.handleRequest,{spanName:`${L} ${A}`,kind:o.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},l))}catch(t){if(t instanceof h.NoFallbackError||await S.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:C})},!1,T),H)throw t;return await (0,p.sendResponse)($,K,new Response(null,{status:500})),null}}e.s(["handler",()=>_,"patchFetch",()=>P,"routeModule",()=>S,"serverHooks",()=>U,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>x],28355)},11072,e=>{e.v(t=>Promise.all(["server/chunks/src_lib_2622b1cd._.js","server/chunks/src_lib_security-detection_4bdbe3ad.js"].map(t=>e.l(t))).then(()=>t(74405)))}];

//# sourceMappingURL=_5bf7b147._.js.map