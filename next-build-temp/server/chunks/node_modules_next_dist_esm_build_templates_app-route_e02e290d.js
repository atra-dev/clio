module.exports=[69467,e=>{"use strict";var t=e.i(47909),i=e.i(74017),n=e.i(96250),a=e.i(59756),r=e.i(61916),s=e.i(74677),o=e.i(69741),d=e.i(16795),l=e.i(87718),c=e.i(95169),u=e.i(47587),m=e.i(66012),p=e.i(70101),h=e.i(26937),y=e.i(10372),v=e.i(93695);e.i(52474);var g=e.i(220),f=e.i(89171),R=e.i(98189),w=e.i(4381),A=e.i(45787),E=e.i(32307),I=e.i(33355),x=e.i(39552),S=e.i(72331),C=e.i(74405),N=e.i(22177),P=e.i(79120);function b(e,t){var i=f.NextResponse.json({message:e},{status:429});if(!t?.headers||"object"!=typeof t.headers)return i;for(let[e,n]of Object.entries(t.headers))i.headers.set(e,String(n));return i}async function M({request:e,session:t,scopePrefix:i,ipLimit:n=120,actorLimit:a=90}){let r=(0,w.enforceRateLimitByRequest)({request:e,scope:`${i}-ip`,limit:n,windowMs:3e5});if(!r.allowed)return await (0,P.logApiAudit)({request:e,module:"Incident Management",activityName:"Incident API rate-limited (IP)",status:"Rejected",sensitivity:"Sensitive",performedBy:t.email,metadata:{reason:"rate_limit_exceeded",scope:`${i}-ip`}}),b("Too many incident requests. Please retry shortly.",r);let s=(0,w.consumeRateLimit)({scope:`${i}-actor`,identifier:t.email,limit:a,windowMs:3e5});return s.allowed?null:(await (0,P.logApiAudit)({request:e,module:"Incident Management",activityName:"Incident API rate-limited (actor)",status:"Rejected",sensitivity:"Sensitive",performedBy:t.email,metadata:{reason:"rate_limit_exceeded",scope:`${i}-actor`}}),b("Too many incident requests for this account. Please retry shortly.",s))}function T(e){return String(e||"").trim().toLowerCase()}function U(e,t=""){return String(e||"").trim()||t}function q(e){return Array.isArray(e)?e:[]}function k(e){return String(e.headers.get("x-forwarded-for")||"").split(",").map(e=>e.trim()).find(Boolean)||String(e.headers.get("x-real-ip")||"").trim()||""}function _(e){let t=new Date(e||"").getTime();return Number.isNaN(t)?null:t}async function D(e){let t=await (0,R.authorizeApiRequest)(e,{requiredPermissions:["incident_management:view"],auditModule:"Incident Management",auditAction:"Incident records list request"});if(t.error)return t.error;let{session:i}=t,n=await M({request:e,session:i,scopePrefix:"incident-list",ipLimit:140,actorLimit:110});if(n)return n;(0,C.drainSecurityDetectionRetryQueue)({reason:"incident-list-get"}).catch(()=>null);try{var a;let t,n,r,s,o,d,l,c=T(e.nextUrl?.searchParams.get("q")),u=T(e.nextUrl?.searchParams.get("status")),m=T(e.nextUrl?.searchParams.get("severity")),p=T(e.nextUrl?.searchParams.get("incidentType")),h=T(e.nextUrl?.searchParams.get("escalationLevel")),y=T(e.nextUrl?.searchParams.get("regulatoryStatus")),v=(a=e.nextUrl?.searchParams.get("restrictedPii"),(t=T(a))&&"all"!==t?!!["yes","true","1","restricted","required"].includes(t)||!["no","false","0","not-required","none"].includes(t)&&null:null),g=(0,P.parsePositiveInt)(e.nextUrl?.searchParams.get("page"),1,{min:1,max:1e5}),R=(0,P.parsePositiveInt)(e.nextUrl?.searchParams.get("pageSize"),12,{min:1,max:200}),w=(await (0,A.listIncidentRecordsBackend)()).filter(e=>{let t=T(e?.status),i=T(e?.severity),n=T(e?.incidentType),a=T(e?.escalationLevel),r=T(e?.regulatoryStatus),s=!!e?.restrictedPiiInvolved,o=T([e?.incidentCode,e?.title,e?.summary,e?.incidentType,e?.severity,e?.status,e?.affectedEmployeeEmail,e?.department,Array.isArray(e?.involvedEmployees)?e.involvedEmployees.join(" "):e?.involvedEmployees,e?.ownerEmail,e?.escalationLevel,e?.regulatoryStatus].join(" ")),d=!c||o.includes(c),l=!u||"all"===u||t.includes(u),g=!m||"all"===m||i.includes(m),f=!p||"all"===p||n.includes(p),R=!h||"all"===h||a.includes(h),w=!y||"all"===y||r.includes(y);return d&&l&&g&&f&&R&&w&&(null===v||s===v)}),E=(n=Date.now(),r=0,s=0,o=0,d=0,l=0,w.forEach(e=>{let t=T(e?.status),i=T(e?.severity),a=T(e?.containmentStatus),c=!!e?.regulatoryNotificationRequired,u=_(e?.regulatoryNotifiedAt),m=_(e?.regulatoryDueAt);["resolved","closed"].includes(t)||(r+=1,"critical"===i&&(s+=1)),"contained"!==a&&(o+=1),c&&!Number.isFinite(u)&&Number.isFinite(m)&&(m<n?l+=1:m<=n+2592e5&&(d+=1))}),{total:w.length,openCases:r,criticalOpen:s,containmentPending:o,dueWithin72Hours:d,overdue72HourNotifications:l}),{data:I,pagination:x}=(0,P.paginateRows)(w,{page:g,pageSize:R}),S=I.map(e=>(0,P.enrichIncidentRecordForApi)(e));return await (0,P.logApiAudit)({request:e,module:"Incident Management",activityName:"Incident records listed",status:"Completed",sensitivity:"Sensitive",performedBy:i.email,metadata:{resultCount:S.length,totalMatched:w.length,viewedRecordRefs:S.slice(0,25).map(e=>({recordId:e.id,recordRef:(0,P.resolveAuditRecordRef)(e,e.id,["incidentCode","id"]),severity:e.severity||"",status:e.status||""})),hasFilters:!!(c||u&&"all"!==u||m&&"all"!==m||p&&"all"!==p||h&&"all"!==h||y&&"all"!==y||null!==v),auditNote:`Listed ${S.length} incident record(s) in current page window.`,nextAction:"No further action required."}}),f.NextResponse.json({records:S,pagination:x,summary:E})}catch(a){let t=a instanceof Error?a.message:"unknown_error",n=(0,P.mapBackendError)(t,"Unable to load incident records.");return await (0,P.logApiAudit)({request:e,module:"Incident Management",activityName:"Incident records list failed",status:"Failed",sensitivity:"Sensitive",performedBy:i.email,metadata:{reason:t}}),f.NextResponse.json({message:n.message},{status:n.status})}}async function O(e){let t=await (0,R.authorizeApiRequest)(e,{requiredPermissions:["incident_management:view"],auditModule:"Incident Management",auditAction:"Incident record create request"});if(t.error)return t.error;let{session:i}=t,n=await M({request:e,session:i,scopePrefix:"incident-create",ipLimit:50,actorLimit:35});if(n)return n;if((0,C.drainSecurityDetectionRetryQueue)({reason:"incident-create-post"}).catch(()=>null),!(0,E.hasPermission)(i.role,"incident_management:edit"))return await (0,P.logApiAudit)({request:e,module:"Incident Management",activityName:"Incident record create blocked by permission policy",status:"Rejected",sensitivity:"Sensitive",performedBy:i.email,metadata:{role:i.role}}),f.NextResponse.json({message:"Forbidden."},{status:403});try{let t=await (0,P.parseJsonBody)(e);Object.prototype.hasOwnProperty.call(t||{},"evidenceDocuments")&&(t.evidenceDocuments=await (0,S.validateIncidentEvidenceDocumentsStrict)(t.evidenceDocuments,{actorEmail:i.email}));let n=await (0,A.createIncidentRecordBackend)(t,i.email),a=Object.keys(t||{}),r=`/incident-management?incident=${encodeURIComponent(n.id)}`,s=(0,x.buildIncidentCreatedNotification)(n,n.id),o=await (0,I.resolveIncidentStakeholderRecipients)({ownerEmail:n.ownerEmail,affectedEmployeeEmail:n.affectedEmployeeEmail,actorEmail:i.email,includeAffectedEmployee:!0,includeActor:!1});await (0,I.createInAppNotificationsBulk)(o.map(e=>{var t;let a;return{recipientEmail:e,title:s.title,message:s.message,severity:(t=n.severity,a=String(t||"").trim().toLowerCase(),"critical"===a?"critical":"high"===a?"high":"low"===a?"low":"medium"),type:"incident-created",module:"Incident Management",actionUrl:r,status:"unread",createdBy:i.email,metadata:{incidentId:n.id,incidentCode:n.incidentCode||"",autoGenerated:!!n.autoGenerated}}}));let d=Array.from(new Set([...q(t?.alertSmsRecipients),...String(t?.alertSmsRecipient||"").split(",").map(e=>e.trim()).filter(Boolean)].map(e=>String(e||"").replace(/[^\d+]/g,"").trim()).filter(Boolean))),l=await (0,N.dispatchSecurityIncidentAlerts)({incident:{...n,actionUrl:r},detection:{ruleId:"MANUAL_INCIDENT_CREATE",severity:U(n?.severity,"Medium"),observedCount:1,windowMinutes:1,summary:U(n?.summary||n?.title,"Manual incident created")},sourceEvent:function({request:e,session:t,record:i}){return{id:U(i?.id||i?.recordId),module:"Incident Management",activityName:"Manual incident created",status:"Completed",occurredAt:new Date().toISOString(),performedBy:U(t?.email),requestMethod:e.method,requestPath:e.nextUrl?.pathname||"/api/hris/incidents",sourceIp:k(e),metadata:{sourceIp:k(e),requestPath:e.nextUrl?.pathname||"/api/hris/incidents",requestMethod:e.method}}}({request:e,session:i,record:n}),emailRecipients:o,smsRecipients:d});return await (0,A.updateIncidentRecordBackend)(n.id,{alertRecipients:o,alertDispatchSummary:l,lastAlertDispatchAt:new Date().toISOString(),externalIntegrations:{...n?.externalIntegrations||{},manualDispatch:!0}},i.email).catch(()=>null),await (0,P.logApiAudit)({request:e,module:"Incident Management",activityName:"Incident record created",status:"Approved",sensitivity:"Sensitive",performedBy:i.email,metadata:{recordId:n.id,recordRef:(0,P.resolveAuditRecordRef)(n,n.id,["incidentCode","id"]),incidentCode:n.incidentCode,severity:n.severity,status:n.status,restrictedPiiInvolved:!!n.restrictedPiiInvolved,changedFields:a,changedFieldCount:a.length,pushEmailStatus:U(l?.email?.status,"unknown"),pushSmsStatus:U(l?.sms?.status,"unknown"),pushWebhookStatus:U(l?.webhooks?.status,"unknown"),pushSmsRecipients:q(l?.smsRecipients).length,resourceType:"Incident Record",resourceLabel:n.title||n.incidentCode||n.id,auditNote:`Created incident with fields: ${(0,P.summarizeAuditFieldList)(a,"No explicit payload fields captured.")}.`,nextAction:"Run containment and impact assessment workflow."}}),f.NextResponse.json({ok:!0,record:(0,P.enrichIncidentRecordForApi)(n)},{status:201})}catch(a){let t=a instanceof Error?a.message:"unknown_error",n=(0,P.mapBackendError)(t,"Unable to create incident record.");return await (0,P.logApiAudit)({request:e,module:"Incident Management",activityName:"Incident record create failed",status:"Failed",sensitivity:"Sensitive",performedBy:i.email,metadata:{reason:t}}),f.NextResponse.json({message:n.message},{status:n.status})}}e.s(["GET",()=>D,"POST",()=>O],93123);var B=e.i(93123);let j=new t.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/hris/incidents/route",pathname:"/api/hris/incidents",filename:"route",bundlePath:""},distDir:"next-build-temp",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/hris/incidents/route.js",nextConfigOutput:"",userland:B}),{workAsyncStorage:L,workUnitAsyncStorage:F,serverHooks:H}=j;function $(){return(0,n.patchFetch)({workAsyncStorage:L,workUnitAsyncStorage:F})}async function K(e,t,n){j.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let f="/api/hris/incidents/route";f=f.replace(/\/index$/,"")||"/";let R=await j.prepare(e,t,{srcPage:f,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:w,params:A,nextConfig:E,parsedUrl:I,isDraftMode:x,prerenderManifest:S,routerServerContext:C,isOnDemandRevalidate:N,revalidateOnlyGenerated:P,resolvedPathname:b,clientReferenceManifest:M,serverActionsManifest:T}=R,U=(0,o.normalizeAppPath)(f),q=!!(S.dynamicRoutes[U]||S.routes[b]),k=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,I,!1):t.end("This page could not be found"),null);if(q&&!x){let e=!!S.routes[b],t=S.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await k();throw new v.NoFallbackError}}let _=null;!q||j.isDev||x||(_="/index"===(_=b)?"/":_);let D=!0===j.isDev||!q,O=q&&!D;T&&M&&(0,s.setManifestsSingleton)({page:f,clientReferenceManifest:M,serverActionsManifest:T});let B=e.method||"GET",L=(0,r.getTracer)(),F=L.getActiveScopeSpan(),H={params:A,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,i,n,a)=>j.onRequestError(e,t,n,a,C)},sharedContext:{buildId:w}},$=new d.NodeNextRequest(e),K=new d.NodeNextResponse(t),G=l.NextRequestAdapter.fromNodeNextRequest($,(0,l.signalFromNodeResponse)(t));try{let s=async e=>j.handle(G,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let i=L.getRootSpanAttributes();if(!i)return;if(i.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${i.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=i.get("next.route");if(n){let t=`${B} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${B} ${f}`)}),o=!!(0,a.getRequestMeta)(e,"minimalMode"),d=async a=>{var r,d;let l=async({previousCacheEntry:i})=>{try{if(!o&&N&&P&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await s(a);e.fetchMetrics=H.renderOpts.fetchMetrics;let d=H.renderOpts.pendingWaitUntil;d&&n.waitUntil&&(n.waitUntil(d),d=void 0);let l=H.renderOpts.collectedTags;if(!q)return await (0,m.sendResponse)($,K,r,H.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(r.headers);l&&(t[y.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let i=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,n=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:i,expire:n}}}}catch(t){throw(null==i?void 0:i.isStale)&&await j.onRequestError(e,t,{routerKind:"App Router",routePath:f,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:N})},!1,C),t}},c=await j.handleResponse({req:e,nextConfig:E,cacheKey:_,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:P,responseGenerator:l,waitUntil:n.waitUntil,isMinimalMode:o});if(!q)return null;if((null==c||null==(r=c.value)?void 0:r.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(d=c.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",N?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let v=(0,p.fromNodeOutgoingHttpHeaders)(c.value.headers);return o&&q||v.delete(y.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||v.get("Cache-Control")||v.set("Cache-Control",(0,h.getCacheControlHeader)(c.cacheControl)),await (0,m.sendResponse)($,K,new Response(c.value.body,{headers:v,status:c.value.status||200})),null};F?await d(F):await L.withPropagatedContext(e.headers,()=>L.trace(c.BaseServerSpan.handleRequest,{spanName:`${B} ${f}`,kind:r.SpanKind.SERVER,attributes:{"http.method":B,"http.target":e.url}},d))}catch(t){if(t instanceof v.NoFallbackError||await j.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:N})},!1,C),q)throw t;return await (0,m.sendResponse)($,K,new Response(null,{status:500})),null}}e.s(["handler",()=>K,"patchFetch",()=>$,"routeModule",()=>j,"serverHooks",()=>H,"workAsyncStorage",()=>L,"workUnitAsyncStorage",()=>F],69467)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_e02e290d.js.map