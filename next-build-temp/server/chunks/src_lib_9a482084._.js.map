{"version":3,"sources":["../../../src/lib/name-utils.js","../../../src/lib/invite-delivery.js"],"sourcesContent":["function normalizeNamePart(value) {\r\n  return String(value ?? \"\").trim();\r\n}\r\n\r\nfunction capitalizeWord(word) {\r\n  const value = normalizeNamePart(word).toLowerCase();\r\n  if (!value) {\r\n    return \"\";\r\n  }\r\n  return `${value.charAt(0).toUpperCase()}${value.slice(1)}`;\r\n}\r\n\r\nexport function formatNameFromEmail(email, { fallbackLabel = \"User\", maxTokens = 3 } = {}) {\r\n  const normalizedEmail = normalizeNamePart(email).toLowerCase();\r\n  const safeFallback = normalizeNamePart(fallbackLabel) || \"User\";\r\n  if (!normalizedEmail.includes(\"@\")) {\r\n    return safeFallback;\r\n  }\r\n\r\n  const localPart = normalizedEmail.split(\"@\")[0] || \"\";\r\n  const tokens = localPart\r\n    .split(/[._-]+/g)\r\n    .map((item) => capitalizeWord(item))\r\n    .filter(Boolean)\r\n    .slice(0, Math.max(1, Number.isFinite(maxTokens) ? maxTokens : 3));\r\n\r\n  if (tokens.length === 0) {\r\n    return safeFallback;\r\n  }\r\n\r\n  return tokens.join(\" \");\r\n}\r\n\r\nfunction formatNameBody({ firstName, middleName, lastName, order }) {\r\n  const normalizedFirstName = normalizeNamePart(firstName);\r\n  const normalizedMiddleName = normalizeNamePart(middleName);\r\n  const normalizedLastName = normalizeNamePart(lastName);\r\n\r\n  if (order === \"last-first\") {\r\n    const firstBlock = [normalizedFirstName, normalizedMiddleName].filter(Boolean).join(\" \");\r\n    if (normalizedLastName) {\r\n      return `${normalizedLastName}${firstBlock ? `, ${firstBlock}` : \"\"}`;\r\n    }\r\n    return firstBlock;\r\n  }\r\n\r\n  return [normalizedFirstName, normalizedMiddleName, normalizedLastName].filter(Boolean).join(\" \");\r\n}\r\n\r\nfunction resolveFallbackName({ fallback, fallbackEmail, fallbackLabel }) {\r\n  const directFallback = normalizeNamePart(fallback);\r\n  if (directFallback) {\r\n    return directFallback;\r\n  }\r\n\r\n  const email = normalizeNamePart(fallbackEmail);\r\n  if (email) {\r\n    return formatNameFromEmail(email, { fallbackLabel });\r\n  }\r\n\r\n  return normalizeNamePart(fallbackLabel) || \"User\";\r\n}\r\n\r\nexport function formatPersonName({\r\n  firstName,\r\n  middleName,\r\n  lastName,\r\n  suffix,\r\n  fallback = \"\",\r\n  fallbackEmail = \"\",\r\n  fallbackLabel = \"User\",\r\n} = {}) {\r\n  const body = formatNameBody({\r\n    firstName,\r\n    middleName,\r\n    lastName,\r\n    order: \"first-last\",\r\n  });\r\n  const normalizedSuffix = normalizeNamePart(suffix);\r\n  const fullName = [body, normalizedSuffix].filter(Boolean).join(\" \").trim();\r\n  if (fullName) {\r\n    return fullName;\r\n  }\r\n\r\n  return resolveFallbackName({\r\n    fallback,\r\n    fallbackEmail,\r\n    fallbackLabel,\r\n  });\r\n}\r\n\r\nexport function formatEmployeeName({\r\n  firstName,\r\n  middleName,\r\n  lastName,\r\n  suffix,\r\n  fallback = \"\",\r\n  fallbackEmail = \"\",\r\n  fallbackLabel = \"Employee\",\r\n} = {}) {\r\n  const body = formatNameBody({\r\n    firstName,\r\n    middleName,\r\n    lastName,\r\n    order: \"last-first\",\r\n  });\r\n  const normalizedSuffix = normalizeNamePart(suffix);\r\n  const fullName = [body, normalizedSuffix].filter(Boolean).join(\" \").trim();\r\n  if (fullName) {\r\n    return fullName;\r\n  }\r\n\r\n  return resolveFallbackName({\r\n    fallback,\r\n    fallbackEmail,\r\n    fallbackLabel,\r\n  });\r\n}\r\n","function normalizeEmailProvider(rawValue) {\r\n  const raw = String(rawValue || \"\")\r\n    .trim()\r\n    .toLowerCase();\r\n  if (!raw) {\r\n    return \"\";\r\n  }\r\n\r\n  if (raw === \"firebase\" || raw.includes(\"firebase\")) {\r\n    return \"firebase\";\r\n  }\r\n\r\n  if (raw === \"resend\" || raw.includes(\"resend\")) {\r\n    return \"resend\";\r\n  }\r\n\r\n  if (raw === \"console\" || raw === \"dev\" || raw.includes(\"console\")) {\r\n    return \"console\";\r\n  }\r\n\r\n  return raw;\r\n}\r\n\r\nfunction getEmailProvider() {\r\n  const configured = normalizeEmailProvider(process.env.CLIO_EMAIL_PROVIDER);\r\n  if (configured) {\r\n    return configured;\r\n  }\r\n\r\n  const hasResendConfig =\r\n    String(process.env.RESEND_API_KEY || \"\").trim().startsWith(\"re_\") &&\r\n    String(process.env.CLIO_EMAIL_FROM || \"\").trim().length > 0;\r\n  if (hasResendConfig) {\r\n    return \"resend\";\r\n  }\r\n\r\n  return \"firebase\";\r\n}\r\n\r\nfunction isConsoleEmailAllowed() {\r\n  return String(process.env.CLIO_ALLOW_CONSOLE_EMAIL || \"\")\r\n    .trim()\r\n    .toLowerCase() === \"true\";\r\n}\r\n\r\nfunction normalizeBaseUrl(value) {\r\n  const raw = String(value || \"\").trim();\r\n  if (!raw) {\r\n    return \"\";\r\n  }\r\n\r\n  if (raw.startsWith(\"http://\") || raw.startsWith(\"https://\")) {\r\n    return raw.replace(/\\/+$/, \"\");\r\n  }\r\n\r\n  return `https://${raw.replace(/^\\/+/, \"\").replace(/\\/+$/, \"\")}`;\r\n}\r\n\r\nfunction assertSafeProductionBaseUrl(baseUrl) {\r\n  if (process.env.NODE_ENV !== \"production\") {\r\n    return;\r\n  }\r\n\r\n  let parsed;\r\n  try {\r\n    parsed = new URL(baseUrl);\r\n  } catch {\r\n    throw new Error(\"app_base_url_not_configured\");\r\n  }\r\n\r\n  const hostname = String(parsed.hostname || \"\").trim().toLowerCase();\r\n  const isLocalHost =\r\n    hostname === \"localhost\" ||\r\n    hostname === \"127.0.0.1\" ||\r\n    hostname === \"::1\" ||\r\n    hostname.endsWith(\".local\");\r\n\r\n  if (isLocalHost) {\r\n    throw new Error(\"unsafe_app_base_url_for_production\");\r\n  }\r\n}\r\n\r\nfunction getAppBaseUrl({ requestOrigin } = {}) {\r\n  const requestOriginUrl = normalizeBaseUrl(requestOrigin);\r\n  const firebaseAuthDomain = normalizeBaseUrl(\r\n    process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN || process.env.FIREBASE_AUTH_DOMAIN,\r\n  );\r\n  const vercelUrl = normalizeBaseUrl(\r\n    process.env.VERCEL_PROJECT_PRODUCTION_URL || process.env.VERCEL_URL,\r\n  );\r\n  const configured = normalizeBaseUrl(process.env.CLIO_APP_BASE_URL);\r\n  const publicSiteUrl = normalizeBaseUrl(process.env.NEXT_PUBLIC_APP_URL);\r\n\r\n  const candidates =\r\n    process.env.NODE_ENV === \"production\"\r\n      ? [requestOriginUrl, configured, publicSiteUrl, vercelUrl, firebaseAuthDomain]\r\n      : [requestOriginUrl, configured, publicSiteUrl, firebaseAuthDomain, vercelUrl];\r\n\r\n  for (const candidate of candidates) {\r\n    if (!candidate) {\r\n      continue;\r\n    }\r\n    assertSafeProductionBaseUrl(candidate);\r\n    return candidate;\r\n  }\r\n\r\n  throw new Error(\"app_base_url_not_configured\");\r\n}\r\n\r\nfunction getLoginPath() {\r\n  const configured = String(process.env.CLIO_LOGIN_PATH || \"\").trim();\r\n  if (!configured) {\r\n    return \"/login\";\r\n  }\r\n  return configured.startsWith(\"/\") ? configured : `/${configured}`;\r\n}\r\n\r\nfunction getInviteVerifyPath() {\r\n  const configured = String(process.env.CLIO_INVITE_VERIFY_PATH || \"\").trim();\r\n  if (!configured) {\r\n    return \"/verify-invite\";\r\n  }\r\n  return configured.startsWith(\"/\") ? configured : `/${configured}`;\r\n}\r\n\r\nfunction buildLoginUrl(baseUrl) {\r\n  return `${baseUrl}${getLoginPath()}`;\r\n}\r\n\r\nfunction buildInviteVerificationUrl(inviteToken, baseUrl) {\r\n  const path = getInviteVerifyPath();\r\n  const token = String(inviteToken || \"\").trim();\r\n  if (!token) {\r\n    throw new Error(\"invalid_invite_token\");\r\n  }\r\n  return `${baseUrl}${path}?token=${encodeURIComponent(token)}`;\r\n}\r\n\r\nfunction isDevelopmentPreviewEnabled() {\r\n  return process.env.NODE_ENV !== \"production\";\r\n}\r\n\r\nfunction escapeHtml(value) {\r\n  return String(value || \"\")\r\n    .replaceAll(\"&\", \"&amp;\")\r\n    .replaceAll(\"<\", \"&lt;\")\r\n    .replaceAll(\">\", \"&gt;\")\r\n    .replaceAll('\"', \"&quot;\")\r\n    .replaceAll(\"'\", \"&#39;\");\r\n}\r\n\r\nfunction buildEmailContent({ role, invitedBy, verifyUrl, loginUrl, expiresAt }) {\r\n  const expirationDate = new Date(expiresAt);\r\n  const readableExpiration = Number.isNaN(expirationDate.getTime())\r\n    ? expiresAt\r\n    : expirationDate.toLocaleString(\"en-US\", {\r\n        month: \"short\",\r\n        day: \"2-digit\",\r\n        year: \"numeric\",\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\",\r\n      });\r\n\r\n  const roleText = String(role || \"Employee\").trim() || \"Employee\";\r\n  const invitedByText = String(invitedBy || \"CLIO Administrator\").trim() || \"CLIO Administrator\";\r\n  const brandDomain = String(process.env.CLIO_EMAIL_BRAND_DOMAIN || \"cisoasaservice.io\").trim() || \"cisoasaservice.io\";\r\n  const safeRole = escapeHtml(roleText);\r\n  const safeInvitedBy = escapeHtml(invitedByText);\r\n  const safeVerifyUrl = escapeHtml(verifyUrl);\r\n  const safeLoginUrl = escapeHtml(loginUrl);\r\n  const safeReadableExpiration = escapeHtml(readableExpiration);\r\n  const safeBrandDomain = escapeHtml(brandDomain);\r\n\r\n  const subject = \"You're invited to verify your email and open your Clio account\";\r\n  const text = [\r\n    \"You have been invited to Clio Secured HRIS.\",\r\n    \"\",\r\n    \"To open your account, please verify your email first.\",\r\n    `Verify your Clio account: ${verifyUrl}`,\r\n    `Sign in after verification: ${loginUrl}`,\r\n    \"\",\r\n    `Assigned role: ${roleText}`,\r\n    `Invited by: ${invitedByText}`,\r\n    `Invitation expires: ${readableExpiration}`,\r\n    \"\",\r\n    \"For security, complete SMS OTP after email verification.\",\r\n    \"Use the same invited work email when signing in.\",\r\n    \"\",\r\n    `Domain: ${brandDomain}`,\r\n  ].join(\"\\n\");\r\n\r\n  return {\r\n    subject,\r\n    text,\r\n    html: [\r\n      \"<div style=\\\"font-family:Arial,sans-serif;line-height:1.6;color:#0f172a;max-width:620px\\\">\",\r\n      \"<p style=\\\"margin:0 0 12px 0\\\">Hello,</p>\",\r\n      \"<p style=\\\"margin:0 0 12px 0\\\">You have been invited to <strong>Clio Secured HRIS</strong>.</p>\",\r\n      \"<p style=\\\"margin:0 0 16px 0\\\">To open your account, please verify your email and complete secure onboarding.</p>\",\r\n      `<p style=\"margin:0 0 16px 0\"><a href=\"${safeVerifyUrl}\" style=\"display:inline-block;background:#0f6bcf;color:#ffffff;text-decoration:none;padding:10px 18px;border-radius:10px;font-weight:600\">Verify Clio Account</a></p>`,\r\n      `<p style=\"margin:0 0 12px 0\"><strong>Assigned role:</strong> ${safeRole}<br/>`,\r\n      `<strong>Invited by:</strong> ${safeInvitedBy}<br/>`,\r\n      `<strong>Invitation expires:</strong> ${safeReadableExpiration}</p>`,\r\n      `<p style=\"margin:0 0 12px 0\">After verification, sign in here: <a href=\"${safeLoginUrl}\">${safeLoginUrl}</a></p>`,\r\n      `<p style=\"margin:0 0 12px 0\">For security, complete SMS OTP after email verification and use the same invited work email.</p>`,\r\n      `<p style=\"margin:0;color:#475569;font-size:12px\">This invitation is intended for authorized recipients of ${safeBrandDomain}.</p>`,\r\n      \"</div>\",\r\n    ].join(\"\"),\r\n  };\r\n}\r\n\r\nfunction parseFirebaseAuthError(payload) {\r\n  const code = String(payload?.error?.message || \"\").trim();\r\n  if (!code) {\r\n    return \"email_delivery_failed\";\r\n  }\r\n  if (code === \"OPERATION_NOT_ALLOWED\") {\r\n    return \"firebase_email_provider_not_enabled\";\r\n  }\r\n  if (code === \"MISSING_CONTINUE_URI\" || code === \"INVALID_CONTINUE_URI\") {\r\n    return \"firebase_continue_url_invalid\";\r\n  }\r\n  if (code === \"INVALID_EMAIL\") {\r\n    return \"invalid_email\";\r\n  }\r\n  if (code === \"PROJECT_NOT_FOUND\" || code === \"API_KEY_INVALID\") {\r\n    return \"firebase_api_key_not_configured\";\r\n  }\r\n  return \"email_delivery_failed\";\r\n}\r\n\r\nasync function sendViaFirebaseAuth({ toEmail, verifyUrl }) {\r\n  const apiKey = String(process.env.NEXT_PUBLIC_FIREBASE_API_KEY || \"\").trim();\r\n  if (!apiKey) {\r\n    throw new Error(\"firebase_api_key_not_configured\");\r\n  }\r\n\r\n  const response = await fetch(`https://identitytoolkit.googleapis.com/v1/accounts:sendOobCode?key=${apiKey}`, {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    body: JSON.stringify({\r\n      requestType: \"EMAIL_SIGNIN\",\r\n      email: toEmail,\r\n      continueUrl: verifyUrl,\r\n      canHandleCodeInApp: true,\r\n    }),\r\n  });\r\n\r\n  const payload = await response.json().catch(() => ({}));\r\n  if (!response.ok) {\r\n    throw new Error(parseFirebaseAuthError(payload));\r\n  }\r\n\r\n  return {\r\n    provider: \"firebase\",\r\n    status: \"sent\",\r\n    messageId: `firebase-${Date.now()}`,\r\n  };\r\n}\r\n\r\nasync function sendViaResend({ toEmail, subject, html, text }) {\r\n  const apiKey = String(process.env.RESEND_API_KEY || \"\").trim();\r\n  const fromAddress = String(process.env.CLIO_EMAIL_FROM || \"\").trim();\r\n  if (!apiKey || !fromAddress || !apiKey.startsWith(\"re_\")) {\r\n    throw new Error(\"email_provider_not_configured\");\r\n  }\r\n\r\n  const response = await fetch(\"https://api.resend.com/emails\", {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: `Bearer ${apiKey}`,\r\n    },\r\n    body: JSON.stringify({\r\n      from: fromAddress,\r\n      to: [toEmail],\r\n      subject,\r\n      html,\r\n      text,\r\n    }),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const payload = await response.json().catch(() => ({}));\r\n    const providerMessage =\r\n      typeof payload?.message === \"string\"\r\n        ? payload.message\r\n        : typeof payload?.error?.message === \"string\"\r\n          ? payload.error.message\r\n          : \"\";\r\n    throw new Error(\r\n      providerMessage ? `email_delivery_failed:${providerMessage}` : \"email_delivery_failed\",\r\n    );\r\n  }\r\n\r\n  const payload = await response.json().catch(() => ({}));\r\n  return {\r\n    provider: \"resend\",\r\n    status: \"sent\",\r\n    messageId: typeof payload?.id === \"string\" ? payload.id : `resend-${Date.now()}`,\r\n  };\r\n}\r\n\r\nfunction sendViaConsole({ toEmail, subject, verifyUrl, loginUrl }) {\r\n  const messageId = `console-${Date.now()}`;\r\n  if (isDevelopmentPreviewEnabled()) {\r\n    console.info(\"[CLIO:InviteEmail]\", {\r\n      toEmail,\r\n      subject,\r\n      verifyUrl,\r\n      loginUrl,\r\n      messageId,\r\n    });\r\n  }\r\n\r\n  return {\r\n    provider: \"console\",\r\n    status: \"simulated\",\r\n    messageId,\r\n    previewUrl: verifyUrl,\r\n    loginUrl,\r\n  };\r\n}\r\n\r\nexport async function deliverInviteEmail({\r\n  toEmail,\r\n  role,\r\n  invitedBy,\r\n  expiresAt,\r\n  inviteToken,\r\n  requestOrigin = \"\",\r\n}) {\r\n  const baseUrl = getAppBaseUrl({ requestOrigin });\r\n  const verifyUrl = buildInviteVerificationUrl(inviteToken, baseUrl);\r\n  const loginUrl = buildLoginUrl(baseUrl);\r\n  const content = buildEmailContent({\r\n    role,\r\n    invitedBy,\r\n    verifyUrl,\r\n    loginUrl,\r\n    expiresAt,\r\n  });\r\n  const provider = getEmailProvider();\r\n\r\n  if (provider === \"firebase\") {\r\n    return await sendViaFirebaseAuth({\r\n      toEmail,\r\n      verifyUrl,\r\n    });\r\n  }\r\n\r\n  if (provider === \"resend\") {\r\n    return await sendViaResend({\r\n      toEmail,\r\n      subject: content.subject,\r\n      html: content.html,\r\n      text: content.text,\r\n    });\r\n  }\r\n\r\n  if (provider === \"console\") {\r\n    if (!isConsoleEmailAllowed()) {\r\n      throw new Error(\"email_provider_not_configured\");\r\n    }\r\n\r\n    return sendViaConsole({\r\n      toEmail,\r\n      subject: content.subject,\r\n      verifyUrl,\r\n      loginUrl,\r\n    });\r\n  }\r\n\r\n  throw new Error(\"unsupported_email_provider\");\r\n}\r\n"],"names":[],"mappings":"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"}