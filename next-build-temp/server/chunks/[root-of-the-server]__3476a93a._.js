module.exports=[79120,e=>{"use strict";var t=e.i(89171),i=e.i(32307),r=e.i(96864);let n=["SUPER_ADMIN","GRC","HR","EA"];function a(e){return String(e||"").trim().toLowerCase()}function s(e,{start:t=2,end:i=2,fallback:r="Masked"}={}){let n=String(e||"").trim();return n?n.length<=t+i?`${n.slice(0,1)}***`:`${n.slice(0,t)}***${n.slice(n.length-i)}`:r}function o(e){return String(e||"").trim().toUpperCase().startsWith("EMPLOYEE_")}function c(e){return Array.isArray(e)?e:[]}function l(e,t={}){return e&&"object"==typeof e&&!Array.isArray(e)?e:t}function d(e,t=""){return String(e||"").trim()||t}function u(e,t=0){let i=Number(e);return Number.isFinite(i)?i:t}function m(e,{lowercase:t=!1}={}){return(Array.isArray(e)?e:"string"==typeof e?e.split(","):[]).map(e=>String(e||"").trim()).filter(Boolean).map(e=>t?e.toLowerCase():e)}function p(e){let t=l(e,{}),i=m(t.involvedEmployees,{lowercase:!0}),r=m(t.alertRecipients,{lowercase:!0}),n=c(t.evidenceDocuments).map((e,t)=>{let i=l(e,{});return{id:d(i.id||`${t+1}`),name:d(i.name,"Incident Evidence"),type:d(i.type,"Incident Evidence"),ref:d(i.ref),storagePath:d(i.storagePath),contentType:d(i.contentType),fileExtension:d(i.fileExtension),sizeBytes:u(i.sizeBytes,0),uploadedAt:d(i.uploadedAt),uploadedBy:d(i.uploadedBy).toLowerCase()}}),a=Math.max(n.length,u(t.evidenceDocumentsCount,n.length)),s=c(t.traceability).map(e=>l(e,{})),o=l(t.forensicSummary,{}),p=l(t.forensicSnapshot,{}),v=l(t.alertDispatchSummary,{}),f=l(t.externalIntegrations,{}),y={...t,incidentCode:d(t.incidentCode),title:d(t.title),summary:d(t.summary),incidentType:d(t.incidentType),severity:d(t.severity),status:d(t.status),ownerEmail:d(t.ownerEmail).toLowerCase(),affectedEmployeeEmail:d(t.affectedEmployeeEmail).toLowerCase(),department:d(t.department),involvedEmployees:i,escalationLevel:d(t.escalationLevel),containmentStatus:d(t.containmentStatus),impactAssessmentStatus:d(t.impactAssessmentStatus),regulatoryStatus:d(t.regulatoryStatus),detectedAt:d(t.detectedAt),resolvedAt:d(t.resolvedAt),closedAt:d(t.closedAt),createdAt:d(t.createdAt),updatedAt:d(t.updatedAt),createdBy:d(t.createdBy).toLowerCase(),updatedBy:d(t.updatedBy).toLowerCase(),alertDescription:d(t.alertDescription),alertOccurrenceCount:Math.max(1,u(t.alertOccurrenceCount,1)),alertFirstObservedAt:d(t.alertFirstObservedAt),alertLastObservedAt:d(t.alertLastObservedAt),alertRecipients:r,alertDispatchSummary:v,externalIntegrations:f,forensicSummary:o,forensicSnapshot:p,evidenceDocuments:n,evidenceDocumentsCount:a,traceability:s},_={caseProfile:{id:d(y.id),recordId:d(y.recordId),incidentCode:y.incidentCode,title:y.title,summary:y.summary,incidentType:y.incidentType,severity:y.severity,status:y.status,restrictedPiiInvolved:!!t.restrictedPiiInvolved,breachConfirmed:!!t.breachConfirmed},ownership:{ownerEmail:y.ownerEmail,affectedEmployeeEmail:y.affectedEmployeeEmail,department:y.department,involvedEmployees:y.involvedEmployees},handling:{escalationRequired:!!t.escalationRequired,escalationLevel:y.escalationLevel,containmentStatus:y.containmentStatus,containmentSummary:d(t.containmentSummary),impactAssessmentStatus:y.impactAssessmentStatus,impactSummary:d(t.impactSummary),executiveNotificationRequired:!!t.executiveNotificationRequired},compliance:{regulatoryNotificationRequired:!!t.regulatoryNotificationRequired,regulatoryStatus:y.regulatoryStatus,regulatoryDueAt:d(t.regulatoryDueAt),regulatoryNotifiedAt:d(t.regulatoryNotifiedAt),affectedIndividualsNotifiedAt:d(t.affectedIndividualsNotifiedAt),documentationRetained:!!t.documentationRetained,documentationRetainedAt:d(t.documentationRetainedAt),documentationLocation:d(t.documentationLocation),classificationStandard:d(t.classificationStandard)},timeline:{detectedAt:y.detectedAt,grcAlertedAt:d(t.grcAlertedAt),executiveNotifiedAt:d(t.executiveNotifiedAt),resolvedAt:y.resolvedAt,closedAt:y.closedAt,createdAt:y.createdAt,updatedAt:y.updatedAt},evidence:{count:y.evidenceDocumentsCount,documents:y.evidenceDocuments,notes:d(t.notes),correctiveActions:d(t.correctiveActions),disciplinaryActions:d(t.disciplinaryActions),resolutionNotes:d(t.resolutionNotes)},alerting:{description:y.alertDescription,occurrences:y.alertOccurrenceCount,firstObservedAt:y.alertFirstObservedAt,lastObservedAt:y.alertLastObservedAt,recipients:y.alertRecipients,dispatchSummary:y.alertDispatchSummary,lastAlertDispatchAt:d(t.lastAlertDispatchAt)},forensic:{windowStart:d(t.forensicWindowStart),windowEnd:d(t.forensicWindowEnd),summary:y.forensicSummary,snapshot:y.forensicSnapshot},audit:{traceability:y.traceability,createdBy:y.createdBy,updatedBy:y.updatedBy}};return{...y,details:_}}function v(e,t,{min:i=1,max:r=1e3}={}){let n=Number.parseInt(String(e||""),10);return Number.isFinite(n)?Math.min(r,Math.max(i,n)):t}function f(e,{page:t=1,pageSize:i=20}={}){let r=v(t,1,{min:1,max:1e5}),n=v(i,20,{min:1,max:200}),a=e.length,s=Math.max(1,Math.ceil(a/n)),o=Math.min(r,s),c=(o-1)*n;return{data:e.slice(c,c+n),pagination:{page:o,pageSize:n,total:a,totalPages:s}}}async function y(e){try{let t=await e.json();return t&&"object"==typeof t?t:{}}catch{throw Error("invalid_json_body")}}function _(e="Record not found."){return t.NextResponse.json({message:e},{status:404})}function g({session:e,requestedOwnerEmail:t,fallbackOwnerEmail:i}){if(!e||!o(e.role))return a(t||i)||null;let r=a(e.email);if(!r)throw Error("employee_session_email_missing");return r}function w(e,t){if(!e||"object"!=typeof e||(0,i.hasPermission)(t,"employees:view:sensitive"))return e;let r=e.governmentIds&&"object"==typeof e.governmentIds?Object.entries(e.governmentIds).reduce((e,[t,i])=>(e[t]=s(i,{start:2,end:2}),e),{}):{},n=e.payrollInformation&&"object"==typeof e.payrollInformation?Object.keys(e.payrollInformation).reduce((e,t)=>(e[t]="Restricted",e),{}):{};return{...e,govId:s(e.govId,{start:2,end:2}),governmentIds:r,payrollInformation:n}}function A({session:e,ownerEmail:t,ownerBypassRoles:r=n}){let s=a(t);return!!s&&(0,i.canAccessResource)({role:e.role,actorIdentifier:e.email,ownerIdentifier:s,allowRoles:r})}function h({role:e,editPermission:t,selfEditPermission:r,isSelfResource:n}){return!!((0,i.hasPermission)(e,t)||n&&r&&(0,i.hasPermission)(e,r))}function b(e,t){switch(String(e||"").trim()){case"invalid_json_body":return{status:400,message:"Invalid request payload."};case"invalid_record_id":return{status:400,message:"Invalid record identifier."};case"invalid_employee_email":return{status:400,message:"Employee email is required."};case"employee_account_not_found":return{status:409,message:"No user account found for this employee email. Invite or activate the user account first."};case"invalid_target_role":return{status:400,message:"Target role is required and must be a valid system role."};case"forbidden_target_role":return{status:403,message:"Target role assignment is not allowed by lifecycle permission policy."};case"role_sync_failed":return{status:409,message:"Employee user account was not found. Invite or activate the account before applying role changes."};case"approval_required":return{status:409,message:"Workflow approval chain must be completed before setting this status."};case"invalid_workflow_action":return{status:400,message:"Invalid workflow action payload."};case"invalid_approval_decision":return{status:400,message:"Approval decision must be approve or reject."};case"no_pending_approval_step":return{status:409,message:"No pending approval step remains for this workflow."};case"approval_not_allowed_for_role":return{status:403,message:"Current role is not allowed to approve the active step."};case"lifecycle_required_evidence_missing":return{status:409,message:"Required supporting documents are missing for this lifecycle category. Attach all required evidence before setting final status."};case"invalid_template_name":return{status:400,message:"Template name is required."};case"invalid_export_dataset":return{status:400,message:"Export dataset is required."};case"invalid_incident_title":return{status:400,message:"Incident title is required."};case"invalid_incident_evidence_payload":return{status:400,message:"Incident evidence payload must be a valid document array."};case"invalid_incident_evidence_name":return{status:400,message:"Incident evidence file name is required."};case"invalid_incident_evidence_reference":return{status:400,message:"Incident evidence must include a valid file reference."};case"invalid_incident_evidence_extension":return{status:400,message:"Incident evidence file extension is not allowed."};case"invalid_incident_evidence_content_type":return{status:400,message:"Incident evidence MIME type is not allowed."};case"invalid_incident_evidence_size":return{status:400,message:"Incident evidence file size exceeds the allowed limit."};case"incident_evidence_av_not_configured":return{status:503,message:"Evidence security scan provider is not configured."};case"incident_evidence_av_hook_failed":return{status:502,message:"Evidence security scan failed. Retry after security provider is available."};case"incident_evidence_av_blocked":return{status:403,message:"Evidence file blocked by malware/security policy scan."};case"invalid_reference_kind":return{status:400,message:"Reference type is invalid."};case"invalid_reference_label":return{status:400,message:"Reference label is required and must be within the allowed length."};case"invalid_retention_module":return{status:400,message:"Retention module filter is invalid."};case"invalid_purge_confirmation":return{status:400,message:"Invalid purge confirmation phrase."};case"duplicate_reference_value":return{status:409,message:"Reference value already exists."};case"immutable_reference_item":return{status:403,message:"System reference values cannot be removed."};case"access_revocation_failed":return{status:409,message:"Access revocation could not be confirmed for this employee account. Retry offboarding or review account status."};case"account_activation_failed":return{status:409,message:"Account activation could not be confirmed for this employee account."};case"email_provider_not_configured":return{status:502,message:"Email provider is not configured. Set CLIO_EMAIL_PROVIDER=firebase and configure Firebase Authentication email template/SMTP settings."};case"firebase_api_key_not_configured":return{status:502,message:"Firebase API key is not configured. Set NEXT_PUBLIC_FIREBASE_API_KEY."};case"firebase_email_provider_not_enabled":return{status:502,message:"Firebase email-link provider is not enabled. Enable Email link (passwordless sign-in) in Firebase Authentication."};case"firebase_continue_url_invalid":return{status:502,message:"Firebase continue URL is invalid. Check NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN (or CLIO_APP_BASE_URL override) and authorize the domain in Firebase Authentication."};case"unsafe_app_base_url_for_production":return{status:502,message:"Invite base URL is unsafe for production (localhost). Remove CLIO_APP_BASE_URL/NEXT_PUBLIC_APP_URL localhost overrides and use NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN."};case"unsupported_email_provider":return{status:502,message:"Unsupported email provider configuration."};case"email_delivery_failed":return{status:502,message:"Unable to deliver invite email."};case"firestore_not_configured":return{status:503,message:"Database is not configured. Set Firebase environment variables and restart the app."};case"firestore_operation_failed":return{status:503,message:"Database operation failed. Retry after Firestore is available."};case"employee_session_email_missing":return{status:401,message:"Session is invalid. Sign in again."};default:return{status:400,message:t||"Unable to process request."}}}function I(e){return String(e||"").trim()}function E(e){return null==e?null:Array.isArray(e)?e.map(e=>E(e)):"object"==typeof e?Object.keys(e).sort().reduce((t,i)=>(t[i]=E(e[i]),t),{}):"string"==typeof e?e.trim():e}function S(e,t,i=[]){return(Array.isArray(i)?i:[]).filter(i=>{var r,n;return r=e?.[i],n=t?.[i],JSON.stringify(E(r))!==JSON.stringify(E(n))})}function x(e,t=[]){if(!e||"object"!=typeof e)return[];let i=new Set((Array.isArray(t)?t:[]).map(e=>I(e)));return Object.keys(e).filter(e=>!i.has(e)).sort()}function R(e,t="",i=[]){let r=Array.isArray(i)?i:[],n=[e?.employeeId,e?.workflowId,e?.lifecycleId,e?.templateId,e?.exportId,e?.id,t];for(let t of r){let i=I(e?.[t]);if(i)return i}for(let e of n){let t=I(e);if(t)return t}return"N/A"}function L(e=[],t="No field details recorded."){let i=c(e).map(e=>I(e)).filter(Boolean);return 0===i.length?t:i.join(", ")}async function N({request:e,module:t,activityName:i,status:n="Completed",sensitivity:a="Sensitive",performedBy:s="system@gmail.com",metadata:o}){let c="true"===process.env.CLIO_AUDIT_ASYNC||"false"!==process.env.CLIO_AUDIT_ASYNC&&!1,l=(0,r.recordAuditEvent)({activityName:i,status:n,module:t,performedBy:s,sensitivity:a,metadata:o,request:e}).catch(()=>null);c||await l}e.s(["canActorAccessOwner",()=>A,"canActorEditModule",()=>h,"enrichIncidentRecordForApi",()=>p,"getSelfRestrictedOwnerEmail",()=>g,"isEmployeeRole",()=>o,"logApiAudit",()=>N,"mapBackendError",()=>b,"normalizeEmail",()=>a,"notFound",()=>_,"paginateRows",()=>f,"parseJsonBody",()=>y,"parsePositiveInt",()=>v,"resolveAuditChangedFields",()=>S,"resolveAuditRecordRef",()=>R,"resolveAuditViewedFields",()=>x,"sanitizeEmployeeRecordForViewer",()=>w,"summarizeAuditFieldList",()=>L])},35110,e=>{"use strict";function t(e){let t=String(e||"").trim();return t?t.startsWith("http://")||t.startsWith("https://")?t.replace(/\/+$/,""):`https://${t.replace(/^\/+/,"").replace(/\/+$/,"")}`:""}function i(e){return String(e||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}async function r({toEmail:e,verifyUrl:t}){let i=String("AIzaSyC-mWz29cK_wjvDsjhgbwYLAuJeygPohOI").trim();if(!i)throw Error("firebase_api_key_not_configured");let r=await fetch(`https://identitytoolkit.googleapis.com/v1/accounts:sendOobCode?key=${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requestType:"EMAIL_SIGNIN",email:e,continueUrl:t,canHandleCodeInApp:!0})}),n=await r.json().catch(()=>({}));if(!r.ok){let e;throw Error((e=String(n?.error?.message||"").trim())?"OPERATION_NOT_ALLOWED"===e?"firebase_email_provider_not_enabled":"MISSING_CONTINUE_URI"===e||"INVALID_CONTINUE_URI"===e?"firebase_continue_url_invalid":"INVALID_EMAIL"===e?"invalid_email":"PROJECT_NOT_FOUND"===e||"API_KEY_INVALID"===e?"firebase_api_key_not_configured":"email_delivery_failed":"email_delivery_failed")}return{provider:"firebase",status:"sent",messageId:`firebase-${Date.now()}`}}async function n({toEmail:e,subject:t,html:i,text:r}){let n=String(process.env.RESEND_API_KEY||"").trim(),a=String(process.env.CLIO_EMAIL_FROM||"").trim();if(!n||!a||!n.startsWith("re_"))throw Error("email_provider_not_configured");let s=await fetch("https://api.resend.com/emails",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({from:a,to:[e],subject:t,html:i,text:r})});if(!s.ok){let e=await s.json().catch(()=>({})),t="string"==typeof e?.message?e.message:"string"==typeof e?.error?.message?e.error.message:"";throw Error(t?`email_delivery_failed:${t}`:"email_delivery_failed")}let o=await s.json().catch(()=>({}));return{provider:"resend",status:"sent",messageId:"string"==typeof o?.id?o.id:`resend-${Date.now()}`}}async function a({toEmail:e,role:a,invitedBy:s,expiresAt:o,inviteToken:c,requestOrigin:l=""}){let d,u,m,p=function({requestOrigin:e}={}){let i=t(e),r=t("atracaas-platform-1fbeb.firebaseapp.com"),n=t(process.env.VERCEL_PROJECT_PRODUCTION_URL||process.env.VERCEL_URL);for(let e of[i,t(process.env.CLIO_APP_BASE_URL),t(process.env.NEXT_PUBLIC_APP_URL),n,r])if(e)return!function(e){let t;try{t=new URL(e)}catch{throw Error("app_base_url_not_configured")}let i=String(t.hostname||"").trim().toLowerCase();if("localhost"===i||"127.0.0.1"===i||"::1"===i||i.endsWith(".local"))throw Error("unsafe_app_base_url_for_production")}(e),e;throw Error("app_base_url_not_configured")}({requestOrigin:l}),v=function(e,t){let i,r=(i=String(process.env.CLIO_INVITE_VERIFY_PATH||"").trim())?i.startsWith("/")?i:`/${i}`:"/verify-invite",n=String(e||"").trim();if(!n)throw Error("invalid_invite_token");return`${t}${r}?token=${encodeURIComponent(n)}`}(c,p),f=`${p}${!(m=String(process.env.CLIO_LOGIN_PATH||"").trim())?"/login":m.startsWith("/")?m:`/${m}`}`,y=function({role:e,invitedBy:t,verifyUrl:r,loginUrl:n,expiresAt:a}){let s=new Date(a),o=Number.isNaN(s.getTime())?a:s.toLocaleString("en-US",{month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),c=String(e||"Employee").trim()||"Employee",l=String(t||"CLIO Administrator").trim()||"CLIO Administrator",d=String(process.env.CLIO_EMAIL_BRAND_DOMAIN||"cisoasaservice.io").trim()||"cisoasaservice.io",u=i(c),m=i(l),p=i(r),v=i(n),f=i(o),y=i(d);return{subject:"You're invited to verify your email and open your Clio account",text:`You have been invited to Clio Secured HRIS.

To open your account, please verify your email first.
Verify your Clio account: ${r}
Sign in after verification: ${n}

Assigned role: ${c}
Invited by: ${l}
Invitation expires: ${o}

For security, complete SMS OTP after email verification.
Use the same invited work email when signing in.

Domain: ${d}`,html:`<div style="font-family:Arial,sans-serif;line-height:1.6;color:#0f172a;max-width:620px"><p style="margin:0 0 12px 0">Hello,</p><p style="margin:0 0 12px 0">You have been invited to <strong>Clio Secured HRIS</strong>.</p><p style="margin:0 0 16px 0">To open your account, please verify your email and complete secure onboarding.</p><p style="margin:0 0 16px 0"><a href="${p}" style="display:inline-block;background:#0f6bcf;color:#ffffff;text-decoration:none;padding:10px 18px;border-radius:10px;font-weight:600">Verify Clio Account</a></p><p style="margin:0 0 12px 0"><strong>Assigned role:</strong> ${u}<br/><strong>Invited by:</strong> ${m}<br/><strong>Invitation expires:</strong> ${f}</p><p style="margin:0 0 12px 0">After verification, sign in here: <a href="${v}">${v}</a></p><p style="margin:0 0 12px 0">For security, complete SMS OTP after email verification and use the same invited work email.</p><p style="margin:0;color:#475569;font-size:12px">This invitation is intended for authorized recipients of ${y}.</p></div>`}}({role:a,invitedBy:s,verifyUrl:v,loginUrl:f,expiresAt:o}),_=(u=(d=String(process.env.CLIO_EMAIL_PROVIDER||"").trim().toLowerCase())?"firebase"===d||d.includes("firebase")?"firebase":"resend"===d||d.includes("resend")?"resend":"console"===d||"dev"===d||d.includes("console")?"console":d:"")||(String(process.env.RESEND_API_KEY||"").trim().startsWith("re_")&&String(process.env.CLIO_EMAIL_FROM||"").trim().length>0?"resend":"firebase");if("firebase"===_)return await r({toEmail:e,verifyUrl:v});if("resend"===_)return await n({toEmail:e,subject:y.subject,html:y.html,text:y.text});if("console"===_){if("true"!==String(process.env.CLIO_ALLOW_CONSOLE_EMAIL||"").trim().toLowerCase())throw Error("email_provider_not_configured");return function({toEmail:e,subject:t,verifyUrl:i,loginUrl:r}){return{provider:"console",status:"simulated",messageId:`console-${Date.now()}`,previewUrl:i,loginUrl:r}}({toEmail:e,subject:y.subject,verifyUrl:v,loginUrl:f})}throw Error("unsupported_email_provider")}e.s(["deliverInviteEmail",()=>a])},70406,(e,t,i)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,i)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,i)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,i)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,i)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,i)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,i)=>{t.exports=e.x("util",()=>require("util"))},66680,(e,t,i)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},2157,(e,t,i)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},50227,(e,t,i)=>{t.exports=e.x("node:path",()=>require("node:path"))},54799,(e,t,i)=>{t.exports=e.x("crypto",()=>require("crypto"))},98189,32307,e=>{"use strict";var t=e.i(89171),i=e.i(59979),r=e.i(81215),n=e.i(28221);let a={SUPER_ADMIN:["*"],GRC:["dashboard:view","employees:view","employees:edit","employees:view:sensitive","lifecycle:view","lifecycle:edit","lifecycle:approve","attendance:view","attendance:edit","attendance:approve","performance:view","performance:edit","performance:approve","templates:view","templates:edit","exports:view","exports:manage","exports:approve","exports:request","activity_log:export","activity_log:view","audit:view","access_management:view","retention_archive:view","retention_archive:manage","incident_management:view","incident_management:edit","user_management:view","user_management:manage","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],HR:["dashboard:view","employees:view","employees:edit","employees:view:sensitive","lifecycle:view","lifecycle:edit","lifecycle:approve","attendance:view","attendance:edit","attendance:approve","performance:view","performance:edit","performance:approve","templates:view","templates:edit","exports:view","exports:manage","exports:approve","exports:request","activity_log:export","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],EA:["dashboard:view","employees:view","employees:edit","employees:view:sensitive","lifecycle:view","lifecycle:edit","lifecycle:approve","attendance:view","attendance:edit","attendance:approve","performance:view","performance:edit","performance:approve","templates:view","templates:edit","exports:view","exports:manage","exports:approve","exports:request","activity_log:export","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],EMPLOYEE_L1:["dashboard:view","employees:view","employees:edit:self","attendance:view","attendance:edit:self","performance:view","templates:view","requests:view","requests:create:self","exports:request:self","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],EMPLOYEE_L2:["dashboard:view","employees:view","employees:edit:self","attendance:view","attendance:edit:self","performance:view","templates:view","requests:view","requests:create:self","exports:request:self","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],EMPLOYEE_L3:["dashboard:view","employees:view","employees:edit:self","attendance:view","attendance:edit:self","performance:view","templates:view","requests:view","requests:create:self","exports:request:self","settings:view","audit:write:nonsensitive","auth:logout","resource:own"]},s={dashboard:"dashboard:view",employees:"employees:view","employment-lifecycle":"lifecycle:view",attendance:"attendance:view",performance:"performance:view","activity-log":"activity_log:view",exports:"exports:view",documents:"templates:view","access-management":"access_management:view","retention-archive":"retention_archive:view","incident-management":"incident_management:view",requests:"requests:view",settings:"settings:view","user-management":"user_management:view"};function o(e,t){let i=a[(0,r.normalizeRole)(e)]??[];return i.includes("*")||i.includes(t)}function c(e,t){let i=(0,r.normalizeRole)(e);if(!new Set(n.MODULE_ACCESS[i]??[]).has(t))return!1;let a=s[t];return!a||o(i,a)}function l({role:e,actorIdentifier:t,ownerIdentifier:i,allowRoles:n=["SUPER_ADMIN"]}){let a=(0,r.normalizeRole)(e);if(n.includes(a))return!0;if(!o(a,"resource:own"))return!1;let s=String(t||"").trim().toLowerCase(),c=String(i||"").trim().toLowerCase();return!!s&&!!c&&s===c}function d(e){let t=String(e||"").trim().replace(/^\/+|\/+$/g,"");if(!t)return"dashboard";let i=t.split("/")[0];return s[i]?i:null}e.s(["canAccessModule",()=>c,"canAccessResource",()=>l,"getModuleIdFromPathname",()=>d,"hasPermission",()=>o],32307);var u=e.i(96864),m=e.i(45709);function p(e,i){return{error:t.NextResponse.json({message:i},{status:e})}}async function v(e,{allowedRoles:t,requiredPermissions:n=[],ownerIdentifier:a,ownerBypassRoles:s=["SUPER_ADMIN"],auditModule:c="Authorization",auditAction:d="API access check"}={}){let f=e.cookies.get(i.SESSION_COOKIE_NAME)?.value,y=(0,i.verifySessionToken)(f);if(!y)return await (0,u.recordAuditEvent)({activityName:`${d} denied (no active session)`,status:"Failed",module:c,performedBy:"anonymous@gmail.com",sensitivity:"Sensitive",metadata:{reason:"unauthorized"},request:e}),p(401,"Unauthorized.");let _={...y,role:(0,r.normalizeRole)(y.role)},g=await (0,m.getLoginAccount)(_.email).catch(()=>null);if(!g)return await (0,u.recordAuditEvent)({activityName:`${d} denied (account not found)`,status:"Failed",module:c,performedBy:_.email,sensitivity:"Sensitive",metadata:{reason:"account_not_found"},request:e}),p(401,"Session is no longer valid. Please sign in again.");if("active"!==g.status)return await (0,u.recordAuditEvent)({activityName:`${d} blocked by account status`,status:"Rejected",module:c,performedBy:_.email,sensitivity:"Sensitive",metadata:{reason:"account_not_active",accountStatus:g.status},request:e}),p(403,"Account is not active.");let w=(0,r.normalizeRole)(g.role),A=Number.parseInt(String(g.sessionVersion??""),10)||1,h="SUPER_ADMIN"===w,b=_.role!==w,I=_.sessionVersion!==A;if(I||b&&!h)return await (0,u.recordAuditEvent)({activityName:`${d} denied (stale session)`,status:"Rejected",module:c,performedBy:_.email,sensitivity:"Sensitive",metadata:{reason:I?"session_version_mismatch":"session_role_mismatch",tokenRole:_.role,accountRole:w,tokenSessionVersion:_.sessionVersion,accountSessionVersion:A},request:e}),p(401,"Session expired. Please sign in again.");if(Array.isArray(t)&&t.length>0&&!t.includes(_.role))return await (0,u.recordAuditEvent)({activityName:`${d} blocked by role policy`,status:"Rejected",module:c,performedBy:_.email,sensitivity:"Sensitive",metadata:{role:_.role,allowedRoles:t,reason:"role_not_allowed"},request:e}),p(403,"Forbidden.");if(n.length>0&&!n.every(e=>o(_.role,e)))return await (0,u.recordAuditEvent)({activityName:`${d} blocked by permission policy`,status:"Rejected",module:c,performedBy:_.email,sensitivity:"Sensitive",metadata:{role:_.role,requiredPermissions:n,reason:"missing_permission"},request:e}),p(403,"Forbidden.");if(a){let t=_.email,i="function"==typeof a?await a(_):a;if(!l({role:_.role,actorIdentifier:t,ownerIdentifier:i,allowRoles:s}))return await (0,u.recordAuditEvent)({activityName:`${d} blocked by ownership policy`,status:"Rejected",module:c,performedBy:_.email,sensitivity:"Sensitive",metadata:{role:_.role,ownerIdentifier:i,reason:"ownership_validation_failed"},request:e}),p(403,"Forbidden.")}return{session:_}}e.s(["authorizeApiRequest",()=>v],98189)},44801,e=>{"use strict";function t(e){return String(e??"").trim()}function i(e,{fallbackLabel:r="User",maxTokens:n=3}={}){let a=t(e).toLowerCase(),s=t(r)||"User";if(!a.includes("@"))return s;let o=(a.split("@")[0]||"").split(/[._-]+/g).map(e=>{let i;return(i=t(e).toLowerCase())?`${i.charAt(0).toUpperCase()}${i.slice(1)}`:""}).filter(Boolean).slice(0,Math.max(1,Number.isFinite(n)?n:3));return 0===o.length?s:o.join(" ")}function r({firstName:e,middleName:i,lastName:r,order:n}){let a=t(e),s=t(i),o=t(r);if("last-first"===n){let e=[a,s].filter(Boolean).join(" ");return o?`${o}${e?`, ${e}`:""}`:e}return[a,s,o].filter(Boolean).join(" ")}function n({fallback:e,fallbackEmail:r,fallbackLabel:n}){let a=t(e);if(a)return a;let s=t(r);return s?i(s,{fallbackLabel:n}):t(n)||"User"}function a({firstName:e,middleName:i,lastName:s,suffix:o,fallback:c="",fallbackEmail:l="",fallbackLabel:d="User"}={}){let u=[r({firstName:e,middleName:i,lastName:s,order:"first-last"}),t(o)].filter(Boolean).join(" ").trim();return u||n({fallback:c,fallbackEmail:l,fallbackLabel:d})}function s({firstName:e,middleName:i,lastName:a,suffix:o,fallback:c="",fallbackEmail:l="",fallbackLabel:d="Employee"}={}){let u=[r({firstName:e,middleName:i,lastName:a,order:"last-first"}),t(o)].filter(Boolean).join(" ").trim();return u||n({fallback:c,fallbackEmail:l,fallbackLabel:d})}e.s(["formatEmployeeName",()=>s,"formatNameFromEmail",()=>i,"formatPersonName",()=>a])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__3476a93a._.js.map