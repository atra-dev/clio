module.exports=[6617,e=>{"use strict";var t=e.i(47909),i=e.i(74017),a=e.i(96250),r=e.i(59756),n=e.i(61916),s=e.i(74677),o=e.i(69741),d=e.i(16795),u=e.i(87718),l=e.i(95169),c=e.i(47587),m=e.i(66012),p=e.i(70101),v=e.i(26937),f=e.i(10372),g=e.i(93695);e.i(52474);var h=e.i(220),_=e.i(89171),y=e.i(59979),b=e.i(4381),w=e.i(96864),A=e.i(14541),R=e.i(11655),S=e.i(14277),E=e.i(45709),C=e.i(33355);function P(e,{status:t=200,rateLimit:i}={}){var a=_.NextResponse.json(e,{status:t});if(!i?.headers||"object"!=typeof i.headers)return a;for(let[e,t]of Object.entries(i.headers))a.headers.set(e,String(t));return a}function N(e){let t=String(e||"").trim();return"firebase_custom_claims_not_configured"===t?"Secure login is unavailable: Firebase Admin credentials are not configured on the server.":"firebase_admin_access_token_failed"===t?"Secure login is unavailable: Firebase Admin token generation failed. Check service account key format.":"firebase_admin_permission_denied"===t?"Secure login is unavailable: Firebase Admin service account lacks Identity Toolkit permissions.":"firebase_project_not_found"===t?"Secure login is unavailable: Firebase Admin project ID is invalid.":"firebase_user_not_found"===t?"Secure login is unavailable: signed-in Firebase user was not found in the configured project.":"Secure login is temporarily unavailable. Please contact Super Admin."}async function L(e){let t=function(e,t=!1){let i=String(process.env[e]||"").trim().toLowerCase();return i?"true"===i||"1"===i||"yes"===i:t}("CLIO_REQUIRE_SMS_MFA",!0),i=(0,b.enforceRateLimitByRequest)({request:e,scope:"auth-login-ip",limit:30,windowMs:3e5});if(!i.allowed)return await (0,w.recordAuditEvent)({activityName:"Login request rate-limited (IP)",status:"Rejected",module:"Authentication",performedBy:"anonymous@gmail.com",sensitivity:"Sensitive",metadata:{reason:"rate_limit_exceeded",scope:"auth-login-ip"},request:e}),P({message:"Too many login attempts. Please try again in a few minutes."},{status:429,rateLimit:i});try{let a=await e.json(),r="string"==typeof a?.idToken?a.idToken:"",n=await (0,A.verifyFirebaseIdToken)(r),s=n.email,o=(0,b.consumeRateLimit)({scope:"auth-login-email",identifier:s,limit:12,windowMs:6e5});if(i=o,!o.allowed)return await (0,w.recordAuditEvent)({activityName:"Login request rate-limited (account)",status:"Rejected",module:"Authentication",performedBy:s,sensitivity:"Sensitive",metadata:{reason:"rate_limit_exceeded",scope:"auth-login-email"},request:e}),P({message:"Too many login attempts for this account. Please try again shortly."},{status:429,rateLimit:o});if(!n.emailVerified)return await (0,w.recordAuditEvent)({activityName:"Login attempt rejected: email not verified",status:"Rejected",module:"Authentication",performedBy:s,sensitivity:"Sensitive",metadata:{reason:"email_not_verified",authProvider:"firebase",firebaseUid:n.uid},request:e}),P({message:"Google account email must be verified.",reason:"email_not_verified"},{status:403,rateLimit:i});if(!n.providerIds.includes("google.com"))return await (0,w.recordAuditEvent)({activityName:"Login attempt rejected: unsupported auth provider",status:"Rejected",module:"Authentication",performedBy:s,sensitivity:"Sensitive",metadata:{reason:"provider_not_allowed",authProvider:"firebase",firebaseUid:n.uid,providerIds:n.providerIds},request:e}),P({message:"Only Google sign-in is allowed for this workspace.",reason:"provider_not_allowed"},{status:403,rateLimit:i});let d=await (0,E.getLoginAccount)(s);if(!d)return await (0,w.recordAuditEvent)({activityName:"Login attempt rejected: account not provisioned",status:"Rejected",module:"Authentication",performedBy:s,sensitivity:"Sensitive",metadata:{reason:"role_not_provisioned",authProvider:"google",firebaseUid:n.uid},request:e}),P({message:"Account is not provisioned for this workspace.",reason:"role_not_provisioned"},{status:403,rateLimit:i});if("disabled"===d.status)return await (0,w.recordAuditEvent)({activityName:"Login attempt rejected: account disabled",status:"Rejected",module:"Authentication",performedBy:s,sensitivity:"Sensitive",metadata:{reason:"account_disabled",accountStatus:d.status,authProvider:"google",firebaseUid:n.uid},request:e}),P({message:"Account is disabled. Please contact Super Admin.",reason:"account_disabled"},{status:403,rateLimit:i});if("invite"===d.source&&!d.emailVerifiedAt)return await (0,w.recordAuditEvent)({activityName:"Login attempt rejected: invite email verification required",status:"Rejected",module:"Authentication",performedBy:s,sensitivity:"Sensitive",metadata:{reason:"invite_email_verification_required",accountStatus:d.status,authProvider:"google",firebaseUid:n.uid,source:d.source},request:e}),P({message:"Account invitation must be verified first. Open your invite verification link and complete OTP.",reason:"invite_email_verification_required"},{status:403,rateLimit:i});if(t&&(!d.phoneVerifiedAt||d.smsMfaEnabled)){let t=null;try{t=await (0,E.createLoginSmsChallenge)({email:s})}catch(a){let t=a instanceof Error?a.message:"mfa_challenge_create_failed";return await (0,w.recordAuditEvent)({activityName:"Login attempt rejected: SMS challenge creation failed",status:"Failed",module:"Authentication",performedBy:s,sensitivity:"Sensitive",metadata:{reason:t,authProvider:"google",firebaseUid:n.uid},request:e}),P({message:"SMS authentication setup is temporarily unavailable. Please retry sign-in.",reason:"sms_mfa_setup_unavailable"},{status:503,rateLimit:i})}return await (0,w.recordAuditEvent)({activityName:"Login attempt rejected: SMS verification required",status:"Rejected",module:"Authentication",performedBy:s,sensitivity:"Sensitive",metadata:{reason:"sms_mfa_required",accountStatus:d.status,authProvider:"google",firebaseUid:n.uid,source:d.source},request:e}),P({message:"SMS authentication is required before login. Complete phone OTP verification to continue.",reason:"sms_mfa_required",challengeToken:t.challengeToken,challengeExpiresAt:t.challengeExpiresAt},{status:403,rateLimit:i})}if("active"!==d.status)return await (0,w.recordAuditEvent)({activityName:"Login attempt rejected: account inactive",status:"Rejected",module:"Authentication",performedBy:s,sensitivity:"Sensitive",metadata:{reason:"account_inactive",accountStatus:d.status,authProvider:"google",firebaseUid:n.uid},request:e}),P({message:"Account is not active yet. Please contact Super Admin.",reason:"account_inactive"},{status:403,rateLimit:i});let u=null;try{u=await (0,R.syncFirebaseCustomClaimsForUser)({uid:n.uid,email:s,role:d.role,status:d.status,sessionVersion:d.sessionVersion,allowMissingUser:!1,strict:!0})}catch(a){let t=a instanceof Error?a.message:"firebase_claims_sync_failed";return await (0,w.recordAuditEvent)({activityName:"Login attempt rejected: custom claims sync failed",status:"Failed",module:"Authentication",performedBy:s,sensitivity:"Sensitive",metadata:{reason:t,authProvider:"google",firebaseUid:n.uid},request:e}),P({message:N(t),reason:t},{status:503,rateLimit:i})}if(!u?.ok&&1)return await (0,w.recordAuditEvent)({activityName:"Login attempt rejected: custom claims not synchronized",status:"Failed",module:"Authentication",performedBy:s,sensitivity:"Sensitive",metadata:{reason:u?.reason||"firebase_claims_sync_failed",authProvider:"google",firebaseUid:n.uid},request:e}),P({message:N(u?.reason||"firebase_claims_sync_failed"),reason:u?.reason||"firebase_claims_sync_failed"},{status:503,rateLimit:i});let{token:l,expiresAt:c}=(0,y.createSession)(s,d.role,{sessionVersion:d.sessionVersion}),m=P({ok:!0},{rateLimit:i});m.cookies.set(y.SESSION_COOKIE_NAME,l,(0,y.getSessionCookieOptions)(c)),await (0,E.markUserLogin)(s);try{let t=e.headers.get("x-forwarded-for"),i=t?t.split(",")[0]?.trim():e.headers.get("x-real-ip")||"unknown",a=e.headers.get("user-agent")||"unknown",r=e.headers.get("accept-language")||"",n=e.headers.get("sec-ch-ua")||"",o=e.headers.get("sec-ch-ua-platform")||"",d=e.headers.get("sec-ch-ua-mobile")||"",u=await (0,E.recordLoginDevice)({email:s,userAgent:a,ip:i,acceptLanguage:r,secChUa:n,secChUaPlatform:o,secChUaMobile:d});u?.isNew&&u?.device?.deviceId&&(await (0,C.createInAppNotification)({title:"New device sign-in detected",message:`New sign-in from ${u.device.label}. Confirm if this was you.`,severity:"medium",type:"device-login",module:"Authentication",actionUrl:"",recipientEmail:s,metadata:{deviceId:u.device.deviceId,deviceLabel:u.device.label,sourceIp:u.device.lastIp,userAgent:u.device.userAgent},createdBy:s}),await (0,S.alertRepeatedNewDeviceSignIns)({actorEmail:s,sourceIp:u.device.lastIp,deviceLabel:u.device.label}).catch(()=>null))}catch{}return await (0,w.recordAuditEvent)({activityName:`User login successful (${d.role})`,status:"Completed",module:"Authentication",performedBy:s,sensitivity:"Sensitive",metadata:{assignedRole:d.role,accountStatus:d.status,sessionVersion:d.sessionVersion,authProvider:"google",firebaseUid:n.uid,claimsSync:u.reason||"synced"},request:e}),m}catch(a){let t=a instanceof Error?a.message:"request_parse_or_internal_error";return await (0,w.recordAuditEvent)({activityName:"Login request failed",status:"Failed",module:"Authentication",performedBy:"anonymous@gmail.com",sensitivity:"Sensitive",metadata:{reason:t},request:e}),P({message:"missing_id_token"===t?"Google sign-in token is missing.":"invalid_id_token"===t?"Invalid Google sign-in token.":"firebase_api_key_not_configured"===t?"Firebase API key is not configured.":"firebase_user_not_found"===t?"Unable to verify Google account.":"firebase_user_missing_email"===t?"Google account does not expose an email.":"identity_lookup_failed"===t?"Unable to verify Google login with Firebase.":"invite_email_verification_required"===t?"Account invitation must be verified first.":"sms_mfa_required"===t?"SMS authentication setup is required before login.":"firestore_operation_failed"===t?"Secure login is temporarily unavailable due to a database issue. Please retry shortly.":"firebase_custom_claims_not_configured"===t?"Firebase custom claims are not configured.":"Unable to process login request."},{status:"firestore_operation_failed"===t?503:400,rateLimit:i})}}e.s(["POST",()=>L],41361);var k=e.i(41361);let x=new t.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:""},distDir:"next-build-temp",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/auth/login/route.js",nextConfigOutput:"",userland:k}),{workAsyncStorage:I,workUnitAsyncStorage:U,serverHooks:T}=x;function j(){return(0,a.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:U})}async function O(e,t,a){x.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let _="/api/auth/login/route";_=_.replace(/\/index$/,"")||"/";let y=await x.prepare(e,t,{srcPage:_,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:b,params:w,nextConfig:A,parsedUrl:R,isDraftMode:S,prerenderManifest:E,routerServerContext:C,isOnDemandRevalidate:P,revalidateOnlyGenerated:N,resolvedPathname:L,clientReferenceManifest:k,serverActionsManifest:I}=y,U=(0,o.normalizeAppPath)(_),T=!!(E.dynamicRoutes[U]||E.routes[L]),j=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,R,!1):t.end("This page could not be found"),null);if(T&&!S){let e=!!E.routes[L],t=E.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await j();throw new g.NoFallbackError}}let O=null;!T||x.isDev||S||(O="/index"===(O=L)?"/":O);let q=!0===x.isDev||!T,F=T&&!q;I&&k&&(0,s.setManifestsSingleton)({page:_,clientReferenceManifest:k,serverActionsManifest:I});let M=e.method||"GET",B=(0,n.getTracer)(),H=B.getActiveScopeSpan(),D={params:w,prerenderManifest:E,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:q,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,i,a,r)=>x.onRequestError(e,t,a,r,C)},sharedContext:{buildId:b}},V=new d.NodeNextRequest(e),$=new d.NodeNextResponse(t),G=u.NextRequestAdapter.fromNodeNextRequest(V,(0,u.signalFromNodeResponse)(t));try{let s=async e=>x.handle(G,D).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let i=B.getRootSpanAttributes();if(!i)return;if(i.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${i.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=i.get("next.route");if(a){let t=`${M} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${_}`)}),o=!!(0,r.getRequestMeta)(e,"minimalMode"),d=async r=>{var n,d;let u=async({previousCacheEntry:i})=>{try{if(!o&&P&&N&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(r);e.fetchMetrics=D.renderOpts.fetchMetrics;let d=D.renderOpts.pendingWaitUntil;d&&a.waitUntil&&(a.waitUntil(d),d=void 0);let u=D.renderOpts.collectedTags;if(!T)return await (0,m.sendResponse)(V,$,n,D.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(n.headers);u&&(t[f.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let i=void 0!==D.renderOpts.collectedRevalidate&&!(D.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&D.renderOpts.collectedRevalidate,a=void 0===D.renderOpts.collectedExpire||D.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:D.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:i,expire:a}}}}catch(t){throw(null==i?void 0:i.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:P})},!1,C),t}},l=await x.handleResponse({req:e,nextConfig:A,cacheKey:O,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:E,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:N,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:o});if(!T)return null;if((null==l||null==(n=l.value)?void 0:n.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(d=l.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",P?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return o&&T||g.delete(f.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,v.getCacheControlHeader)(l.cacheControl)),await (0,m.sendResponse)(V,$,new Response(l.value.body,{headers:g,status:l.value.status||200})),null};H?await d(H):await B.withPropagatedContext(e.headers,()=>B.trace(l.BaseServerSpan.handleRequest,{spanName:`${M} ${_}`,kind:n.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},d))}catch(t){if(t instanceof g.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:P})},!1,C),T)throw t;return await (0,m.sendResponse)(V,$,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>j,"routeModule",()=>x,"serverHooks",()=>T,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>U],6617)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_3e349984.js.map