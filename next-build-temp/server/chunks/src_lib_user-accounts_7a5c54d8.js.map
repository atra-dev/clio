{"version":3,"sources":["../../../src/lib/user-accounts.js","../../../src/features/hris/constants.js","../../../src/lib/firebase-custom-claims.js"],"sourcesContent":["import { createHmac, randomBytes, randomInt, timingSafeEqual } from \"node:crypto\";\r\nimport { promises as fs } from \"node:fs\";\r\nimport path from \"node:path\";\r\nimport {\r\n  addDoc,\r\n  collection,\r\n  deleteDoc,\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  limit as queryLimit,\r\n  query,\r\n  setDoc,\r\n  updateDoc,\r\n  where,\r\n} from \"firebase/firestore/lite\";\r\nimport { ROLES } from \"@/features/hris/constants\";\r\nimport { syncFirebaseCustomClaimsForUser } from \"@/lib/firebase-custom-claims\";\r\nimport { getFirestoreDb, isFirestoreEnabled } from \"@/lib/firebase\";\r\n\r\nconst DATA_DIR = path.join(process.cwd(), \"data\");\r\nconst USER_STORE_FILE = path.join(DATA_DIR, \"user-accounts.json\");\r\nconst ALLOWED_STATUSES = new Set([\"pending\", \"active\", \"disabled\"]);\r\nconst ALLOWED_INVITE_STATUSES = new Set([\"sent\", \"otp_sent\", \"verified\", \"revoked\", \"expired\"]);\r\nconst ALLOWED_ROLE_IDS = new Set(ROLES.map((role) => role.id));\r\nconst EMPLOYEE_ACCOUNT_ROLE_ID = \"EMPLOYEE_L1\";\r\nconst DEFAULT_INVITE_EXPIRATION_DAYS = 7;\r\nconst DEFAULT_ARCHIVE_RETENTION_YEARS = 5;\r\nconst DEFAULT_OTP_TTL_SECONDS = 300;\r\nconst DEFAULT_OTP_MAX_ATTEMPTS = 5;\r\nconst DEFAULT_OTP_RESEND_COOLDOWN_SECONDS = 60;\r\nconst DEFAULT_LOGIN_MFA_CHALLENGE_TTL_SECONDS = 600;\r\nconst MAX_KNOWN_DEVICES = 12;\r\nconst LEGACY_LOCAL_ACCOUNT_EMAILS = new Set([\r\n  \"superadmin@clio.local\",\r\n  \"temp.admin@clio.local\",\r\n  \"hr@clio.local\",\r\n  \"grc@clio.local\",\r\n  \"ea@clio.local\",\r\n]);\r\n\r\nlet storeInitPromise;\r\n\r\nfunction nowIso() {\r\n  return new Date().toISOString();\r\n}\r\n\r\nfunction addYearsToIso(isoTimestamp, years) {\r\n  const base = new Date(isoTimestamp);\r\n  if (Number.isNaN(base.getTime())) {\r\n    const fallback = new Date();\r\n    fallback.setUTCFullYear(fallback.getUTCFullYear() + years);\r\n    return fallback.toISOString();\r\n  }\r\n  base.setUTCFullYear(base.getUTCFullYear() + years);\r\n  return base.toISOString();\r\n}\r\n\r\nfunction normalizeIsoTimestamp(value) {\r\n  if (typeof value !== \"string\") {\r\n    return \"\";\r\n  }\r\n  const parsed = new Date(value);\r\n  if (Number.isNaN(parsed.getTime())) {\r\n    return \"\";\r\n  }\r\n  return parsed.toISOString();\r\n}\r\n\r\nfunction getArchiveRetentionYears() {\r\n  const raw = Number.parseInt(String(process.env.CLIO_RETENTION_YEARS || \"\").trim(), 10);\r\n  if (!Number.isFinite(raw) || raw < 1) {\r\n    return DEFAULT_ARCHIVE_RETENTION_YEARS;\r\n  }\r\n  return Math.min(raw, 25);\r\n}\r\n\r\nfunction resolveRetentionDeleteAt({ archivedAt, retentionDeleteAt }) {\r\n  const normalizedRetention = normalizeIsoTimestamp(retentionDeleteAt);\r\n  if (normalizedRetention) {\r\n    return normalizedRetention;\r\n  }\r\n  return addYearsToIso(archivedAt, getArchiveRetentionYears());\r\n}\r\n\r\nfunction createId(prefix) {\r\n  return `${prefix}-${Date.now()}-${Math.random().toString(36).slice(2, 8).toUpperCase()}`;\r\n}\r\n\r\nfunction createInviteToken() {\r\n  return randomBytes(20).toString(\"hex\");\r\n}\r\n\r\nfunction normalizeEmail(value) {\r\n  return String(value || \"\").trim().toLowerCase();\r\n}\r\n\r\nfunction normalizeSessionVersion(value, fallback = 1) {\r\n  const parsed = Number.parseInt(String(value ?? \"\"), 10);\r\n  if (!Number.isFinite(parsed) || parsed < 1) {\r\n    return fallback;\r\n  }\r\n  return parsed;\r\n}\r\n\r\nfunction normalizeBooleanFlag(value, fallback = false) {\r\n  if (typeof value === \"boolean\") {\r\n    return value;\r\n  }\r\n  const raw = String(value || \"\")\r\n    .trim()\r\n    .toLowerCase();\r\n  if (!raw) {\r\n    return fallback;\r\n  }\r\n  return raw === \"true\" || raw === \"1\" || raw === \"yes\";\r\n}\r\n\r\nfunction isLegacyLocalAccountEmail(value) {\r\n  return LEGACY_LOCAL_ACCOUNT_EMAILS.has(normalizeEmail(value));\r\n}\r\n\r\nfunction isValidEmail(value) {\r\n  return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(normalizeEmail(value));\r\n}\r\n\r\nfunction normalizeNameField(value, { allowEmpty = true } = {}) {\r\n  const normalized = String(value || \"\")\r\n    .trim()\r\n    .replace(/\\s+/g, \" \");\r\n  if (!normalized) {\r\n    return allowEmpty ? \"\" : null;\r\n  }\r\n  if (normalized.length > 80) {\r\n    throw new Error(\"invalid_name\");\r\n  }\r\n  return normalized;\r\n}\r\n\r\nfunction normalizeProfilePhotoDataUrl(value) {\r\n  if (value == null || value === \"\") {\r\n    return null;\r\n  }\r\n\r\n  const normalized = String(value).trim();\r\n  if (!normalized) {\r\n    return null;\r\n  }\r\n\r\n  const isDataImage = /^data:image\\/(png|jpeg|jpg|webp);base64,/i.test(normalized);\r\n  if (isDataImage) {\r\n    if (normalized.length > 1_500_000) {\r\n      throw new Error(\"invalid_profile_photo\");\r\n    }\r\n    return normalized;\r\n  }\r\n\r\n  const isWebUrl = /^https?:\\/\\/[^\\s]+$/i.test(normalized);\r\n  if (!isWebUrl || normalized.length > 2_048) {\r\n    throw new Error(\"invalid_profile_photo\");\r\n  }\r\n\r\n  return normalized;\r\n}\r\n\r\nfunction normalizeStoragePath(value) {\r\n  if (value == null || value === \"\") {\r\n    return null;\r\n  }\r\n\r\n  const normalized = String(value).trim().replace(/^\\/+/, \"\");\r\n  if (!normalized) {\r\n    return null;\r\n  }\r\n  if (normalized.length > 512 || normalized.includes(\"..\") || normalized.includes(\"\\\\\")) {\r\n    throw new Error(\"invalid_storage_path\");\r\n  }\r\n  if (!/^clio\\/[a-z0-9/_\\-.\\s]+$/i.test(normalized)) {\r\n    throw new Error(\"invalid_storage_path\");\r\n  }\r\n  return normalized;\r\n}\r\n\r\nfunction envInt(name, fallback, { min, max } = {}) {\r\n  const raw = String(process.env[name] || \"\").trim();\r\n  const parsed = Number.parseInt(raw, 10);\r\n  if (!Number.isFinite(parsed)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (Number.isFinite(min) && parsed < min) {\r\n    return min;\r\n  }\r\n\r\n  if (Number.isFinite(max) && parsed > max) {\r\n    return max;\r\n  }\r\n\r\n  return parsed;\r\n}\r\n\r\nfunction getInviteExpirationMs() {\r\n  const days = envInt(\"CLIO_INVITE_EXPIRATION_DAYS\", DEFAULT_INVITE_EXPIRATION_DAYS, {\r\n    min: 1,\r\n    max: 90,\r\n  });\r\n  return days * 24 * 60 * 60 * 1000;\r\n}\r\n\r\nfunction createInviteExpirationIso() {\r\n  return new Date(Date.now() + getInviteExpirationMs()).toISOString();\r\n}\r\n\r\nfunction getOtpSecret() {\r\n  const configuredSecret = String(process.env.CLIO_SMS_OTP_SECRET || \"\").trim();\r\n  if (configuredSecret) {\r\n    return configuredSecret;\r\n  }\r\n\r\n  const sessionSecret = String(process.env.CLIO_SESSION_SECRET || \"\").trim();\r\n  if (sessionSecret) {\r\n    return sessionSecret;\r\n  }\r\n\r\n  if (process.env.NODE_ENV === \"production\") {\r\n    throw new Error(\"sms_otp_secret_required\");\r\n  }\r\n\r\n  return \"clio-dev-sms-otp-secret\";\r\n}\r\n\r\nfunction getOtpTtlSeconds() {\r\n  return envInt(\"CLIO_SMS_OTP_TTL_SECONDS\", DEFAULT_OTP_TTL_SECONDS, {\r\n    min: 60,\r\n    max: 900,\r\n  });\r\n}\r\n\r\nfunction getOtpMaxAttempts() {\r\n  return envInt(\"CLIO_SMS_OTP_MAX_ATTEMPTS\", DEFAULT_OTP_MAX_ATTEMPTS, {\r\n    min: 1,\r\n    max: 10,\r\n  });\r\n}\r\n\r\nfunction getOtpResendCooldownSeconds() {\r\n  return envInt(\"CLIO_SMS_OTP_RESEND_COOLDOWN_SECONDS\", DEFAULT_OTP_RESEND_COOLDOWN_SECONDS, {\r\n    min: 15,\r\n    max: 300,\r\n  });\r\n}\r\n\r\nfunction getLoginMfaChallengeTtlSeconds() {\r\n  return envInt(\"CLIO_LOGIN_MFA_CHALLENGE_TTL_SECONDS\", DEFAULT_LOGIN_MFA_CHALLENGE_TTL_SECONDS, {\r\n    min: 120,\r\n    max: 1800,\r\n  });\r\n}\r\n\r\nfunction normalizePhoneNumber(value) {\r\n  const raw = String(value || \"\").trim();\r\n  if (!raw) {\r\n    return \"\";\r\n  }\r\n\r\n  const withoutSpaces = raw.replace(/[()\\s-]/g, \"\");\r\n  let candidate = withoutSpaces;\r\n\r\n  if (candidate.startsWith(\"00\")) {\r\n    candidate = `+${candidate.slice(2)}`;\r\n  }\r\n\r\n  if (!candidate.startsWith(\"+\")) {\r\n    const defaultCountryCode = String(process.env.CLIO_SMS_DEFAULT_COUNTRY_CODE || \"+63\")\r\n      .trim()\r\n      .replace(/[^\\d+]/g, \"\");\r\n    const normalizedCountryCode = defaultCountryCode.startsWith(\"+\")\r\n      ? defaultCountryCode\r\n      : `+${defaultCountryCode}`;\r\n    const digitsOnly = candidate.replace(/\\D/g, \"\");\r\n    candidate = `${normalizedCountryCode}${digitsOnly}`;\r\n  } else {\r\n    candidate = `+${candidate.slice(1).replace(/\\D/g, \"\")}`;\r\n  }\r\n\r\n  if (!/^\\+\\d{10,15}$/.test(candidate)) {\r\n    return \"\";\r\n  }\r\n\r\n  return candidate;\r\n}\r\n\r\nfunction maskPhoneNumber(value) {\r\n  const normalized = normalizePhoneNumber(value);\r\n  if (!normalized) {\r\n    return \"\";\r\n  }\r\n\r\n  const last4 = normalized.slice(-4);\r\n  return `***-***-${last4}`;\r\n}\r\n\r\nfunction getPhoneLast4(value) {\r\n  const normalized = normalizePhoneNumber(value);\r\n  if (!normalized) {\r\n    return \"\";\r\n  }\r\n  return normalized.slice(-4);\r\n}\r\n\r\nfunction hashValue(namespace, value) {\r\n  return createHmac(\"sha256\", getOtpSecret()).update(`${namespace}:${value}`).digest(\"hex\");\r\n}\r\n\r\nfunction hashOtpCode({ token, code }) {\r\n  return hashValue(\"otp\", `${token}:${String(code || \"\").trim()}`);\r\n}\r\n\r\nfunction hashPhoneNumber(value) {\r\n  return hashValue(\"phone\", normalizePhoneNumber(value));\r\n}\r\n\r\nfunction resolveBrowser(userAgent) {\r\n  const ua = String(userAgent || \"\").toLowerCase();\r\n  if (!ua || ua === \"unknown\") {\r\n    return \"Unknown Browser\";\r\n  }\r\n  if (ua.includes(\"edg/\")) return \"Microsoft Edge\";\r\n  if (ua.includes(\"opr/\") || ua.includes(\"opera\")) return \"Opera\";\r\n  if (ua.includes(\"firefox/\")) return \"Firefox\";\r\n  if (ua.includes(\"safari/\") && !ua.includes(\"chrome/\")) return \"Safari\";\r\n  if (ua.includes(\"chrome/\")) return \"Chrome\";\r\n  return \"Browser\";\r\n}\r\n\r\nfunction resolveOs(userAgent) {\r\n  const ua = String(userAgent || \"\").toLowerCase();\r\n  if (!ua || ua === \"unknown\") {\r\n    return \"Unknown OS\";\r\n  }\r\n  if (ua.includes(\"windows\")) return \"Windows\";\r\n  if (ua.includes(\"mac os x\") || ua.includes(\"macintosh\")) return \"macOS\";\r\n  if (ua.includes(\"android\")) return \"Android\";\r\n  if (ua.includes(\"iphone\") || ua.includes(\"ipad\") || ua.includes(\"ios\")) return \"iOS\";\r\n  if (ua.includes(\"linux\")) return \"Linux\";\r\n  return \"OS\";\r\n}\r\n\r\nfunction summarizeDeviceLabel(userAgent) {\r\n  const ua = String(userAgent || \"\").trim();\r\n  if (!ua || ua === \"unknown\") {\r\n    return \"Unknown device\";\r\n  }\r\n  return `${resolveBrowser(ua)} on ${resolveOs(ua)}`;\r\n}\r\n\r\nfunction normalizeDeviceEntry(entry) {\r\n  const deviceId = String(entry?.deviceId || \"\").trim();\r\n  if (!deviceId) {\r\n    return null;\r\n  }\r\n\r\n  const firstSeenAt = normalizeIsoTimestamp(entry?.firstSeenAt) || nowIso();\r\n  const lastSeenAt = normalizeIsoTimestamp(entry?.lastSeenAt) || firstSeenAt;\r\n  const label = String(entry?.label || \"\").trim() || \"Unknown device\";\r\n  const userAgent = String(entry?.userAgent || \"\").trim() || \"unknown\";\r\n  const lastIp = String(entry?.lastIp || \"\").trim() || \"unknown\";\r\n  const trusted = Boolean(entry?.trusted);\r\n  const deniedAt = normalizeIsoTimestamp(entry?.deniedAt) || null;\r\n  const deniedReason = typeof entry?.deniedReason === \"string\" ? entry.deniedReason : null;\r\n\r\n  return {\r\n    deviceId,\r\n    label,\r\n    userAgent,\r\n    lastIp,\r\n    firstSeenAt,\r\n    lastSeenAt,\r\n    trusted,\r\n    deniedAt,\r\n    deniedReason,\r\n  };\r\n}\r\n\r\nfunction normalizeDeviceList(entries) {\r\n  return (Array.isArray(entries) ? entries : [])\r\n    .map(normalizeDeviceEntry)\r\n    .filter(Boolean)\r\n    .sort((a, b) => new Date(b.lastSeenAt || 0).getTime() - new Date(a.lastSeenAt || 0).getTime())\r\n    .slice(0, MAX_KNOWN_DEVICES);\r\n}\r\n\r\nfunction buildDeviceFingerprint({\r\n  userAgent,\r\n  acceptLanguage,\r\n  secChUa,\r\n  secChUaPlatform,\r\n  secChUaMobile,\r\n} = {}) {\r\n  const fingerprintSource = [\r\n    String(userAgent || \"\").trim(),\r\n    String(acceptLanguage || \"\").trim(),\r\n    String(secChUa || \"\").trim(),\r\n    String(secChUaPlatform || \"\").trim(),\r\n    String(secChUaMobile || \"\").trim(),\r\n  ]\r\n    .filter(Boolean)\r\n    .join(\"|\");\r\n  return hashValue(\"device\", fingerprintSource || \"unknown-device\");\r\n}\r\n\r\nfunction buildDevicePayload({\r\n  userAgent,\r\n  ip,\r\n  acceptLanguage,\r\n  secChUa,\r\n  secChUaPlatform,\r\n  secChUaMobile,\r\n} = {}) {\r\n  const deviceId = buildDeviceFingerprint({ userAgent, acceptLanguage, secChUa, secChUaPlatform, secChUaMobile });\r\n  return {\r\n    deviceId,\r\n    label: summarizeDeviceLabel(userAgent),\r\n    userAgent: String(userAgent || \"\").trim() || \"unknown\",\r\n    lastIp: String(ip || \"\").trim() || \"unknown\",\r\n  };\r\n}\r\n\r\nfunction isValidOtpCode(value) {\r\n  return /^\\d{6}$/.test(String(value || \"\").trim());\r\n}\r\n\r\nfunction generateOtpCode() {\r\n  return String(randomInt(0, 1000000)).padStart(6, \"0\");\r\n}\r\n\r\nfunction safeEqual(left, right) {\r\n  const leftBuffer = Buffer.from(String(left || \"\"), \"utf8\");\r\n  const rightBuffer = Buffer.from(String(right || \"\"), \"utf8\");\r\n  if (leftBuffer.length !== rightBuffer.length) {\r\n    return false;\r\n  }\r\n  return timingSafeEqual(leftBuffer, rightBuffer);\r\n}\r\n\r\nfunction normalizeInviteToken(value) {\r\n  const token = String(value || \"\").trim().toLowerCase();\r\n  if (!/^[a-f0-9]{24,128}$/.test(token)) {\r\n    return \"\";\r\n  }\r\n  return token;\r\n}\r\n\r\nfunction normalizeLoginMfaChallengeToken(value) {\r\n  return normalizeInviteToken(value);\r\n}\r\n\r\nfunction maskEmail(value) {\r\n  const normalized = normalizeEmail(value);\r\n  const [username, domain] = normalized.split(\"@\");\r\n  if (!username || !domain) {\r\n    return \"\";\r\n  }\r\n\r\n  if (username.length <= 2) {\r\n    return `**@${domain}`;\r\n  }\r\n\r\n  return `${username.slice(0, 2)}***@${domain}`;\r\n}\r\n\r\nfunction parseEmailList(rawValue, fallback = []) {\r\n  if (typeof rawValue !== \"string\" || rawValue.trim().length === 0) {\r\n    return fallback.map(normalizeEmail).filter(Boolean);\r\n  }\r\n\r\n  return rawValue\r\n    .split(\",\")\r\n    .map(normalizeEmail)\r\n    .filter(Boolean);\r\n}\r\n\r\nfunction isEmployeeRoleId(roleId) {\r\n  const normalized = String(roleId || \"\")\r\n    .trim()\r\n    .toUpperCase();\r\n  return normalized === \"EMPLOYEE\" || normalized.startsWith(\"EMPLOYEE_\");\r\n}\r\n\r\nfunction normalizeRequestedAccountRole(roleId) {\r\n  const normalized = String(roleId || \"\")\r\n    .trim()\r\n    .toUpperCase();\r\n  if (!normalized) {\r\n    return \"\";\r\n  }\r\n\r\n  if (normalized === \"EMPLOYEE\") {\r\n    return EMPLOYEE_ACCOUNT_ROLE_ID;\r\n  }\r\n\r\n  if (!ALLOWED_ROLE_IDS.has(normalized)) {\r\n    return \"\";\r\n  }\r\n\r\n  if (isEmployeeRoleId(normalized)) {\r\n    return EMPLOYEE_ACCOUNT_ROLE_ID;\r\n  }\r\n\r\n  return normalized;\r\n}\r\n\r\nfunction normalizeStoredAccountRole(roleId, fallbackRole = \"HR\") {\r\n  const requested = normalizeRequestedAccountRole(roleId);\r\n  if (requested) {\r\n    return requested;\r\n  }\r\n\r\n  const fallback = normalizeRequestedAccountRole(fallbackRole);\r\n  return fallback || \"HR\";\r\n}\r\n\r\nfunction getBootstrapAccounts() {\r\n  const groups = [\r\n    {\r\n      role: \"SUPER_ADMIN\",\r\n      emails: parseEmailList(process.env.SUPER_ADMIN_EMAILS, []),\r\n    },\r\n    {\r\n      role: \"HR\",\r\n      emails: parseEmailList(process.env.HR_EMAILS, []),\r\n    },\r\n    {\r\n      role: \"GRC\",\r\n      emails: parseEmailList(process.env.GRC_EMAILS, []),\r\n    },\r\n    {\r\n      role: \"EA\",\r\n      emails: parseEmailList(process.env.EA_EMAILS, []),\r\n    },\r\n    {\r\n      role: \"EMPLOYEE_L1\",\r\n      emails: parseEmailList(process.env.EMPLOYEE_L1_EMAILS, []),\r\n    },\r\n    {\r\n      role: \"EMPLOYEE_L2\",\r\n      emails: parseEmailList(process.env.EMPLOYEE_L2_EMAILS, []),\r\n    },\r\n    {\r\n      role: \"EMPLOYEE_L3\",\r\n      emails: parseEmailList(process.env.EMPLOYEE_L3_EMAILS, []),\r\n    },\r\n  ];\r\n\r\n  return groups.flatMap((group) =>\r\n    group.emails.map((email) => ({\r\n      email,\r\n      role: normalizeRequestedAccountRole(group.role) || group.role,\r\n    })),\r\n  );\r\n}\r\n\r\nfunction normalizeUserRecord(user) {\r\n  const email = normalizeEmail(user?.email);\r\n  if (!isValidEmail(email)) {\r\n    return null;\r\n  }\r\n\r\n  const role = normalizeStoredAccountRole(user?.role, \"HR\");\r\n  const status = ALLOWED_STATUSES.has(user?.status) ? user.status : \"pending\";\r\n  const invitedAt = typeof user?.invitedAt === \"string\" ? user.invitedAt : nowIso();\r\n  const updatedAt = typeof user?.updatedAt === \"string\" ? user.updatedAt : invitedAt;\r\n  const archivedAt = normalizeIsoTimestamp(user?.archivedAt);\r\n  const retentionDeleteAt = resolveRetentionDeleteAt({\r\n    archivedAt: archivedAt || invitedAt,\r\n    retentionDeleteAt: user?.retentionDeleteAt,\r\n  });\r\n  const archivedBy = normalizeEmail(user?.archivedBy) || null;\r\n  const archiveReason = typeof user?.archiveReason === \"string\" ? user.archiveReason : null;\r\n  let firstName = \"\";\r\n  let middleName = \"\";\r\n  let lastName = \"\";\r\n  let profilePhotoDataUrl = null;\r\n  let profilePhotoStoragePath = null;\r\n  try {\r\n    firstName = normalizeNameField(user?.firstName);\r\n    middleName = normalizeNameField(user?.middleName);\r\n    lastName = normalizeNameField(user?.lastName);\r\n  } catch {\r\n    firstName = \"\";\r\n    middleName = \"\";\r\n    lastName = \"\";\r\n  }\r\n  try {\r\n    profilePhotoDataUrl = normalizeProfilePhotoDataUrl(user?.profilePhotoDataUrl);\r\n  } catch {\r\n    profilePhotoDataUrl = null;\r\n  }\r\n  try {\r\n    profilePhotoStoragePath = normalizeStoragePath(user?.profilePhotoStoragePath);\r\n  } catch {\r\n    profilePhotoStoragePath = null;\r\n  }\r\n  const rawLoginMfa = user?.loginMfa && typeof user.loginMfa === \"object\" ? user.loginMfa : null;\r\n  const loginMfaChallengeTokenHash =\r\n    typeof rawLoginMfa?.challengeTokenHash === \"string\" ? rawLoginMfa.challengeTokenHash : null;\r\n  const loginMfaChallengeExpiresAt = normalizeIsoTimestamp(rawLoginMfa?.challengeExpiresAt);\r\n  const loginMfa = loginMfaChallengeTokenHash\r\n    ? {\r\n        challengeTokenHash: loginMfaChallengeTokenHash,\r\n        challengeExpiresAt: loginMfaChallengeExpiresAt || null,\r\n        phoneMasked: typeof rawLoginMfa?.phoneMasked === \"string\" ? rawLoginMfa.phoneMasked : null,\r\n        phoneLast4: typeof rawLoginMfa?.phoneLast4 === \"string\" ? rawLoginMfa.phoneLast4 : null,\r\n        phoneHash: typeof rawLoginMfa?.phoneHash === \"string\" ? rawLoginMfa.phoneHash : null,\r\n        otpHash: typeof rawLoginMfa?.otpHash === \"string\" ? rawLoginMfa.otpHash : null,\r\n        otpExpiresAt: normalizeIsoTimestamp(rawLoginMfa?.otpExpiresAt) || null,\r\n        otpRequestedAt: normalizeIsoTimestamp(rawLoginMfa?.otpRequestedAt) || null,\r\n        otpAttemptCount: Number.isFinite(rawLoginMfa?.otpAttemptCount) ? Math.max(0, rawLoginMfa.otpAttemptCount) : 0,\r\n        otpMaxAttempts: Number.isFinite(rawLoginMfa?.otpMaxAttempts)\r\n          ? Math.max(1, rawLoginMfa.otpMaxAttempts)\r\n          : getOtpMaxAttempts(),\r\n        resendAvailableAt: normalizeIsoTimestamp(rawLoginMfa?.resendAvailableAt) || null,\r\n        updatedAt: normalizeIsoTimestamp(rawLoginMfa?.updatedAt) || null,\r\n      }\r\n    : null;\r\n  const knownDevices = normalizeDeviceList(user?.knownDevices);\r\n\r\n  return {\r\n    id: typeof user?.id === \"string\" && user.id.trim().length > 0 ? user.id : email,\r\n    email,\r\n    role,\r\n    status,\r\n    sessionVersion: normalizeSessionVersion(user?.sessionVersion, 1),\r\n    invitedBy: normalizeEmail(user?.invitedBy) || \"system.clio@gmail.com\",\r\n    invitedAt,\r\n    activatedAt: typeof user?.activatedAt === \"string\" ? user.activatedAt : null,\r\n    emailVerifiedAt: typeof user?.emailVerifiedAt === \"string\" ? user.emailVerifiedAt : null,\r\n    lastLoginAt: typeof user?.lastLoginAt === \"string\" ? user.lastLoginAt : null,\r\n    phoneVerifiedAt: typeof user?.phoneVerifiedAt === \"string\" ? user.phoneVerifiedAt : null,\r\n    phoneLast4: typeof user?.phoneLast4 === \"string\" ? user.phoneLast4 : null,\r\n    phoneHash: typeof user?.phoneHash === \"string\" ? user.phoneHash : null,\r\n    smsMfaEnabled: normalizeBooleanFlag(user?.smsMfaEnabled, false),\r\n    verificationMethod: [\"sms\", \"email\"].includes(user?.verificationMethod) ? user.verificationMethod : null,\r\n    archivedAt: archivedAt || null,\r\n    archivedBy,\r\n    archiveReason,\r\n    isArchived: Boolean(user?.isArchived || archivedAt),\r\n    retentionDeleteAt: archivedAt ? retentionDeleteAt : normalizeIsoTimestamp(user?.retentionDeleteAt) || null,\r\n    firstName,\r\n    middleName,\r\n    lastName,\r\n    profilePhotoDataUrl,\r\n    profilePhotoStoragePath,\r\n    profileUpdatedAt: typeof user?.profileUpdatedAt === \"string\" ? user.profileUpdatedAt : null,\r\n    knownDevices,\r\n    loginMfa,\r\n    updatedAt,\r\n    source: user?.source === \"bootstrap\" ? \"bootstrap\" : \"invite\",\r\n  };\r\n}\r\n\r\nasync function syncCustomClaimsForPublicUser(\r\n  user,\r\n  { allowMissingUser = true, strict = false } = {},\r\n) {\r\n  if (!user || typeof user !== \"object\") {\r\n    return {\r\n      ok: false,\r\n      reason: \"invalid_user_payload\",\r\n      email: \"\",\r\n    };\r\n  }\r\n\r\n  const email = normalizeEmail(user.email);\r\n  if (!email) {\r\n    return {\r\n      ok: false,\r\n      reason: \"invalid_user_email\",\r\n      email: \"\",\r\n    };\r\n  }\r\n\r\n  try {\r\n    return await syncFirebaseCustomClaimsForUser({\r\n      email,\r\n      role: normalizeStoredAccountRole(user.role, \"HR\"),\r\n      status: String(user.status || \"\").trim().toLowerCase() || \"pending\",\r\n      sessionVersion: normalizeSessionVersion(user.sessionVersion, 1),\r\n      allowMissingUser,\r\n      strict,\r\n    });\r\n  } catch (error) {\r\n    if (strict) {\r\n      throw error;\r\n    }\r\n    return {\r\n      ok: false,\r\n      reason: error instanceof Error ? error.message : \"firebase_claims_sync_failed\",\r\n      email,\r\n    };\r\n  }\r\n}\r\n\r\nfunction normalizeInviteRecord(invite) {\r\n  const email = normalizeEmail(invite?.email);\r\n  if (!isValidEmail(email)) {\r\n    return null;\r\n  }\r\n\r\n  const role = normalizeStoredAccountRole(invite?.role, \"HR\");\r\n  const invitedAt = typeof invite?.invitedAt === \"string\" ? invite.invitedAt : nowIso();\r\n  const expiresAt =\r\n    typeof invite?.expiresAt === \"string\"\r\n      ? invite.expiresAt\r\n      : createInviteExpirationIso();\r\n  const status = ALLOWED_INVITE_STATUSES.has(invite?.status) ? invite.status : \"sent\";\r\n  const phoneMasked =\r\n    typeof invite?.verification?.phoneMasked === \"string\" ? invite.verification.phoneMasked : null;\r\n  const phoneLast4 =\r\n    typeof invite?.verification?.phoneLast4 === \"string\" ? invite.verification.phoneLast4 : null;\r\n  const otpHash = typeof invite?.verification?.otpHash === \"string\" ? invite.verification.otpHash : null;\r\n  const otpExpiresAt =\r\n    typeof invite?.verification?.otpExpiresAt === \"string\" ? invite.verification.otpExpiresAt : null;\r\n  const otpRequestedAt =\r\n    typeof invite?.verification?.otpRequestedAt === \"string\" ? invite.verification.otpRequestedAt : null;\r\n  const otpAttemptCount = Number.isFinite(invite?.verification?.otpAttemptCount)\r\n    ? Math.max(0, invite.verification.otpAttemptCount)\r\n    : 0;\r\n  const otpMaxAttempts = Number.isFinite(invite?.verification?.otpMaxAttempts)\r\n    ? Math.max(1, invite.verification.otpMaxAttempts)\r\n    : getOtpMaxAttempts();\r\n  const resendAvailableAt =\r\n    typeof invite?.verification?.resendAvailableAt === \"string\" ? invite.verification.resendAvailableAt : null;\r\n  const verifiedAt =\r\n    typeof invite?.verification?.verifiedAt === \"string\" ? invite.verification.verifiedAt : null;\r\n  const phoneHash = typeof invite?.verification?.phoneHash === \"string\" ? invite.verification.phoneHash : null;\r\n  const createdAt = typeof invite?.createdAt === \"string\" ? invite.createdAt : invitedAt;\r\n  const updatedAt = typeof invite?.updatedAt === \"string\" ? invite.updatedAt : invitedAt;\r\n\r\n  return {\r\n    id: typeof invite?.id === \"string\" && invite.id.trim().length > 0 ? invite.id : createId(\"INV\"),\r\n    email,\r\n    role,\r\n    invitedBy: normalizeEmail(invite?.invitedBy) || \"system.clio@gmail.com\",\r\n    invitedAt,\r\n    expiresAt,\r\n    token: typeof invite?.token === \"string\" && invite.token.trim().length > 0 ? invite.token : createInviteToken(),\r\n    status,\r\n    createdAt,\r\n    updatedAt,\r\n    verification: {\r\n      phoneMasked,\r\n      phoneLast4,\r\n      phoneHash,\r\n      otpHash,\r\n      otpExpiresAt,\r\n      otpRequestedAt,\r\n      otpAttemptCount,\r\n      otpMaxAttempts,\r\n      resendAvailableAt,\r\n      verifiedAt,\r\n    },\r\n  };\r\n}\r\n\r\nfunction normalizeStore(rawStore) {\r\n  const rawUsers = Array.isArray(rawStore?.users) ? rawStore.users : [];\r\n  const rawInvites = Array.isArray(rawStore?.invites) ? rawStore.invites : [];\r\n\r\n  const userByEmail = new Map();\r\n  rawUsers\r\n    .map(normalizeUserRecord)\r\n    .filter(Boolean)\r\n    .forEach((record) => {\r\n      if (!userByEmail.has(record.email)) {\r\n        userByEmail.set(record.email, record);\r\n      }\r\n    });\r\n\r\n  return {\r\n    users: Array.from(userByEmail.values()),\r\n    invites: rawInvites.map(normalizeInviteRecord).filter(Boolean),\r\n  };\r\n}\r\n\r\nfunction withBootstrapAccounts(store) {\r\n  const nextStore = {\r\n    users: [...store.users],\r\n    invites: [...store.invites],\r\n  };\r\n\r\n  const existingEmails = new Set(nextStore.users.map((item) => item.email));\r\n  const timestamp = nowIso();\r\n  let changed = false;\r\n\r\n  for (const bootstrap of getBootstrapAccounts()) {\r\n    if (existingEmails.has(bootstrap.email)) {\r\n      continue;\r\n    }\r\n\r\n    nextStore.users.push({\r\n      id: bootstrap.email,\r\n      email: bootstrap.email,\r\n      role: bootstrap.role,\r\n      status: \"active\",\r\n      sessionVersion: 1,\r\n      invitedBy: \"system.clio@gmail.com\",\r\n      invitedAt: timestamp,\r\n      activatedAt: timestamp,\r\n      emailVerifiedAt: timestamp,\r\n      lastLoginAt: null,\r\n      phoneVerifiedAt: timestamp,\r\n      phoneLast4: null,\r\n      phoneHash: null,\r\n      verificationMethod: \"email\",\r\n      updatedAt: timestamp,\r\n      source: \"bootstrap\",\r\n    });\r\n    existingEmails.add(bootstrap.email);\r\n    changed = true;\r\n  }\r\n\r\n  return { store: nextStore, changed };\r\n}\r\n\r\nfunction pruneLegacyLocalAccountsFromStore(store) {\r\n  const nextUsers = store.users.filter((user) => !isLegacyLocalAccountEmail(user?.email));\r\n  const nextInvites = store.invites.filter((invite) => !isLegacyLocalAccountEmail(invite?.email));\r\n  const changed = nextUsers.length !== store.users.length || nextInvites.length !== store.invites.length;\r\n\r\n  return {\r\n    store: {\r\n      users: nextUsers,\r\n      invites: nextInvites,\r\n    },\r\n    changed,\r\n  };\r\n}\r\n\r\nfunction sortUsersByDate(users) {\r\n  return [...users].sort((a, b) => {\r\n    const left = new Date(a.updatedAt || a.invitedAt).getTime();\r\n    const right = new Date(b.updatedAt || b.invitedAt).getTime();\r\n    return right - left;\r\n  });\r\n}\r\n\r\nfunction toPublicUser(user) {\r\n  return {\r\n    id: user.id,\r\n    email: user.email,\r\n    role: user.role,\r\n    status: user.status,\r\n    sessionVersion: normalizeSessionVersion(user?.sessionVersion, 1),\r\n    invitedBy: user.invitedBy,\r\n    invitedAt: user.invitedAt,\r\n    activatedAt: user.activatedAt,\r\n    emailVerifiedAt: user.emailVerifiedAt,\r\n    lastLoginAt: user.lastLoginAt,\r\n    phoneVerifiedAt: user.phoneVerifiedAt,\r\n    phoneLast4: user.phoneLast4,\r\n    smsMfaEnabled: Boolean(user?.smsMfaEnabled),\r\n    verificationMethod: user.verificationMethod,\r\n    archivedAt: user.archivedAt || null,\r\n    archivedBy: user.archivedBy || null,\r\n    archiveReason: user.archiveReason || null,\r\n    isArchived: Boolean(user.isArchived || user.archivedAt),\r\n    retentionDeleteAt: user.retentionDeleteAt || null,\r\n    firstName: user.firstName || \"\",\r\n    middleName: user.middleName || \"\",\r\n    lastName: user.lastName || \"\",\r\n    profilePhotoDataUrl: user.profilePhotoDataUrl || null,\r\n    profilePhotoStoragePath: user.profilePhotoStoragePath || null,\r\n    profileUpdatedAt: user.profileUpdatedAt || null,\r\n    updatedAt: user.updatedAt,\r\n    source: user.source,\r\n  };\r\n}\r\n\r\nfunction getUsersCollectionName() {\r\n  return String(process.env.CLIO_FIRESTORE_USERS_COLLECTION || \"clio_users\").trim() || \"clio_users\";\r\n}\r\n\r\nfunction getInvitesCollectionName() {\r\n  return String(process.env.CLIO_FIRESTORE_INVITES_COLLECTION || \"clio_user_invites\").trim() || \"clio_user_invites\";\r\n}\r\n\r\nasync function getFirestoreStore() {\n  if (!isFirestoreEnabled()) {\n    return null;\n  }\n\n  return getFirestoreDb();\n}\n\nfunction throwFirestoreOperationFailed(error, operation = \"user_accounts\") {\n  const wrapped = new Error(\"firestore_operation_failed\");\n  wrapped.cause = error;\n  wrapped.operation = operation;\n  wrapped.firestoreReason = error instanceof Error ? error.message : \"unknown_firestore_error\";\n  throw wrapped;\n}\n\r\nfunction normalizeFirestoreUser(docId, payload) {\r\n  return normalizeUserRecord({\r\n    id: docId,\r\n    ...payload,\r\n  });\r\n}\r\n\r\nasync function ensureFirestoreBootstrapAccounts(db) {\r\n  const collectionName = getUsersCollectionName();\r\n  const timestamp = nowIso();\r\n\r\n  for (const bootstrap of getBootstrapAccounts()) {\r\n    const normalizedEmail = normalizeEmail(bootstrap.email);\r\n    if (!normalizedEmail) {\r\n      continue;\r\n    }\r\n\r\n    const userRef = doc(db, collectionName, normalizedEmail);\r\n    const existing = await getDoc(userRef);\r\n    if (existing.exists()) {\r\n      continue;\r\n    }\r\n\r\n    await setDoc(userRef, {\r\n      id: normalizedEmail,\r\n      email: normalizedEmail,\r\n      role: bootstrap.role,\r\n      status: \"active\",\r\n      sessionVersion: 1,\r\n      invitedBy: \"system.clio@gmail.com\",\r\n      invitedAt: timestamp,\r\n      activatedAt: timestamp,\r\n      emailVerifiedAt: timestamp,\r\n      lastLoginAt: null,\r\n      phoneVerifiedAt: timestamp,\r\n      phoneLast4: null,\r\n      phoneHash: null,\r\n      verificationMethod: \"email\",\r\n      updatedAt: timestamp,\r\n      source: \"bootstrap\",\r\n    });\r\n  }\r\n}\r\n\r\nasync function pruneLegacyLocalAccountsFromFirestore(db) {\r\n  const usersCollection = getUsersCollectionName();\r\n  const invitesCollection = getInvitesCollectionName();\r\n  const legacyEmails = Array.from(LEGACY_LOCAL_ACCOUNT_EMAILS);\r\n\r\n  for (const email of legacyEmails) {\r\n    try {\r\n      const userRef = doc(db, usersCollection, email);\r\n      const userSnapshot = await getDoc(userRef);\r\n      if (userSnapshot.exists()) {\r\n        await deleteDoc(userRef);\r\n      }\r\n    } catch {\r\n      // Ignore cleanup failures so user listing/login flow is never blocked.\r\n    }\r\n  }\r\n\r\n  try {\r\n    const inviteQuery = query(\r\n      collection(db, invitesCollection),\r\n      where(\"email\", \"in\", legacyEmails),\r\n      queryLimit(20),\r\n    );\r\n    const inviteSnapshot = await getDocs(inviteQuery);\r\n    for (const inviteDoc of inviteSnapshot.docs) {\r\n      const payload = inviteDoc.data() || {};\r\n      const email = normalizeEmail(payload.email);\r\n      if (!LEGACY_LOCAL_ACCOUNT_EMAILS.has(email)) {\r\n        continue;\r\n      }\r\n      await deleteDoc(doc(db, invitesCollection, inviteDoc.id));\r\n    }\r\n  } catch {\r\n    // Ignore cleanup failures so user listing/login flow is never blocked.\r\n  }\r\n}\r\n\r\nasync function ensureUserDirectoryPreparedInFirestore(db) {\r\n  await pruneLegacyLocalAccountsFromFirestore(db);\r\n  await ensureFirestoreBootstrapAccounts(db);\r\n}\r\n\r\nasync function listUserAccountsFromFirestore(db) {\r\n  await ensureUserDirectoryPreparedInFirestore(db);\r\n\r\n  const snapshot = await getDocs(collection(db, getUsersCollectionName()));\r\n  const users = snapshot.docs\r\n    .map((item) => normalizeFirestoreUser(item.id, item.data()))\r\n    .filter(Boolean)\r\n    .filter((user) => !isLegacyLocalAccountEmail(user.email))\r\n    .map(toPublicUser);\r\n\r\n  return sortUsersByDate(users);\r\n}\r\n\r\nasync function getLoginAccountFromFirestore(db, email) {\r\n  if (isLegacyLocalAccountEmail(email)) {\r\n    return null;\r\n  }\r\n\r\n  await ensureUserDirectoryPreparedInFirestore(db);\r\n\r\n  const userRef = doc(db, getUsersCollectionName(), email);\r\n  const snapshot = await getDoc(userRef);\r\n  if (!snapshot.exists()) {\r\n    return null;\r\n  }\r\n\r\n  const normalized = normalizeFirestoreUser(snapshot.id, snapshot.data());\r\n  return normalized ? toPublicUser(normalized) : null;\r\n}\r\n\r\nasync function markUserLoginInFirestore(db, email) {\r\n  const userRef = doc(db, getUsersCollectionName(), email);\r\n  const snapshot = await getDoc(userRef);\r\n  if (!snapshot.exists()) {\r\n    return null;\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  await updateDoc(userRef, {\r\n    lastLoginAt: timestamp,\r\n    updatedAt: timestamp,\r\n  });\r\n\r\n  const updated = normalizeFirestoreUser(snapshot.id, {\r\n    ...snapshot.data(),\r\n    lastLoginAt: timestamp,\r\n    updatedAt: timestamp,\r\n  });\r\n\r\n  return updated ? toPublicUser(updated) : null;\r\n}\r\n\r\nasync function revokeUserSessionsInFirestore(db, { userId }) {\r\n  const normalizedUserId = String(userId || \"\").trim().toLowerCase();\r\n  if (!normalizedUserId) {\r\n    throw new Error(\"invalid_user\");\r\n  }\r\n\r\n  const userRef = doc(db, getUsersCollectionName(), normalizedUserId);\r\n  const snapshot = await getDoc(userRef);\r\n  if (!snapshot.exists()) {\r\n    return null;\r\n  }\r\n\r\n  const currentData = snapshot.data() || {};\r\n  const currentSessionVersion = normalizeSessionVersion(currentData?.sessionVersion, 1);\r\n  const timestamp = nowIso();\r\n  const nextPayload = {\r\n    sessionVersion: currentSessionVersion + 1,\r\n    updatedAt: timestamp,\r\n  };\r\n\r\n  await updateDoc(userRef, nextPayload);\r\n\r\n  const updated = normalizeFirestoreUser(snapshot.id, {\r\n    ...currentData,\r\n    ...nextPayload,\r\n  });\r\n  return updated ? toPublicUser(updated) : null;\r\n}\r\n\r\nasync function inviteUserAccountInFirestore(db, { email, role, invitedBy }) {\r\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!isValidEmail(normalizedEmail)) {\r\n    throw new Error(\"invalid_email\");\r\n  }\r\n\r\n  const requestedRole = normalizeRequestedAccountRole(role);\r\n  if (!requestedRole) {\r\n    throw new Error(\"invalid_role\");\r\n  }\r\n\r\n  const sender = normalizeEmail(invitedBy) || \"superadmin.clio@gmail.com\";\r\n  const timestamp = nowIso();\r\n  const userRef = doc(db, getUsersCollectionName(), normalizedEmail);\r\n  const existing = await getDoc(userRef);\r\n\r\n  const basePayload = existing.exists() ? existing.data() : {};\r\n  const nextSessionVersion = existing.exists()\r\n    ? normalizeSessionVersion(basePayload?.sessionVersion, 1) + 1\r\n    : 1;\r\n  const nextUser = normalizeUserRecord({\r\n    ...basePayload,\r\n    id: normalizedEmail,\r\n    email: normalizedEmail,\r\n    role: requestedRole,\r\n    status: \"pending\",\r\n    sessionVersion: nextSessionVersion,\r\n    invitedBy: sender,\r\n    invitedAt: timestamp,\r\n    emailVerifiedAt: null,\r\n    phoneVerifiedAt: null,\r\n    phoneLast4: null,\r\n    phoneHash: null,\r\n    verificationMethod: null,\r\n    updatedAt: timestamp,\r\n    source: basePayload?.source === \"bootstrap\" ? \"bootstrap\" : \"invite\",\r\n  });\r\n\r\n  await setDoc(userRef, nextUser);\r\n\r\n  const priorInvites = await getDocs(\r\n    query(collection(db, getInvitesCollectionName()), where(\"email\", \"==\", normalizedEmail)),\r\n  );\r\n  for (const inviteSnapshot of priorInvites.docs) {\r\n    const payload = inviteSnapshot.data() || {};\r\n    if (![\"sent\", \"otp_sent\", \"expired\"].includes(payload?.status)) {\r\n      continue;\r\n    }\r\n\r\n    await updateDoc(doc(db, getInvitesCollectionName(), inviteSnapshot.id), {\r\n      status: \"revoked\",\r\n      updatedAt: timestamp,\r\n    });\r\n  }\r\n\r\n  const expiresAt = createInviteExpirationIso();\r\n  const invite = {\r\n    email: normalizedEmail,\r\n    role: requestedRole,\r\n    invitedBy: sender,\r\n    invitedAt: timestamp,\r\n    expiresAt,\r\n    token: createInviteToken(),\r\n    status: \"sent\",\r\n    createdAt: timestamp,\r\n    updatedAt: timestamp,\r\n    verification: {\r\n      phoneMasked: null,\r\n      phoneLast4: null,\r\n      phoneHash: null,\r\n      otpHash: null,\r\n      otpExpiresAt: null,\r\n      otpRequestedAt: null,\r\n      otpAttemptCount: 0,\r\n      otpMaxAttempts: getOtpMaxAttempts(),\r\n      resendAvailableAt: null,\r\n      verifiedAt: null,\r\n    },\r\n  };\r\n\r\n  const inviteRef = await addDoc(collection(db, getInvitesCollectionName()), invite);\r\n\r\n  return {\r\n    user: toPublicUser(nextUser),\r\n    invite: {\r\n      id: inviteRef.id,\r\n      email: invite.email,\r\n      role: invite.role,\r\n      invitedBy: invite.invitedBy,\r\n      invitedAt: invite.invitedAt,\r\n      expiresAt: invite.expiresAt,\r\n      status: invite.status,\r\n      token: invite.token,\r\n    },\r\n  };\r\n}\r\n\r\nasync function updateUserAccountStatusInFirestore(db, { userId, status }) {\r\n  const normalizedStatus = String(status || \"\")\r\n    .trim()\r\n    .toLowerCase();\r\n  if (!ALLOWED_STATUSES.has(normalizedStatus)) {\r\n    throw new Error(\"invalid_status\");\r\n  }\r\n\r\n  const normalizedUserId = String(userId || \"\").trim().toLowerCase();\r\n  if (!normalizedUserId) {\r\n    throw new Error(\"invalid_user\");\r\n  }\r\n\r\n  const userRef = doc(db, getUsersCollectionName(), normalizedUserId);\r\n  const snapshot = await getDoc(userRef);\r\n  if (!snapshot.exists()) {\r\n    return null;\r\n  }\r\n\r\n  const currentData = snapshot.data() || {};\r\n  const currentStatus = String(currentData?.status || \"\").trim().toLowerCase();\r\n  const currentSessionVersion = normalizeSessionVersion(currentData?.sessionVersion, 1);\r\n\r\n  const timestamp = nowIso();\r\n  const nextPayload = {\r\n    status: normalizedStatus,\r\n    sessionVersion: normalizedStatus !== currentStatus ? currentSessionVersion + 1 : currentSessionVersion,\r\n    updatedAt: timestamp,\r\n  };\r\n\r\n  if (normalizedStatus === \"active\" && !currentData?.activatedAt) {\r\n    nextPayload.activatedAt = timestamp;\r\n  }\r\n\r\n  await updateDoc(userRef, nextPayload);\r\n\r\n  const updated = normalizeFirestoreUser(snapshot.id, {\r\n    ...currentData,\r\n    ...nextPayload,\r\n  });\r\n\r\n  return updated ? toPublicUser(updated) : null;\r\n}\r\n\r\nasync function updateUserAccountRoleInFirestore(db, { userId, role }) {\r\n  const normalizedRole = normalizeRequestedAccountRole(role);\r\n  if (!normalizedRole) {\r\n    throw new Error(\"invalid_role\");\r\n  }\r\n\r\n  const normalizedUserId = String(userId || \"\").trim().toLowerCase();\r\n  if (!normalizedUserId) {\r\n    throw new Error(\"invalid_user\");\r\n  }\r\n\r\n  const userRef = doc(db, getUsersCollectionName(), normalizedUserId);\r\n  const snapshot = await getDoc(userRef);\r\n  if (!snapshot.exists()) {\r\n    return null;\r\n  }\r\n\r\n  const currentData = snapshot.data() || {};\r\n  const currentRole = normalizeStoredAccountRole(currentData?.role, \"HR\");\r\n  const currentSessionVersion = normalizeSessionVersion(currentData?.sessionVersion, 1);\r\n  const timestamp = nowIso();\r\n  const nextPayload = {\r\n    role: normalizedRole,\r\n    sessionVersion: normalizedRole !== currentRole ? currentSessionVersion + 1 : currentSessionVersion,\r\n    updatedAt: timestamp,\r\n  };\r\n\r\n  await updateDoc(userRef, nextPayload);\r\n\r\n  const updated = normalizeFirestoreUser(snapshot.id, {\r\n    ...currentData,\r\n    ...nextPayload,\r\n  });\r\n\r\n  return updated ? toPublicUser(updated) : null;\r\n}\r\n\r\nasync function archiveUserAccountInFirestore(\r\n  db,\r\n  {\r\n    userId,\r\n    archivedBy,\r\n    reason,\r\n    retentionDeleteAt,\r\n  },\r\n) {\r\n  const normalizedUserId = String(userId || \"\").trim().toLowerCase();\r\n  if (!normalizedUserId) {\r\n    throw new Error(\"invalid_user\");\r\n  }\r\n\r\n  const userRef = doc(db, getUsersCollectionName(), normalizedUserId);\r\n  const snapshot = await getDoc(userRef);\r\n  if (!snapshot.exists()) {\r\n    return null;\r\n  }\r\n\r\n  const currentData = snapshot.data() || {};\r\n  const currentStatus = String(currentData?.status || \"\").trim().toLowerCase();\r\n  const currentSessionVersion = normalizeSessionVersion(currentData?.sessionVersion, 1);\r\n  const timestamp = nowIso();\r\n  const nextPayload = {\r\n    status: \"disabled\",\r\n    archivedAt: timestamp,\r\n    archivedBy: normalizeEmail(archivedBy) || \"system.clio@gmail.com\",\r\n    archiveReason: String(reason || \"\").trim() || \"Resigned\",\r\n    isArchived: true,\r\n    retentionDeleteAt: resolveRetentionDeleteAt({\r\n      archivedAt: timestamp,\r\n      retentionDeleteAt,\r\n    }),\r\n    sessionVersion: currentStatus !== \"disabled\" ? currentSessionVersion + 1 : currentSessionVersion,\r\n    updatedAt: timestamp,\r\n  };\r\n\r\n  await updateDoc(userRef, nextPayload);\r\n\r\n  const updated = normalizeFirestoreUser(snapshot.id, {\r\n    ...currentData,\r\n    ...nextPayload,\r\n  });\r\n\r\n  return updated ? toPublicUser(updated) : null;\r\n}\r\n\r\nasync function updateUserAccountProfileInFirestore(\r\n  db,\r\n  { userId, firstName, middleName, lastName, profilePhotoDataUrl, profilePhotoStoragePath, smsMfaEnabled },\r\n) {\r\n  const normalizedUserId = String(userId || \"\").trim().toLowerCase();\r\n  if (!normalizedUserId) {\r\n    throw new Error(\"invalid_user\");\r\n  }\r\n\r\n  const userRef = doc(db, getUsersCollectionName(), normalizedUserId);\r\n  const snapshot = await getDoc(userRef);\r\n  if (!snapshot.exists()) {\r\n    return null;\r\n  }\r\n\r\n  const current = normalizeFirestoreUser(snapshot.id, snapshot.data());\r\n  if (!current) {\r\n    return null;\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  const shouldUpdateMfa = typeof smsMfaEnabled === \"boolean\";\r\n  if (shouldUpdateMfa && smsMfaEnabled && !current.phoneVerifiedAt) {\r\n    throw new Error(\"mfa_phone_not_verified\");\r\n  }\r\n  const nextPayload = {\r\n    firstName: normalizeNameField(firstName),\r\n    middleName: normalizeNameField(middleName),\r\n    lastName: normalizeNameField(lastName),\r\n    profilePhotoDataUrl: normalizeProfilePhotoDataUrl(profilePhotoDataUrl),\r\n    profilePhotoStoragePath: normalizeStoragePath(profilePhotoStoragePath),\r\n    profileUpdatedAt: timestamp,\r\n    updatedAt: timestamp,\r\n  };\r\n  if (shouldUpdateMfa) {\r\n    nextPayload.smsMfaEnabled = smsMfaEnabled;\r\n    if (!smsMfaEnabled) {\r\n      nextPayload.loginMfa = null;\r\n    }\r\n  }\r\n\r\n  await updateDoc(userRef, nextPayload);\r\n\r\n  const updated = normalizeFirestoreUser(snapshot.id, {\r\n    ...snapshot.data(),\r\n    ...nextPayload,\r\n  });\r\n\r\n  return updated ? toPublicUser(updated) : null;\r\n}\r\n\r\nasync function writeStore(store) {\r\n  await fs.writeFile(USER_STORE_FILE, `${JSON.stringify(store, null, 2)}\\n`, \"utf8\");\r\n}\r\n\r\nasync function readStoreFile() {\r\n  const rawContent = await fs.readFile(USER_STORE_FILE, \"utf8\").catch(() => \"\");\r\n  if (!rawContent.trim()) {\r\n    return { users: [], invites: [] };\r\n  }\r\n\r\n  try {\r\n    return JSON.parse(rawContent);\r\n  } catch {\r\n    return { users: [], invites: [] };\r\n  }\r\n}\r\n\r\nasync function ensureStore() {\r\n  if (!storeInitPromise) {\r\n    storeInitPromise = (async () => {\r\n      await fs.mkdir(DATA_DIR, { recursive: true });\r\n      const raw = await readStoreFile();\r\n      const normalized = normalizeStore(raw);\r\n      const { store: prunedStore } = pruneLegacyLocalAccountsFromStore(normalized);\r\n      const { store } = withBootstrapAccounts(prunedStore);\r\n      await writeStore(store);\r\n    })();\r\n  }\r\n\r\n  return storeInitPromise;\r\n}\r\n\r\nasync function loadStore() {\r\n  await ensureStore();\r\n  const raw = await readStoreFile();\r\n  const normalized = normalizeStore(raw);\r\n  const { store: prunedStore, changed: pruneChanged } = pruneLegacyLocalAccountsFromStore(normalized);\r\n  const { store, changed: bootstrapChanged } = withBootstrapAccounts(prunedStore);\r\n  const changed = pruneChanged || bootstrapChanged;\r\n\r\n  if (changed) {\r\n    await writeStore(store);\r\n  }\r\n\r\n  return store;\r\n}\r\n\r\nasync function listUserAccountsFromFile() {\r\n  const store = await loadStore();\r\n  return sortUsersByDate(store.users)\r\n    .filter((user) => !isLegacyLocalAccountEmail(user.email))\r\n    .map(toPublicUser);\r\n}\r\n\r\nasync function getLoginAccountFromFile(email) {\r\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!normalizedEmail) {\r\n    return null;\r\n  }\r\n  if (isLegacyLocalAccountEmail(normalizedEmail)) {\r\n    return null;\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const user = store.users.find((item) => item.email === normalizedEmail);\r\n  return user ? toPublicUser(user) : null;\r\n}\r\n\r\nasync function markUserLoginInFile(email) {\r\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!normalizedEmail) {\r\n    return null;\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const target = store.users.find((item) => item.email === normalizedEmail);\r\n  if (!target) {\r\n    return null;\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  target.lastLoginAt = timestamp;\r\n  target.updatedAt = timestamp;\r\n  await writeStore(store);\r\n  return toPublicUser(target);\r\n}\r\n\r\nasync function recordLoginDeviceInFile({ email, device }) {\r\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!normalizedEmail) {\r\n    return null;\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const target = store.users.find((item) => item.email === normalizedEmail);\r\n  if (!target) {\r\n    return null;\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  const devicePayload = normalizeDeviceEntry({\r\n    ...device,\r\n    firstSeenAt: timestamp,\r\n    lastSeenAt: timestamp,\r\n  });\r\n  if (!devicePayload) {\r\n    return null;\r\n  }\r\n\r\n  const existingDevices = normalizeDeviceList(target.knownDevices);\r\n  const existingIndex = existingDevices.findIndex((entry) => entry.deviceId === devicePayload.deviceId);\r\n  const updatedDevice =\r\n    existingIndex >= 0\r\n      ? {\r\n          ...existingDevices[existingIndex],\r\n          label: devicePayload.label || existingDevices[existingIndex].label,\r\n          userAgent: devicePayload.userAgent || existingDevices[existingIndex].userAgent,\r\n          lastIp: devicePayload.lastIp || existingDevices[existingIndex].lastIp,\r\n          lastSeenAt: timestamp,\r\n        }\r\n      : devicePayload;\r\n\r\n  const nextDevices = [...existingDevices];\r\n  if (existingIndex >= 0) {\r\n    nextDevices.splice(existingIndex, 1, updatedDevice);\r\n  } else {\r\n    nextDevices.push(updatedDevice);\r\n  }\r\n\r\n  target.knownDevices = normalizeDeviceList(nextDevices);\r\n  target.updatedAt = timestamp;\r\n  await writeStore(store);\r\n\r\n  return {\r\n    isNew: existingIndex < 0,\r\n    device: updatedDevice,\r\n  };\r\n}\r\n\r\nasync function updateDeviceTrustInFirestore(db, { email, deviceId, trusted, deniedReason }) {\r\n  const userRef = doc(db, getUsersCollectionName(), email);\r\n  const snapshot = await getDoc(userRef);\r\n  if (!snapshot.exists()) {\r\n    return null;\r\n  }\r\n\r\n  const current = normalizeFirestoreUser(snapshot.id, snapshot.data());\r\n  if (!current) {\r\n    return null;\r\n  }\r\n\r\n  const existingDevices = normalizeDeviceList(current.knownDevices);\r\n  const index = existingDevices.findIndex((entry) => entry.deviceId === deviceId);\r\n  if (index < 0) {\r\n    return null;\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  const updatedDevice = {\r\n    ...existingDevices[index],\r\n    trusted: Boolean(trusted),\r\n    deniedAt: trusted ? null : timestamp,\r\n    deniedReason: trusted ? null : deniedReason || \"user_reported\",\r\n    lastSeenAt: timestamp,\r\n  };\r\n\r\n  const nextDevices = [...existingDevices];\r\n  nextDevices.splice(index, 1, updatedDevice);\r\n  const normalizedDevices = normalizeDeviceList(nextDevices);\r\n\r\n  await updateDoc(userRef, {\r\n    knownDevices: normalizedDevices,\r\n    updatedAt: timestamp,\r\n  });\r\n\r\n  return updatedDevice;\r\n}\r\n\r\nasync function updateDeviceTrustInFile({ email, deviceId, trusted, deniedReason }) {\r\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!normalizedEmail) {\r\n    return null;\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const target = store.users.find((item) => item.email === normalizedEmail);\r\n  if (!target) {\r\n    return null;\r\n  }\r\n\r\n  const existingDevices = normalizeDeviceList(target.knownDevices);\r\n  const index = existingDevices.findIndex((entry) => entry.deviceId === deviceId);\r\n  if (index < 0) {\r\n    return null;\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  const updatedDevice = {\r\n    ...existingDevices[index],\r\n    trusted: Boolean(trusted),\r\n    deniedAt: trusted ? null : timestamp,\r\n    deniedReason: trusted ? null : deniedReason || \"user_reported\",\r\n    lastSeenAt: timestamp,\r\n  };\r\n\r\n  const nextDevices = [...existingDevices];\r\n  nextDevices.splice(index, 1, updatedDevice);\r\n  target.knownDevices = normalizeDeviceList(nextDevices);\r\n  target.updatedAt = timestamp;\r\n  await writeStore(store);\r\n  return updatedDevice;\r\n}\r\n\r\nasync function revokeUserSessionsInFile({ userId }) {\r\n  const normalizedUserId = String(userId || \"\").trim().toLowerCase();\r\n  if (!normalizedUserId) {\r\n    throw new Error(\"invalid_user\");\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const user = store.users.find((item) => item.id === normalizedUserId || item.email === normalizedUserId);\r\n  if (!user) {\r\n    return null;\r\n  }\r\n\r\n  const currentSessionVersion = normalizeSessionVersion(user.sessionVersion, 1);\r\n  user.sessionVersion = currentSessionVersion + 1;\r\n  user.updatedAt = nowIso();\r\n  await writeStore(store);\r\n  return toPublicUser(user);\r\n}\r\n\r\nasync function inviteUserAccountInFile({ email, role, invitedBy }) {\r\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!isValidEmail(normalizedEmail)) {\r\n    throw new Error(\"invalid_email\");\r\n  }\r\n\r\n  const requestedRole = normalizeRequestedAccountRole(role);\r\n  if (!requestedRole) {\r\n    throw new Error(\"invalid_role\");\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const timestamp = nowIso();\r\n  const sender = normalizeEmail(invitedBy) || \"superadmin.clio@gmail.com\";\r\n\r\n  for (const existingInvite of store.invites) {\r\n    if (existingInvite.email !== normalizedEmail) {\r\n      continue;\r\n    }\r\n    if (![\"sent\", \"otp_sent\", \"expired\"].includes(existingInvite.status)) {\r\n      continue;\r\n    }\r\n\r\n    existingInvite.status = \"revoked\";\r\n    existingInvite.updatedAt = timestamp;\r\n  }\r\n\r\n  let user = store.users.find((item) => item.email === normalizedEmail);\r\n  if (!user) {\r\n    user = {\r\n      id: normalizedEmail,\r\n      email: normalizedEmail,\r\n      role: requestedRole,\r\n      status: \"pending\",\r\n      sessionVersion: 1,\r\n      invitedBy: sender,\r\n      invitedAt: timestamp,\r\n      activatedAt: null,\r\n      emailVerifiedAt: null,\r\n      lastLoginAt: null,\r\n      phoneVerifiedAt: null,\r\n      phoneLast4: null,\r\n      phoneHash: null,\r\n      verificationMethod: null,\r\n      updatedAt: timestamp,\r\n      source: \"invite\",\r\n    };\r\n    store.users.push(user);\r\n  } else {\r\n    const currentSessionVersion = normalizeSessionVersion(user.sessionVersion, 1);\r\n    user.role = requestedRole;\r\n    user.status = \"pending\";\r\n    user.sessionVersion = currentSessionVersion + 1;\r\n    user.invitedBy = sender;\r\n    user.invitedAt = timestamp;\r\n    user.emailVerifiedAt = null;\r\n    user.phoneVerifiedAt = null;\r\n    user.phoneLast4 = null;\r\n    user.phoneHash = null;\r\n    user.verificationMethod = null;\r\n    user.updatedAt = timestamp;\r\n    if (user.source !== \"bootstrap\") {\r\n      user.source = \"invite\";\r\n    }\r\n  }\r\n\r\n  const expiresAt = createInviteExpirationIso();\r\n  const invite = {\r\n    id: createId(\"INV\"),\r\n    email: normalizedEmail,\r\n    role: requestedRole,\r\n    invitedBy: sender,\r\n    invitedAt: timestamp,\r\n    expiresAt,\r\n    token: createInviteToken(),\r\n    status: \"sent\",\r\n    createdAt: timestamp,\r\n    updatedAt: timestamp,\r\n    verification: {\r\n      phoneMasked: null,\r\n      phoneLast4: null,\r\n      phoneHash: null,\r\n      otpHash: null,\r\n      otpExpiresAt: null,\r\n      otpRequestedAt: null,\r\n      otpAttemptCount: 0,\r\n      otpMaxAttempts: getOtpMaxAttempts(),\r\n      resendAvailableAt: null,\r\n      verifiedAt: null,\r\n    },\r\n  };\r\n\r\n  store.invites.unshift(invite);\r\n  if (store.invites.length > 500) {\r\n    store.invites.length = 500;\r\n  }\r\n\r\n  await writeStore(store);\r\n\r\n  return {\r\n    user: toPublicUser(user),\r\n    invite: {\r\n      id: invite.id,\r\n      email: invite.email,\r\n      role: invite.role,\r\n      invitedBy: invite.invitedBy,\r\n      invitedAt: invite.invitedAt,\r\n      expiresAt: invite.expiresAt,\r\n      status: invite.status,\r\n      token: invite.token,\r\n    },\r\n  };\r\n}\r\n\r\nasync function updateUserAccountStatusInFile({ userId, status }) {\r\n  const normalizedStatus = String(status || \"\")\r\n    .trim()\r\n    .toLowerCase();\r\n  if (!ALLOWED_STATUSES.has(normalizedStatus)) {\r\n    throw new Error(\"invalid_status\");\r\n  }\r\n\r\n  const normalizedUserId = String(userId || \"\").trim().toLowerCase();\r\n  if (!normalizedUserId) {\r\n    throw new Error(\"invalid_user\");\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const user = store.users.find((item) => item.id === normalizedUserId || item.email === normalizedUserId);\r\n  if (!user) {\r\n    return null;\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  const currentStatus = String(user.status || \"\").trim().toLowerCase();\r\n  const currentSessionVersion = normalizeSessionVersion(user.sessionVersion, 1);\r\n  user.status = normalizedStatus;\r\n  user.sessionVersion = normalizedStatus !== currentStatus ? currentSessionVersion + 1 : currentSessionVersion;\r\n  user.updatedAt = timestamp;\r\n  if (normalizedStatus === \"active\" && !user.activatedAt) {\r\n    user.activatedAt = timestamp;\r\n  }\r\n\r\n  await writeStore(store);\r\n  return toPublicUser(user);\r\n}\r\n\r\nasync function updateUserAccountRoleInFile({ userId, role }) {\r\n  const normalizedRole = normalizeRequestedAccountRole(role);\r\n  if (!normalizedRole) {\r\n    throw new Error(\"invalid_role\");\r\n  }\r\n\r\n  const normalizedUserId = String(userId || \"\").trim().toLowerCase();\r\n  if (!normalizedUserId) {\r\n    throw new Error(\"invalid_user\");\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const user = store.users.find((item) => item.id === normalizedUserId || item.email === normalizedUserId);\r\n  if (!user) {\r\n    return null;\r\n  }\r\n\r\n  const currentRole = normalizeStoredAccountRole(user.role, \"HR\");\r\n  const currentSessionVersion = normalizeSessionVersion(user.sessionVersion, 1);\r\n  user.role = normalizedRole;\r\n  user.sessionVersion = normalizedRole !== currentRole ? currentSessionVersion + 1 : currentSessionVersion;\r\n  user.updatedAt = nowIso();\r\n\r\n  await writeStore(store);\r\n  return toPublicUser(user);\r\n}\r\n\r\nasync function archiveUserAccountInFile({\r\n  userId,\r\n  archivedBy,\r\n  reason,\r\n  retentionDeleteAt,\r\n}) {\r\n  const normalizedUserId = String(userId || \"\").trim().toLowerCase();\r\n  if (!normalizedUserId) {\r\n    throw new Error(\"invalid_user\");\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const user = store.users.find((item) => item.id === normalizedUserId || item.email === normalizedUserId);\r\n  if (!user) {\r\n    return null;\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  const currentStatus = String(user.status || \"\").trim().toLowerCase();\r\n  const currentSessionVersion = normalizeSessionVersion(user.sessionVersion, 1);\r\n  user.status = \"disabled\";\r\n  user.archivedAt = timestamp;\r\n  user.archivedBy = normalizeEmail(archivedBy) || \"system.clio@gmail.com\";\r\n  user.archiveReason = String(reason || \"\").trim() || \"Resigned\";\r\n  user.isArchived = true;\r\n  user.retentionDeleteAt = resolveRetentionDeleteAt({\r\n    archivedAt: timestamp,\r\n    retentionDeleteAt,\r\n  });\r\n  user.sessionVersion = currentStatus !== \"disabled\" ? currentSessionVersion + 1 : currentSessionVersion;\r\n  user.updatedAt = timestamp;\r\n\r\n  await writeStore(store);\r\n  return toPublicUser(user);\r\n}\r\n\r\nasync function updateUserAccountProfileInFile({\r\n  userId,\r\n  firstName,\r\n  middleName,\r\n  lastName,\r\n  profilePhotoDataUrl,\r\n  profilePhotoStoragePath,\r\n  smsMfaEnabled,\r\n}) {\r\n  const normalizedUserId = String(userId || \"\").trim().toLowerCase();\r\n  if (!normalizedUserId) {\r\n    throw new Error(\"invalid_user\");\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const user = store.users.find((item) => item.id === normalizedUserId || item.email === normalizedUserId);\r\n  if (!user) {\r\n    return null;\r\n  }\r\n\r\n  const shouldUpdateMfa = typeof smsMfaEnabled === \"boolean\";\r\n  if (shouldUpdateMfa && smsMfaEnabled && !user.phoneVerifiedAt) {\r\n    throw new Error(\"mfa_phone_not_verified\");\r\n  }\r\n\r\n  user.firstName = normalizeNameField(firstName);\r\n  user.middleName = normalizeNameField(middleName);\r\n  user.lastName = normalizeNameField(lastName);\r\n  user.profilePhotoDataUrl = normalizeProfilePhotoDataUrl(profilePhotoDataUrl);\r\n  user.profilePhotoStoragePath = normalizeStoragePath(profilePhotoStoragePath);\r\n  if (shouldUpdateMfa) {\r\n    user.smsMfaEnabled = smsMfaEnabled;\r\n    if (!smsMfaEnabled) {\r\n      user.loginMfa = null;\r\n    }\r\n  }\r\n  user.profileUpdatedAt = nowIso();\r\n  user.updatedAt = user.profileUpdatedAt;\r\n\r\n  await writeStore(store);\r\n  return toPublicUser(user);\r\n}\r\n\r\nasync function purgeDueArchivedUserAccountsInFirestore(db, { now }) {\r\n  const cutoff = normalizeIsoTimestamp(now) || nowIso();\r\n  const usersRef = collection(db, getUsersCollectionName());\r\n  const usersSnapshot = await getDocs(query(usersRef, where(\"retentionDeleteAt\", \"<=\", cutoff)));\r\n  let deletedUsers = 0;\r\n  let deletedInvites = 0;\r\n  const deletedEmails = [];\r\n\r\n  for (const userSnapshot of usersSnapshot.docs) {\r\n    const payload = userSnapshot.data() || {};\r\n    const archivedAt = normalizeIsoTimestamp(payload.archivedAt);\r\n    if (!archivedAt) {\r\n      continue;\r\n    }\r\n\r\n    const email = normalizeEmail(payload.email || userSnapshot.id);\r\n    await deleteDoc(doc(db, getUsersCollectionName(), userSnapshot.id));\r\n    deletedUsers += 1;\r\n    if (email) {\r\n      deletedEmails.push(email);\r\n      const inviteRef = collection(db, getInvitesCollectionName());\r\n      const inviteSnapshot = await getDocs(query(inviteRef, where(\"email\", \"==\", email)));\r\n      for (const inviteDoc of inviteSnapshot.docs) {\r\n        await deleteDoc(doc(db, getInvitesCollectionName(), inviteDoc.id));\r\n        deletedInvites += 1;\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    cutoff,\r\n    deletedUsers,\r\n    deletedInvites,\r\n    deletedEmails,\r\n  };\r\n}\r\n\r\nasync function purgeDueArchivedUserAccountsInFile({ now }) {\r\n  const cutoff = normalizeIsoTimestamp(now) || nowIso();\r\n  const store = await loadStore();\r\n  const dueEmails = new Set();\r\n\r\n  store.users.forEach((user) => {\r\n    const archivedAt = normalizeIsoTimestamp(user.archivedAt);\r\n    if (!archivedAt) {\r\n      return;\r\n    }\r\n    const retentionDeleteAt = resolveRetentionDeleteAt({\r\n      archivedAt,\r\n      retentionDeleteAt: user.retentionDeleteAt,\r\n    });\r\n    if (retentionDeleteAt <= cutoff) {\r\n      dueEmails.add(user.email);\r\n    }\r\n  });\r\n\r\n  if (dueEmails.size === 0) {\r\n    return {\r\n      cutoff,\r\n      deletedUsers: 0,\r\n      deletedInvites: 0,\r\n      deletedEmails: [],\r\n    };\r\n  }\r\n\r\n  const initialUserCount = store.users.length;\r\n  const initialInviteCount = store.invites.length;\r\n  store.users = store.users.filter((user) => !dueEmails.has(user.email));\r\n  store.invites = store.invites.filter((invite) => !dueEmails.has(invite.email));\r\n  await writeStore(store);\r\n\r\n  return {\r\n    cutoff,\r\n    deletedUsers: initialUserCount - store.users.length,\r\n    deletedInvites: initialInviteCount - store.invites.length,\r\n    deletedEmails: Array.from(dueEmails.values()),\r\n  };\r\n}\r\n\r\nasync function revokeInviteByIdInFirestore(db, inviteId) {\r\n  const normalizedInviteId = String(inviteId || \"\").trim();\r\n  if (!normalizedInviteId) {\r\n    throw new Error(\"invalid_invite\");\r\n  }\r\n\r\n  const inviteRef = doc(db, getInvitesCollectionName(), normalizedInviteId);\r\n  const snapshot = await getDoc(inviteRef);\r\n  if (!snapshot.exists()) {\r\n    return null;\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  await updateDoc(inviteRef, {\r\n    status: \"revoked\",\r\n    updatedAt: timestamp,\r\n  });\r\n\r\n  const normalized = normalizeInviteRecord({\r\n    id: snapshot.id,\r\n    ...snapshot.data(),\r\n    status: \"revoked\",\r\n    updatedAt: timestamp,\r\n  });\r\n  return normalized ? toPublicInvite(normalized) : null;\r\n}\r\n\r\nasync function revokeInviteByIdInFile(inviteId) {\r\n  const normalizedInviteId = String(inviteId || \"\").trim();\r\n  if (!normalizedInviteId) {\r\n    throw new Error(\"invalid_invite\");\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const invite = store.invites.find((item) => item.id === normalizedInviteId);\r\n  if (!invite) {\r\n    return null;\r\n  }\r\n\r\n  invite.status = \"revoked\";\r\n  invite.updatedAt = nowIso();\r\n  await writeStore(store);\r\n  return toPublicInvite(invite);\r\n}\r\n\r\nfunction isInviteExpired(invite) {\r\n  const expiresMs = new Date(invite?.expiresAt).getTime();\r\n  if (!Number.isFinite(expiresMs)) {\r\n    return false;\r\n  }\r\n  return expiresMs <= Date.now();\r\n}\r\n\r\nfunction resolveInviteStatus(invite) {\r\n  if (!invite) {\r\n    return \"revoked\";\r\n  }\r\n\r\n  if (invite.status === \"verified\" || invite.status === \"revoked\" || invite.status === \"expired\") {\r\n    return invite.status;\r\n  }\r\n\r\n  return isInviteExpired(invite) ? \"expired\" : invite.status;\r\n}\r\n\r\nfunction toPublicInvite(invite) {\r\n  const status = resolveInviteStatus(invite);\r\n  return {\r\n    id: invite.id,\r\n    role: invite.role,\r\n    status,\r\n    invitedAt: invite.invitedAt,\r\n    expiresAt: invite.expiresAt,\r\n    emailMasked: maskEmail(invite.email),\r\n    phoneMasked: invite.verification?.phoneMasked || null,\r\n    verifiedAt: invite.verification?.verifiedAt || null,\r\n    otpRequestedAt: invite.verification?.otpRequestedAt || null,\r\n    otpExpiresAt: invite.verification?.otpExpiresAt || null,\r\n    resendAvailableAt: invite.verification?.resendAvailableAt || null,\r\n  };\r\n}\r\n\r\nasync function findInviteDocumentByTokenInFirestore(db, token) {\r\n  const normalizedToken = normalizeInviteToken(token);\r\n  if (!normalizedToken) {\r\n    return null;\r\n  }\r\n\r\n  const snapshot = await getDocs(\r\n    query(collection(db, getInvitesCollectionName()), where(\"token\", \"==\", normalizedToken), queryLimit(1)),\r\n  );\r\n  if (snapshot.empty) {\r\n    return null;\r\n  }\r\n\r\n  const inviteDoc = snapshot.docs[0];\r\n  const normalizedInvite = normalizeInviteRecord({\r\n    id: inviteDoc.id,\r\n    ...inviteDoc.data(),\r\n  });\r\n\r\n  if (!normalizedInvite) {\r\n    return null;\r\n  }\r\n\r\n  return {\r\n    ref: doc(db, getInvitesCollectionName(), inviteDoc.id),\r\n    invite: normalizedInvite,\r\n  };\r\n}\r\n\r\nasync function findInviteByTokenInFile(token) {\r\n  const normalizedToken = normalizeInviteToken(token);\r\n  if (!normalizedToken) {\r\n    return null;\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const inviteIndex = store.invites.findIndex((item) => item.token === normalizedToken);\r\n  if (inviteIndex === -1) {\r\n    return null;\r\n  }\r\n\r\n  return {\r\n    store,\r\n    inviteIndex,\r\n    invite: store.invites[inviteIndex],\r\n  };\r\n}\r\n\r\nasync function getInviteForAccountOpeningFromFirestore(db, token) {\r\n  const found = await findInviteDocumentByTokenInFirestore(db, token);\r\n  if (!found) {\r\n    return null;\r\n  }\r\n\r\n  const currentStatus = resolveInviteStatus(found.invite);\r\n  if (currentStatus === \"expired\" && found.invite.status !== \"expired\") {\r\n    const timestamp = nowIso();\r\n    await updateDoc(found.ref, {\r\n      status: \"expired\",\r\n      updatedAt: timestamp,\r\n    });\r\n    found.invite.status = \"expired\";\r\n    found.invite.updatedAt = timestamp;\r\n  }\r\n\r\n  return toPublicInvite(found.invite);\r\n}\r\n\r\nasync function getInviteForAccountOpeningFromFile(token) {\r\n  const found = await findInviteByTokenInFile(token);\r\n  if (!found) {\r\n    return null;\r\n  }\r\n\r\n  const currentStatus = resolveInviteStatus(found.invite);\r\n  if (currentStatus === \"expired\" && found.invite.status !== \"expired\") {\r\n    found.invite.status = \"expired\";\r\n    found.invite.updatedAt = nowIso();\r\n    await writeStore(found.store);\r\n  }\r\n\r\n  return toPublicInvite(found.invite);\r\n}\r\n\r\nasync function startInviteSmsVerificationInFirestore(db, { token, phoneNumber }) {\r\n  const normalizedToken = normalizeInviteToken(token);\r\n  if (!normalizedToken) {\r\n    throw new Error(\"invalid_invite_token\");\r\n  }\r\n\r\n  const normalizedPhone = normalizePhoneNumber(phoneNumber);\r\n  if (!normalizedPhone) {\r\n    throw new Error(\"invalid_phone_number\");\r\n  }\r\n\r\n  const found = await findInviteDocumentByTokenInFirestore(db, normalizedToken);\r\n  if (!found) {\r\n    throw new Error(\"invite_not_found\");\r\n  }\r\n\r\n  const currentStatus = resolveInviteStatus(found.invite);\r\n  if (currentStatus === \"expired\") {\r\n    const timestamp = nowIso();\r\n    await updateDoc(found.ref, {\r\n      status: \"expired\",\r\n      updatedAt: timestamp,\r\n    });\r\n    throw new Error(\"invite_expired\");\r\n  }\r\n\r\n  if (currentStatus === \"revoked\") {\r\n    throw new Error(\"invite_revoked\");\r\n  }\r\n\r\n  const userRef = doc(db, getUsersCollectionName(), found.invite.email);\r\n  const userSnapshot = await getDoc(userRef);\r\n  if (!userSnapshot.exists()) {\r\n    throw new Error(\"invite_user_not_found\");\r\n  }\r\n\r\n  const currentUser = normalizeFirestoreUser(userSnapshot.id, userSnapshot.data());\r\n  if (!currentUser) {\r\n    throw new Error(\"invite_user_not_found\");\r\n  }\r\n\r\n  if (currentUser.status === \"disabled\") {\r\n    throw new Error(\"account_disabled\");\r\n  }\r\n\r\n  const phoneAlreadyVerified = Boolean(currentUser.phoneVerifiedAt || currentUser.verificationMethod === \"sms\");\r\n  if (currentStatus === \"verified\" && phoneAlreadyVerified) {\r\n    throw new Error(\"invite_already_verified\");\r\n  }\r\n\r\n  const resendAvailableAt = found.invite.verification?.resendAvailableAt;\r\n  if (resendAvailableAt && new Date(resendAvailableAt).getTime() > Date.now()) {\r\n    throw new Error(\"otp_cooldown\");\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  const otpCode = generateOtpCode();\r\n  const otpExpiresAt = new Date(Date.now() + getOtpTtlSeconds() * 1000).toISOString();\r\n  const nextVerification = {\r\n    phoneMasked: maskPhoneNumber(normalizedPhone),\r\n    phoneLast4: getPhoneLast4(normalizedPhone),\r\n    phoneHash: hashPhoneNumber(normalizedPhone),\r\n    otpHash: hashOtpCode({ token: normalizedToken, code: otpCode }),\r\n    otpExpiresAt,\r\n    otpRequestedAt: timestamp,\r\n    otpAttemptCount: 0,\r\n    otpMaxAttempts: getOtpMaxAttempts(),\r\n    resendAvailableAt: new Date(Date.now() + getOtpResendCooldownSeconds() * 1000).toISOString(),\r\n    verifiedAt: null,\r\n  };\r\n\r\n  await updateDoc(found.ref, {\r\n    status: \"otp_sent\",\r\n    updatedAt: timestamp,\r\n    verification: nextVerification,\r\n  });\r\n\r\n  return {\r\n    invite: toPublicInvite({\r\n      ...found.invite,\r\n      status: \"otp_sent\",\r\n      updatedAt: timestamp,\r\n      verification: nextVerification,\r\n    }),\r\n    otpCode,\r\n    phoneNumber: normalizedPhone,\r\n    otpExpiresAt,\r\n    phoneMasked: nextVerification.phoneMasked,\r\n    resendAvailableAt: nextVerification.resendAvailableAt,\r\n  };\r\n}\r\n\r\nasync function startInviteSmsVerificationInFile({ token, phoneNumber }) {\r\n  const normalizedToken = normalizeInviteToken(token);\r\n  if (!normalizedToken) {\r\n    throw new Error(\"invalid_invite_token\");\r\n  }\r\n\r\n  const normalizedPhone = normalizePhoneNumber(phoneNumber);\r\n  if (!normalizedPhone) {\r\n    throw new Error(\"invalid_phone_number\");\r\n  }\r\n\r\n  const found = await findInviteByTokenInFile(normalizedToken);\r\n  if (!found) {\r\n    throw new Error(\"invite_not_found\");\r\n  }\r\n\r\n  const currentStatus = resolveInviteStatus(found.invite);\r\n  if (currentStatus === \"expired\") {\r\n    found.invite.status = \"expired\";\r\n    found.invite.updatedAt = nowIso();\r\n    await writeStore(found.store);\r\n    throw new Error(\"invite_expired\");\r\n  }\r\n\r\n  if (currentStatus === \"revoked\") {\r\n    throw new Error(\"invite_revoked\");\r\n  }\r\n\r\n  const user = found.store.users.find((item) => item.email === found.invite.email);\r\n  if (!user) {\r\n    throw new Error(\"invite_user_not_found\");\r\n  }\r\n\r\n  if (user.status === \"disabled\") {\r\n    throw new Error(\"account_disabled\");\r\n  }\r\n\r\n  const phoneAlreadyVerified = Boolean(user.phoneVerifiedAt || user.verificationMethod === \"sms\");\r\n  if (currentStatus === \"verified\" && phoneAlreadyVerified) {\r\n    throw new Error(\"invite_already_verified\");\r\n  }\r\n\r\n  const resendAvailableAt = found.invite.verification?.resendAvailableAt;\r\n  if (resendAvailableAt && new Date(resendAvailableAt).getTime() > Date.now()) {\r\n    throw new Error(\"otp_cooldown\");\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  const otpCode = generateOtpCode();\r\n  const otpExpiresAt = new Date(Date.now() + getOtpTtlSeconds() * 1000).toISOString();\r\n  const nextVerification = {\r\n    phoneMasked: maskPhoneNumber(normalizedPhone),\r\n    phoneLast4: getPhoneLast4(normalizedPhone),\r\n    phoneHash: hashPhoneNumber(normalizedPhone),\r\n    otpHash: hashOtpCode({ token: normalizedToken, code: otpCode }),\r\n    otpExpiresAt,\r\n    otpRequestedAt: timestamp,\r\n    otpAttemptCount: 0,\r\n    otpMaxAttempts: getOtpMaxAttempts(),\r\n    resendAvailableAt: new Date(Date.now() + getOtpResendCooldownSeconds() * 1000).toISOString(),\r\n    verifiedAt: null,\r\n  };\r\n\r\n  found.invite.status = \"otp_sent\";\r\n  found.invite.updatedAt = timestamp;\r\n  found.invite.verification = nextVerification;\r\n  await writeStore(found.store);\r\n\r\n  return {\r\n    invite: toPublicInvite(found.invite),\r\n    otpCode,\r\n    phoneNumber: normalizedPhone,\r\n    otpExpiresAt,\r\n    phoneMasked: nextVerification.phoneMasked,\r\n    resendAvailableAt: nextVerification.resendAvailableAt,\r\n  };\r\n}\r\n\r\nasync function completeInviteSmsVerificationInFirestore(db, { token, otpCode }) {\r\n  const normalizedToken = normalizeInviteToken(token);\r\n  if (!normalizedToken) {\r\n    throw new Error(\"invalid_invite_token\");\r\n  }\r\n\r\n  if (!isValidOtpCode(otpCode)) {\r\n    throw new Error(\"invalid_otp\");\r\n  }\r\n\r\n  const found = await findInviteDocumentByTokenInFirestore(db, normalizedToken);\r\n  if (!found) {\r\n    throw new Error(\"invite_not_found\");\r\n  }\r\n\r\n  const currentStatus = resolveInviteStatus(found.invite);\r\n  if (currentStatus === \"expired\") {\r\n    await updateDoc(found.ref, {\r\n      status: \"expired\",\r\n      updatedAt: nowIso(),\r\n    });\r\n    throw new Error(\"invite_expired\");\r\n  }\r\n\r\n  if (currentStatus === \"revoked\") {\r\n    throw new Error(\"invite_revoked\");\r\n  }\r\n\r\n  if (currentStatus === \"verified\") {\r\n    throw new Error(\"invite_already_verified\");\r\n  }\r\n\r\n  const verification = found.invite.verification || {};\r\n  if (!verification.otpHash || !verification.otpExpiresAt) {\r\n    throw new Error(\"otp_not_requested\");\r\n  }\r\n\r\n  if (new Date(verification.otpExpiresAt).getTime() <= Date.now()) {\r\n    await updateDoc(found.ref, {\r\n      updatedAt: nowIso(),\r\n      verification: {\r\n        ...verification,\r\n        otpHash: null,\r\n        otpExpiresAt: null,\r\n      },\r\n    });\r\n    throw new Error(\"otp_expired\");\r\n  }\r\n\r\n  const maxAttempts = Number.isFinite(verification.otpMaxAttempts)\r\n    ? Math.max(1, verification.otpMaxAttempts)\r\n    : getOtpMaxAttempts();\r\n  const currentAttempts = Number.isFinite(verification.otpAttemptCount)\r\n    ? Math.max(0, verification.otpAttemptCount)\r\n    : 0;\r\n\r\n  if (currentAttempts >= maxAttempts) {\r\n    throw new Error(\"otp_attempts_exceeded\");\r\n  }\r\n\r\n  const expectedHash = hashOtpCode({\r\n    token: normalizedToken,\r\n    code: String(otpCode).trim(),\r\n  });\r\n\r\n  if (!safeEqual(expectedHash, verification.otpHash)) {\r\n    const nextAttemptCount = currentAttempts + 1;\r\n    const timestamp = nowIso();\r\n    const isLocked = nextAttemptCount >= maxAttempts;\r\n    await updateDoc(found.ref, {\r\n      status: isLocked ? \"revoked\" : found.invite.status,\r\n      updatedAt: timestamp,\r\n      verification: {\r\n        ...verification,\r\n        otpAttemptCount: nextAttemptCount,\r\n      },\r\n    });\r\n\r\n    if (isLocked) {\r\n      throw new Error(\"otp_attempts_exceeded\");\r\n    }\r\n\r\n    throw new Error(\"invalid_otp\");\r\n  }\r\n\r\n  const userRef = doc(db, getUsersCollectionName(), found.invite.email);\r\n  const userSnapshot = await getDoc(userRef);\r\n  if (!userSnapshot.exists()) {\r\n    throw new Error(\"invite_user_not_found\");\r\n  }\r\n\r\n  const currentUser = normalizeFirestoreUser(userSnapshot.id, userSnapshot.data());\r\n  if (!currentUser) {\r\n    throw new Error(\"invite_user_not_found\");\r\n  }\r\n\r\n  if (currentUser.status === \"disabled\") {\r\n    throw new Error(\"account_disabled\");\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  const nextUser = normalizeUserRecord({\r\n    ...currentUser,\r\n    status: \"active\",\r\n    activatedAt: currentUser.activatedAt || timestamp,\r\n    emailVerifiedAt: currentUser.emailVerifiedAt || timestamp,\r\n    updatedAt: timestamp,\r\n    phoneVerifiedAt: timestamp,\r\n    phoneLast4: verification.phoneLast4 || null,\r\n    phoneHash: verification.phoneHash || null,\r\n    verificationMethod: \"sms\",\r\n  });\r\n  await setDoc(userRef, nextUser);\r\n\r\n  const nextVerification = {\r\n    ...verification,\r\n    otpHash: null,\r\n    otpExpiresAt: null,\r\n    otpAttemptCount: 0,\r\n    verifiedAt: timestamp,\r\n  };\r\n  await updateDoc(found.ref, {\r\n    status: \"verified\",\r\n    updatedAt: timestamp,\r\n    verification: nextVerification,\r\n  });\r\n\r\n  return {\r\n    user: toPublicUser(nextUser),\r\n    invite: toPublicInvite({\r\n      ...found.invite,\r\n      status: \"verified\",\r\n      updatedAt: timestamp,\r\n      verification: nextVerification,\r\n    }),\r\n  };\r\n}\r\n\r\nasync function completeInviteSmsVerificationInFile({ token, otpCode }) {\r\n  const normalizedToken = normalizeInviteToken(token);\r\n  if (!normalizedToken) {\r\n    throw new Error(\"invalid_invite_token\");\r\n  }\r\n\r\n  if (!isValidOtpCode(otpCode)) {\r\n    throw new Error(\"invalid_otp\");\r\n  }\r\n\r\n  const found = await findInviteByTokenInFile(normalizedToken);\r\n  if (!found) {\r\n    throw new Error(\"invite_not_found\");\r\n  }\r\n\r\n  const currentStatus = resolveInviteStatus(found.invite);\r\n  if (currentStatus === \"expired\") {\r\n    found.invite.status = \"expired\";\r\n    found.invite.updatedAt = nowIso();\r\n    await writeStore(found.store);\r\n    throw new Error(\"invite_expired\");\r\n  }\r\n\r\n  if (currentStatus === \"revoked\") {\r\n    throw new Error(\"invite_revoked\");\r\n  }\r\n\r\n  if (currentStatus === \"verified\") {\r\n    throw new Error(\"invite_already_verified\");\r\n  }\r\n\r\n  const verification = found.invite.verification || {};\r\n  if (!verification.otpHash || !verification.otpExpiresAt) {\r\n    throw new Error(\"otp_not_requested\");\r\n  }\r\n\r\n  if (new Date(verification.otpExpiresAt).getTime() <= Date.now()) {\r\n    found.invite.updatedAt = nowIso();\r\n    found.invite.verification = {\r\n      ...verification,\r\n      otpHash: null,\r\n      otpExpiresAt: null,\r\n    };\r\n    await writeStore(found.store);\r\n    throw new Error(\"otp_expired\");\r\n  }\r\n\r\n  const maxAttempts = Number.isFinite(verification.otpMaxAttempts)\r\n    ? Math.max(1, verification.otpMaxAttempts)\r\n    : getOtpMaxAttempts();\r\n  const currentAttempts = Number.isFinite(verification.otpAttemptCount)\r\n    ? Math.max(0, verification.otpAttemptCount)\r\n    : 0;\r\n  if (currentAttempts >= maxAttempts) {\r\n    throw new Error(\"otp_attempts_exceeded\");\r\n  }\r\n\r\n  const expectedHash = hashOtpCode({\r\n    token: normalizedToken,\r\n    code: String(otpCode).trim(),\r\n  });\r\n  if (!safeEqual(expectedHash, verification.otpHash)) {\r\n    const timestamp = nowIso();\r\n    const nextAttemptCount = currentAttempts + 1;\r\n    const isLocked = nextAttemptCount >= maxAttempts;\r\n    found.invite.status = isLocked ? \"revoked\" : found.invite.status;\r\n    found.invite.updatedAt = timestamp;\r\n    found.invite.verification = {\r\n      ...verification,\r\n      otpAttemptCount: nextAttemptCount,\r\n    };\r\n    await writeStore(found.store);\r\n\r\n    if (isLocked) {\r\n      throw new Error(\"otp_attempts_exceeded\");\r\n    }\r\n    throw new Error(\"invalid_otp\");\r\n  }\r\n\r\n  const user = found.store.users.find((item) => item.email === found.invite.email);\r\n  if (!user) {\r\n    throw new Error(\"invite_user_not_found\");\r\n  }\r\n\r\n  if (user.status === \"disabled\") {\r\n    throw new Error(\"account_disabled\");\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  user.status = \"active\";\r\n  user.activatedAt = user.activatedAt || timestamp;\r\n  user.emailVerifiedAt = user.emailVerifiedAt || timestamp;\r\n  user.phoneVerifiedAt = timestamp;\r\n  user.phoneLast4 = verification.phoneLast4 || null;\r\n  user.phoneHash = verification.phoneHash || null;\r\n  user.verificationMethod = \"sms\";\r\n  user.updatedAt = timestamp;\r\n\r\n  found.invite.status = \"verified\";\r\n  found.invite.updatedAt = timestamp;\r\n  found.invite.verification = {\r\n    ...verification,\r\n    otpHash: null,\r\n    otpExpiresAt: null,\r\n    otpAttemptCount: 0,\r\n    verifiedAt: timestamp,\r\n  };\r\n  await writeStore(found.store);\r\n\r\n  return {\r\n    user: toPublicUser(user),\r\n    invite: toPublicInvite(found.invite),\r\n  };\r\n}\r\n\r\nasync function createLoginSmsChallengeInFirestore(db, { email }) {\r\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!isValidEmail(normalizedEmail)) {\r\n    throw new Error(\"invalid_email\");\r\n  }\r\n\r\n  const userRef = doc(db, getUsersCollectionName(), normalizedEmail);\r\n  const snapshot = await getDoc(userRef);\r\n  if (!snapshot.exists()) {\r\n    throw new Error(\"user_not_found\");\r\n  }\r\n\r\n  const normalizedUser = normalizeFirestoreUser(snapshot.id, snapshot.data());\r\n  if (!normalizedUser) {\r\n    throw new Error(\"user_not_found\");\r\n  }\r\n\r\n  if (normalizedUser.status === \"disabled\") {\r\n    throw new Error(\"account_disabled\");\r\n  }\r\n\r\n  const challengeToken = createInviteToken();\r\n  const timestamp = nowIso();\r\n  const challengeExpiresAt = new Date(Date.now() + getLoginMfaChallengeTtlSeconds() * 1000).toISOString();\r\n  const loginMfa = {\r\n    challengeTokenHash: hashValue(\"login_mfa_challenge\", challengeToken),\r\n    challengeExpiresAt,\r\n    phoneMasked: null,\r\n    phoneLast4: null,\r\n    phoneHash: null,\r\n    otpHash: null,\r\n    otpExpiresAt: null,\r\n    otpRequestedAt: null,\r\n    otpAttemptCount: 0,\r\n    otpMaxAttempts: getOtpMaxAttempts(),\r\n    resendAvailableAt: null,\r\n    updatedAt: timestamp,\r\n  };\r\n\r\n  await updateDoc(userRef, {\r\n    loginMfa,\r\n    updatedAt: timestamp,\r\n  });\r\n\r\n  return {\r\n    challengeToken,\r\n    challengeExpiresAt,\r\n  };\r\n}\r\n\r\nasync function createLoginSmsChallengeInFile({ email }) {\r\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!isValidEmail(normalizedEmail)) {\r\n    throw new Error(\"invalid_email\");\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const user = store.users.find((item) => item.email === normalizedEmail);\r\n  if (!user) {\r\n    throw new Error(\"user_not_found\");\r\n  }\r\n\r\n  if (user.status === \"disabled\") {\r\n    throw new Error(\"account_disabled\");\r\n  }\r\n\r\n  const challengeToken = createInviteToken();\r\n  const timestamp = nowIso();\r\n  const challengeExpiresAt = new Date(Date.now() + getLoginMfaChallengeTtlSeconds() * 1000).toISOString();\r\n  user.loginMfa = {\r\n    challengeTokenHash: hashValue(\"login_mfa_challenge\", challengeToken),\r\n    challengeExpiresAt,\r\n    phoneMasked: null,\r\n    phoneLast4: null,\r\n    phoneHash: null,\r\n    otpHash: null,\r\n    otpExpiresAt: null,\r\n    otpRequestedAt: null,\r\n    otpAttemptCount: 0,\r\n    otpMaxAttempts: getOtpMaxAttempts(),\r\n    resendAvailableAt: null,\r\n    updatedAt: timestamp,\r\n  };\r\n  user.updatedAt = timestamp;\r\n  await writeStore(store);\r\n\r\n  return {\r\n    challengeToken,\r\n    challengeExpiresAt,\r\n  };\r\n}\r\n\r\nfunction resolveLoginMfaState(raw) {\r\n  if (!raw || typeof raw !== \"object\") {\r\n    return null;\r\n  }\r\n  const challengeTokenHash = typeof raw.challengeTokenHash === \"string\" ? raw.challengeTokenHash : \"\";\r\n  if (!challengeTokenHash) {\r\n    return null;\r\n  }\r\n  return {\r\n    challengeTokenHash,\r\n    challengeExpiresAt: normalizeIsoTimestamp(raw.challengeExpiresAt) || \"\",\r\n    phoneMasked: typeof raw.phoneMasked === \"string\" ? raw.phoneMasked : \"\",\r\n    phoneLast4: typeof raw.phoneLast4 === \"string\" ? raw.phoneLast4 : \"\",\r\n    phoneHash: typeof raw.phoneHash === \"string\" ? raw.phoneHash : \"\",\r\n    otpHash: typeof raw.otpHash === \"string\" ? raw.otpHash : \"\",\r\n    otpExpiresAt: normalizeIsoTimestamp(raw.otpExpiresAt) || \"\",\r\n    otpRequestedAt: normalizeIsoTimestamp(raw.otpRequestedAt) || \"\",\r\n    otpAttemptCount: Number.isFinite(raw.otpAttemptCount) ? Math.max(0, raw.otpAttemptCount) : 0,\r\n    otpMaxAttempts: Number.isFinite(raw.otpMaxAttempts) ? Math.max(1, raw.otpMaxAttempts) : getOtpMaxAttempts(),\r\n    resendAvailableAt: normalizeIsoTimestamp(raw.resendAvailableAt) || \"\",\r\n    updatedAt: normalizeIsoTimestamp(raw.updatedAt) || \"\",\r\n  };\r\n}\r\n\r\nfunction verifyLoginMfaChallenge({ challengeToken, loginMfa }) {\r\n  const normalizedToken = normalizeLoginMfaChallengeToken(challengeToken);\r\n  if (!normalizedToken) {\r\n    throw new Error(\"invalid_mfa_challenge\");\r\n  }\r\n\r\n  const state = resolveLoginMfaState(loginMfa);\r\n  if (!state?.challengeTokenHash) {\r\n    throw new Error(\"invalid_mfa_challenge\");\r\n  }\r\n\r\n  const expectedChallengeHash = hashValue(\"login_mfa_challenge\", normalizedToken);\r\n  if (!safeEqual(expectedChallengeHash, state.challengeTokenHash)) {\r\n    throw new Error(\"invalid_mfa_challenge\");\r\n  }\r\n\r\n  if (!state.challengeExpiresAt || new Date(state.challengeExpiresAt).getTime() <= Date.now()) {\r\n    throw new Error(\"invalid_mfa_challenge\");\r\n  }\r\n\r\n  return {\r\n    normalizedToken,\r\n    state,\r\n  };\r\n}\r\n\r\nasync function startLoginSmsVerificationInFirestore(db, { email, challengeToken, phoneNumber }) {\r\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!isValidEmail(normalizedEmail)) {\r\n    throw new Error(\"invalid_email\");\r\n  }\r\n\r\n  const normalizedPhone = normalizePhoneNumber(phoneNumber);\r\n  if (!normalizedPhone) {\r\n    throw new Error(\"invalid_phone_number\");\r\n  }\r\n\r\n  const userRef = doc(db, getUsersCollectionName(), normalizedEmail);\r\n  const snapshot = await getDoc(userRef);\r\n  if (!snapshot.exists()) {\r\n    throw new Error(\"user_not_found\");\r\n  }\r\n\r\n  const rawUser = snapshot.data() || {};\r\n  const normalizedUser = normalizeFirestoreUser(snapshot.id, rawUser);\r\n  if (!normalizedUser) {\r\n    throw new Error(\"user_not_found\");\r\n  }\r\n\r\n  if (normalizedUser.status === \"disabled\") {\r\n    throw new Error(\"account_disabled\");\r\n  }\r\n\r\n  if (normalizedUser.phoneVerifiedAt) {\r\n    throw new Error(\"already_verified\");\r\n  }\r\n\r\n  const { normalizedToken, state } = verifyLoginMfaChallenge({\r\n    challengeToken,\r\n    loginMfa: rawUser.loginMfa,\r\n  });\r\n\r\n  if (state.resendAvailableAt && new Date(state.resendAvailableAt).getTime() > Date.now()) {\r\n    throw new Error(\"otp_cooldown\");\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  const otpCode = generateOtpCode();\r\n  const otpExpiresAt = new Date(Date.now() + getOtpTtlSeconds() * 1000).toISOString();\r\n  const nextLoginMfa = {\r\n    ...state,\r\n    phoneMasked: maskPhoneNumber(normalizedPhone),\r\n    phoneLast4: getPhoneLast4(normalizedPhone),\r\n    phoneHash: hashPhoneNumber(normalizedPhone),\r\n    otpHash: hashOtpCode({ token: normalizedToken, code: otpCode }),\r\n    otpExpiresAt,\r\n    otpRequestedAt: timestamp,\r\n    otpAttemptCount: 0,\r\n    otpMaxAttempts: getOtpMaxAttempts(),\r\n    resendAvailableAt: new Date(Date.now() + getOtpResendCooldownSeconds() * 1000).toISOString(),\r\n    updatedAt: timestamp,\r\n  };\r\n\r\n  await updateDoc(userRef, {\r\n    loginMfa: nextLoginMfa,\r\n    updatedAt: timestamp,\r\n  });\r\n\r\n  return {\r\n    phoneNumber: normalizedPhone,\r\n    phoneMasked: nextLoginMfa.phoneMasked,\r\n    otpCode,\r\n    otpExpiresAt,\r\n    resendAvailableAt: nextLoginMfa.resendAvailableAt,\r\n  };\r\n}\r\n\r\nasync function startLoginSmsVerificationInFile({ email, challengeToken, phoneNumber }) {\r\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!isValidEmail(normalizedEmail)) {\r\n    throw new Error(\"invalid_email\");\r\n  }\r\n\r\n  const normalizedPhone = normalizePhoneNumber(phoneNumber);\r\n  if (!normalizedPhone) {\r\n    throw new Error(\"invalid_phone_number\");\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const user = store.users.find((item) => item.email === normalizedEmail);\r\n  if (!user) {\r\n    throw new Error(\"user_not_found\");\r\n  }\r\n\r\n  if (user.status === \"disabled\") {\r\n    throw new Error(\"account_disabled\");\r\n  }\r\n\r\n  if (user.phoneVerifiedAt) {\r\n    throw new Error(\"already_verified\");\r\n  }\r\n\r\n  const { normalizedToken, state } = verifyLoginMfaChallenge({\r\n    challengeToken,\r\n    loginMfa: user.loginMfa,\r\n  });\r\n\r\n  if (state.resendAvailableAt && new Date(state.resendAvailableAt).getTime() > Date.now()) {\r\n    throw new Error(\"otp_cooldown\");\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  const otpCode = generateOtpCode();\r\n  const otpExpiresAt = new Date(Date.now() + getOtpTtlSeconds() * 1000).toISOString();\r\n  const nextLoginMfa = {\r\n    ...state,\r\n    phoneMasked: maskPhoneNumber(normalizedPhone),\r\n    phoneLast4: getPhoneLast4(normalizedPhone),\r\n    phoneHash: hashPhoneNumber(normalizedPhone),\r\n    otpHash: hashOtpCode({ token: normalizedToken, code: otpCode }),\r\n    otpExpiresAt,\r\n    otpRequestedAt: timestamp,\r\n    otpAttemptCount: 0,\r\n    otpMaxAttempts: getOtpMaxAttempts(),\r\n    resendAvailableAt: new Date(Date.now() + getOtpResendCooldownSeconds() * 1000).toISOString(),\r\n    updatedAt: timestamp,\r\n  };\r\n\r\n  user.loginMfa = nextLoginMfa;\r\n  user.updatedAt = timestamp;\r\n  await writeStore(store);\r\n\r\n  return {\r\n    phoneNumber: normalizedPhone,\r\n    phoneMasked: nextLoginMfa.phoneMasked,\r\n    otpCode,\r\n    otpExpiresAt,\r\n    resendAvailableAt: nextLoginMfa.resendAvailableAt,\r\n  };\r\n}\r\n\r\nasync function completeLoginSmsVerificationInFirestore(db, { email, challengeToken, otpCode }) {\r\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!isValidEmail(normalizedEmail)) {\r\n    throw new Error(\"invalid_email\");\r\n  }\r\n\r\n  if (!isValidOtpCode(otpCode)) {\r\n    throw new Error(\"invalid_otp\");\r\n  }\r\n\r\n  const userRef = doc(db, getUsersCollectionName(), normalizedEmail);\r\n  const snapshot = await getDoc(userRef);\r\n  if (!snapshot.exists()) {\r\n    throw new Error(\"user_not_found\");\r\n  }\r\n\r\n  const rawUser = snapshot.data() || {};\r\n  const normalizedUser = normalizeFirestoreUser(snapshot.id, rawUser);\r\n  if (!normalizedUser) {\r\n    throw new Error(\"user_not_found\");\r\n  }\r\n\r\n  if (normalizedUser.status === \"disabled\") {\r\n    throw new Error(\"account_disabled\");\r\n  }\r\n\r\n  if (normalizedUser.phoneVerifiedAt) {\r\n    throw new Error(\"already_verified\");\r\n  }\r\n\r\n  const { normalizedToken, state } = verifyLoginMfaChallenge({\r\n    challengeToken,\r\n    loginMfa: rawUser.loginMfa,\r\n  });\r\n\r\n  if (!state.otpHash || !state.otpExpiresAt) {\r\n    throw new Error(\"otp_not_requested\");\r\n  }\r\n\r\n  if (new Date(state.otpExpiresAt).getTime() <= Date.now()) {\r\n    await updateDoc(userRef, {\r\n      loginMfa: {\r\n        ...state,\r\n        otpHash: null,\r\n        otpExpiresAt: null,\r\n        updatedAt: nowIso(),\r\n      },\r\n      updatedAt: nowIso(),\r\n    });\r\n    throw new Error(\"otp_expired\");\r\n  }\r\n\r\n  const maxAttempts = Number.isFinite(state.otpMaxAttempts) ? Math.max(1, state.otpMaxAttempts) : getOtpMaxAttempts();\r\n  const currentAttempts = Number.isFinite(state.otpAttemptCount) ? Math.max(0, state.otpAttemptCount) : 0;\r\n  if (currentAttempts >= maxAttempts) {\r\n    throw new Error(\"otp_attempts_exceeded\");\r\n  }\r\n\r\n  const expectedHash = hashOtpCode({\r\n    token: normalizedToken,\r\n    code: String(otpCode).trim(),\r\n  });\r\n  if (!safeEqual(expectedHash, state.otpHash)) {\r\n    const nextAttemptCount = currentAttempts + 1;\r\n    const timestamp = nowIso();\r\n    await updateDoc(userRef, {\r\n      loginMfa: {\r\n        ...state,\r\n        otpAttemptCount: nextAttemptCount,\r\n        updatedAt: timestamp,\r\n      },\r\n      updatedAt: timestamp,\r\n    });\r\n\r\n    if (nextAttemptCount >= maxAttempts) {\r\n      throw new Error(\"otp_attempts_exceeded\");\r\n    }\r\n\r\n    throw new Error(\"invalid_otp\");\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  const nextPayload = {\r\n    phoneVerifiedAt: timestamp,\r\n    phoneLast4: state.phoneLast4 || null,\r\n    phoneHash: state.phoneHash || null,\r\n    verificationMethod: \"sms\",\r\n    loginMfa: null,\r\n    updatedAt: timestamp,\r\n  };\r\n\r\n  await updateDoc(userRef, nextPayload);\r\n\r\n  const updated = normalizeFirestoreUser(snapshot.id, {\r\n    ...rawUser,\r\n    ...nextPayload,\r\n  });\r\n\r\n  return updated ? toPublicUser(updated) : null;\r\n}\r\n\r\nasync function recordLoginDeviceInFirestore(db, { email, device }) {\r\n  const userRef = doc(db, getUsersCollectionName(), email);\r\n  const snapshot = await getDoc(userRef);\r\n  if (!snapshot.exists()) {\r\n    return null;\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  const current = normalizeFirestoreUser(snapshot.id, snapshot.data());\r\n  if (!current) {\r\n    return null;\r\n  }\r\n\r\n  const devicePayload = normalizeDeviceEntry({\r\n    ...device,\r\n    firstSeenAt: timestamp,\r\n    lastSeenAt: timestamp,\r\n  });\r\n  if (!devicePayload) {\r\n    return null;\r\n  }\r\n\r\n  const existingDevices = normalizeDeviceList(current.knownDevices);\r\n  const existingIndex = existingDevices.findIndex((entry) => entry.deviceId === devicePayload.deviceId);\r\n  const updatedDevice =\r\n    existingIndex >= 0\r\n      ? {\r\n          ...existingDevices[existingIndex],\r\n          label: devicePayload.label || existingDevices[existingIndex].label,\r\n          userAgent: devicePayload.userAgent || existingDevices[existingIndex].userAgent,\r\n          lastIp: devicePayload.lastIp || existingDevices[existingIndex].lastIp,\r\n          lastSeenAt: timestamp,\r\n        }\r\n      : devicePayload;\r\n\r\n  const nextDevices = [...existingDevices];\r\n  if (existingIndex >= 0) {\r\n    nextDevices.splice(existingIndex, 1, updatedDevice);\r\n  } else {\r\n    nextDevices.push(updatedDevice);\r\n  }\r\n\r\n  const sortedDevices = normalizeDeviceList(nextDevices);\r\n  await updateDoc(userRef, {\r\n    knownDevices: sortedDevices,\r\n    updatedAt: timestamp,\r\n  });\r\n\r\n  return {\r\n    isNew: existingIndex < 0,\r\n    device: updatedDevice,\r\n  };\r\n}\r\n\r\nasync function completeLoginSmsVerificationInFile({ email, challengeToken, otpCode }) {\r\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!isValidEmail(normalizedEmail)) {\r\n    throw new Error(\"invalid_email\");\r\n  }\r\n\r\n  if (!isValidOtpCode(otpCode)) {\r\n    throw new Error(\"invalid_otp\");\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const user = store.users.find((item) => item.email === normalizedEmail);\r\n  if (!user) {\r\n    throw new Error(\"user_not_found\");\r\n  }\r\n\r\n  if (user.status === \"disabled\") {\r\n    throw new Error(\"account_disabled\");\r\n  }\r\n\r\n  if (user.phoneVerifiedAt) {\r\n    throw new Error(\"already_verified\");\r\n  }\r\n\r\n  const { normalizedToken, state } = verifyLoginMfaChallenge({\r\n    challengeToken,\r\n    loginMfa: user.loginMfa,\r\n  });\r\n\r\n  if (!state.otpHash || !state.otpExpiresAt) {\r\n    throw new Error(\"otp_not_requested\");\r\n  }\r\n\r\n  if (new Date(state.otpExpiresAt).getTime() <= Date.now()) {\r\n    user.loginMfa = {\r\n      ...state,\r\n      otpHash: null,\r\n      otpExpiresAt: null,\r\n      updatedAt: nowIso(),\r\n    };\r\n    user.updatedAt = nowIso();\r\n    await writeStore(store);\r\n    throw new Error(\"otp_expired\");\r\n  }\r\n\r\n  const maxAttempts = Number.isFinite(state.otpMaxAttempts) ? Math.max(1, state.otpMaxAttempts) : getOtpMaxAttempts();\r\n  const currentAttempts = Number.isFinite(state.otpAttemptCount) ? Math.max(0, state.otpAttemptCount) : 0;\r\n  if (currentAttempts >= maxAttempts) {\r\n    throw new Error(\"otp_attempts_exceeded\");\r\n  }\r\n\r\n  const expectedHash = hashOtpCode({\r\n    token: normalizedToken,\r\n    code: String(otpCode).trim(),\r\n  });\r\n  if (!safeEqual(expectedHash, state.otpHash)) {\r\n    const timestamp = nowIso();\r\n    const nextAttemptCount = currentAttempts + 1;\r\n    user.loginMfa = {\r\n      ...state,\r\n      otpAttemptCount: nextAttemptCount,\r\n      updatedAt: timestamp,\r\n    };\r\n    user.updatedAt = timestamp;\r\n    await writeStore(store);\r\n\r\n    if (nextAttemptCount >= maxAttempts) {\r\n      throw new Error(\"otp_attempts_exceeded\");\r\n    }\r\n\r\n    throw new Error(\"invalid_otp\");\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  user.phoneVerifiedAt = timestamp;\r\n  user.phoneLast4 = state.phoneLast4 || null;\r\n  user.phoneHash = state.phoneHash || null;\r\n  user.verificationMethod = \"sms\";\r\n  user.loginMfa = null;\r\n  user.updatedAt = timestamp;\r\n  await writeStore(store);\r\n\r\n  return toPublicUser(user);\r\n}\r\n\r\nasync function completeLoginSmsVerificationWithFirebaseInFirestore(db, { email, challengeToken, phoneNumber }) {\r\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!isValidEmail(normalizedEmail)) {\r\n    throw new Error(\"invalid_email\");\r\n  }\r\n\r\n  const normalizedPhone = normalizePhoneNumber(phoneNumber);\r\n  if (!normalizedPhone) {\r\n    throw new Error(\"invalid_phone_number\");\r\n  }\r\n\r\n  const userRef = doc(db, getUsersCollectionName(), normalizedEmail);\r\n  const snapshot = await getDoc(userRef);\r\n  if (!snapshot.exists()) {\r\n    throw new Error(\"user_not_found\");\r\n  }\r\n\r\n  const rawUser = snapshot.data() || {};\r\n  const normalizedUser = normalizeFirestoreUser(snapshot.id, rawUser);\r\n  if (!normalizedUser) {\r\n    throw new Error(\"user_not_found\");\r\n  }\r\n\r\n  if (normalizedUser.status === \"disabled\") {\r\n    throw new Error(\"account_disabled\");\r\n  }\r\n\r\n  verifyLoginMfaChallenge({\r\n    challengeToken,\r\n    loginMfa: rawUser.loginMfa,\r\n  });\r\n\r\n  const timestamp = nowIso();\r\n  const nextPayload = {\r\n    phoneVerifiedAt: normalizedUser.phoneVerifiedAt || timestamp,\r\n    phoneLast4: getPhoneLast4(normalizedPhone),\r\n    phoneHash: hashPhoneNumber(normalizedPhone),\r\n    verificationMethod: \"sms\",\r\n    loginMfa: null,\r\n    updatedAt: timestamp,\r\n  };\r\n\r\n  await updateDoc(userRef, nextPayload);\r\n\r\n  const updated = normalizeFirestoreUser(snapshot.id, {\r\n    ...rawUser,\r\n    ...nextPayload,\r\n  });\r\n\r\n  return updated ? toPublicUser(updated) : null;\r\n}\r\n\r\nasync function completeLoginSmsVerificationWithFirebaseInFile({ email, challengeToken, phoneNumber }) {\r\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!isValidEmail(normalizedEmail)) {\r\n    throw new Error(\"invalid_email\");\r\n  }\r\n\r\n  const normalizedPhone = normalizePhoneNumber(phoneNumber);\r\n  if (!normalizedPhone) {\r\n    throw new Error(\"invalid_phone_number\");\r\n  }\r\n\r\n  const store = await loadStore();\r\n  const user = store.users.find((item) => item.email === normalizedEmail);\r\n  if (!user) {\r\n    throw new Error(\"user_not_found\");\r\n  }\r\n\r\n  if (user.status === \"disabled\") {\r\n    throw new Error(\"account_disabled\");\r\n  }\r\n\r\n  verifyLoginMfaChallenge({\r\n    challengeToken,\r\n    loginMfa: user.loginMfa,\r\n  });\r\n\r\n  const timestamp = nowIso();\r\n  user.phoneVerifiedAt = user.phoneVerifiedAt || timestamp;\r\n  user.phoneLast4 = getPhoneLast4(normalizedPhone);\r\n  user.phoneHash = hashPhoneNumber(normalizedPhone);\r\n  user.verificationMethod = \"sms\";\r\n  user.loginMfa = null;\r\n  user.updatedAt = timestamp;\r\n  await writeStore(store);\r\n\r\n  return toPublicUser(user);\r\n}\r\n\r\nasync function completeInviteEmailVerificationInFirestore(db, { token }) {\r\n  const normalizedToken = normalizeInviteToken(token);\r\n  if (!normalizedToken) {\r\n    throw new Error(\"invalid_invite_token\");\r\n  }\r\n\r\n  const found = await findInviteDocumentByTokenInFirestore(db, normalizedToken);\r\n  if (!found) {\r\n    throw new Error(\"invite_not_found\");\r\n  }\r\n\r\n  const currentStatus = resolveInviteStatus(found.invite);\r\n  if (currentStatus === \"expired\") {\r\n    await updateDoc(found.ref, {\r\n      status: \"expired\",\r\n      updatedAt: nowIso(),\r\n    });\r\n    throw new Error(\"invite_expired\");\r\n  }\r\n\r\n  if (currentStatus === \"revoked\") {\r\n    throw new Error(\"invite_revoked\");\r\n  }\r\n\r\n  if (currentStatus === \"verified\") {\r\n    throw new Error(\"invite_already_verified\");\r\n  }\r\n\r\n  const userRef = doc(db, getUsersCollectionName(), found.invite.email);\r\n  const userSnapshot = await getDoc(userRef);\r\n  if (!userSnapshot.exists()) {\r\n    throw new Error(\"invite_user_not_found\");\r\n  }\r\n\r\n  const currentUser = normalizeFirestoreUser(userSnapshot.id, userSnapshot.data());\r\n  if (!currentUser) {\r\n    throw new Error(\"invite_user_not_found\");\r\n  }\r\n\r\n  if (currentUser.status === \"disabled\") {\r\n    throw new Error(\"account_disabled\");\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  const nextUser = normalizeUserRecord({\r\n    ...currentUser,\r\n    status: \"active\",\r\n    activatedAt: currentUser.activatedAt || timestamp,\r\n    emailVerifiedAt: timestamp,\r\n    verificationMethod: \"email\",\r\n    updatedAt: timestamp,\r\n  });\r\n  await setDoc(userRef, nextUser);\r\n\r\n  const nextVerification = {\r\n    ...(found.invite.verification || {}),\r\n    otpHash: null,\r\n    otpExpiresAt: null,\r\n    otpAttemptCount: 0,\r\n    verifiedAt: timestamp,\r\n  };\r\n  await updateDoc(found.ref, {\r\n    status: \"verified\",\r\n    updatedAt: timestamp,\r\n    verification: nextVerification,\r\n  });\r\n\r\n  return {\r\n    user: toPublicUser(nextUser),\r\n    invite: toPublicInvite({\r\n      ...found.invite,\r\n      status: \"verified\",\r\n      updatedAt: timestamp,\r\n      verification: nextVerification,\r\n    }),\r\n  };\r\n}\r\n\r\nasync function completeInviteEmailVerificationInFile({ token }) {\r\n  const normalizedToken = normalizeInviteToken(token);\r\n  if (!normalizedToken) {\r\n    throw new Error(\"invalid_invite_token\");\r\n  }\r\n\r\n  const found = await findInviteByTokenInFile(normalizedToken);\r\n  if (!found) {\r\n    throw new Error(\"invite_not_found\");\r\n  }\r\n\r\n  const currentStatus = resolveInviteStatus(found.invite);\r\n  if (currentStatus === \"expired\") {\r\n    found.invite.status = \"expired\";\r\n    found.invite.updatedAt = nowIso();\r\n    await writeStore(found.store);\r\n    throw new Error(\"invite_expired\");\r\n  }\r\n\r\n  if (currentStatus === \"revoked\") {\r\n    throw new Error(\"invite_revoked\");\r\n  }\r\n\r\n  if (currentStatus === \"verified\") {\r\n    throw new Error(\"invite_already_verified\");\r\n  }\r\n\r\n  const user = found.store.users.find((item) => item.email === found.invite.email);\r\n  if (!user) {\r\n    throw new Error(\"invite_user_not_found\");\r\n  }\r\n\r\n  if (user.status === \"disabled\") {\r\n    throw new Error(\"account_disabled\");\r\n  }\r\n\r\n  const timestamp = nowIso();\r\n  user.status = \"active\";\r\n  user.activatedAt = user.activatedAt || timestamp;\r\n  user.emailVerifiedAt = timestamp;\r\n  user.verificationMethod = \"email\";\r\n  user.updatedAt = timestamp;\r\n\r\n  found.invite.status = \"verified\";\r\n  found.invite.updatedAt = timestamp;\r\n  found.invite.verification = {\r\n    ...(found.invite.verification || {}),\r\n    otpHash: null,\r\n    otpExpiresAt: null,\r\n    otpAttemptCount: 0,\r\n    verifiedAt: timestamp,\r\n  };\r\n  await writeStore(found.store);\r\n\r\n  return {\r\n    user: toPublicUser(user),\r\n    invite: toPublicInvite(found.invite),\r\n  };\r\n}\r\n\r\nexport async function getInviteForEmailVerification(token) {\n  const inviteBusinessErrors = new Set([\r\n    \"invalid_invite_token\",\r\n    \"invite_not_found\",\r\n    \"invite_expired\",\r\n    \"invite_revoked\",\r\n    \"invite_already_verified\",\r\n    \"invite_user_not_found\",\r\n    \"account_disabled\",\r\n  ]);\r\n  const db = await getFirestoreStore();\r\n  if (db) {\n    try {\n      return await getInviteForAccountOpeningFromFirestore(db, token);\n    } catch (error) {\n      const reason = error instanceof Error ? error.message : \"\";\n      if (inviteBusinessErrors.has(reason)) {\n        throw error;\n      }\n      throwFirestoreOperationFailed(error, \"get_invite_for_email_verification\");\n    }\n  }\n\r\n  return await getInviteForAccountOpeningFromFile(token);\r\n}\r\n\r\nexport async function startInviteSmsVerification({ token, phoneNumber }) {\n  const inviteBusinessErrors = new Set([\r\n    \"invalid_invite_token\",\r\n    \"invalid_phone_number\",\r\n    \"invite_not_found\",\r\n    \"invite_expired\",\r\n    \"invite_revoked\",\r\n    \"invite_already_verified\",\r\n    \"invite_user_not_found\",\r\n    \"account_disabled\",\r\n    \"otp_cooldown\",\r\n  ]);\r\n  const db = await getFirestoreStore();\r\n  if (db) {\n    try {\n      return await startInviteSmsVerificationInFirestore(db, { token, phoneNumber });\n    } catch (error) {\n      const reason = error instanceof Error ? error.message : \"\";\n      if (inviteBusinessErrors.has(reason)) {\n        throw error;\n      }\n      throwFirestoreOperationFailed(error, \"start_invite_sms_verification\");\n    }\n  }\n\r\n  return await startInviteSmsVerificationInFile({ token, phoneNumber });\r\n}\r\n\r\nexport async function completeInviteSmsVerification({ token, otpCode }) {\n  const inviteBusinessErrors = new Set([\r\n    \"invalid_invite_token\",\r\n    \"invite_not_found\",\r\n    \"invite_expired\",\r\n    \"invite_revoked\",\r\n    \"invite_already_verified\",\r\n    \"invite_user_not_found\",\r\n    \"account_disabled\",\r\n    \"otp_not_requested\",\r\n    \"otp_expired\",\r\n    \"otp_attempts_exceeded\",\r\n    \"invalid_otp\",\r\n  ]);\r\n\r\n  let result;\r\n  const db = await getFirestoreStore();\r\n  if (db) {\n    try {\n      result = await completeInviteSmsVerificationInFirestore(db, { token, otpCode });\n    } catch (error) {\n      const reason = error instanceof Error ? error.message : \"\";\n      if (inviteBusinessErrors.has(reason)) {\n        throw error;\n      }\n      throwFirestoreOperationFailed(error, \"complete_invite_sms_verification\");\n    }\n  } else {\n    result = await completeInviteSmsVerificationInFile({ token, otpCode });\r\n  }\r\n\r\n  await syncCustomClaimsForPublicUser(result?.user, {\r\n    allowMissingUser: false,\r\n    strict: false,\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\nexport async function verifyInviteEmail({ token }) {\n  const inviteBusinessErrors = new Set([\r\n    \"invalid_invite_token\",\r\n    \"invite_not_found\",\r\n    \"invite_expired\",\r\n    \"invite_revoked\",\r\n    \"invite_already_verified\",\r\n    \"invite_user_not_found\",\r\n    \"account_disabled\",\r\n  ]);\r\n\r\n  let result;\r\n  const db = await getFirestoreStore();\r\n  if (db) {\n    try {\n      result = await completeInviteEmailVerificationInFirestore(db, { token });\n    } catch (error) {\n      const reason = error instanceof Error ? error.message : \"\";\n      if (inviteBusinessErrors.has(reason)) {\n        throw error;\n      }\n      throwFirestoreOperationFailed(error, \"verify_invite_email\");\n    }\n  } else {\n    result = await completeInviteEmailVerificationInFile({ token });\r\n  }\r\n\r\n  await syncCustomClaimsForPublicUser(result?.user, {\r\n    allowMissingUser: false,\r\n    strict: false,\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\nexport async function createLoginSmsChallenge({ email }) {\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!normalizedEmail) {\r\n    throw new Error(\"invalid_email\");\r\n  }\r\n\r\n  const db = await getFirestoreStore();\r\n  if (db) {\n    try {\n      return await createLoginSmsChallengeInFirestore(db, { email: normalizedEmail });\n    } catch (error) {\n      const reason = error instanceof Error ? error.message : \"\";\n      if ([\"invalid_email\", \"user_not_found\", \"account_disabled\", \"already_verified\"].includes(reason)) {\n        throw error;\n      }\n      throwFirestoreOperationFailed(error, \"create_login_sms_challenge\");\n    }\n  }\n\r\n  return await createLoginSmsChallengeInFile({ email: normalizedEmail });\r\n}\r\n\r\nexport async function startLoginSmsVerification({ email, challengeToken, phoneNumber }) {\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!normalizedEmail) {\r\n    throw new Error(\"invalid_email\");\r\n  }\r\n\r\n  const businessErrors = new Set([\r\n    \"invalid_email\",\r\n    \"invalid_phone_number\",\r\n    \"invalid_mfa_challenge\",\r\n    \"otp_cooldown\",\r\n    \"user_not_found\",\r\n    \"account_disabled\",\r\n    \"already_verified\",\r\n  ]);\r\n\r\n  const db = await getFirestoreStore();\r\n  if (db) {\n    try {\n      return await startLoginSmsVerificationInFirestore(db, {\n        email: normalizedEmail,\n        challengeToken,\n        phoneNumber,\n      });\n    } catch (error) {\n      const reason = error instanceof Error ? error.message : \"\";\n      if (businessErrors.has(reason)) {\n        throw error;\n      }\n      throwFirestoreOperationFailed(error, \"start_login_sms_verification\");\n    }\n  }\n\r\n  return await startLoginSmsVerificationInFile({\r\n    email: normalizedEmail,\r\n    challengeToken,\r\n    phoneNumber,\r\n  });\r\n}\r\n\r\nexport async function completeLoginSmsVerification({ email, challengeToken, otpCode }) {\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!normalizedEmail) {\r\n    throw new Error(\"invalid_email\");\r\n  }\r\n\r\n  const businessErrors = new Set([\r\n    \"invalid_email\",\r\n    \"invalid_mfa_challenge\",\r\n    \"invalid_otp\",\r\n    \"otp_not_requested\",\r\n    \"otp_expired\",\r\n    \"otp_attempts_exceeded\",\r\n    \"user_not_found\",\r\n    \"account_disabled\",\r\n    \"already_verified\",\r\n  ]);\r\n\r\n  let updatedUser = null;\r\n  const db = await getFirestoreStore();\r\n  if (db) {\n    try {\n      updatedUser = await completeLoginSmsVerificationInFirestore(db, {\n        email: normalizedEmail,\n        challengeToken,\n        otpCode,\n      });\n    } catch (error) {\n      const reason = error instanceof Error ? error.message : \"\";\n      if (businessErrors.has(reason)) {\n        throw error;\n      }\n      throwFirestoreOperationFailed(error, \"complete_login_sms_verification\");\n    }\n  } else {\n    updatedUser = await completeLoginSmsVerificationInFile({\r\n      email: normalizedEmail,\r\n      challengeToken,\r\n      otpCode,\r\n    });\r\n  }\r\n\r\n  await syncCustomClaimsForPublicUser(updatedUser, {\r\n    allowMissingUser: false,\r\n    strict: false,\r\n  });\r\n\r\n  return updatedUser;\r\n}\r\n\r\nexport async function completeLoginSmsVerificationWithFirebase({ email, challengeToken, phoneNumber }) {\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!normalizedEmail) {\r\n    throw new Error(\"invalid_email\");\r\n  }\r\n\r\n  const businessErrors = new Set([\r\n    \"invalid_email\",\r\n    \"invalid_phone_number\",\r\n    \"invalid_mfa_challenge\",\r\n    \"user_not_found\",\r\n    \"account_disabled\",\r\n    \"already_verified\",\r\n  ]);\r\n\r\n  let updatedUser = null;\r\n  const db = await getFirestoreStore();\r\n  if (db) {\n    try {\n      updatedUser = await completeLoginSmsVerificationWithFirebaseInFirestore(db, {\n        email: normalizedEmail,\n        challengeToken,\n        phoneNumber,\n      });\n    } catch (error) {\n      const reason = error instanceof Error ? error.message : \"\";\n      if (businessErrors.has(reason)) {\n        throw error;\n      }\n      throwFirestoreOperationFailed(error, \"complete_login_sms_verification_firebase\");\n    }\n  } else {\n    updatedUser = await completeLoginSmsVerificationWithFirebaseInFile({\r\n      email: normalizedEmail,\r\n      challengeToken,\r\n      phoneNumber,\r\n    });\r\n  }\r\n\r\n  await syncCustomClaimsForPublicUser(updatedUser, {\r\n    allowMissingUser: false,\r\n    strict: false,\r\n  });\r\n\r\n  return updatedUser;\r\n}\r\n\r\nexport async function revokeInviteById(inviteId) {\n  const db = await getFirestoreStore();\n  if (db) {\n    try {\n      return await revokeInviteByIdInFirestore(db, inviteId);\n    } catch (error) {\n      throwFirestoreOperationFailed(error, \"revoke_invite\");\n    }\n  }\n\r\n  return await revokeInviteByIdInFile(inviteId);\r\n}\r\n\r\nexport async function listUserAccounts() {\n  const db = await getFirestoreStore();\n  if (db) {\n    try {\n      return await listUserAccountsFromFirestore(db);\n    } catch (error) {\n      throwFirestoreOperationFailed(error, \"list_user_accounts\");\n    }\n  }\n\r\n  return await listUserAccountsFromFile();\r\n}\r\n\r\nexport async function getLoginAccount(email) {\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!normalizedEmail) {\r\n    return null;\r\n  }\r\n\r\n  const db = await getFirestoreStore();\n  if (db) {\n    try {\n      return await getLoginAccountFromFirestore(db, normalizedEmail);\n    } catch (error) {\n      throwFirestoreOperationFailed(error, \"get_login_account\");\n    }\n  }\n\r\n  return await getLoginAccountFromFile(normalizedEmail);\r\n}\r\n\r\nexport async function markUserLogin(email) {\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!normalizedEmail) {\r\n    return null;\r\n  }\r\n\r\n  const db = await getFirestoreStore();\n  if (db) {\n    try {\n      return await markUserLoginInFirestore(db, normalizedEmail);\n    } catch (error) {\n      throwFirestoreOperationFailed(error, \"mark_user_login\");\n    }\n  }\n\r\n  return await markUserLoginInFile(normalizedEmail);\r\n}\r\n\r\nexport async function recordLoginDevice({ email, userAgent, ip, acceptLanguage, secChUa, secChUaPlatform, secChUaMobile }) {\n  const normalizedEmail = normalizeEmail(email);\r\n  if (!normalizedEmail) {\r\n    return null;\r\n  }\r\n\r\n  const device = buildDevicePayload({\r\n    userAgent,\r\n    ip,\r\n    acceptLanguage,\r\n    secChUa,\r\n    secChUaPlatform,\r\n    secChUaMobile,\r\n  });\r\n\r\n  const db = await getFirestoreStore();\n  if (db) {\n    try {\n      return await recordLoginDeviceInFirestore(db, { email: normalizedEmail, device });\n    } catch (error) {\n      throwFirestoreOperationFailed(error, \"record_login_device\");\n    }\n  }\n\r\n  return await recordLoginDeviceInFile({ email: normalizedEmail, device });\r\n}\r\n\r\nexport async function updateLoginDeviceTrust({ email, deviceId, trusted, deniedReason }) {\n  const normalizedEmail = normalizeEmail(email);\r\n  const normalizedDeviceId = String(deviceId || \"\").trim();\r\n  if (!normalizedEmail || !normalizedDeviceId) {\r\n    throw new Error(\"invalid_device\");\r\n  }\r\n\r\n  const db = await getFirestoreStore();\n  if (db) {\n    try {\n      return await updateDeviceTrustInFirestore(db, {\n        email: normalizedEmail,\n        deviceId: normalizedDeviceId,\n        trusted,\n        deniedReason,\n      });\n    } catch (error) {\n      throwFirestoreOperationFailed(error, \"update_login_device_trust\");\n    }\n  }\n\r\n  return await updateDeviceTrustInFile({\r\n    email: normalizedEmail,\r\n    deviceId: normalizedDeviceId,\r\n    trusted,\r\n    deniedReason,\r\n  });\r\n}\r\n\r\nexport async function revokeUserSessions({ userId }) {\n  const normalizedUserId = String(userId || \"\").trim().toLowerCase();\r\n  if (!normalizedUserId) {\r\n    throw new Error(\"invalid_user\");\r\n  }\r\n\r\n  let updatedUser;\r\n  const db = await getFirestoreStore();\n  if (db) {\n    try {\n      updatedUser = await revokeUserSessionsInFirestore(db, { userId: normalizedUserId });\n    } catch (error) {\n      throwFirestoreOperationFailed(error, \"revoke_user_sessions\");\n    }\n  } else {\n    updatedUser = await revokeUserSessionsInFile({ userId: normalizedUserId });\r\n  }\r\n\r\n  await syncCustomClaimsForPublicUser(updatedUser, {\r\n    allowMissingUser: false,\r\n    strict: false,\r\n  });\r\n\r\n  return updatedUser;\r\n}\r\n\r\nexport async function inviteUserAccount({ email, role, invitedBy }) {\n  let result;\r\n  const db = await getFirestoreStore();\n  if (db) {\n    try {\n      result = await inviteUserAccountInFirestore(db, { email, role, invitedBy });\n    } catch (error) {\n      throwFirestoreOperationFailed(error, \"invite_user_account\");\n    }\n  } else {\n    result = await inviteUserAccountInFile({ email, role, invitedBy });\r\n  }\r\n\r\n  await syncCustomClaimsForPublicUser(result?.user, {\r\n    allowMissingUser: true,\r\n    strict: false,\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\nexport async function updateUserAccountStatus({ userId, status }) {\n  let updatedUser;\r\n  const db = await getFirestoreStore();\n  if (db) {\n    try {\n      updatedUser = await updateUserAccountStatusInFirestore(db, { userId, status });\n    } catch (error) {\n      throwFirestoreOperationFailed(error, \"update_user_account_status\");\n    }\n  } else {\n    updatedUser = await updateUserAccountStatusInFile({ userId, status });\r\n  }\r\n\r\n  await syncCustomClaimsForPublicUser(updatedUser, {\r\n    allowMissingUser: false,\r\n    strict: false,\r\n  });\r\n\r\n  return updatedUser;\r\n}\r\n\r\nexport async function archiveUserAccount({\n  userId,\r\n  archivedBy,\r\n  reason,\r\n  retentionDeleteAt,\r\n}) {\r\n  let updatedUser;\r\n  const db = await getFirestoreStore();\n  if (db) {\n    try {\n      updatedUser = await archiveUserAccountInFirestore(db, {\n        userId,\n        archivedBy,\n        reason,\n        retentionDeleteAt,\n      });\n    } catch (error) {\n      throwFirestoreOperationFailed(error, \"archive_user_account\");\n    }\n  } else {\n    updatedUser = await archiveUserAccountInFile({\r\n      userId,\r\n      archivedBy,\r\n      reason,\r\n      retentionDeleteAt,\r\n    });\r\n  }\r\n\r\n  await syncCustomClaimsForPublicUser(updatedUser, {\r\n    allowMissingUser: false,\r\n    strict: false,\r\n  });\r\n\r\n  return updatedUser;\r\n}\r\n\r\nexport async function updateUserAccountRole({ userId, role }) {\n  let updatedUser;\r\n  const db = await getFirestoreStore();\n  if (db) {\n    try {\n      updatedUser = await updateUserAccountRoleInFirestore(db, { userId, role });\n    } catch (error) {\n      throwFirestoreOperationFailed(error, \"update_user_account_role\");\n    }\n  } else {\n    updatedUser = await updateUserAccountRoleInFile({ userId, role });\r\n  }\r\n\r\n  await syncCustomClaimsForPublicUser(updatedUser, {\r\n    allowMissingUser: false,\r\n    strict: false,\r\n  });\r\n\r\n  return updatedUser;\r\n}\r\n\r\nexport async function purgeDueArchivedUserAccounts({ now } = {}) {\n  const db = await getFirestoreStore();\n  if (db) {\n    try {\n      return await purgeDueArchivedUserAccountsInFirestore(db, { now });\n    } catch (error) {\n      throwFirestoreOperationFailed(error, \"purge_due_archived_user_accounts\");\n    }\n  }\n\r\n  return await purgeDueArchivedUserAccountsInFile({ now });\r\n}\r\n\r\nexport async function updateUserAccountProfile({\n  userId,\r\n  firstName,\r\n  middleName,\r\n  lastName,\r\n  profilePhotoDataUrl,\r\n  profilePhotoStoragePath,\r\n  smsMfaEnabled,\r\n}) {\r\n  const db = await getFirestoreStore();\n  if (db) {\n    try {\n      return await updateUserAccountProfileInFirestore(db, {\n        userId,\n        firstName,\n        middleName,\n        lastName,\n        profilePhotoDataUrl,\n        profilePhotoStoragePath,\n        smsMfaEnabled,\n      });\n    } catch (error) {\n      throwFirestoreOperationFailed(error, \"update_user_account_profile\");\n    }\n  }\n\r\n  return await updateUserAccountProfileInFile({\r\n    userId,\r\n    firstName,\r\n    middleName,\r\n    lastName,\r\n    profilePhotoDataUrl,\r\n    profilePhotoStoragePath,\r\n    smsMfaEnabled,\r\n  });\r\n}\r\n","export const ROLES = [\r\n  {\r\n    id: \"SUPER_ADMIN\",\r\n    label: \"Super Admin\",\r\n    description: \"Full system access and administrative control\",\r\n  },\r\n  {\r\n    id: \"GRC\",\r\n    label: \"GRC\",\r\n    description: \"Governance, Risk, and Compliance oversight\",\r\n  },\r\n  {\r\n    id: \"HR\",\r\n    label: \"HR\",\r\n    description: \"Human Resources operations and employee lifecycle\",\r\n  },\r\n  {\r\n    id: \"EA\",\r\n    label: \"EA\",\r\n    description: \"Executive assistance and department coordination\",\r\n  },\r\n  {\r\n    id: \"EMPLOYEE_L1\",\r\n    label: \"Employee (L1)\",\r\n    description: \"Can access and update limited personal profile details\",\r\n  },\r\n  {\r\n    id: \"EMPLOYEE_L2\",\r\n    label: \"Employee (L2)\",\r\n    description: \"Can access and update limited personal profile details\",\r\n  },\r\n  {\r\n    id: \"EMPLOYEE_L3\",\r\n    label: \"Employee (L3)\",\r\n    description: \"Can access and update limited personal profile details\",\r\n  },\r\n];\r\n\r\nexport const MODULES = [\r\n  {\r\n    id: \"dashboard\",\r\n    label: \"Dashboard\",\r\n    href: \"/dashboard\",\r\n    description: \"Company-wide attendance and HR KPIs\",\r\n  },\r\n  {\r\n    id: \"employees\",\r\n    label: \"Employee Records\",\r\n    href: \"/employees\",\r\n    description: \"Centralized employee profiles and status\",\r\n  },\r\n  {\r\n    id: \"employment-lifecycle\",\r\n    label: \"Employment Lifecycle\",\r\n    href: \"/employment-lifecycle\",\r\n    description: \"Onboarding, role changes, disciplinary records, and offboarding\",\r\n  },\r\n  {\r\n    id: \"attendance\",\r\n    label: \"Attendance Management\",\r\n    href: \"/attendance\",\r\n    description: \"Time logs, leave requests, approvals, and traceable updates\",\r\n  },\r\n  {\r\n    id: \"performance\",\r\n    label: \"Performance Management\",\r\n    href: \"/performance\",\r\n    description: \"KPI documentation, evaluations, and promotion justification\",\r\n  },\r\n  {\r\n    id: \"documents\",\r\n    label: \"Document Repository\",\r\n    href: \"/documents\",\r\n    description: \"Version-controlled contracts, NDAs, and HR acknowledgments\",\r\n  },\r\n  {\r\n    id: \"activity-log\",\r\n    label: \"Audit Logs\",\r\n    href: \"/activity-log\",\r\n    description: \"Full audit trail for employee data changes\",\r\n  },\r\n  {\r\n    id: \"exports\",\r\n    label: \"Reports & Exports\",\r\n    href: \"/exports\",\r\n    description: \"Control exports for sheets and reports\",\r\n  },\r\n  {\r\n    id: \"access-management\",\r\n    label: \"Access Management\",\r\n    href: \"/access-management\",\r\n    description: \"Role access review, least privilege checks, and privilege governance\",\r\n  },\r\n  {\r\n    id: \"retention-archive\",\r\n    label: \"Retention & Archive\",\r\n    href: \"/retention-archive\",\r\n    description: \"Archive controls, 5-year retention policy, and secure deletion readiness\",\r\n  },\r\n  {\r\n    id: \"incident-management\",\r\n    label: \"Incident Management\",\r\n    href: \"/incident-management\",\r\n    description: \"PII incident response, escalation tracking, and breach readiness\",\r\n  },\r\n  {\r\n    id: \"requests\",\r\n    label: \"Requests\",\r\n    href: \"/requests\",\r\n    description: \"Self-service requests with workflow tracking\",\r\n  },\r\n  {\r\n    id: \"user-management\",\r\n    label: \"User Management\",\r\n    href: \"/user-management\",\r\n    description: \"Invite users, assign roles, and control account status\",\r\n  },\r\n];\r\n\r\nexport const MODULE_ACCESS = {\r\n  SUPER_ADMIN: [\"dashboard\", \"activity-log\", \"user-management\", \"settings\"],\r\n  GRC: [\r\n    \"dashboard\",\r\n    \"employees\",\r\n    \"employment-lifecycle\",\r\n    \"attendance\",\r\n    \"performance\",\r\n    \"documents\",\r\n    \"activity-log\",\r\n    \"exports\",\r\n    \"user-management\",\r\n    \"retention-archive\",\r\n    \"incident-management\",\r\n    \"settings\",\r\n  ],\r\n  HR: [\r\n    \"dashboard\",\r\n    \"employees\",\r\n    \"employment-lifecycle\",\r\n    \"attendance\",\r\n    \"performance\",\r\n    \"documents\",\r\n    \"exports\",\r\n    \"settings\",\r\n  ],\r\n  EA: [\r\n    \"dashboard\",\r\n    \"employees\",\r\n    \"employment-lifecycle\",\r\n    \"attendance\",\r\n    \"performance\",\r\n    \"documents\",\r\n    \"exports\",\r\n    \"settings\",\r\n  ],\r\n  EMPLOYEE_L1: [\"dashboard\", \"employees\", \"attendance\", \"performance\", \"documents\", \"settings\"],\r\n  EMPLOYEE_L2: [\"dashboard\", \"employees\", \"attendance\", \"performance\", \"documents\", \"settings\"],\r\n  EMPLOYEE_L3: [\"dashboard\", \"employees\", \"attendance\", \"performance\", \"documents\", \"settings\"],\r\n};\r\n\r\nexport const LOGIN_HIGHLIGHTS = [\r\n  \"Invite-first access with required email verification\",\r\n  \"Employee Records with restricted PII controls\",\r\n  \"Employment Lifecycle and immediate offboarding revocation\",\r\n  \"Attendance and Performance workflows with traceability\",\r\n  \"Version-controlled template repository and monitored exports\",\r\n];\r\n","import { createSign } from \"node:crypto\";\r\n\r\nconst GOOGLE_OAUTH_TOKEN_URL = \"https://oauth2.googleapis.com/token\";\r\nconst FIREBASE_IDENTITY_TOOLKIT_BASE_URL = \"https://identitytoolkit.googleapis.com/v1\";\r\nconst CLAIMS_CHAR_LIMIT = 1000;\r\nconst TOKEN_SCOPE = \"https://www.googleapis.com/auth/identitytoolkit\";\r\n\r\nlet cachedAccessToken = {\r\n  token: \"\",\r\n  expiresAtMs: 0,\r\n  cacheKey: \"\",\r\n};\r\n\r\nfunction env(name) {\r\n  return String(process.env[name] || \"\").trim();\r\n}\r\n\r\nfunction parseBooleanEnv(name, fallbackValue = false) {\r\n  const raw = env(name).toLowerCase();\r\n  if (!raw) {\r\n    return fallbackValue;\r\n  }\r\n  return raw === \"true\" || raw === \"1\" || raw === \"yes\";\r\n}\r\n\r\nfunction isClaimsSyncRequired() {\r\n  const defaultRequired = process.env.NODE_ENV === \"production\";\r\n  return parseBooleanEnv(\"CLIO_REQUIRE_FIREBASE_CUSTOM_CLAIMS\", defaultRequired);\r\n}\r\n\r\nfunction normalizePrivateKey(value) {\r\n  return String(value || \"\").replace(/\\\\n/g, \"\\n\").trim();\r\n}\r\n\r\nfunction getServiceAccountConfig() {\r\n  const projectId = env(\"FIREBASE_ADMIN_PROJECT_ID\") || env(\"NEXT_PUBLIC_FIREBASE_PROJECT_ID\");\r\n  const clientEmail = env(\"FIREBASE_ADMIN_CLIENT_EMAIL\");\r\n  const privateKey = normalizePrivateKey(env(\"FIREBASE_ADMIN_PRIVATE_KEY\"));\r\n\r\n  if (!projectId || !clientEmail || !privateKey) {\r\n    return null;\r\n  }\r\n\r\n  return {\r\n    projectId,\r\n    clientEmail,\r\n    privateKey,\r\n  };\r\n}\r\n\r\nfunction base64UrlEncodeJson(payload) {\r\n  return Buffer.from(JSON.stringify(payload), \"utf8\").toString(\"base64url\");\r\n}\r\n\r\nfunction signJwtAssertion({ clientEmail, privateKey }) {\r\n  const issuedAt = Math.floor(Date.now() / 1000);\r\n  const header = {\r\n    alg: \"RS256\",\r\n    typ: \"JWT\",\r\n  };\r\n  const body = {\r\n    iss: clientEmail,\r\n    scope: TOKEN_SCOPE,\r\n    aud: GOOGLE_OAUTH_TOKEN_URL,\r\n    iat: issuedAt,\r\n    exp: issuedAt + 3600,\r\n  };\r\n\r\n  const encodedHeader = base64UrlEncodeJson(header);\r\n  const encodedBody = base64UrlEncodeJson(body);\r\n  const unsignedToken = `${encodedHeader}.${encodedBody}`;\r\n\r\n  const signer = createSign(\"RSA-SHA256\");\r\n  signer.update(unsignedToken);\r\n  signer.end();\r\n  const signature = signer.sign(privateKey, \"base64url\");\r\n\r\n  return `${unsignedToken}.${signature}`;\r\n}\r\n\r\nasync function getAccessToken(config) {\r\n  const cacheKey = `${config.projectId}:${config.clientEmail}`;\r\n  const now = Date.now();\r\n\r\n  if (\r\n    cachedAccessToken.token &&\r\n    cachedAccessToken.cacheKey === cacheKey &&\r\n    now < cachedAccessToken.expiresAtMs - 60_000\r\n  ) {\r\n    return cachedAccessToken.token;\r\n  }\r\n\r\n  const assertion = signJwtAssertion(config);\r\n  const body = new URLSearchParams({\r\n    grant_type: \"urn:ietf:params:oauth:grant-type:jwt-bearer\",\r\n    assertion,\r\n  });\r\n\r\n  const response = await fetch(GOOGLE_OAUTH_TOKEN_URL, {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\r\n    },\r\n    body,\r\n    cache: \"no-store\",\r\n  });\r\n\r\n  const payload = await response.json().catch(() => ({}));\r\n  if (!response.ok || !payload?.access_token) {\r\n    throw new Error(\"firebase_admin_access_token_failed\");\r\n  }\r\n\r\n  const expiresInSeconds = Number.parseInt(String(payload.expires_in || \"3600\"), 10) || 3600;\r\n  cachedAccessToken = {\r\n    token: String(payload.access_token),\r\n    expiresAtMs: now + expiresInSeconds * 1000,\r\n    cacheKey,\r\n  };\r\n\r\n  return cachedAccessToken.token;\r\n}\r\n\r\nfunction mapIdentityToolkitErrorCode(code) {\r\n  const normalized = String(code || \"\").trim();\r\n  if (!normalized) {\r\n    return \"firebase_identity_toolkit_request_failed\";\r\n  }\r\n  if (normalized === \"EMAIL_NOT_FOUND\" || normalized === \"USER_NOT_FOUND\") {\r\n    return \"firebase_user_not_found\";\r\n  }\r\n  if (normalized === \"INVALID_CUSTOM_ATTRIBUTES\") {\r\n    return \"invalid_custom_claims_payload\";\r\n  }\r\n  if (normalized === \"INSUFFICIENT_PERMISSION\") {\r\n    return \"firebase_admin_permission_denied\";\r\n  }\r\n  if (normalized === \"PROJECT_NOT_FOUND\") {\r\n    return \"firebase_project_not_found\";\r\n  }\r\n  return \"firebase_identity_toolkit_request_failed\";\r\n}\r\n\r\nasync function callIdentityToolkit(config, accessToken, methodName, payload) {\r\n  const response = await fetch(\r\n    `${FIREBASE_IDENTITY_TOOLKIT_BASE_URL}/projects/${encodeURIComponent(config.projectId)}/${methodName}`,\r\n    {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${accessToken}`,\r\n      },\r\n      body: JSON.stringify(payload || {}),\r\n      cache: \"no-store\",\r\n    },\r\n  );\r\n\r\n  const result = await response.json().catch(() => ({}));\r\n  if (!response.ok) {\r\n    const reason = mapIdentityToolkitErrorCode(result?.error?.message);\r\n    throw new Error(reason);\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nfunction normalizeEmail(value) {\r\n  return String(value || \"\")\r\n    .trim()\r\n    .toLowerCase();\r\n}\r\n\r\nfunction normalizeRole(value) {\r\n  return String(value || \"\")\r\n    .trim()\r\n    .toUpperCase();\r\n}\r\n\r\nfunction normalizeStatus(value) {\r\n  return String(value || \"\")\r\n    .trim()\r\n    .toLowerCase();\r\n}\r\n\r\nfunction normalizeSessionVersion(value) {\r\n  const parsed = Number.parseInt(String(value ?? \"\"), 10);\r\n  if (!Number.isFinite(parsed) || parsed < 1) {\r\n    return 1;\r\n  }\r\n  return parsed;\r\n}\r\n\r\nfunction parseCustomAttributes(rawValue) {\r\n  if (!rawValue) {\r\n    return {};\r\n  }\r\n  try {\r\n    const parsed = JSON.parse(String(rawValue || \"\"));\r\n    if (parsed && typeof parsed === \"object\" && !Array.isArray(parsed)) {\r\n      return parsed;\r\n    }\r\n  } catch {\r\n    return {};\r\n  }\r\n  return {};\r\n}\r\n\r\nasync function lookupFirebaseUser({ config, accessToken, uid, email }) {\r\n  const normalizedUid = String(uid || \"\").trim();\r\n  const normalizedEmail = normalizeEmail(email);\r\n\r\n  if (normalizedUid) {\r\n    const byUid = await callIdentityToolkit(config, accessToken, \"accounts:lookup\", {\r\n      localId: [normalizedUid],\r\n    });\r\n    const user = Array.isArray(byUid?.users) ? byUid.users[0] : null;\r\n    if (user) {\r\n      return user;\r\n    }\r\n  }\r\n\r\n  if (normalizedEmail) {\r\n    try {\r\n      const byEmail = await callIdentityToolkit(config, accessToken, \"accounts:lookup\", {\r\n        email: [normalizedEmail],\r\n      });\r\n      const user = Array.isArray(byEmail?.users) ? byEmail.users[0] : null;\r\n      if (user) {\r\n        return user;\r\n      }\r\n    } catch (error) {\r\n      if (String(error?.message || \"\") === \"firebase_user_not_found\") {\r\n        return null;\r\n      }\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nfunction buildClioClaims({ role, email, status, sessionVersion }) {\r\n  const claims = {\r\n    role: normalizeRole(role) || \"EMPLOYEE_L1\",\r\n    clioRole: normalizeRole(role) || \"EMPLOYEE_L1\",\r\n    clioEmail: normalizeEmail(email) || \"\",\r\n    clioStatus: normalizeStatus(status) || \"pending\",\r\n    clioSessionVersion: normalizeSessionVersion(sessionVersion),\r\n  };\r\n\r\n  const serialized = JSON.stringify(claims);\r\n  if (serialized.length > CLAIMS_CHAR_LIMIT) {\r\n    throw new Error(\"invalid_custom_claims_payload\");\r\n  }\r\n\r\n  return claims;\r\n}\r\n\r\nexport function isFirebaseCustomClaimsSyncConfigured() {\r\n  return Boolean(getServiceAccountConfig());\r\n}\r\n\r\nexport async function syncFirebaseCustomClaimsForUser({\r\n  uid,\r\n  email,\r\n  role,\r\n  status,\r\n  sessionVersion,\r\n  allowMissingUser = true,\r\n  strict,\r\n} = {}) {\r\n  const config = getServiceAccountConfig();\r\n  const requireSync = typeof strict === \"boolean\" ? strict : isClaimsSyncRequired();\r\n\r\n  if (!config) {\r\n    if (requireSync) {\r\n      throw new Error(\"firebase_custom_claims_not_configured\");\r\n    }\r\n    return {\r\n      ok: false,\r\n      reason: \"firebase_custom_claims_not_configured\",\r\n      uid: \"\",\r\n      email: normalizeEmail(email),\r\n    };\r\n  }\r\n\r\n  const accessToken = await getAccessToken(config);\r\n  const user = await lookupFirebaseUser({\r\n    config,\r\n    accessToken,\r\n    uid,\r\n    email,\r\n  });\r\n\r\n  if (!user) {\r\n    if (allowMissingUser) {\r\n      return {\r\n        ok: false,\r\n        reason: \"firebase_user_not_found\",\r\n        uid: String(uid || \"\").trim(),\r\n        email: normalizeEmail(email),\r\n      };\r\n    }\r\n    throw new Error(\"firebase_user_not_found\");\r\n  }\r\n\r\n  const resolvedUid = String(user.localId || \"\").trim();\r\n  const resolvedEmail = normalizeEmail(email) || normalizeEmail(user.email);\r\n  if (!resolvedUid || !resolvedEmail) {\r\n    throw new Error(\"firebase_user_not_found\");\r\n  }\r\n\r\n  const nextClaims = {\r\n    ...parseCustomAttributes(user.customAttributes),\r\n    ...buildClioClaims({\r\n      role,\r\n      email: resolvedEmail,\r\n      status,\r\n      sessionVersion,\r\n    }),\r\n  };\r\n\r\n  const serializedClaims = JSON.stringify(nextClaims);\r\n  if (serializedClaims.length > CLAIMS_CHAR_LIMIT) {\r\n    throw new Error(\"invalid_custom_claims_payload\");\r\n  }\r\n\r\n  await callIdentityToolkit(config, accessToken, \"accounts:update\", {\r\n    localId: resolvedUid,\r\n    customAttributes: serializedClaims,\r\n  });\r\n\r\n  return {\r\n    ok: true,\r\n    reason: \"synced\",\r\n    uid: resolvedUid,\r\n    email: resolvedEmail,\r\n    claims: nextClaims,\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}