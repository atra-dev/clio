{"version":3,"sources":["../../../../src/components/auth/LoginCard.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport {\r\n  GoogleAuthProvider,\r\n  RecaptchaVerifier,\r\n  getRedirectResult,\r\n  linkWithPhoneNumber,\r\n  onAuthStateChanged,\r\n  reauthenticateWithPhoneNumber,\r\n  signInWithPopup,\r\n  signInWithRedirect,\r\n  signOut,\r\n} from \"firebase/auth\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport BrandMark from \"@/components/ui/BrandMark\";\r\nimport { getFirebaseClientAuth } from \"@/lib/firebase-client-auth\";\r\n\r\nexport default function LoginCard() {\r\n  const router = useRouter();\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [isSendingOtp, setIsSendingOtp] = useState(false);\r\n  const [isVerifyingOtp, setIsVerifyingOtp] = useState(false);\r\n  const [isVerifyingAccess, setIsVerifyingAccess] = useState(false);\r\n  const [useVisibleRecaptcha, setUseVisibleRecaptcha] = useState(false);\r\n  const [otpCooldownSecondsLeft, setOtpCooldownSecondsLeft] = useState(0);\r\n  const finalizingLoginRef = useRef(false);\r\n  const [errorMessage, setErrorMessage] = useState(\"\");\r\n  const [infoMessage, setInfoMessage] = useState(\"\");\r\n  const [mfaState, setMfaState] = useState({\r\n    challengeToken: \"\",\r\n    challengeExpiresAt: \"\",\r\n    phoneNumber: \"\",\r\n    otpCode: \"\",\r\n    otpRequestedAt: \"\",\r\n  });\r\n  const [pendingFirebaseUser, setPendingFirebaseUser] = useState(null);\r\n  const confirmationResultRef = useRef(null);\r\n  const recaptchaVerifierRef = useRef(null);\r\n  const recaptchaCreationPromiseRef = useRef(null);\r\n  const sendOtpInFlightRef = useRef(false);\r\n  const recaptchaContainerIdRef = useRef(`clio-login-sms-recaptcha-${Math.random().toString(36).slice(2, 10)}`);\r\n  const lastAutoSendChallengeRef = useRef(\"\");\r\n  const lastAutoVerifyCodeRef = useRef(\"\");\r\n  const otpInputRefs = useRef([]);\r\n  const REDIRECT_PENDING_KEY = \"clio_google_redirect_pending\";\r\n  const REDIRECT_USER_WAIT_TIMEOUT_MS = 15000;\r\n  const OTP_AUTO_SEND_GUARD_WINDOW_MS = 120000;\r\n\r\n  const startOtpCooldown = (seconds = 90) => {\r\n    const next = Number.isFinite(seconds) ? Math.max(1, Math.trunc(seconds)) : 90;\r\n    setOtpCooldownSecondsLeft(next);\r\n  };\r\n\r\n  const setRedirectPending = () => {\r\n    if (typeof window === \"undefined\") {\r\n      return;\r\n    }\r\n    window.sessionStorage.setItem(REDIRECT_PENDING_KEY, \"1\");\r\n  };\r\n\r\n  const clearRedirectPending = () => {\r\n    if (typeof window === \"undefined\") {\r\n      return;\r\n    }\r\n    window.sessionStorage.removeItem(REDIRECT_PENDING_KEY);\r\n  };\r\n\r\n  const hasRedirectPending = () => {\r\n    if (typeof window === \"undefined\") {\r\n      return false;\r\n    }\r\n    return window.sessionStorage.getItem(REDIRECT_PENDING_KEY) === \"1\";\r\n  };\r\n\r\n  const buildOtpAutoSendGuardKey = (challengeToken, userId = \"\") => {\r\n    const normalizedUserId = String(userId || \"\").trim();\r\n    if (normalizedUserId) {\r\n      return `clio_sms_otp_autosend_guard:user:${normalizedUserId}`;\r\n    }\r\n    return `clio_sms_otp_autosend_guard:challenge:${String(challengeToken || \"\").trim()}`;\r\n  };\r\n\r\n  const markOtpAutoSendGuard = (challengeToken, userId = \"\") => {\r\n    if (typeof window === \"undefined\") {\r\n      return;\r\n    }\r\n    const normalized = String(challengeToken || \"\").trim();\r\n    if (!normalized) {\r\n      return;\r\n    }\r\n    window.sessionStorage.setItem(buildOtpAutoSendGuardKey(normalized, userId), String(Date.now()));\r\n  };\r\n\r\n  const shouldSkipOtpAutoSend = (challengeToken, userId = \"\") => {\r\n    if (typeof window === \"undefined\") {\r\n      return false;\r\n    }\r\n    const normalized = String(challengeToken || \"\").trim();\r\n    if (!normalized) {\r\n      return false;\r\n    }\r\n    const key = buildOtpAutoSendGuardKey(normalized, userId);\r\n    const raw = window.sessionStorage.getItem(key);\r\n    const sentAt = Number(raw);\r\n    if (!Number.isFinite(sentAt) || sentAt <= 0) {\r\n      if (raw) {\r\n        window.sessionStorage.removeItem(key);\r\n      }\r\n      return false;\r\n    }\r\n    const elapsed = Date.now() - sentAt;\r\n    if (elapsed >= OTP_AUTO_SEND_GUARD_WINDOW_MS) {\r\n      window.sessionStorage.removeItem(key);\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const waitForSignedInUser = async (auth, timeoutMs = 5000) => {\r\n    if (auth.currentUser) {\r\n      return auth.currentUser;\r\n    }\r\n\r\n    return await new Promise((resolve) => {\r\n      let settled = false;\r\n      let unsubscribe = () => {};\r\n\r\n      const finish = (value) => {\r\n        if (settled) {\r\n          return;\r\n        }\r\n        settled = true;\r\n        unsubscribe();\r\n        resolve(value || null);\r\n      };\r\n\r\n      const timeout = window.setTimeout(() => {\r\n        finish(null);\r\n      }, timeoutMs);\r\n\r\n      unsubscribe = onAuthStateChanged(auth, (user) => {\r\n        if (!user) {\r\n          return;\r\n        }\r\n        window.clearTimeout(timeout);\r\n        finish(user);\r\n      });\r\n    });\r\n  };\r\n\r\n  const buildGoogleProvider = () => {\r\n    const provider = new GoogleAuthProvider();\r\n    provider.setCustomParameters({\r\n      prompt: \"select_account\",\r\n    });\r\n    return provider;\r\n  };\r\n\r\n  const mapLoginError = (error) => {\r\n    if (error?.code === \"sms_mfa_required\") {\r\n      return \"SMS authentication is required before login.\";\r\n    }\r\n\r\n    const rawCode = String(error?.code || \"\").trim();\r\n    const rawMessage = String(error?.message || \"\").trim();\r\n\r\n    if (rawCode === \"email_not_verified\") {\r\n      return \"Google account email must be verified.\";\r\n    }\r\n    if (rawCode === \"provider_not_allowed\") {\r\n      return \"Only Google sign-in is allowed for this workspace.\";\r\n    }\r\n    if (rawCode === \"role_not_provisioned\") {\r\n      return \"Account is not provisioned for this workspace.\";\r\n    }\r\n    if (rawCode === \"account_disabled\") {\r\n      return \"Account is disabled. Please contact Super Admin.\";\r\n    }\r\n    if (rawCode === \"invite_email_verification_required\") {\r\n      return \"Complete invite verification first before login.\";\r\n    }\r\n    if (rawCode === \"account_inactive\") {\r\n      return \"Account is not active yet. Please contact Super Admin.\";\r\n    }\r\n    if (rawCode === \"sms_mfa_setup_unavailable\") {\r\n      return \"SMS authentication setup is temporarily unavailable. Please retry sign-in.\";\r\n    }\r\n    if (rawCode === \"firebase_phone_not_verified\") {\r\n      return \"Phone verification is not complete. Finish OTP verification first.\";\r\n    }\r\n\r\n    if (rawCode === \"auth/unauthorized-domain\") {\r\n      return \"Current domain is not authorized in Firebase Authentication settings.\";\r\n    }\r\n    if (rawCode === \"auth/invalid-api-key\") {\r\n      return \"Firebase API key is invalid. Check NEXT_PUBLIC_FIREBASE_API_KEY in .env.local.\";\r\n    }\r\n    if (rawCode === \"auth/internal-error\") {\r\n      return \"Authentication flow was interrupted. Click Continue with Google again.\";\r\n    }\r\n    if (rawCode === \"auth/invalid-app-credential\") {\r\n      return \"SMS authentication setup failed. Check Firebase Phone provider setup and Authorized domains.\";\r\n    }\r\n    if (rawCode === \"auth/operation-not-allowed\") {\r\n      return \"Firebase Phone authentication is disabled. Enable it in Firebase Authentication > Sign-in method.\";\r\n    }\r\n    if (rawCode === \"auth/invalid-phone-number\") {\r\n      return \"Phone number is invalid. Use international format (e.g. +639171234567).\";\r\n    }\r\n    if (rawCode === \"auth/too-many-requests\") {\r\n      return \"Too many OTP attempts. Please wait before retrying.\";\r\n    }\r\n    if (rawCode === \"auth/code-expired\") {\r\n      return \"OTP has expired. Request a new code.\";\r\n    }\r\n    if (rawCode === \"auth/invalid-verification-code\") {\r\n      return \"OTP is invalid. Check the code and try again.\";\r\n    }\r\n    if (rawCode === \"auth/provider-already-linked\") {\r\n      return \"Phone number is already linked. Continue verification.\";\r\n    }\r\n    if (rawCode === \"auth/captcha-check-failed\") {\r\n      return \"Captcha validation failed. Retry and complete captcha challenge.\";\r\n    }\r\n    if (rawMessage.toLowerCase().includes(\"recaptcha has already been rendered\")) {\r\n      return \"Security challenge is refreshing. Please retry OTP in a few seconds.\";\r\n    }\r\n    if (rawMessage.startsWith(\"firebase_client_not_configured\")) {\r\n      return \"Firebase client is not configured. Set NEXT_PUBLIC_FIREBASE_API_KEY, NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN, NEXT_PUBLIC_FIREBASE_PROJECT_ID, and NEXT_PUBLIC_FIREBASE_APP_ID, then restart npm run dev.\";\r\n    }\r\n    return error?.message || \"Unable to complete Google sign-in.\";\r\n  };\r\n\r\n  const disposeRecaptchaVerifier = () => {\r\n    recaptchaCreationPromiseRef.current = null;\r\n    if (recaptchaVerifierRef.current) {\r\n      try {\r\n        recaptchaVerifierRef.current.clear();\r\n      } catch {}\r\n      recaptchaVerifierRef.current = null;\r\n    }\r\n\r\n    if (typeof document !== \"undefined\") {\r\n      const container = document.getElementById(recaptchaContainerIdRef.current);\r\n      if (container) {\r\n        container.innerHTML = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  const getOrCreateRecaptchaVerifier = async (auth) => {\r\n    if (recaptchaVerifierRef.current) {\r\n      return recaptchaVerifierRef.current;\r\n    }\r\n\r\n    if (recaptchaCreationPromiseRef.current) {\r\n      return await recaptchaCreationPromiseRef.current;\r\n    }\r\n\r\n    if (typeof window === \"undefined\") {\r\n      throw new Error(\"captcha_not_ready\");\r\n    }\r\n\r\n    const container = document.getElementById(recaptchaContainerIdRef.current);\r\n    if (!container) {\r\n      throw new Error(\"captcha_not_ready\");\r\n    }\r\n\r\n    recaptchaCreationPromiseRef.current = (async () => {\r\n      // Ensure the host element is clean before creating a new verifier instance.\r\n      container.innerHTML = \"\";\r\n      const verifier = new RecaptchaVerifier(auth, recaptchaContainerIdRef.current, {\r\n        size: useVisibleRecaptcha ? \"normal\" : \"invisible\",\r\n      });\r\n      await verifier.render();\r\n      recaptchaVerifierRef.current = verifier;\r\n      return verifier;\r\n    })();\r\n\r\n    try {\r\n      return await recaptchaCreationPromiseRef.current;\r\n    } catch (error) {\r\n      try {\r\n        container.innerHTML = \"\";\r\n      } catch {}\r\n      recaptchaVerifierRef.current = null;\r\n      throw error;\r\n    } finally {\r\n      recaptchaCreationPromiseRef.current = null;\r\n    }\r\n  };\r\n\r\n  const resetMfaState = () => {\r\n    setMfaState({\r\n      challengeToken: \"\",\r\n      challengeExpiresAt: \"\",\r\n      phoneNumber: \"\",\r\n      otpCode: \"\",\r\n      otpRequestedAt: \"\",\r\n    });\r\n    sendOtpInFlightRef.current = false;\r\n    setUseVisibleRecaptcha(false);\r\n    setPendingFirebaseUser(null);\r\n    setInfoMessage(\"\");\r\n    confirmationResultRef.current = null;\r\n    lastAutoSendChallengeRef.current = \"\";\r\n    lastAutoVerifyCodeRef.current = \"\";\r\n    disposeRecaptchaVerifier();\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (otpCooldownSecondsLeft <= 0) {\r\n      return;\r\n    }\r\n\r\n    const timer = window.setInterval(() => {\r\n      setOtpCooldownSecondsLeft((current) => (current <= 1 ? 0 : current - 1));\r\n    }, 1000);\r\n\r\n    return () => {\r\n      window.clearInterval(timer);\r\n    };\r\n  }, [otpCooldownSecondsLeft]);\r\n\r\n  const completeWorkspaceLogin = async (auth, firebaseUser) => {\r\n    const idToken = await firebaseUser.getIdToken(true);\r\n\r\n    const response = await fetch(\"/api/auth/login\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        idToken,\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const payload = await response.json().catch(() => ({}));\r\n      if (payload?.reason === \"sms_mfa_required\") {\r\n        const smsError = new Error(payload.message || \"SMS authentication is required before login.\");\r\n        smsError.code = \"sms_mfa_required\";\r\n        smsError.challengeToken = String(payload?.challengeToken || \"\");\r\n        smsError.challengeExpiresAt = String(payload?.challengeExpiresAt || \"\");\r\n        smsError.firebaseUser = firebaseUser;\r\n        throw smsError;\r\n      }\r\n\r\n      await signOut(auth).catch(() => {});\r\n      const loginError = new Error(payload.message || \"Unable to log in.\");\r\n      loginError.code = String(payload?.reason || `http_${response.status}` || \"\").trim();\r\n      throw loginError;\r\n    }\r\n  };\r\n\r\n  const activateSmsEnrollment = (error, fallbackUser = null) => {\r\n    if (error?.code !== \"sms_mfa_required\") {\r\n      return false;\r\n    }\r\n\r\n    const challengeToken = String(error?.challengeToken || \"\").trim();\r\n    if (!challengeToken) {\r\n      return false;\r\n    }\r\n\r\n    const authUser = error?.firebaseUser || fallbackUser || null;\r\n    if (!authUser) {\r\n      return false;\r\n    }\r\n\r\n    setPendingFirebaseUser(authUser);\r\n    setMfaState({\r\n      challengeToken,\r\n      challengeExpiresAt: String(error?.challengeExpiresAt || \"\"),\r\n      phoneNumber: authUser.phoneNumber || \"\",\r\n      otpCode: \"\",\r\n      otpRequestedAt: \"\",\r\n    });\r\n    setErrorMessage(\"\");\r\n    setInfoMessage(\"\");\r\n    sendOtpInFlightRef.current = false;\r\n    setUseVisibleRecaptcha(false);\r\n    confirmationResultRef.current = null;\r\n    lastAutoSendChallengeRef.current = \"\";\r\n    lastAutoVerifyCodeRef.current = \"\";\r\n    disposeRecaptchaVerifier();\r\n    return true;\r\n  };\r\n\r\n  const completeFirebaseSmsEnrollment = async (firebaseUser, phoneNumberOverride = \"\") => {\r\n    const idToken = await firebaseUser.getIdToken(true);\r\n    const response = await fetch(\"/api/auth/mfa/sms/verify\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        idToken,\r\n        challengeToken: mfaState.challengeToken,\r\n        phoneNumber: String(phoneNumberOverride || mfaState.phoneNumber || \"\").trim(),\r\n      }),\r\n    });\r\n\r\n    const payload = await response.json().catch(() => ({}));\r\n    if (!response.ok) {\r\n      throw new Error(payload?.message || \"Unable to complete SMS verification.\");\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const hasLinkedPhone =\r\n      Boolean(pendingFirebaseUser?.phoneNumber) ||\r\n      pendingFirebaseUser?.providerData?.some((provider) => provider?.providerId === \"phone\");\r\n\r\n    if (!mfaState.challengeToken || !hasLinkedPhone || !pendingFirebaseUser) {\r\n      return;\r\n    }\r\n\r\n    if (isSendingOtp || isVerifyingOtp || otpCooldownSecondsLeft > 0) {\r\n      return;\r\n    }\r\n\r\n    if (confirmationResultRef.current || mfaState.otpRequestedAt) {\r\n      return;\r\n    }\r\n\r\n    if (lastAutoSendChallengeRef.current === mfaState.challengeToken) {\r\n      return;\r\n    }\r\n\r\n    if (shouldSkipOtpAutoSend(mfaState.challengeToken, pendingFirebaseUser?.uid)) {\r\n      setInfoMessage(\"OTP was recently sent. Enter the current code or tap Send OTP if needed.\");\r\n      return;\r\n    }\r\n\r\n    lastAutoSendChallengeRef.current = mfaState.challengeToken;\r\n    setInfoMessage(\"Sending OTP to your registered mobile number...\");\r\n    handleSendOtp().catch(() => null);\r\n  }, [\r\n    isSendingOtp,\r\n    isVerifyingOtp,\r\n    otpCooldownSecondsLeft,\r\n    mfaState.challengeToken,\r\n    mfaState.otpRequestedAt,\r\n    pendingFirebaseUser,\r\n  ]);\r\n\r\n  const handleSendOtp = async () => {\r\n    if (!pendingFirebaseUser || !mfaState.challengeToken || isSendingOtp || sendOtpInFlightRef.current) {\r\n      return;\r\n    }\r\n\r\n    sendOtpInFlightRef.current = true;\r\n    setIsSendingOtp(true);\r\n    setErrorMessage(\"\");\r\n    setInfoMessage(\"\");\r\n\r\n    try {\r\n      const auth = getFirebaseClientAuth();\r\n      const activeUser = auth.currentUser || pendingFirebaseUser;\r\n      if (!activeUser) {\r\n        throw new Error(\"Firebase session expired. Retry Google sign-in.\");\r\n      }\r\n\r\n      const alreadyLinked = activeUser.providerData.some((provider) => provider?.providerId === \"phone\");\r\n      const fallbackPhoneNumber = String(mfaState.phoneNumber || \"\").trim();\r\n      const targetPhoneNumber = String(activeUser.phoneNumber || fallbackPhoneNumber).trim();\r\n      if (!targetPhoneNumber) {\r\n        throw new Error(\"auth/invalid-phone-number\");\r\n      }\r\n\r\n      const requestOtp = async () => {\r\n        const verifier = await getOrCreateRecaptchaVerifier(auth);\r\n        return alreadyLinked\r\n          ? await reauthenticateWithPhoneNumber(activeUser, targetPhoneNumber, verifier)\r\n          : await linkWithPhoneNumber(activeUser, targetPhoneNumber, verifier);\r\n      };\r\n\r\n      let confirmationResult;\r\n      try {\r\n        confirmationResult = await requestOtp();\r\n      } catch (firstError) {\r\n        const firstMessage = String(firstError?.message || \"\").toLowerCase();\r\n        if (firstMessage.includes(\"recaptcha has already been rendered\")) {\r\n          disposeRecaptchaVerifier();\r\n          confirmationResult = await requestOtp();\r\n        } else {\r\n          throw firstError;\r\n        }\r\n      }\r\n\r\n      confirmationResultRef.current = confirmationResult;\r\n      setMfaState((current) => ({\r\n        ...current,\r\n        phoneNumber: targetPhoneNumber,\r\n        otpCode: \"\",\r\n        otpRequestedAt: new Date().toISOString(),\r\n      }));\r\n      markOtpAutoSendGuard(mfaState.challengeToken, activeUser.uid);\r\n      setUseVisibleRecaptcha(false);\r\n      setOtpCooldownSecondsLeft(0);\r\n      lastAutoVerifyCodeRef.current = \"\";\r\n      setInfoMessage(\"OTP sent via SMS. Enter the code to continue.\");\r\n    } catch (error) {\r\n      const errorCode = String(error?.code || \"\").trim();\r\n      const errorMessage = String(error?.message || \"\").toLowerCase();\r\n      const isCaptchaProblem =\r\n        errorCode === \"auth/captcha-check-failed\" ||\r\n        errorMessage.includes(\"recaptcha has already been rendered\") ||\r\n        errorMessage.includes(\"recaptcha\");\r\n      if (isCaptchaProblem && !useVisibleRecaptcha) {\r\n        setUseVisibleRecaptcha(true);\r\n      }\r\n      if (String(error?.code || \"\").trim() === \"auth/too-many-requests\") {\r\n        startOtpCooldown(90);\r\n      }\r\n      const mapped = mapLoginError(error);\r\n      setErrorMessage(mapped);\r\n      disposeRecaptchaVerifier();\r\n      confirmationResultRef.current = null;\r\n    } finally {\r\n      sendOtpInFlightRef.current = false;\r\n      setIsSendingOtp(false);\r\n    }\r\n  };\r\n\r\n  const handleVerifyOtp = async () => {\r\n    const enteredOtpCode = String(mfaState.otpCode || \"\")\r\n      .replace(/\\D/g, \"\")\r\n      .slice(0, 6);\r\n    if (!pendingFirebaseUser || !mfaState.challengeToken || enteredOtpCode.length !== 6 || isVerifyingOtp) {\r\n      return;\r\n    }\r\n\r\n    setIsVerifyingOtp(true);\r\n    setIsVerifyingAccess(true);\r\n    setErrorMessage(\"\");\r\n    setInfoMessage(\"\");\r\n\r\n    try {\r\n      const auth = getFirebaseClientAuth();\r\n      const confirmationResult = confirmationResultRef.current;\r\n      if (!confirmationResult) {\r\n        throw new Error(\"Request OTP first before entering a verification code.\");\r\n      }\r\n\r\n      const credentialResult = await confirmationResult.confirm(enteredOtpCode);\r\n      const verifiedUser = credentialResult?.user || auth.currentUser || pendingFirebaseUser;\r\n      if (!verifiedUser) {\r\n        throw new Error(\"Firebase session expired. Retry Google sign-in.\");\r\n      }\r\n\r\n      await completeFirebaseSmsEnrollment(verifiedUser, verifiedUser.phoneNumber || mfaState.phoneNumber);\r\n      await completeWorkspaceLogin(auth, verifiedUser);\r\n      resetMfaState();\r\n      router.replace(\"/dashboard\");\r\n      router.refresh();\r\n    } catch (error) {\r\n      if (activateSmsEnrollment(error, pendingFirebaseUser)) {\r\n        setInfoMessage(\"SMS challenge refreshed. Request OTP again.\");\r\n      } else {\r\n        setErrorMessage(mapLoginError(error));\r\n      }\r\n    } finally {\r\n      setIsVerifyingOtp(false);\r\n      setIsVerifyingAccess(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    let active = true;\r\n    const processRedirectResult = async () => {\r\n      try {\r\n        const auth = getFirebaseClientAuth();\r\n        const redirectWasPending = hasRedirectPending();\r\n        const redirectResult = await getRedirectResult(auth);\r\n        if (!active) {\r\n          return;\r\n        }\r\n\r\n        // Firebase can restore currentUser even when getRedirectResult() is null.\r\n        // Use both sources so redirect callbacks are resilient across browsers.\r\n        const redirectUser =\r\n          redirectResult?.user ||\r\n          auth.currentUser ||\r\n          (redirectWasPending ? await waitForSignedInUser(auth, REDIRECT_USER_WAIT_TIMEOUT_MS) : null);\r\n\r\n        if (redirectUser) {\r\n          setIsSubmitting(true);\r\n          setIsVerifyingAccess(true);\r\n          setErrorMessage(\"\");\r\n          clearRedirectPending();\r\n          await completeWorkspaceLogin(auth, redirectUser);\r\n          finalizingLoginRef.current = true;\r\n          router.replace(\"/dashboard\");\r\n          router.refresh();\r\n          return;\r\n        }\r\n\r\n        if (!redirectWasPending) {\r\n          return;\r\n        }\r\n\r\n        clearRedirectPending();\r\n        setInfoMessage(\"Sign-in session was not completed. Click Continue with Google to retry.\");\r\n      } catch (error) {\r\n        if (!active) {\r\n          return;\r\n        }\r\n        clearRedirectPending();\r\n        if (!activateSmsEnrollment(error)) {\r\n          setErrorMessage(mapLoginError(error));\r\n        }\r\n      } finally {\r\n        if (active && !finalizingLoginRef.current) {\r\n          setIsSubmitting(false);\r\n          setIsVerifyingAccess(false);\r\n        }\r\n      }\r\n    };\r\n\r\n    processRedirectResult();\r\n    return () => {\r\n      active = false;\r\n      disposeRecaptchaVerifier();\r\n      confirmationResultRef.current = null;\r\n    };\r\n  }, [router]);\r\n\r\n  const handleGoogleLogin = async () => {\r\n    setIsSubmitting(true);\r\n    setErrorMessage(\"\");\r\n    setInfoMessage(\"\");\r\n\r\n    let auth;\r\n    let provider;\r\n\r\n    try {\r\n      auth = getFirebaseClientAuth();\r\n      provider = buildGoogleProvider();\r\n\r\n      const popupResult = await signInWithPopup(auth, provider);\r\n      if (popupResult?.user) {\r\n        clearRedirectPending();\r\n        setIsVerifyingAccess(true);\r\n        await completeWorkspaceLogin(auth, popupResult.user);\r\n        finalizingLoginRef.current = true;\r\n        router.replace(\"/dashboard\");\r\n        router.refresh();\r\n        return;\r\n      }\r\n\r\n      setRedirectPending();\r\n      await signInWithRedirect(auth, provider);\r\n      return;\r\n    } catch (error) {\r\n      const rawCode = String(error?.code || \"\").trim();\r\n      const canFallbackToRedirect =\r\n        rawCode === \"auth/popup-blocked\" ||\r\n        rawCode === \"auth/popup-closed-by-user\" ||\r\n        rawCode === \"auth/cancelled-popup-request\" ||\r\n        rawCode === \"auth/internal-error\";\r\n\r\n      if (canFallbackToRedirect && auth && provider) {\r\n        try {\r\n          setRedirectPending();\r\n          await signInWithRedirect(auth, provider);\r\n          return;\r\n        } catch (redirectError) {\r\n          clearRedirectPending();\r\n          if (!activateSmsEnrollment(redirectError)) {\r\n            setErrorMessage(mapLoginError(redirectError));\r\n          }\r\n          return;\r\n        }\r\n      }\r\n\r\n      clearRedirectPending();\r\n      if (!activateSmsEnrollment(error)) {\r\n        setErrorMessage(mapLoginError(error));\r\n      }\r\n    } finally {\r\n      if (!finalizingLoginRef.current) {\r\n        setIsSubmitting(false);\r\n        setIsVerifyingAccess(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  const showVerifyingOverlay = isVerifyingAccess || isVerifyingOtp || finalizingLoginRef.current;\r\n  const hasPhoneProviderLinked =\r\n    Boolean(pendingFirebaseUser?.phoneNumber) ||\r\n    pendingFirebaseUser?.providerData?.some((provider) => provider?.providerId === \"phone\");\r\n  const hasMfaChallenge = Boolean(mfaState.challengeToken);\r\n  const isPhoneRegistrationRequired = hasMfaChallenge && !hasPhoneProviderLinked;\r\n  const hasPhoneNumber = mfaState.phoneNumber.trim().length > 0;\r\n  const hasOtpRequest = Boolean(mfaState.otpRequestedAt) || Boolean(confirmationResultRef.current);\r\n  const isOtpCooldownActive = otpCooldownSecondsLeft > 0;\r\n  const isSmsSendingStep = isPhoneRegistrationRequired && isSendingOtp && !hasOtpRequest;\r\n  const showRegistrationStep = isPhoneRegistrationRequired && !hasOtpRequest && !isSmsSendingStep;\r\n  const showOtpStep = hasOtpRequest || !isPhoneRegistrationRequired;\r\n  const modalTitle = showRegistrationStep\r\n    ? \"Register Phone Number\"\r\n    : isSmsSendingStep\r\n      ? \"Sending OTP Code\"\r\n      : \"OTP Verification\";\r\n  const modalDescription = showRegistrationStep\r\n    ? \"Register your mobile number first before you can continue.\"\r\n    : isSmsSendingStep\r\n      ? \"Please wait while we send a one-time code to your mobile number.\"\r\n      : \"Enter the 6-digit code sent to your mobile number.\";\r\n  const otpCodeValue = String(mfaState.otpCode || \"\")\r\n    .replace(/\\D/g, \"\")\r\n    .slice(0, 6);\r\n  const otpDigitValues = Array.from({ length: 6 }, (_, index) => otpCodeValue[index] || \"\");\r\n\r\n  const updateOtpCode = (nextCode) => {\r\n    const normalized = String(nextCode || \"\")\r\n      .replace(/\\D/g, \"\")\r\n      .slice(0, 6);\r\n    setMfaState((current) => ({\r\n      ...current,\r\n      otpCode: normalized,\r\n    }));\r\n  };\r\n\r\n  const handleOtpInputChange = (index, rawValue) => {\r\n    const digits = String(rawValue || \"\").replace(/\\D/g, \"\");\r\n    const currentDigits = otpDigitValues.slice();\r\n\r\n    if (!digits) {\r\n      if (index >= otpCodeValue.length) {\r\n        return;\r\n      }\r\n      updateOtpCode(otpCodeValue.slice(0, index));\r\n      return;\r\n    }\r\n\r\n    for (let offset = 0; offset < digits.length && index + offset < 6; offset += 1) {\r\n      currentDigits[index + offset] = digits[offset];\r\n    }\r\n\r\n    updateOtpCode(currentDigits.join(\"\"));\r\n    const nextIndex = Math.min(index + digits.length, 5);\r\n    window.requestAnimationFrame(() => {\r\n      otpInputRefs.current[nextIndex]?.focus();\r\n      otpInputRefs.current[nextIndex]?.select?.();\r\n    });\r\n  };\r\n\r\n  const handleOtpInputKeyDown = (index, event) => {\r\n    if (event.key === \"Backspace\" && !otpDigitValues[index] && index > 0) {\r\n      event.preventDefault();\r\n      updateOtpCode(otpCodeValue.slice(0, index - 1));\r\n      window.requestAnimationFrame(() => {\r\n        otpInputRefs.current[index - 1]?.focus();\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (event.key === \"ArrowLeft\" && index > 0) {\r\n      event.preventDefault();\r\n      otpInputRefs.current[index - 1]?.focus();\r\n      return;\r\n    }\r\n\r\n    if (event.key === \"ArrowRight\" && index < 5) {\r\n      event.preventDefault();\r\n      otpInputRefs.current[index + 1]?.focus();\r\n    }\r\n  };\r\n\r\n  const handleOtpPaste = (event) => {\r\n    const pasted = event.clipboardData?.getData(\"text\") || \"\";\r\n    const digits = pasted.replace(/\\D/g, \"\").slice(0, 6);\r\n    if (!digits) {\r\n      return;\r\n    }\r\n    event.preventDefault();\r\n    updateOtpCode(digits);\r\n    const focusIndex = Math.min(digits.length, 6) - 1;\r\n    window.requestAnimationFrame(() => {\r\n      otpInputRefs.current[focusIndex]?.focus();\r\n      otpInputRefs.current[focusIndex]?.select?.();\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!hasMfaChallenge) {\r\n      return;\r\n    }\r\n\r\n    if (otpCodeValue.length < 6) {\r\n      lastAutoVerifyCodeRef.current = \"\";\r\n      return;\r\n    }\r\n\r\n    if (!hasOtpRequest || isVerifyingOtp || isSendingOtp) {\r\n      return;\r\n    }\r\n\r\n    const submissionKey = `${mfaState.challengeToken}:${otpCodeValue}`;\r\n    if (lastAutoVerifyCodeRef.current === submissionKey) {\r\n      return;\r\n    }\r\n\r\n    lastAutoVerifyCodeRef.current = submissionKey;\r\n    handleVerifyOtp().catch(() => null);\r\n  }, [\r\n    hasMfaChallenge,\r\n    hasOtpRequest,\r\n    isSendingOtp,\r\n    isVerifyingOtp,\r\n    mfaState.challengeToken,\r\n    otpCodeValue,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    if (!hasMfaChallenge || !hasOtpRequest || isVerifyingOtp) {\r\n      return;\r\n    }\r\n\r\n    const firstEmptyIndex = otpDigitValues.findIndex((digit) => !digit);\r\n    const targetIndex = firstEmptyIndex === -1 ? 5 : firstEmptyIndex;\r\n    window.requestAnimationFrame(() => {\r\n      otpInputRefs.current[targetIndex]?.focus();\r\n    });\r\n  }, [hasMfaChallenge, hasOtpRequest, isVerifyingOtp, otpCodeValue]);\r\n\r\n  return (\r\n    <section className=\"w-full\">\r\n      <div className=\"relative mx-auto w-full max-w-3xl overflow-hidden rounded-3xl border border-[#e6dcc7] bg-[#fffdf7] p-8 shadow-[0_28px_60px_-44px_rgba(15,23,42,0.55)] sm:p-10\">\r\n        <div className=\"pointer-events-none absolute left-0 right-0 top-0 h-1.5 bg-[linear-gradient(90deg,#0f766e_0%,#0284c7_45%,#f97316_100%)]\" />\r\n        <div className=\"pointer-events-none absolute -top-20 -right-20 h-56 w-56 rounded-full bg-[#f1f5f9]\" />\r\n        <div className=\"pointer-events-none absolute -bottom-20 -left-20 h-56 w-56 rounded-full bg-[#ffe8c7]\" />\r\n        <div className={`relative space-y-7 transition-opacity ${hasMfaChallenge ? \"opacity-70\" : \"opacity-100\"}`}>\r\n          <BrandMark compact />\r\n          <div className=\"space-y-2\">\r\n            <p className=\"text-xs font-semibold uppercase tracking-[0.28em] text-[#0f766e]\">\r\n              Clio Workspace\r\n            </p>\r\n            <h1 className=\"max-w-xl text-3xl font-semibold tracking-tight text-slate-900 sm:text-4xl\">\r\n              Secure access to your workspace.\r\n            </h1>\r\n            <p className=\"max-w-lg text-base text-slate-600\">\r\n              Sign in with your verified work account to continue.\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"pt-1\" />\r\n\r\n          <div className=\"space-y-5 pt-2\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleGoogleLogin}\r\n              disabled={isSubmitting || hasMfaChallenge}\r\n              className=\"relative inline-flex h-12 w-full items-center justify-center rounded-2xl border border-[#d2d6dc] bg-white px-5 text-[15px] font-semibold text-[#1f1f1f] shadow-[0_1px_2px_rgba(15,23,42,0.08)] transition-all duration-200 hover:border-[#c4c8ce] hover:bg-[#f8f9fa] active:scale-[0.997] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#1a73e8]/35 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-65\"\r\n            >\r\n              <svg viewBox=\"0 0 18 18\" className=\"pointer-events-none absolute left-5 top-1/2 h-5 w-5 -translate-y-1/2\" aria-hidden=\"true\">\r\n                <path\r\n                  fill=\"#4285F4\"\r\n                  d=\"M17.64 9.2045c0-.638-.0573-1.2518-.1636-1.8409H9v3.4818h4.8436c-.2086 1.125-.8427 2.0782-1.7977 2.7155v2.2582h2.9082c1.7018-1.5664 2.6859-3.8741 2.6859-6.6146z\"\r\n                />\r\n                <path\r\n                  fill=\"#34A853\"\r\n                  d=\"M9 18c2.43 0 4.4673-.8064 5.9564-2.1805l-2.9082-2.2582c-.8064.5409-1.8377.8605-3.0482.8605-2.3468 0-4.3341-1.5859-5.0432-3.7168H.9577v2.3332C2.4382 15.98 5.4818 18 9 18z\"\r\n                />\r\n                <path\r\n                  fill=\"#FBBC05\"\r\n                  d=\"M3.9568 10.705c-.1809-.5409-.2841-1.1182-.2841-1.705 0-.5868.1032-1.1641.2841-1.705V4.9618H.9577C.3477 6.1732 0 7.5491 0 9c0 1.4509.3477 2.8268.9577 4.0382l2.9991-2.3332z\"\r\n                />\r\n                <path\r\n                  fill=\"#EA4335\"\r\n                  d=\"M9 3.5795c1.3214 0 2.5077.4545 3.4405 1.3455l2.5805-2.5805C13.4632.891 11.4259 0 9 0 5.4818 0 2.4382 2.02.9577 4.9618l2.9991 2.3332C4.6659 5.1641 6.6532 3.5795 9 3.5795z\"\r\n                />\r\n              </svg>\r\n              <span>{isSubmitting ? \"Signing in...\" : \"Continue with Google\"}</span>\r\n            </button>\r\n\r\n            {!hasMfaChallenge && errorMessage ? (\r\n              <p className=\"rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700\">\r\n                {errorMessage}\r\n              </p>\r\n            ) : null}\r\n\r\n            {!hasMfaChallenge && infoMessage ? (\r\n              <p className=\"rounded-xl border border-sky-200 bg-sky-50 px-3 py-2 text-xs text-sky-700\">{infoMessage}</p>\r\n            ) : null}\r\n\r\n            <p className=\"text-xs text-slate-500\">\r\n              Complete your invite verification first, then use the same invited email for Google sign-in.\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {hasMfaChallenge ? (\r\n        <div className=\"fixed inset-0 z-40 flex items-end justify-center bg-slate-950/45 p-3 backdrop-blur-sm sm:items-center sm:p-4\">\r\n          <div className=\"w-full max-w-lg overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-[0_30px_70px_-30px_rgba(15,23,42,0.55)]\">\r\n            <div className=\"border-b border-slate-100 bg-[linear-gradient(120deg,#f8fafc_0%,#f1f5f9_100%)] px-4 py-3 sm:px-5\">\r\n              <div className=\"flex items-center justify-between gap-3\">\r\n                <div className=\"min-w-0\">\r\n                  <p className=\"text-[11px] font-semibold uppercase tracking-[0.2em] text-[#0f766e]\">CLIO</p>\r\n                  <h2 className=\"mt-1 text-base font-semibold text-slate-900 sm:text-lg\">{modalTitle}</h2>\r\n                  <p className=\"mt-1 text-sm text-slate-600\">{modalDescription}</p>\r\n                </div>\r\n                <span className=\"inline-flex h-10 w-10 shrink-0 items-center justify-center rounded-2xl bg-slate-900 text-white\">\r\n                  <svg viewBox=\"0 0 24 24\" className=\"h-5 w-5\" aria-hidden=\"true\">\r\n                    <path\r\n                      fill=\"currentColor\"\r\n                      d=\"M12 2a4 4 0 0 0-4 4v3H7a3 3 0 0 0-3 3v7a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3v-7a3 3 0 0 0-3-3h-1V6a4 4 0 0 0-4-4zm-2 7V6a2 2 0 1 1 4 0v3h-4z\"\r\n                    />\r\n                  </svg>\r\n                </span>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-3 px-4 py-4 sm:px-5 sm:py-5\">\r\n              <div className={useVisibleRecaptcha ? \"rounded-xl border border-slate-200 bg-white p-2\" : \"sr-only\"}>\r\n                <p className={useVisibleRecaptcha ? \"mb-2 text-[11px] font-medium text-slate-600\" : \"hidden\"}>\r\n                  Complete the captcha challenge, then tap Register again.\r\n                </p>\r\n                <div id={recaptchaContainerIdRef.current} />\r\n              </div>\r\n\r\n              <div className=\"rounded-2xl border border-slate-200 bg-[linear-gradient(180deg,#fcfdff_0%,#f8fafc_100%)] p-3 shadow-[0_18px_38px_-32px_rgba(15,23,42,0.45)] sm:p-4\">\r\n                <div className=\"space-y-4\">\r\n                  {showRegistrationStep ? (\r\n                    <div>\r\n                      <label className=\"mt-2 block space-y-1\">\r\n                        <span className=\"text-xs font-medium text-slate-700\">Mobile Number</span>\r\n                        <input\r\n                          type=\"tel\"\r\n                          value={mfaState.phoneNumber}\r\n                          onChange={(event) =>\r\n                            setMfaState((current) => ({\r\n                              ...current,\r\n                              phoneNumber: event.target.value,\r\n                            }))\r\n                          }\r\n                          placeholder=\"+639171234567\"\r\n                          className=\"h-10 w-full rounded-xl border border-slate-300 bg-white px-3 text-sm text-slate-900 placeholder:text-slate-400 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-100\"\r\n                          disabled={isSendingOtp || isVerifyingOtp}\r\n                        />\r\n                      </label>\r\n                      <p className={`mt-2 text-[11px] ${hasPhoneNumber ? \"text-slate-500\" : \"font-medium text-amber-700\"}`}>\r\n                        {hasPhoneNumber\r\n                          ? \"Use international format with country code to register this account.\"\r\n                          : \"Add your mobile number first before requesting OTP.\"}\r\n                      </p>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={handleSendOtp}\r\n                        disabled={isSendingOtp || isOtpCooldownActive || !hasPhoneNumber}\r\n                        className=\"mt-3 inline-flex h-10 w-full items-center justify-center rounded-xl border border-sky-300 bg-white px-4 text-sm font-semibold text-sky-700 transition hover:bg-sky-50 disabled:cursor-not-allowed disabled:opacity-60\"\r\n                      >\r\n                        {isSendingOtp ? \"Sending OTP...\" : isOtpCooldownActive ? `Retry in ${otpCooldownSecondsLeft}s` : \"Register\"}\r\n                      </button>\r\n                      {isOtpCooldownActive ? (\r\n                        <p className=\"mt-2 text-[11px] font-medium text-amber-700\">\r\n                          OTP is temporarily rate-limited. Please wait before retrying.\r\n                        </p>\r\n                      ) : null}\r\n                    </div>\r\n                  ) : null}\r\n\r\n                  {isSmsSendingStep ? (\r\n                    <div className=\"rounded-xl border border-sky-100 bg-sky-50/70 px-4 py-6\">\r\n                      <div className=\"flex flex-col items-center justify-center gap-3 text-center\">\r\n                        <span className=\"inline-flex h-10 w-10 items-center justify-center rounded-full bg-white text-sky-600 shadow-sm\">\r\n                          <svg viewBox=\"0 0 24 24\" className=\"h-5 w-5\" aria-hidden=\"true\">\r\n                            <path\r\n                              fill=\"currentColor\"\r\n                              d=\"M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm0 3.2l-8 5-8-5V6l8 5 8-5v1.2z\"\r\n                            />\r\n                          </svg>\r\n                        </span>\r\n                        <p className=\"text-sm font-semibold text-slate-800\">Sending OTP to your mobile number...</p>\r\n                        <span className=\"inline-flex w-8 justify-start\">\r\n                          <span className=\"inline-flex h-1.5 w-1.5 animate-bounce rounded-full bg-sky-500 [animation-delay:-0.2s]\" />\r\n                          <span className=\"ml-1 inline-flex h-1.5 w-1.5 animate-bounce rounded-full bg-sky-500 [animation-delay:-0.1s]\" />\r\n                          <span className=\"ml-1 inline-flex h-1.5 w-1.5 animate-bounce rounded-full bg-sky-500\" />\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  ) : null}\r\n\r\n                  {showOtpStep ? (\r\n                    <div>\r\n                      {!isPhoneRegistrationRequired ? (\r\n                        <div className=\"mb-2 space-y-2\">\r\n                          <p className=\"rounded-xl border border-sky-200 bg-sky-50 px-3 py-2 text-xs text-sky-700\">\r\n                            OTP is sent automatically to your registered mobile number.\r\n                          </p>\r\n                          <button\r\n                            type=\"button\"\r\n                            onClick={handleSendOtp}\r\n                            disabled={isSendingOtp || isVerifyingOtp || isOtpCooldownActive || !hasPhoneNumber}\r\n                            className=\"inline-flex h-9 items-center justify-center rounded-xl border border-sky-300 bg-white px-3 text-xs font-semibold text-sky-700 transition hover:bg-sky-50 disabled:cursor-not-allowed disabled:opacity-60\"\r\n                          >\r\n                            {isSendingOtp ? \"Sending OTP...\" : isOtpCooldownActive ? `Retry in ${otpCooldownSecondsLeft}s` : hasOtpRequest ? \"Resend OTP\" : \"Send OTP\"}\r\n                          </button>\r\n                        </div>\r\n                      ) : null}\r\n                      <label className=\"mt-2 block space-y-2\">\r\n                        <span className=\"text-xs font-medium text-slate-700\">Verification Code</span>\r\n                        <div className=\"mx-auto flex max-w-[360px] items-center justify-center gap-2 sm:gap-3\" onPaste={handleOtpPaste}>\r\n                          {otpDigitValues.map((digit, index) => (\r\n                            <input\r\n                              key={`otp-${index}`}\r\n                              ref={(element) => {\r\n                                otpInputRefs.current[index] = element;\r\n                              }}\r\n                              type=\"text\"\r\n                              inputMode=\"numeric\"\r\n                              autoComplete={index === 0 ? \"one-time-code\" : \"off\"}\r\n                              maxLength={1}\r\n                              value={digit}\r\n                              onChange={(event) => handleOtpInputChange(index, event.target.value)}\r\n                              onKeyDown={(event) => handleOtpInputKeyDown(index, event)}\r\n                              className=\"h-12 w-12 rounded-2xl border border-sky-200 bg-[linear-gradient(180deg,#ffffff_0%,#f8fbff_100%)] text-center text-lg font-semibold text-slate-900 shadow-[0_2px_10px_-8px_rgba(2,132,199,0.45)] transition focus:border-sky-500 focus:outline-none focus:ring-2 focus:ring-sky-100 disabled:opacity-60\"\r\n                              disabled={isSendingOtp || isVerifyingOtp}\r\n                            />\r\n                          ))}\r\n                        </div>\r\n                      </label>\r\n                      {!hasOtpRequest ? (\r\n                        <p className=\"mt-2 text-[11px] text-slate-500\">Waiting for OTP challenge. Please hold for a moment.</p>\r\n                      ) : otpCodeValue.length < 6 ? (\r\n                        <p className=\"mt-2 text-[11px] text-slate-500\">Enter the 6-digit code. Verification is automatic.</p>\r\n                      ) : null}\r\n                    </div>\r\n                  ) : null}\r\n                </div>\r\n              </div>\r\n\r\n              {errorMessage ? (\r\n                <p className=\"rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700\">\r\n                  {errorMessage}\r\n                </p>\r\n              ) : null}\r\n\r\n              {infoMessage ? (\r\n                <p className=\"rounded-xl border border-sky-200 bg-sky-50 px-3 py-2 text-xs text-sky-700\">{infoMessage}</p>\r\n              ) : null}\r\n\r\n              {mfaState.otpRequestedAt ? (\r\n                <p className=\"text-xs text-slate-500\">\r\n                  OTP requested: {new Intl.DateTimeFormat(\"en-US\", { dateStyle: \"medium\", timeStyle: \"short\" }).format(new Date(mfaState.otpRequestedAt))}\r\n                </p>\r\n              ) : null}\r\n\r\n              {mfaState.challengeExpiresAt ? (\r\n                <p className=\"text-[11px] text-slate-500\">\r\n                  Session expires: {new Intl.DateTimeFormat(\"en-US\", { dateStyle: \"medium\", timeStyle: \"short\" }).format(new Date(mfaState.challengeExpiresAt))}\r\n                </p>\r\n              ) : null}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {showVerifyingOverlay ? (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-white/75 backdrop-blur-[2px]\">\r\n          <div className=\"flex items-center gap-3 rounded-2xl border border-slate-200 bg-white/95 px-5 py-3 text-sm font-semibold text-slate-700 shadow-[0_12px_30px_-20px_rgba(15,23,42,0.45)]\">\r\n            <span className=\"inline-flex h-9 w-9 items-center justify-center rounded-full bg-sky-50 text-sky-600\">\r\n              <svg viewBox=\"0 0 24 24\" className=\"h-5 w-5\" aria-hidden=\"true\">\r\n                <path\r\n                  fill=\"currentColor\"\r\n                  d=\"M12 3a5 5 0 0 0-5 5v2H6a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2h-1V8a5 5 0 0 0-5-5zm-3 7V8a3 3 0 1 1 6 0v2H9z\"\r\n                />\r\n              </svg>\r\n            </span>\r\n            <span className=\"flex flex-col text-left\">\r\n              <span className=\"text-[13px] font-semibold text-slate-900\">Verifying access</span>\r\n              <span className=\"text-[11px] font-medium text-slate-500\">Securing your session</span>\r\n            </span>\r\n            <span className=\"inline-flex w-6 justify-start\">\r\n              <span className=\"inline-flex h-1.5 w-1.5 animate-bounce rounded-full bg-sky-500 [animation-delay:-0.2s]\" />\r\n              <span className=\"ml-1 inline-flex h-1.5 w-1.5 animate-bounce rounded-full bg-sky-500 [animation-delay:-0.1s]\" />\r\n              <span className=\"ml-1 inline-flex h-1.5 w-1.5 animate-bounce rounded-full bg-sky-500\" />\r\n            </span>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n    </section>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}