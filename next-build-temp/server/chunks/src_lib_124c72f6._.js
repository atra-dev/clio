module.exports=[44801,e=>{"use strict";function t(e){return String(e??"").trim()}function r(e,{fallbackLabel:i="User",maxTokens:n=3}={}){let o=t(e).toLowerCase(),s=t(i)||"User";if(!o.includes("@"))return s;let a=(o.split("@")[0]||"").split(/[._-]+/g).map(e=>{let r;return(r=t(e).toLowerCase())?`${r.charAt(0).toUpperCase()}${r.slice(1)}`:""}).filter(Boolean).slice(0,Math.max(1,Number.isFinite(n)?n:3));return 0===a.length?s:a.join(" ")}function i({firstName:e,middleName:r,lastName:i,order:n}){let o=t(e),s=t(r),a=t(i);if("last-first"===n){let e=[o,s].filter(Boolean).join(" ");return a?`${a}${e?`, ${e}`:""}`:e}return[o,s,a].filter(Boolean).join(" ")}function n({fallback:e,fallbackEmail:i,fallbackLabel:n}){let o=t(e);if(o)return o;let s=t(i);return s?r(s,{fallbackLabel:n}):t(n)||"User"}function o({firstName:e,middleName:r,lastName:s,suffix:a,fallback:l="",fallbackEmail:c="",fallbackLabel:u="User"}={}){let p=[i({firstName:e,middleName:r,lastName:s,order:"first-last"}),t(a)].filter(Boolean).join(" ").trim();return p||n({fallback:l,fallbackEmail:c,fallbackLabel:u})}function s({firstName:e,middleName:r,lastName:o,suffix:a,fallback:l="",fallbackEmail:c="",fallbackLabel:u="Employee"}={}){let p=[i({firstName:e,middleName:r,lastName:o,order:"last-first"}),t(a)].filter(Boolean).join(" ").trim();return p||n({fallback:l,fallbackEmail:c,fallbackLabel:u})}e.s(["formatEmployeeName",()=>s,"formatNameFromEmail",()=>r,"formatPersonName",()=>o])},35110,e=>{"use strict";function t(e){let t=String(e||"").trim();return t?t.startsWith("http://")||t.startsWith("https://")?t.replace(/\/+$/,""):`https://${t.replace(/^\/+/,"").replace(/\/+$/,"")}`:""}function r(e){return String(e||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}async function i({toEmail:e,verifyUrl:t}){let r=String("AIzaSyC-mWz29cK_wjvDsjhgbwYLAuJeygPohOI").trim();if(!r)throw Error("firebase_api_key_not_configured");let i=await fetch(`https://identitytoolkit.googleapis.com/v1/accounts:sendOobCode?key=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requestType:"EMAIL_SIGNIN",email:e,continueUrl:t,canHandleCodeInApp:!0})}),n=await i.json().catch(()=>({}));if(!i.ok){let e;throw Error((e=String(n?.error?.message||"").trim())?"OPERATION_NOT_ALLOWED"===e?"firebase_email_provider_not_enabled":"MISSING_CONTINUE_URI"===e||"INVALID_CONTINUE_URI"===e?"firebase_continue_url_invalid":"INVALID_EMAIL"===e?"invalid_email":"PROJECT_NOT_FOUND"===e||"API_KEY_INVALID"===e?"firebase_api_key_not_configured":"email_delivery_failed":"email_delivery_failed")}return{provider:"firebase",status:"sent",messageId:`firebase-${Date.now()}`}}async function n({toEmail:e,subject:t,html:r,text:i}){let n=String(process.env.RESEND_API_KEY||"").trim(),o=String(process.env.CLIO_EMAIL_FROM||"").trim();if(!n||!o||!n.startsWith("re_"))throw Error("email_provider_not_configured");let s=await fetch("https://api.resend.com/emails",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({from:o,to:[e],subject:t,html:r,text:i})});if(!s.ok){let e=await s.json().catch(()=>({})),t="string"==typeof e?.message?e.message:"string"==typeof e?.error?.message?e.error.message:"";throw Error(t?`email_delivery_failed:${t}`:"email_delivery_failed")}let a=await s.json().catch(()=>({}));return{provider:"resend",status:"sent",messageId:"string"==typeof a?.id?a.id:`resend-${Date.now()}`}}async function o({toEmail:e,role:o,invitedBy:s,expiresAt:a,inviteToken:l,requestOrigin:c=""}){let u,p,d,f=function({requestOrigin:e}={}){let r=t(e),i=t("atracaas-platform-1fbeb.firebaseapp.com"),n=t(process.env.VERCEL_PROJECT_PRODUCTION_URL||process.env.VERCEL_URL);for(let e of[r,t(process.env.CLIO_APP_BASE_URL),t(process.env.NEXT_PUBLIC_APP_URL),n,i])if(e)return!function(e){let t;try{t=new URL(e)}catch{throw Error("app_base_url_not_configured")}let r=String(t.hostname||"").trim().toLowerCase();if("localhost"===r||"127.0.0.1"===r||"::1"===r||r.endsWith(".local"))throw Error("unsafe_app_base_url_for_production")}(e),e;throw Error("app_base_url_not_configured")}({requestOrigin:c}),m=function(e,t){let r,i=(r=String(process.env.CLIO_INVITE_VERIFY_PATH||"").trim())?r.startsWith("/")?r:`/${r}`:"/verify-invite",n=String(e||"").trim();if(!n)throw Error("invalid_invite_token");return`${t}${i}?token=${encodeURIComponent(n)}`}(l,f),_=`${f}${!(d=String(process.env.CLIO_LOGIN_PATH||"").trim())?"/login":d.startsWith("/")?d:`/${d}`}`,g=function({role:e,invitedBy:t,verifyUrl:i,loginUrl:n,expiresAt:o}){let s=new Date(o),a=Number.isNaN(s.getTime())?o:s.toLocaleString("en-US",{month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),l=String(e||"Employee").trim()||"Employee",c=String(t||"CLIO Administrator").trim()||"CLIO Administrator",u=String(process.env.CLIO_EMAIL_BRAND_DOMAIN||"cisoasaservice.io").trim()||"cisoasaservice.io",p=r(l),d=r(c),f=r(i),m=r(n),_=r(a),g=r(u);return{subject:"You're invited to verify your email and open your Clio account",text:`You have been invited to Clio Secured HRIS.

To open your account, please verify your email first.
Verify your Clio account: ${i}
Sign in after verification: ${n}

Assigned role: ${l}
Invited by: ${c}
Invitation expires: ${a}

For security, complete SMS OTP after email verification.
Use the same invited work email when signing in.

Domain: ${u}`,html:`<div style="font-family:Arial,sans-serif;line-height:1.6;color:#0f172a;max-width:620px"><p style="margin:0 0 12px 0">Hello,</p><p style="margin:0 0 12px 0">You have been invited to <strong>Clio Secured HRIS</strong>.</p><p style="margin:0 0 16px 0">To open your account, please verify your email and complete secure onboarding.</p><p style="margin:0 0 16px 0"><a href="${f}" style="display:inline-block;background:#0f6bcf;color:#ffffff;text-decoration:none;padding:10px 18px;border-radius:10px;font-weight:600">Verify Clio Account</a></p><p style="margin:0 0 12px 0"><strong>Assigned role:</strong> ${p}<br/><strong>Invited by:</strong> ${d}<br/><strong>Invitation expires:</strong> ${_}</p><p style="margin:0 0 12px 0">After verification, sign in here: <a href="${m}">${m}</a></p><p style="margin:0 0 12px 0">For security, complete SMS OTP after email verification and use the same invited work email.</p><p style="margin:0;color:#475569;font-size:12px">This invitation is intended for authorized recipients of ${g}.</p></div>`}}({role:o,invitedBy:s,verifyUrl:m,loginUrl:_,expiresAt:a}),v=(p=(u=String(process.env.CLIO_EMAIL_PROVIDER||"").trim().toLowerCase())?"firebase"===u||u.includes("firebase")?"firebase":"resend"===u||u.includes("resend")?"resend":"console"===u||"dev"===u||u.includes("console")?"console":u:"")||(String(process.env.RESEND_API_KEY||"").trim().startsWith("re_")&&String(process.env.CLIO_EMAIL_FROM||"").trim().length>0?"resend":"firebase");if("firebase"===v)return await i({toEmail:e,verifyUrl:m});if("resend"===v)return await n({toEmail:e,subject:g.subject,html:g.html,text:g.text});if("console"===v){if("true"!==String(process.env.CLIO_ALLOW_CONSOLE_EMAIL||"").trim().toLowerCase())throw Error("email_provider_not_configured");return function({toEmail:e,subject:t,verifyUrl:r,loginUrl:i}){return{provider:"console",status:"simulated",messageId:`console-${Date.now()}`,previewUrl:r,loginUrl:i}}({toEmail:e,subject:g.subject,verifyUrl:m,loginUrl:_})}throw Error("unsupported_email_provider")}e.s(["deliverInviteEmail",()=>o])},22177,e=>{"use strict";function t(e,r=""){return String(e||"").trim()||r}function r(e){return Array.isArray(e)?e:[]}function i(e){return t(e).toLowerCase()}function n(e){return String(e||"").replace(/[^\d+]/g,"").trim()}function o(e){return t(e).split(",").map(e=>e.trim()).filter(Boolean)}function s(e=[]){return Array.from(new Set(e.filter(Boolean)))}function a(){let e,r=(e=t(process.env.CLIO_ALERT_EMAIL_PROVIDER).toLowerCase())?e.includes("resend")?"resend":e.includes("firebase")?"firebase":e.includes("console")||"dev"===e?"console":"none"===e||"off"===e?"none":e:"";return r||"none"}function l(){let e,r=(e=t(process.env.CLIO_ALERT_SMS_PROVIDER).toLowerCase())?e.includes("twilio")?"twilio":e.includes("console")||"dev"===e?"console":"none"===e||"off"===e?"none":e:"";return r||"none"}function c(e=[]){return s([...o(process.env.CLIO_SECURITY_ALERT_RECIPIENTS),...o(process.env.GRC_EMAILS),...o(process.env.SUPER_ADMIN_EMAILS),...r(e)].map(e=>i(e)).filter(Boolean))}async function u({recipients:e,subject:r,text:i,html:n}){let o=t(process.env.RESEND_API_KEY),s=t(process.env.CLIO_EMAIL_FROM);if(!o||!s||!o.startsWith("re_"))throw Error("email_provider_not_configured");let a=await fetch("https://api.resend.com/emails",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({from:s,to:e,subject:r,text:i,html:n})}),l=await a.json().catch(()=>({}));if(!a.ok){let e=t(l?.message)||t(l?.error?.message)||"email_delivery_failed";throw Error(`email_delivery_failed:${e}`)}return{provider:"resend",status:"sent",messageId:t(l?.id,`resend-${Date.now()}`),recipientCount:e.length}}async function p({recipients:e,subject:n,text:o,html:l}){let c=s(r(e).map(i).filter(Boolean));if(0===c.length)return{provider:"none",status:"skipped",reason:"no_recipients",recipientCount:0};let p=a();return"none"===p?{provider:p,status:"skipped",reason:"provider_disabled",recipientCount:0}:"firebase"===p?{provider:p,status:"skipped",reason:"firebase_not_supported_for_custom_alert_email",recipientCount:0}:"console"===p?function({recipients:e,subject:r,text:i}){return function(e,r=!1){let i=t(process.env[e]).toLowerCase();return i?"true"===i||"1"===i||"yes"===i:r}("CLIO_ALLOW_CONSOLE_EMAIL",!0)&&console.info("[CLIO:SecurityAlert:Email]",{recipients:e,subject:r,text:i}),{provider:"console",status:"simulated",recipientCount:e.length}}({recipients:c,subject:n,text:o}):"resend"===p?await u({recipients:c,subject:n,text:o,html:l}):{provider:p,status:"skipped",reason:"unsupported_provider",recipientCount:0}}async function d({recipients:e,body:r}){let i=t(process.env.TWILIO_ACCOUNT_SID),n=t(process.env.TWILIO_AUTH_TOKEN),o=t(process.env.TWILIO_FROM_NUMBER);if(!i||!n||!o)throw Error("twilio_not_configured");let s=Buffer.from(`${i}:${n}`,"utf8").toString("base64"),a=e.map(async e=>{let n=new URLSearchParams;n.set("To",e),n.set("From",o),n.set("Body",r);let a=await fetch(`https://api.twilio.com/2010-04-01/Accounts/${encodeURIComponent(i)}/Messages.json`,{method:"POST",headers:{Authorization:`Basic ${s}`,"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()}),l=await a.json().catch(()=>({}));if(!a.ok){let e=t(l?.message,"sms_delivery_failed");throw Error(`twilio_delivery_failed:${e}`)}return{to:e,sid:t(l?.sid)}}),l=await Promise.allSettled(a),c=l.filter(e=>"fulfilled"===e.status).map(e=>e.value),u=l.filter(e=>"rejected"===e.status).map(e=>t(e.reason?.message||"sms_delivery_failed"));return{provider:"twilio",status:u.length>0?c.length>0?"partial":"failed":"sent",deliveredCount:c.length,recipientCount:e.length,delivered:c,failed:u}}async function f({recipients:e,body:t}){let i=s(r(e).map(n).filter(Boolean));if(0===i.length)return{provider:"none",status:"skipped",reason:"no_recipients",deliveredCount:0,recipientCount:0,failed:[]};let o=l();return"none"===o?{provider:o,status:"skipped",reason:"provider_disabled",deliveredCount:0,recipientCount:i.length,failed:[]}:"console"===o?function({recipients:e,body:t}){return{provider:"console",status:"simulated",deliveredCount:e.length,recipientCount:e.length,delivered:e.map(e=>({to:e,sid:`console-${Date.now()}`})),failed:[]}}({recipients:i,body:t}):"twilio"===o?await d({recipients:i,body:t}):{provider:o,status:"skipped",reason:"unsupported_provider",deliveredCount:0,recipientCount:i.length,failed:[]}}async function m({url:e,label:r,token:i,payload:n,timeoutMs:o}){let s=new AbortController,a=setTimeout(()=>s.abort(),o);try{let o={"Content-Type":"application/json","X-CLIO-Source":"security-detection","X-CLIO-Target":r};i&&(o.Authorization=`Bearer ${i}`);let a=await fetch(e,{method:"POST",headers:o,body:JSON.stringify(n),signal:s.signal}),l=await a.text().catch(()=>"");return{label:r,url:e,ok:a.ok,status:a.status,body:t(l)}}catch(i){return{label:r,url:e,ok:!1,status:0,body:t(i?.message,"webhook_delivery_failed")}}finally{clearTimeout(a)}}async function _(e){let r,i,n,s,a=(r=o(process.env.CLIO_SECURITY_WEBHOOK_URLS).map(e=>({label:"security-webhook",url:e,token:t(process.env.CLIO_SECURITY_WEBHOOK_TOKEN)})),i=t(process.env.CLIO_SIEM_WEBHOOK_URL),n=t(process.env.CLIO_EDR_WEBHOOK_URL),s=[...r],i&&s.push({label:"siem",url:i,token:t(process.env.CLIO_SIEM_WEBHOOK_TOKEN)}),n&&s.push({label:"edr",url:n,token:t(process.env.CLIO_EDR_WEBHOOK_TOKEN)}),s.filter(e=>t(e.url)));if(0===a.length)return{status:"skipped",targets:[],successCount:0};let l=Number.parseInt(t(process.env.CLIO_SECURITY_WEBHOOK_TIMEOUT_MS,"5000"),10)||5e3,c=await Promise.all(a.map(t=>m({...t,payload:e,timeoutMs:Math.max(1e3,Math.min(2e4,l))}))),u=c.filter(e=>e.ok).length;return{status:u===c.length?"sent":u>0?"partial":"failed",targets:c,successCount:u}}async function g({incident:e,detection:i,sourceEvent:u,emailRecipients:d=[],smsRecipients:m=[]}={}){let v,h=c(d),y=function(e=[]){return s([...o(process.env.CLIO_SMS_ALERT_RECIPIENTS),...r(e)].map(e=>n(e)).filter(Boolean))}(m),I=function({incident:e,detection:r}){let i=t(e?.severity||r?.severity||"Medium").toUpperCase(),n=t(e?.incidentCode,"INCIDENT"),o=t(e?.title,"Security anomaly detected");return`[CLIO][${i}] ${n} - ${o}`}({incident:e,detection:i}),C=function({incident:e,detection:r,sourceEvent:i}){let n=t(r?.ruleId,"N/A"),o=t(i?.metadata?.sourceIp||i?.sourceIp,"unknown"),s=t(i?.performedBy,"unknown"),a=t(i?.metadata?.requestPath||i?.requestPath,"unknown"),l=Number(r?.observedCount||0),c=t(e?.detectedAt||i?.occurredAt,new Date().toISOString());return`CLIO security anomaly alert
Incident: ${t(e?.incidentCode,"-")} | ${t(e?.title,"-")}
Severity: ${t(e?.severity,"-")}
Rule: ${n}
Detected At: ${c}
Actor: ${s}
Source IP: ${o}
Request Path: ${a}
Observed Count: ${l>0?l:"-"}
Summary: ${t(e?.summary||r?.summary,"-")}
Action URL: ${t(e?.actionUrl,"/incident-management")}`}({incident:e,detection:i,sourceEvent:u}),E=(v=String(C||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"),`<pre style="font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; white-space:pre-wrap;">${v}</pre>`),[O,S,L]=await Promise.all([p({recipients:h,subject:I,text:C,html:E}).catch(e=>({provider:a(),status:"failed",reason:t(e?.message,"email_delivery_failed"),recipientCount:h.length})),f({recipients:y,body:`${I}
${C}`.slice(0,1200)}).catch(e=>({provider:l(),status:"failed",reason:t(e?.message,"sms_delivery_failed"),deliveredCount:0,recipientCount:y.length,failed:[t(e?.message,"sms_delivery_failed")]})),_({eventType:"clio.security.incident",generatedAt:new Date().toISOString(),incident:e,detection:i,sourceEvent:{id:t(u?.id),module:t(u?.module),activityName:t(u?.activityName),status:t(u?.status),occurredAt:t(u?.occurredAt),sourceIp:t(u?.metadata?.sourceIp||u?.sourceIp),requestPath:t(u?.metadata?.requestPath||u?.requestPath)}})]);return{subject:I,email:O,sms:S,webhooks:L,recipients:h,smsRecipients:y}}function v(e=[]){return c(e)}async function h({recipients:e=[],body:r=""}={}){return await f({recipients:e,body:t(r,"")})}e.s(["dispatchDirectSms",()=>h,"dispatchSecurityIncidentAlerts",()=>g,"resolveSecurityAlertEmailRecipients",()=>v])}];

//# sourceMappingURL=src_lib_124c72f6._.js.map