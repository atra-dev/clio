module.exports=[70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},66680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},2157,(e,t,r)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},50227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},33355,e=>{"use strict";e.i(18097);var t=e.i(19e3),r=e.i(67658),i=e.i(45709);function n(){return new Date().toISOString()}function a(e,t=""){return String(e||"").trim()||t}function o(e,t=!1){if("boolean"==typeof e)return e;if("number"==typeof e)return 0!==e;if("string"==typeof e){let r=e.trim().toLowerCase();if(!r)return t;if(["true","1","yes","on","y"].includes(r))return!0;if(["false","0","no","off","n"].includes(r))return!1}return t}function s(e){return e&&"object"==typeof e&&!Array.isArray(e)?e:{}}function c(e){return Array.isArray(e)?e:[]}function l(e,t,{min:r=1,max:i=Number.MAX_SAFE_INTEGER}={}){let n=Number.parseInt(String(e||""),10);return Number.isFinite(n)?Math.min(i,Math.max(r,n)):t}function u(e){return String(e||"").trim().toLowerCase()}function d(e){return String(e||"").trim().toLowerCase()}function f(e){return String(e||"").split(",").map(e=>u(e)).filter(Boolean)}function p(e){return"read"===String(e||"").trim().toLowerCase()?"read":"unread"}function m(){return a(process.env.CLIO_FIRESTORE_NOTIFICATIONS_COLLECTION,"clio_notifications")}function _(){return(0,r.isFirestoreEnabled)()?(0,r.getFirestoreDb)():null}function g(e){return{...e.data()||{},id:e.id,recordId:e.id}}function w(e,t){let r=u(t),i=u(e?.recipientEmail);return o(e?.broadcast,!1)||r&&i&&r===i}function h(e,t){return new Date(t?.createdAt||0).getTime()-new Date(e?.createdAt||0).getTime()}async function y(e){let r=_();if(!r)return null;let i=function(e){let t,r=n(),i=u(e?.recipientEmail),c=o(e?.broadcast,!1);if(!i&&!c)throw Error("invalid_notification_recipient");return{title:a(e?.title,"Security notification"),message:a(e?.message,"A security event requires review."),severity:"critical"===(t=String(e?.severity||"").trim().toLowerCase())?"critical":"high"===t?"high":"low"===t?"low":"medium",type:a(e?.type,"security"),module:a(e?.module,"Incident Management"),actionUrl:a(e?.actionUrl,"/incident-management"),recipientEmail:i,broadcast:c,status:p(e?.status),metadata:s(e?.metadata),createdAt:a(e?.createdAt,r),updatedAt:a(e?.updatedAt,r),readAt:a(e?.readAt,""),createdBy:u(e?.createdBy)}}(e),c=await (0,t.addDoc)((0,t.collection)(r,m()),i);return{...i,id:c.id,recordId:c.id}}async function v(e){let t=c(e);if(0===t.length)return[];let r=[];for(let e of t){let t=await y(e);t&&r.push(t)}return r}async function x(e,r){let i=_();if(!i)return null;let n=a(e);if(!n)throw Error("invalid_record_id");let o=(0,t.doc)(i,m(),n),s=await (0,t.getDoc)(o);if(!s.exists())return null;let c=g(s);if(!w(c,r))throw Error("forbidden_notification_access");return c}async function A({recipientEmail:e,status:r="all",limit:i=20}={}){let n=_();if(!n)return{records:[],unreadCount:0,totalScoped:0};let a=String(r||"").trim().toLowerCase(),o=l(i,20,{min:1,max:120}),s=Math.max(4*o,100),c=(await (0,t.getDocs)((0,t.query)((0,t.collection)(n,m()),(0,t.orderBy)("createdAt","desc"),(0,t.limit)(s)))).docs.map(g).filter(t=>w(t,e)),u=c.reduce((e,t)=>e+ +("unread"===p(t?.status)),0);return{records:c.filter(e=>"all"===a||!a||p(e?.status)===a).sort(h).slice(0,o),unreadCount:u,totalScoped:c.length}}async function S(e,r){let i=_();if(!i)return null;let o=a(e);if(!o)throw Error("invalid_record_id");let s=(0,t.doc)(i,m(),o),c=await (0,t.getDoc)(s);if(!c.exists())return null;let l=g(c);if(!w(l,r))throw Error("forbidden_notification_access");if("read"===p(l.status))return l;let u={...l,status:"read",readAt:n(),updatedAt:n()};return await (0,t.updateDoc)(s,u),u}async function I(e,r,i){let o=_();if(!o)return null;let c=a(e);if(!c)throw Error("invalid_record_id");let l=u(r),d=a(i).toLowerCase();if("confirm"!==d&&"deny"!==d)throw Error("invalid_device_verification_decision");let f=(0,t.doc)(o,m(),c),p=await (0,t.getDoc)(f);if(!p.exists())return null;let h=g(p);if(!w(h,l))throw Error("forbidden_notification_access");let y=s(h?.metadata),v=a(y?.deviceVerificationDecision).toLowerCase();if(v){if(v===d)return h;throw Error("device_verification_already_resolved")}let x=n(),A={...h,status:"read",readAt:a(h?.readAt,x),updatedAt:x,metadata:{...y,deviceVerificationDecision:d,deviceVerificationResolvedAt:x,deviceVerificationResponder:l}};return await (0,t.updateDoc)(f,A),A}async function b({recipientEmail:e,limit:r=120}={}){let i=u(e);if(!i)return{updatedCount:0};let o=_();if(!o)return{updatedCount:0};let s=l(r,120,{min:1,max:300}),{records:c}=await A({recipientEmail:i,status:"unread",limit:s}),d=0;for(let e of c){let r=a(e?.id||e?.recordId);if(!r)continue;let i=(0,t.doc)(o,m(),r);await (0,t.updateDoc)(i,{status:"read",readAt:n(),updatedAt:n()}),d+=1}return{updatedCount:d}}function E(e=[]){return Array.from(new Set(c(e).map(e=>u(e)).filter(Boolean)))}async function R({ownerEmail:e,affectedEmployeeEmail:t,actorEmail:r,includeAffectedEmployee:n=!0,includeActor:a=!1}={}){let o=[u(process.env.CLIO_GRC_ALERT_EMAIL),...f(process.env.GRC_EMAILS),u(e)];n&&o.push(u(t)),a&&o.push(u(r));let s=[];try{let e=await (0,i.listUserAccounts)();s=c(e).filter(e=>u(e?.email)).filter(e=>"active"===d(e?.status)).filter(e=>{let t=String(e?.role||"").trim().toUpperCase();return"GRC"===t}).map(e=>u(e?.email))}catch{s=[]}return E([...o,...s])}async function k(){let e=[u(process.env.CLIO_GRC_ALERT_EMAIL),...f(process.env.GRC_EMAILS)],t=[];try{let e=await (0,i.listUserAccounts)();t=c(e).filter(e=>u(e?.email)).filter(e=>"active"===d(e?.status)).filter(e=>"GRC"===String(e?.role||"").trim().toUpperCase()).map(e=>u(e?.email))}catch{t=[]}return E([...e,...t])}e.s(["createInAppNotification",()=>y,"createInAppNotificationsBulk",()=>v,"getInAppNotificationForRecipient",()=>x,"listInAppNotifications",()=>A,"markAllInAppNotificationsRead",()=>b,"markInAppNotificationRead",()=>S,"resolveDeviceVerificationNotification",()=>I,"resolveGrcRecipients",()=>k,"resolveIncidentStakeholderRecipients",()=>R])},4381,e=>{"use strict";let t="__clio_rate_limit_buckets__";function r(e){return String(e||"").trim().toLowerCase()}function i(e){if(!e||!e.headers)return"unknown";let t=e.headers.get("x-forwarded-for");if(t){let e=t.split(",")[0]?.trim();if(e)return e}for(let t of["x-real-ip","cf-connecting-ip","x-vercel-forwarded-for"]){let r=String(e.headers.get(t)||"").trim();if(r)return r}return"unknown"}function n({scope:e,identifier:i,limit:n=20,windowMs:a=3e5}){let o=String(e||"default").trim().toLowerCase(),s=r(i)||"unknown",c=Math.max(1,Number.parseInt(String(n),10)||1),l=Math.max(1e3,Number.parseInt(String(a),10)||1e3),u=(globalThis[t]||(globalThis[t]=new Map),globalThis[t]),d=Date.now();!function(e,t){if(e.size<=5e3)return;for(let[r,i]of e.entries())(!i||t>=i.resetAt)&&e.delete(r);if(e.size<=5e3)return;let r=e.size-5e3;for(let t of e.keys())if(e.delete(t),(r-=1)<=0)break}(u,d);let f=`${o}:${s}`,p=u.get(f);(!p||d>=p.resetAt)&&(p={count:0,resetAt:d+l}),p.count+=1,u.set(f,p);let m=Math.max(0,c-p.count),_=Math.max(1,Math.ceil((p.resetAt-d)/1e3));return{allowed:p.count<=c,key:f,remaining:m,retryAfterSeconds:_,resetAt:p.resetAt,headers:{"Retry-After":String(_),"X-RateLimit-Limit":String(c),"X-RateLimit-Remaining":String(m),"X-RateLimit-Reset":String(Math.floor(p.resetAt/1e3))}}}function a({request:e,scope:t,identifier:a,limit:o,windowMs:s}){return n({scope:t,identifier:r(a)||i(e),limit:o,windowMs:s})}e.s(["consumeRateLimit",()=>n,"enforceRateLimitByRequest",()=>a,"getRequestSourceIp",()=>i])},14277,e=>{"use strict";var t=e.i(4381),r=e.i(33355);let i=new Set(["invalid_otp","otp_expired","otp_attempts_exceeded","otp_not_requested","otp_cooldown","firebase_phone_not_verified"]);function n(e){return String(e||"").trim()}function a(e){return n(e).toLowerCase()}async function o(e){let t=await (0,r.resolveGrcRecipients)();if(0===t.length)return;let i=t.map(t=>e(t));await (0,r.createInAppNotificationsBulk)(i)}async function s({request:e,actorEmail:r,reason:c,context:l="login_sms_verification"}={}){let u,d=n(c).toLowerCase();if(!i.has(d))return;let f=(0,t.getRequestSourceIp)(e),p=(u=a(r))||n(f)||"unknown",m=(0,t.consumeRateLimit)({scope:`auth-otp-failure-alert:${l}`,identifier:p,limit:5,windowMs:6e5});m.allowed&&!(m.remaining>0)&&await o(e=>({title:"Repeated OTP verification failures detected",message:`Detected 5 OTP failure events for ${p} within 10 minutes.`,severity:"high",type:"auth-otp-failure-spike",module:"Authentication",actionUrl:"/incident-management",recipientEmail:e,metadata:{actorEmail:a(r),sourceIp:f,reason:d,context:l,threshold:5,windowMinutes:10},createdBy:a(r)||"system@gmail.com"}))}async function c({actorEmail:e,sourceIp:r,deviceLabel:i}={}){let s=a(e);if(!s)return;let l=(0,t.consumeRateLimit)({scope:"auth-new-device-alert",identifier:s,limit:3,windowMs:18e5});l.allowed&&!(l.remaining>0)&&await o(e=>({title:"Unusual new-device sign-in pattern detected",message:`User ${s} triggered 3 new-device sign-ins within 30 minutes.`,severity:"medium",type:"auth-new-device-anomaly",module:"Authentication",actionUrl:"/incident-management",recipientEmail:e,metadata:{actorEmail:s,sourceIp:n(r),deviceLabel:n(i),threshold:3,windowMinutes:30},createdBy:s}))}e.s(["alertRepeatedNewDeviceSignIns",()=>c,"alertRepeatedOtpFailures",()=>s])},14541,e=>{"use strict";async function t(e){let t=String(e||"").trim();if(!t)throw Error("missing_id_token");let r=String(process.env.NEXT_PUBLIC_FIREBASE_API_KEY||"").trim();if(!r)throw Error("firebase_api_key_not_configured");let i=await fetch(`https://identitytoolkit.googleapis.com/v1/accounts:lookup?key=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idToken:t}),cache:"no-store"}),n=await i.json().catch(()=>({}));if(!i.ok){let e;throw Error("INVALID_ID_TOKEN"===(e=String(n?.error?.message||"").trim())||"TOKEN_EXPIRED"===e?"invalid_id_token":"USER_NOT_FOUND"===e?"firebase_user_not_found":"identity_lookup_failed")}let a=Array.isArray(n?.users)?n.users[0]:null;if(!a)throw Error("firebase_user_not_found");let o=String(a.email||"").trim().toLowerCase();if(!o)throw Error("firebase_user_missing_email");let s=Array.isArray(a.providerUserInfo)?a.providerUserInfo.map(e=>String(e?.providerId||"").trim()).filter(Boolean):[],c=String(a.phoneNumber||"").trim();return{uid:String(a.localId||"").trim(),email:o,emailVerified:!0===a.emailVerified,providerIds:s,phoneNumber:c}}e.s(["verifyFirebaseIdToken",()=>t])},11072,e=>{e.v(t=>Promise.all(["server/chunks/src_lib_124c72f6._.js","server/chunks/src_lib_hris-backend_4dbd0cdd.js","server/chunks/src_lib_security-detection_4bdbe3ad.js"].map(t=>e.l(t))).then(()=>t(74405)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__6b858e7c._.js.map