module.exports=[35110,e=>{"use strict";function t(e){let t=String(e||"").trim();return t?t.startsWith("http://")||t.startsWith("https://")?t.replace(/\/+$/,""):`https://${t.replace(/^\/+/,"").replace(/\/+$/,"")}`:""}function i(e){return String(e||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}async function r({toEmail:e,verifyUrl:t}){let i=String("AIzaSyC-mWz29cK_wjvDsjhgbwYLAuJeygPohOI").trim();if(!i)throw Error("firebase_api_key_not_configured");let r=await fetch(`https://identitytoolkit.googleapis.com/v1/accounts:sendOobCode?key=${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requestType:"EMAIL_SIGNIN",email:e,continueUrl:t,canHandleCodeInApp:!0})}),n=await r.json().catch(()=>({}));if(!r.ok){let e;throw Error((e=String(n?.error?.message||"").trim())?"OPERATION_NOT_ALLOWED"===e?"firebase_email_provider_not_enabled":"MISSING_CONTINUE_URI"===e||"INVALID_CONTINUE_URI"===e?"firebase_continue_url_invalid":"INVALID_EMAIL"===e?"invalid_email":"PROJECT_NOT_FOUND"===e||"API_KEY_INVALID"===e?"firebase_api_key_not_configured":"email_delivery_failed":"email_delivery_failed")}return{provider:"firebase",status:"sent",messageId:`firebase-${Date.now()}`}}async function n({toEmail:e,subject:t,html:i,text:r}){let n=String(process.env.RESEND_API_KEY||"").trim(),a=String(process.env.CLIO_EMAIL_FROM||"").trim();if(!n||!a||!n.startsWith("re_"))throw Error("email_provider_not_configured");let o=await fetch("https://api.resend.com/emails",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({from:a,to:[e],subject:t,html:i,text:r})});if(!o.ok){let e=await o.json().catch(()=>({})),t="string"==typeof e?.message?e.message:"string"==typeof e?.error?.message?e.error.message:"";throw Error(t?`email_delivery_failed:${t}`:"email_delivery_failed")}let s=await o.json().catch(()=>({}));return{provider:"resend",status:"sent",messageId:"string"==typeof s?.id?s.id:`resend-${Date.now()}`}}async function a({toEmail:e,role:a,invitedBy:o,expiresAt:s,inviteToken:l,requestOrigin:c=""}){let d,u,p,m=function({requestOrigin:e}={}){let i=t(e),r=t("atracaas-platform-1fbeb.firebaseapp.com"),n=t(process.env.VERCEL_PROJECT_PRODUCTION_URL||process.env.VERCEL_URL);for(let e of[i,t(process.env.CLIO_APP_BASE_URL),t(process.env.NEXT_PUBLIC_APP_URL),n,r])if(e)return!function(e){let t;try{t=new URL(e)}catch{throw Error("app_base_url_not_configured")}let i=String(t.hostname||"").trim().toLowerCase();if("localhost"===i||"127.0.0.1"===i||"::1"===i||i.endsWith(".local"))throw Error("unsafe_app_base_url_for_production")}(e),e;throw Error("app_base_url_not_configured")}({requestOrigin:c}),f=function(e,t){let i,r=(i=String(process.env.CLIO_INVITE_VERIFY_PATH||"").trim())?i.startsWith("/")?i:`/${i}`:"/verify-invite",n=String(e||"").trim();if(!n)throw Error("invalid_invite_token");return`${t}${r}?token=${encodeURIComponent(n)}`}(l,m),v=`${m}${!(p=String(process.env.CLIO_LOGIN_PATH||"").trim())?"/login":p.startsWith("/")?p:`/${p}`}`,y=function({role:e,invitedBy:t,verifyUrl:r,loginUrl:n,expiresAt:a}){let o=new Date(a),s=Number.isNaN(o.getTime())?a:o.toLocaleString("en-US",{month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),l=String(e||"Employee").trim()||"Employee",c=String(t||"CLIO Administrator").trim()||"CLIO Administrator",d=String(process.env.CLIO_EMAIL_BRAND_DOMAIN||"cisoasaservice.io").trim()||"cisoasaservice.io",u=i(l),p=i(c),m=i(r),f=i(n),v=i(s),y=i(d);return{subject:"You're invited to verify your email and open your Clio account",text:`You have been invited to Clio Secured HRIS.

To open your account, please verify your email first.
Verify your Clio account: ${r}
Sign in after verification: ${n}

Assigned role: ${l}
Invited by: ${c}
Invitation expires: ${s}

For security, complete SMS OTP after email verification.
Use the same invited work email when signing in.

Domain: ${d}`,html:`<div style="font-family:Arial,sans-serif;line-height:1.6;color:#0f172a;max-width:620px"><p style="margin:0 0 12px 0">Hello,</p><p style="margin:0 0 12px 0">You have been invited to <strong>Clio Secured HRIS</strong>.</p><p style="margin:0 0 16px 0">To open your account, please verify your email and complete secure onboarding.</p><p style="margin:0 0 16px 0"><a href="${m}" style="display:inline-block;background:#0f6bcf;color:#ffffff;text-decoration:none;padding:10px 18px;border-radius:10px;font-weight:600">Verify Clio Account</a></p><p style="margin:0 0 12px 0"><strong>Assigned role:</strong> ${u}<br/><strong>Invited by:</strong> ${p}<br/><strong>Invitation expires:</strong> ${v}</p><p style="margin:0 0 12px 0">After verification, sign in here: <a href="${f}">${f}</a></p><p style="margin:0 0 12px 0">For security, complete SMS OTP after email verification and use the same invited work email.</p><p style="margin:0;color:#475569;font-size:12px">This invitation is intended for authorized recipients of ${y}.</p></div>`}}({role:a,invitedBy:o,verifyUrl:f,loginUrl:v,expiresAt:s}),g=(u=(d=String(process.env.CLIO_EMAIL_PROVIDER||"").trim().toLowerCase())?"firebase"===d||d.includes("firebase")?"firebase":"resend"===d||d.includes("resend")?"resend":"console"===d||"dev"===d||d.includes("console")?"console":d:"")||(String(process.env.RESEND_API_KEY||"").trim().startsWith("re_")&&String(process.env.CLIO_EMAIL_FROM||"").trim().length>0?"resend":"firebase");if("firebase"===g)return await r({toEmail:e,verifyUrl:f});if("resend"===g)return await n({toEmail:e,subject:y.subject,html:y.html,text:y.text});if("console"===g){if("true"!==String(process.env.CLIO_ALLOW_CONSOLE_EMAIL||"").trim().toLowerCase())throw Error("email_provider_not_configured");return function({toEmail:e,subject:t,verifyUrl:i,loginUrl:r}){return{provider:"console",status:"simulated",messageId:`console-${Date.now()}`,previewUrl:i,loginUrl:r}}({toEmail:e,subject:y.subject,verifyUrl:f,loginUrl:v})}throw Error("unsupported_email_provider")}e.s(["deliverInviteEmail",()=>a])},70406,(e,t,i)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,i)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,i)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,i)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,i)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,i)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,i)=>{t.exports=e.x("util",()=>require("util"))},66680,(e,t,i)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},2157,(e,t,i)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},50227,(e,t,i)=>{t.exports=e.x("node:path",()=>require("node:path"))},54799,(e,t,i)=>{t.exports=e.x("crypto",()=>require("crypto"))},98189,32307,e=>{"use strict";var t=e.i(89171),i=e.i(59979),r=e.i(81215),n=e.i(28221);let a={SUPER_ADMIN:["*"],GRC:["dashboard:view","employees:view","employees:edit","employees:view:sensitive","lifecycle:view","lifecycle:edit","lifecycle:approve","attendance:view","attendance:edit","attendance:approve","performance:view","performance:edit","performance:approve","templates:view","templates:edit","exports:view","exports:manage","exports:approve","exports:request","activity_log:export","activity_log:view","audit:view","access_management:view","retention_archive:view","retention_archive:manage","incident_management:view","incident_management:edit","user_management:view","user_management:manage","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],HR:["dashboard:view","employees:view","employees:edit","employees:view:sensitive","lifecycle:view","lifecycle:edit","lifecycle:approve","attendance:view","attendance:edit","attendance:approve","performance:view","performance:edit","performance:approve","templates:view","templates:edit","exports:view","exports:manage","exports:approve","exports:request","activity_log:export","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],EA:["dashboard:view","employees:view","employees:edit","employees:view:sensitive","lifecycle:view","lifecycle:edit","lifecycle:approve","attendance:view","attendance:edit","attendance:approve","performance:view","performance:edit","performance:approve","templates:view","templates:edit","exports:view","exports:manage","exports:approve","exports:request","activity_log:export","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],EMPLOYEE_L1:["dashboard:view","employees:view","employees:edit:self","attendance:view","attendance:edit:self","performance:view","templates:view","requests:view","requests:create:self","exports:request:self","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],EMPLOYEE_L2:["dashboard:view","employees:view","employees:edit:self","attendance:view","attendance:edit:self","performance:view","templates:view","requests:view","requests:create:self","exports:request:self","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],EMPLOYEE_L3:["dashboard:view","employees:view","employees:edit:self","attendance:view","attendance:edit:self","performance:view","templates:view","requests:view","requests:create:self","exports:request:self","settings:view","audit:write:nonsensitive","auth:logout","resource:own"]},o={dashboard:"dashboard:view",employees:"employees:view","employment-lifecycle":"lifecycle:view",attendance:"attendance:view",performance:"performance:view","activity-log":"activity_log:view",exports:"exports:view",documents:"templates:view","access-management":"access_management:view","retention-archive":"retention_archive:view","incident-management":"incident_management:view",requests:"requests:view",settings:"settings:view","user-management":"user_management:view"};function s(e,t){let i=a[(0,r.normalizeRole)(e)]??[];return i.includes("*")||i.includes(t)}function l(e,t){let i=(0,r.normalizeRole)(e);if(!new Set(n.MODULE_ACCESS[i]??[]).has(t))return!1;let a=o[t];return!a||s(i,a)}function c({role:e,actorIdentifier:t,ownerIdentifier:i,allowRoles:n=["SUPER_ADMIN"]}){let a=(0,r.normalizeRole)(e);if(n.includes(a))return!0;if(!s(a,"resource:own"))return!1;let o=String(t||"").trim().toLowerCase(),l=String(i||"").trim().toLowerCase();return!!o&&!!l&&o===l}function d(e){let t=String(e||"").trim().replace(/^\/+|\/+$/g,"");if(!t)return"dashboard";let i=t.split("/")[0];return o[i]?i:null}e.s(["canAccessModule",()=>l,"canAccessResource",()=>c,"getModuleIdFromPathname",()=>d,"hasPermission",()=>s],32307);var u=e.i(96864),p=e.i(45709);function m(e,i){return{error:t.NextResponse.json({message:i},{status:e})}}async function f(e,{allowedRoles:t,requiredPermissions:n=[],ownerIdentifier:a,ownerBypassRoles:o=["SUPER_ADMIN"],auditModule:l="Authorization",auditAction:d="API access check"}={}){let v=e.cookies.get(i.SESSION_COOKIE_NAME)?.value,y=(0,i.verifySessionToken)(v);if(!y)return await (0,u.recordAuditEvent)({activityName:`${d} denied (no active session)`,status:"Failed",module:l,performedBy:"anonymous@gmail.com",sensitivity:"Sensitive",metadata:{reason:"unauthorized"},request:e}),m(401,"Unauthorized.");let g={...y,role:(0,r.normalizeRole)(y.role)},w=await (0,p.getLoginAccount)(g.email).catch(()=>null);if(!w)return await (0,u.recordAuditEvent)({activityName:`${d} denied (account not found)`,status:"Failed",module:l,performedBy:g.email,sensitivity:"Sensitive",metadata:{reason:"account_not_found"},request:e}),m(401,"Session is no longer valid. Please sign in again.");if("active"!==w.status)return await (0,u.recordAuditEvent)({activityName:`${d} blocked by account status`,status:"Rejected",module:l,performedBy:g.email,sensitivity:"Sensitive",metadata:{reason:"account_not_active",accountStatus:w.status},request:e}),m(403,"Account is not active.");let h=(0,r.normalizeRole)(w.role),_=Number.parseInt(String(w.sessionVersion??""),10)||1,A="SUPER_ADMIN"===h,E=g.role!==h,R=g.sessionVersion!==_;if(R||E&&!A)return await (0,u.recordAuditEvent)({activityName:`${d} denied (stale session)`,status:"Rejected",module:l,performedBy:g.email,sensitivity:"Sensitive",metadata:{reason:R?"session_version_mismatch":"session_role_mismatch",tokenRole:g.role,accountRole:h,tokenSessionVersion:g.sessionVersion,accountSessionVersion:_},request:e}),m(401,"Session expired. Please sign in again.");if(Array.isArray(t)&&t.length>0&&!t.includes(g.role))return await (0,u.recordAuditEvent)({activityName:`${d} blocked by role policy`,status:"Rejected",module:l,performedBy:g.email,sensitivity:"Sensitive",metadata:{role:g.role,allowedRoles:t,reason:"role_not_allowed"},request:e}),m(403,"Forbidden.");if(n.length>0&&!n.every(e=>s(g.role,e)))return await (0,u.recordAuditEvent)({activityName:`${d} blocked by permission policy`,status:"Rejected",module:l,performedBy:g.email,sensitivity:"Sensitive",metadata:{role:g.role,requiredPermissions:n,reason:"missing_permission"},request:e}),m(403,"Forbidden.");if(a){let t=g.email,i="function"==typeof a?await a(g):a;if(!c({role:g.role,actorIdentifier:t,ownerIdentifier:i,allowRoles:o}))return await (0,u.recordAuditEvent)({activityName:`${d} blocked by ownership policy`,status:"Rejected",module:l,performedBy:g.email,sensitivity:"Sensitive",metadata:{role:g.role,ownerIdentifier:i,reason:"ownership_validation_failed"},request:e}),m(403,"Forbidden.")}return{session:g}}e.s(["authorizeApiRequest",()=>f],98189)},44801,e=>{"use strict";function t(e){return String(e??"").trim()}function i(e,{fallbackLabel:r="User",maxTokens:n=3}={}){let a=t(e).toLowerCase(),o=t(r)||"User";if(!a.includes("@"))return o;let s=(a.split("@")[0]||"").split(/[._-]+/g).map(e=>{let i;return(i=t(e).toLowerCase())?`${i.charAt(0).toUpperCase()}${i.slice(1)}`:""}).filter(Boolean).slice(0,Math.max(1,Number.isFinite(n)?n:3));return 0===s.length?o:s.join(" ")}function r({firstName:e,middleName:i,lastName:r,order:n}){let a=t(e),o=t(i),s=t(r);if("last-first"===n){let e=[a,o].filter(Boolean).join(" ");return s?`${s}${e?`, ${e}`:""}`:e}return[a,o,s].filter(Boolean).join(" ")}function n({fallback:e,fallbackEmail:r,fallbackLabel:n}){let a=t(e);if(a)return a;let o=t(r);return o?i(o,{fallbackLabel:n}):t(n)||"User"}function a({firstName:e,middleName:i,lastName:o,suffix:s,fallback:l="",fallbackEmail:c="",fallbackLabel:d="User"}={}){let u=[r({firstName:e,middleName:i,lastName:o,order:"first-last"}),t(s)].filter(Boolean).join(" ").trim();return u||n({fallback:l,fallbackEmail:c,fallbackLabel:d})}function o({firstName:e,middleName:i,lastName:a,suffix:s,fallback:l="",fallbackEmail:c="",fallbackLabel:d="Employee"}={}){let u=[r({firstName:e,middleName:i,lastName:a,order:"last-first"}),t(s)].filter(Boolean).join(" ").trim();return u||n({fallback:l,fallbackEmail:c,fallbackLabel:d})}e.s(["formatEmployeeName",()=>o,"formatNameFromEmail",()=>i,"formatPersonName",()=>a])},33355,e=>{"use strict";e.i(18097);var t=e.i(19e3),i=e.i(67658),r=e.i(45709);function n(){return new Date().toISOString()}function a(e,t=""){return String(e||"").trim()||t}function o(e,t=!1){if("boolean"==typeof e)return e;if("number"==typeof e)return 0!==e;if("string"==typeof e){let i=e.trim().toLowerCase();if(!i)return t;if(["true","1","yes","on","y"].includes(i))return!0;if(["false","0","no","off","n"].includes(i))return!1}return t}function s(e){return e&&"object"==typeof e&&!Array.isArray(e)?e:{}}function l(e){return Array.isArray(e)?e:[]}function c(e,t,{min:i=1,max:r=Number.MAX_SAFE_INTEGER}={}){let n=Number.parseInt(String(e||""),10);return Number.isFinite(n)?Math.min(r,Math.max(i,n)):t}function d(e){return String(e||"").trim().toLowerCase()}function u(e){return String(e||"").trim().toLowerCase()}function p(e){return String(e||"").split(",").map(e=>d(e)).filter(Boolean)}function m(e){return"read"===String(e||"").trim().toLowerCase()?"read":"unread"}function f(){return a(process.env.CLIO_FIRESTORE_NOTIFICATIONS_COLLECTION,"clio_notifications")}function v(){return(0,i.isFirestoreEnabled)()?(0,i.getFirestoreDb)():null}function y(e){return{...e.data()||{},id:e.id,recordId:e.id}}function g(e,t){let i=d(t),r=d(e?.recipientEmail);return o(e?.broadcast,!1)||i&&r&&i===r}function w(e,t){return new Date(t?.createdAt||0).getTime()-new Date(e?.createdAt||0).getTime()}async function h(e){let i=v();if(!i)return null;let r=function(e){let t,i=n(),r=d(e?.recipientEmail),l=o(e?.broadcast,!1);if(!r&&!l)throw Error("invalid_notification_recipient");return{title:a(e?.title,"Security notification"),message:a(e?.message,"A security event requires review."),severity:"critical"===(t=String(e?.severity||"").trim().toLowerCase())?"critical":"high"===t?"high":"low"===t?"low":"medium",type:a(e?.type,"security"),module:a(e?.module,"Incident Management"),actionUrl:a(e?.actionUrl,"/incident-management"),recipientEmail:r,broadcast:l,status:m(e?.status),metadata:s(e?.metadata),createdAt:a(e?.createdAt,i),updatedAt:a(e?.updatedAt,i),readAt:a(e?.readAt,""),createdBy:d(e?.createdBy)}}(e),l=await (0,t.addDoc)((0,t.collection)(i,f()),r);return{...r,id:l.id,recordId:l.id}}async function _(e){let t=l(e);if(0===t.length)return[];let i=[];for(let e of t){let t=await h(e);t&&i.push(t)}return i}async function A(e,i){let r=v();if(!r)return null;let n=a(e);if(!n)throw Error("invalid_record_id");let o=(0,t.doc)(r,f(),n),s=await (0,t.getDoc)(o);if(!s.exists())return null;let l=y(s);if(!g(l,i))throw Error("forbidden_notification_access");return l}async function E({recipientEmail:e,status:i="all",limit:r=20}={}){let n=v();if(!n)return{records:[],unreadCount:0,totalScoped:0};let a=String(i||"").trim().toLowerCase(),o=c(r,20,{min:1,max:120}),s=Math.max(4*o,100),l=(await (0,t.getDocs)((0,t.query)((0,t.collection)(n,f()),(0,t.orderBy)("createdAt","desc"),(0,t.limit)(s)))).docs.map(y).filter(t=>g(t,e)),d=l.reduce((e,t)=>e+ +("unread"===m(t?.status)),0);return{records:l.filter(e=>"all"===a||!a||m(e?.status)===a).sort(w).slice(0,o),unreadCount:d,totalScoped:l.length}}async function R(e,i){let r=v();if(!r)return null;let o=a(e);if(!o)throw Error("invalid_record_id");let s=(0,t.doc)(r,f(),o),l=await (0,t.getDoc)(s);if(!l.exists())return null;let c=y(l);if(!g(c,i))throw Error("forbidden_notification_access");if("read"===m(c.status))return c;let d={...c,status:"read",readAt:n(),updatedAt:n()};return await (0,t.updateDoc)(s,d),d}async function I(e,i,r){let o=v();if(!o)return null;let l=a(e);if(!l)throw Error("invalid_record_id");let c=d(i),u=a(r).toLowerCase();if("confirm"!==u&&"deny"!==u)throw Error("invalid_device_verification_decision");let p=(0,t.doc)(o,f(),l),m=await (0,t.getDoc)(p);if(!m.exists())return null;let w=y(m);if(!g(w,c))throw Error("forbidden_notification_access");let h=s(w?.metadata),_=a(h?.deviceVerificationDecision).toLowerCase();if(_){if(_===u)return w;throw Error("device_verification_already_resolved")}let A=n(),E={...w,status:"read",readAt:a(w?.readAt,A),updatedAt:A,metadata:{...h,deviceVerificationDecision:u,deviceVerificationResolvedAt:A,deviceVerificationResponder:c}};return await (0,t.updateDoc)(p,E),E}async function x({recipientEmail:e,limit:i=120}={}){let r=d(e);if(!r)return{updatedCount:0};let o=v();if(!o)return{updatedCount:0};let s=c(i,120,{min:1,max:300}),{records:l}=await E({recipientEmail:r,status:"unread",limit:s}),u=0;for(let e of l){let i=a(e?.id||e?.recordId);if(!i)continue;let r=(0,t.doc)(o,f(),i);await (0,t.updateDoc)(r,{status:"read",readAt:n(),updatedAt:n()}),u+=1}return{updatedCount:u}}function S(e=[]){return Array.from(new Set(l(e).map(e=>d(e)).filter(Boolean)))}async function C({ownerEmail:e,affectedEmployeeEmail:t,actorEmail:i,includeAffectedEmployee:n=!0,includeActor:a=!1}={}){let o=[d(process.env.CLIO_GRC_ALERT_EMAIL),...p(process.env.GRC_EMAILS),d(e)];n&&o.push(d(t)),a&&o.push(d(i));let s=[];try{let e=await (0,r.listUserAccounts)();s=l(e).filter(e=>d(e?.email)).filter(e=>"active"===u(e?.status)).filter(e=>{let t=String(e?.role||"").trim().toUpperCase();return"GRC"===t}).map(e=>d(e?.email))}catch{s=[]}return S([...o,...s])}async function b(){let e=[d(process.env.CLIO_GRC_ALERT_EMAIL),...p(process.env.GRC_EMAILS)],t=[];try{let e=await (0,r.listUserAccounts)();t=l(e).filter(e=>d(e?.email)).filter(e=>"active"===u(e?.status)).filter(e=>"GRC"===String(e?.role||"").trim().toUpperCase()).map(e=>d(e?.email))}catch{t=[]}return S([...e,...t])}e.s(["createInAppNotification",()=>h,"createInAppNotificationsBulk",()=>_,"getInAppNotificationForRecipient",()=>A,"listInAppNotifications",()=>E,"markAllInAppNotificationsRead",()=>x,"markInAppNotificationRead",()=>R,"resolveDeviceVerificationNotification",()=>I,"resolveGrcRecipients",()=>b,"resolveIncidentStakeholderRecipients",()=>C])},39552,e=>{"use strict";function t(e,i=""){return String(e||"").trim()||i}let i={title:"Incident title",summary:"Incident summary",incidentType:"Incident type",severity:"Severity",status:"Status",containmentStatus:"Containment status",containmentSummary:"Containment summary",impactAssessmentStatus:"Impact assessment status",impactSummary:"Impact assessment summary",ownerEmail:"Incident owner",affectedEmployeeEmail:"Affected employee",restrictedPiiInvolved:"Restricted PII flag",escalationRequired:"Escalation requirement",executiveNotificationRequired:"Executive notification requirement",regulatoryNotificationRequired:"Regulatory notification requirement",regulatoryNotifiedAt:"Regulator notification",affectedIndividualsNotifiedAt:"Affected-individual notification",grcAlertedAt:"GRC alert timestamp",executiveNotifiedAt:"Executive notification timestamp",documentationRetained:"Documentation retention",documentationLocation:"Documentation location",classificationStandard:"Classification standard",notes:"Investigation notes",forensicWindowStart:"Forensic window start",forensicWindowEnd:"Forensic window end"};function r(e={},i=""){let n=t(e?.title);if(n)return n;let a=t(e?.incidentCode);return a?`Case ${a}`:t(i)?"Incident Record":"Incident"}function n(e={},i=""){let a=r(e,i),o=t(e?.severity,"Medium"),s=t(e?.status,"Open");return{title:`New Incident: ${a}`,message:`A new incident has been logged for review. Severity: ${o}. Current status: ${s}.`}}function a(e={},n=[],o=""){let s=r(e,o),l=function(e=[],{max:r=4}={}){let n=Array.from(new Set((Array.isArray(e)?e:[]).map(e=>{let r;return(r=t(e))?i[r]?i[r]:r.replace(/([a-z0-9])([A-Z])/g,"$1 $2").replace(/[_-]+/g," ").replace(/\s+/g," ").trim().replace(/^./,e=>e.toUpperCase()):"Field"}).filter(Boolean)));if(0===n.length)return"";if(n.length<=r)return n.join(", ");let a=n.slice(0,r).join(", ");return`${a}, +${n.length-r} more`}(n),c=new Set((Array.isArray(n)?n:[]).map(e=>t(e))),d="Incident workflow details were updated.";c.has("status")?d=`Incident status is now ${t(e?.status,"updated")}.`:c.has("containmentStatus")?d=`Containment status is now ${t(e?.containmentStatus,"updated")}.`:c.has("regulatoryNotifiedAt")?d="Regulator notification has been recorded.":c.has("affectedIndividualsNotifiedAt")?d="Affected-individual notification has been recorded.":c.has("executiveNotifiedAt")?d="Executive notification has been recorded.":c.has("grcAlertedAt")&&(d="GRC alert timestamp has been recorded.");let u=l?` Updated fields: ${l}.`:"";return{title:`Incident Updated: ${s}`,message:`${d}${u}`.trim()}}e.s(["buildIncidentCreatedNotification",()=>n,"buildIncidentUpdatedNotification",()=>a])},51251,e=>{"use strict";var t=e.i(47909),i=e.i(74017),r=e.i(96250),n=e.i(59756),a=e.i(61916),o=e.i(74677),s=e.i(69741),l=e.i(16795),c=e.i(87718),d=e.i(95169),u=e.i(47587),p=e.i(66012),m=e.i(70101),f=e.i(26937),v=e.i(10372),y=e.i(93695);e.i(52474);var g=e.i(220),w=e.i(89171),h=e.i(98189),_=e.i(96864),A=e.i(45787),E=e.i(33355),R=e.i(39552),I=e.i(45709);function x(e,t=""){return String(e||"").trim()||t}async function S(e){let t=await (0,h.authorizeApiRequest)(e,{requiredPermissions:["resource:own"],ownerIdentifier:e=>e.email,ownerBypassRoles:["SUPER_ADMIN","GRC","HR","EA","EMPLOYEE_L1","EMPLOYEE_L2","EMPLOYEE_L3"],auditModule:"Authentication",auditAction:"Device verification response"});if(t.error)return t.error;let{session:i}=t;try{var r;let t,n=await e.json().catch(()=>({})),a=x(n?.notificationId),o=(r=n?.decision,t=String(r||"").trim().toLowerCase(),"confirm"===t||"yes"===t?"confirm":"deny"===t||"no"===t?"deny":"");if(!a||!o)return w.NextResponse.json({message:"Invalid device verification request."},{status:400});let s=await (0,E.getInAppNotificationForRecipient)(a,i.email);if(!s)return w.NextResponse.json({message:"Notification not found."},{status:404});let l=s?.metadata&&"object"==typeof s.metadata?s.metadata:{},c=x(l?.deviceVerificationDecision).toLowerCase(),d="confirmed"===c?"confirm":"denied"===c?"deny":c;if(d){if(d===o)return w.NextResponse.json({ok:!0,decision:d,alreadyResolved:!0});return w.NextResponse.json({message:`Device verification already submitted as ${d}.`},{status:409})}let u=x(l?.deviceId),p=x(l?.deviceLabel,"Unknown device"),m=x(l?.sourceIp,"unknown"),f=x(l?.userAgent,"unknown");if(!u)return w.NextResponse.json({message:"Device reference is missing."},{status:400});if("confirm"===o)return await (0,I.updateLoginDeviceTrust)({email:i.email,deviceId:u,trusted:!0}),await (0,E.resolveDeviceVerificationNotification)(a,i.email,"confirm"),await (0,_.recordAuditEvent)({activityName:"Device verification confirmed",status:"Completed",module:"Authentication",performedBy:i.email,sensitivity:"Sensitive",metadata:{deviceId:u,deviceLabel:p,sourceIp:m},request:e}),w.NextResponse.json({ok:!0,decision:"confirm"});await (0,I.updateLoginDeviceTrust)({email:i.email,deviceId:u,trusted:!1,deniedReason:"user_reported"}),await (0,I.revokeUserSessions)({userId:i.email}).catch(()=>null),await (0,E.resolveDeviceVerificationNotification)(a,i.email,"deny");let v=await (0,A.createIncidentRecordBackend)({title:"Unrecognized device login reported",summary:`User ${i.email} reported an unrecognized device login from ${p}. Source IP: ${m}.`,incidentType:"Unauthorized Access",severity:"High",status:"Open",restrictedPiiInvolved:!1,affectedEmployeeEmail:i.email,ownerEmail:i.email},i.email),y=await (0,E.resolveGrcRecipients)();if(y.length>0&&v){let e=`/incident-management?incident=${encodeURIComponent(v.id)}`,t=(0,R.buildIncidentCreatedNotification)(v,v.id),r=y.map(r=>({title:t.title,message:`User reported unrecognized login. ${t.message}`,severity:v.severity||"High",type:"incident-created",module:"Incident Management",actionUrl:e,recipientEmail:r,metadata:{incidentId:v.id,incidentCode:v.incidentCode||"",reportedBy:i.email,deviceLabel:p,sourceIp:m,userAgent:f},createdBy:i.email}));await (0,E.createInAppNotificationsBulk)(r)}return await (0,_.recordAuditEvent)({activityName:"Device verification denied (incident created)",status:"Completed",module:"Authentication",performedBy:i.email,sensitivity:"Sensitive",metadata:{deviceId:u,deviceLabel:p,sourceIp:m,incidentId:v?.id||null,incidentCode:v?.incidentCode||null},request:e}),w.NextResponse.json({ok:!0,decision:"deny",incidentId:v?.id||null})}catch(t){let e=t instanceof Error?t.message:"device_verification_failed";return w.NextResponse.json({message:"Unable to process device verification.",reason:e},{status:"device_verification_already_resolved"===e?409:400})}}e.s(["POST",()=>S],95806);var C=e.i(95806);let b=new t.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/auth/device-verification/route",pathname:"/api/auth/device-verification",filename:"route",bundlePath:""},distDir:"next-build-temp",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/auth/device-verification/route.js",nextConfigOutput:"",userland:C}),{workAsyncStorage:N,workUnitAsyncStorage:L,serverHooks:O}=b;function $(){return(0,r.patchFetch)({workAsyncStorage:N,workUnitAsyncStorage:L})}async function P(e,t,r){b.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/auth/device-verification/route";w=w.replace(/\/index$/,"")||"/";let h=await b.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!h)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:_,params:A,nextConfig:E,parsedUrl:R,isDraftMode:I,prerenderManifest:x,routerServerContext:S,isOnDemandRevalidate:C,revalidateOnlyGenerated:N,resolvedPathname:L,clientReferenceManifest:O,serverActionsManifest:$}=h,P=(0,s.normalizeAppPath)(w),U=!!(x.dynamicRoutes[P]||x.routes[L]),D=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,R,!1):t.end("This page could not be found"),null);if(U&&!I){let e=!!x.routes[L],t=x.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await D();throw new y.NoFallbackError}}let T=null;!U||b.isDev||I||(T="/index"===(T=L)?"/":T);let k=!0===b.isDev||!U,j=U&&!k;$&&O&&(0,o.setManifestsSingleton)({page:w,clientReferenceManifest:O,serverActionsManifest:$});let q=e.method||"GET",M=(0,a.getTracer)(),B=M.getActiveScopeSpan(),F={params:A,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,i,r,n)=>b.onRequestError(e,t,r,n,S)},sharedContext:{buildId:_}},H=new l.NodeNextRequest(e),V=new l.NodeNextResponse(t),z=c.NextRequestAdapter.fromNodeNextRequest(H,(0,c.signalFromNodeResponse)(t));try{let o=async e=>b.handle(z,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let i=M.getRootSpanAttributes();if(!i)return;if(i.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${i.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=i.get("next.route");if(r){let t=`${q} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${w}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var a,l;let c=async({previousCacheEntry:i})=>{try{if(!s&&C&&N&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await o(n);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let c=F.renderOpts.collectedTags;if(!U)return await (0,p.sendResponse)(H,V,a,F.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(a.headers);c&&(t[v.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let i=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,r=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:i,expire:r}}}}catch(t){throw(null==i?void 0:i.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:C})},!1,S),t}},d=await b.handleResponse({req:e,nextConfig:E,cacheKey:T,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:N,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:s});if(!U)return null;if((null==d||null==(a=d.value)?void 0:a.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",C?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),I&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return s&&U||y.delete(v.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,f.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(H,V,new Response(d.value.body,{headers:y,status:d.value.status||200})),null};B?await l(B):await M.withPropagatedContext(e.headers,()=>M.trace(d.BaseServerSpan.handleRequest,{spanName:`${q} ${w}`,kind:a.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},l))}catch(t){if(t instanceof y.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:C})},!1,S),U)throw t;return await (0,p.sendResponse)(H,V,new Response(null,{status:500})),null}}e.s(["handler",()=>P,"patchFetch",()=>$,"routeModule",()=>b,"serverHooks",()=>O,"workAsyncStorage",()=>N,"workUnitAsyncStorage",()=>L],51251)},11072,e=>{e.v(t=>Promise.all(["server/chunks/src_lib_security-alert-delivery_e5801815.js","server/chunks/src_lib_security-detection_4bdbe3ad.js"].map(t=>e.l(t))).then(()=>t(74405)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__72738cae._.js.map