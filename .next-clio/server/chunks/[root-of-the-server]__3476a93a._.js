module.exports=[79120,e=>{"use strict";var t=e.i(89171),i=e.i(32307),r=e.i(96864);let n=["SUPER_ADMIN","GRC","HR","EA"];function s(e){return String(e||"").trim().toLowerCase()}function a(e,{start:t=2,end:i=2,fallback:r="Masked"}={}){let n=String(e||"").trim();return n?n.length<=t+i?`${n.slice(0,1)}***`:`${n.slice(0,t)}***${n.slice(n.length-i)}`:r}function o(e){return String(e||"").trim().toUpperCase().startsWith("EMPLOYEE_")}function l(e,t,{min:i=1,max:r=1e3}={}){let n=Number.parseInt(String(e||""),10);return Number.isFinite(n)?Math.min(r,Math.max(i,n)):t}function c(e,{page:t=1,pageSize:i=20}={}){let r=l(t,1,{min:1,max:1e5}),n=l(i,20,{min:1,max:200}),s=e.length,a=Math.max(1,Math.ceil(s/n)),o=Math.min(r,a),d=(o-1)*n;return{data:e.slice(d,d+n),pagination:{page:o,pageSize:n,total:s,totalPages:a}}}async function d(e){try{let t=await e.json();return t&&"object"==typeof t?t:{}}catch{throw Error("invalid_json_body")}}function u(e="Record not found."){return t.NextResponse.json({message:e},{status:404})}function m({session:e,requestedOwnerEmail:t,fallbackOwnerEmail:i}){return e&&o(e.role)?s(e.email):s(t||i)||null}function p(e,t){if(!e||"object"!=typeof e||(0,i.hasPermission)(t,"employees:view:sensitive"))return e;let r=e.governmentIds&&"object"==typeof e.governmentIds?Object.entries(e.governmentIds).reduce((e,[t,i])=>(e[t]=a(i,{start:2,end:2}),e),{}):{},n=e.payrollInformation&&"object"==typeof e.payrollInformation?Object.keys(e.payrollInformation).reduce((e,t)=>(e[t]="Restricted",e),{}):{};return{...e,govId:a(e.govId,{start:2,end:2}),governmentIds:r,payrollInformation:n}}function v({session:e,ownerEmail:t,ownerBypassRoles:r=n}){let a=s(t);return!!a&&(0,i.canAccessResource)({role:e.role,actorIdentifier:e.email,ownerIdentifier:a,allowRoles:r})}function f({role:e,editPermission:t,selfEditPermission:r,isSelfResource:n}){return!!((0,i.hasPermission)(e,t)||n&&r&&(0,i.hasPermission)(e,r))}function _(e,t){switch(String(e||"").trim()){case"invalid_json_body":return{status:400,message:"Invalid request payload."};case"invalid_record_id":return{status:400,message:"Invalid record identifier."};case"invalid_employee_email":return{status:400,message:"Employee email is required."};case"employee_account_not_found":return{status:409,message:"No user account found for this employee email. Invite or activate the user account first."};case"invalid_target_role":return{status:400,message:"Target role is required and must be a valid system role."};case"forbidden_target_role":return{status:403,message:"Target role assignment is not allowed by lifecycle permission policy."};case"role_sync_failed":return{status:409,message:"Employee user account was not found. Invite or activate the account before applying role changes."};case"approval_required":return{status:409,message:"Workflow approval chain must be completed before setting this status."};case"invalid_workflow_action":return{status:400,message:"Invalid workflow action payload."};case"invalid_approval_decision":return{status:400,message:"Approval decision must be approve or reject."};case"no_pending_approval_step":return{status:409,message:"No pending approval step remains for this workflow."};case"approval_not_allowed_for_role":return{status:403,message:"Current role is not allowed to approve the active step."};case"invalid_template_name":return{status:400,message:"Template name is required."};case"invalid_export_dataset":return{status:400,message:"Export dataset is required."};case"invalid_incident_title":return{status:400,message:"Incident title is required."};case"invalid_incident_evidence_payload":return{status:400,message:"Incident evidence payload must be a valid document array."};case"invalid_incident_evidence_name":return{status:400,message:"Incident evidence file name is required."};case"invalid_incident_evidence_reference":return{status:400,message:"Incident evidence must include a valid file reference."};case"invalid_incident_evidence_extension":return{status:400,message:"Incident evidence file extension is not allowed."};case"invalid_incident_evidence_content_type":return{status:400,message:"Incident evidence MIME type is not allowed."};case"invalid_incident_evidence_size":return{status:400,message:"Incident evidence file size exceeds the allowed limit."};case"incident_evidence_av_not_configured":return{status:503,message:"Evidence security scan provider is not configured."};case"incident_evidence_av_hook_failed":return{status:502,message:"Evidence security scan failed. Retry after security provider is available."};case"incident_evidence_av_blocked":return{status:403,message:"Evidence file blocked by malware/security policy scan."};case"invalid_reference_kind":return{status:400,message:"Reference type is invalid."};case"invalid_reference_label":return{status:400,message:"Reference label is required and must be within the allowed length."};case"invalid_retention_module":return{status:400,message:"Retention module filter is invalid."};case"invalid_purge_confirmation":return{status:400,message:"Invalid purge confirmation phrase."};case"duplicate_reference_value":return{status:409,message:"Reference value already exists."};case"immutable_reference_item":return{status:403,message:"System reference values cannot be removed."};case"access_revocation_failed":return{status:409,message:"Access revocation could not be confirmed for this employee account. Retry offboarding or review account status."};case"account_activation_failed":return{status:409,message:"Account activation could not be confirmed for this employee account."};case"email_provider_not_configured":return{status:502,message:"Email provider is not configured. Set CLIO_EMAIL_PROVIDER=firebase and NEXT_PUBLIC_FIREBASE_API_KEY."};case"firebase_api_key_not_configured":return{status:502,message:"Firebase API key is not configured. Set NEXT_PUBLIC_FIREBASE_API_KEY."};case"firebase_email_provider_not_enabled":return{status:502,message:"Firebase email-link provider is not enabled. Enable Email link (passwordless sign-in) in Firebase Authentication."};case"firebase_continue_url_invalid":return{status:502,message:"Firebase continue URL is invalid. Check CLIO_APP_BASE_URL / CLIO_INVITE_VERIFY_PATH and authorize the domain in Firebase Authentication."};case"unsupported_email_provider":return{status:502,message:"Unsupported email provider configuration."};case"email_delivery_failed":return{status:502,message:"Unable to deliver invite email."};case"firestore_not_configured":return{status:503,message:"Database is not configured. Set Firebase environment variables and restart the app."};default:return{status:400,message:t||"Unable to process request."}}}function g(e){return String(e||"").trim()}function y(e){return null==e?null:Array.isArray(e)?e.map(e=>y(e)):"object"==typeof e?Object.keys(e).sort().reduce((t,i)=>(t[i]=y(e[i]),t),{}):"string"==typeof e?e.trim():e}function w(e,t,i=[]){return(Array.isArray(i)?i:[]).filter(i=>{var r,n;return r=e?.[i],n=t?.[i],JSON.stringify(y(r))!==JSON.stringify(y(n))})}function h(e,t=[]){if(!e||"object"!=typeof e)return[];let i=new Set((Array.isArray(t)?t:[]).map(e=>g(e)));return Object.keys(e).filter(e=>!i.has(e)).sort()}function I(e,t="",i=[]){let r=Array.isArray(i)?i:[],n=[e?.employeeId,e?.workflowId,e?.lifecycleId,e?.templateId,e?.exportId,e?.id,t];for(let t of r){let i=g(e?.[t]);if(i)return i}for(let e of n){let t=g(e);if(t)return t}return"N/A"}function b(e=[],t="No field details recorded."){let i=(Array.isArray(e)?e:[]).map(e=>g(e)).filter(Boolean);return 0===i.length?t:i.join(", ")}async function E({request:e,module:t,activityName:i,status:n="Completed",sensitivity:s="Sensitive",performedBy:a="system@gmail.com",metadata:o}){let l="true"===process.env.CLIO_AUDIT_ASYNC||"false"!==process.env.CLIO_AUDIT_ASYNC&&!1,c=(0,r.recordAuditEvent)({activityName:i,status:n,module:t,performedBy:a,sensitivity:s,metadata:o,request:e}).catch(()=>null);l||await c}e.s(["canActorAccessOwner",()=>v,"canActorEditModule",()=>f,"getSelfRestrictedOwnerEmail",()=>m,"isEmployeeRole",()=>o,"logApiAudit",()=>E,"mapBackendError",()=>_,"normalizeEmail",()=>s,"notFound",()=>u,"paginateRows",()=>c,"parseJsonBody",()=>d,"parsePositiveInt",()=>l,"resolveAuditChangedFields",()=>w,"resolveAuditRecordRef",()=>I,"resolveAuditViewedFields",()=>h,"sanitizeEmployeeRecordForViewer",()=>p,"summarizeAuditFieldList",()=>b])},35110,e=>{"use strict";function t(){let e=String(process.env.CLIO_APP_BASE_URL||"").trim();return e?e.replace(/\/+$/,""):"http://localhost:3000"}async function i({toEmail:e,verifyUrl:t}){let i=String("AIzaSyC-mWz29cK_wjvDsjhgbwYLAuJeygPohOI").trim();if(!i)throw Error("firebase_api_key_not_configured");let r=await fetch(`https://identitytoolkit.googleapis.com/v1/accounts:sendOobCode?key=${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requestType:"EMAIL_SIGNIN",email:e,continueUrl:t,canHandleCodeInApp:!0})}),n=await r.json().catch(()=>({}));if(!r.ok){let e;throw Error((e=String(n?.error?.message||"").trim())?"OPERATION_NOT_ALLOWED"===e?"firebase_email_provider_not_enabled":"MISSING_CONTINUE_URI"===e||"INVALID_CONTINUE_URI"===e?"firebase_continue_url_invalid":"INVALID_EMAIL"===e?"invalid_email":"PROJECT_NOT_FOUND"===e||"API_KEY_INVALID"===e?"firebase_api_key_not_configured":"email_delivery_failed":"email_delivery_failed")}return{provider:"firebase",status:"sent",messageId:`firebase-${Date.now()}`}}async function r({toEmail:e,subject:t,html:i,text:r}){let n=String(process.env.RESEND_API_KEY||"").trim(),s=String(process.env.CLIO_EMAIL_FROM||"").trim();if(!n||!s||!n.startsWith("re_"))throw Error("email_provider_not_configured");let a=await fetch("https://api.resend.com/emails",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({from:s,to:[e],subject:t,html:i,text:r})});if(!a.ok){let e=await a.json().catch(()=>({})),t="string"==typeof e?.message?e.message:"string"==typeof e?.error?.message?e.error.message:"";throw Error(t?`email_delivery_failed:${t}`:"email_delivery_failed")}let o=await a.json().catch(()=>({}));return{provider:"resend",status:"sent",messageId:"string"==typeof o?.id?o.id:`resend-${Date.now()}`}}async function n({toEmail:e,role:n,invitedBy:s,expiresAt:a,inviteToken:o}){let l,c,d,u=function(e){let i,r=t(),n=(i=String(process.env.CLIO_INVITE_VERIFY_PATH||"").trim())?i.startsWith("/")?i:`/${i}`:"/verify-invite",s=String(e||"").trim();if(!s)throw Error("invalid_invite_token");return`${r}${n}?token=${encodeURIComponent(s)}`}(o),m=(c=t(),`${c}${!(d=String(process.env.CLIO_LOGIN_PATH||"").trim())?"/login":d.startsWith("/")?d:`/${d}`}`),p=function({role:e,invitedBy:t,verifyUrl:i,loginUrl:r,expiresAt:n}){let s=new Date(n),a=Number.isNaN(s.getTime())?n:s.toLocaleString("en-US",{month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return{subject:"You are invited to CLIO HRIS",text:`You were invited to access CLIO HRIS.
Assigned role: ${e}
Invited by: ${t}
Verify your email: ${i}
Sign-in page: ${r}
Invitation expires: ${a}

Step 1: Open the verification link and complete email verification.
Step 2: After verification, sign in using Google with the same invited work email.
Only invited accounts can access the workspace.`,html:`<p>You were invited to access <strong>CLIO HRIS</strong>.</p><p><strong>Assigned role:</strong> ${e}<br/><strong>Invited by:</strong> ${t}<br/><strong>Invitation expires:</strong> ${a}</p><p><a href="${i}">Verify your email</a></p><p><a href="${r}">Open CLIO sign-in</a></p><p>After verification, sign in using Google with the same invited work email.</p>`}}({role:n,invitedBy:s,verifyUrl:u,loginUrl:m,expiresAt:a}),v=!(l=String(process.env.CLIO_EMAIL_PROVIDER||"").trim().toLowerCase())||"firebase"===l||l.includes("firebase")?"firebase":"resend"===l||l.includes("resend")?"resend":"console"===l||"dev"===l||l.includes("console")?"console":l;if("firebase"===v)return await i({toEmail:e,verifyUrl:u});if("resend"===v)return await r({toEmail:e,subject:p.subject,html:p.html,text:p.text});if("console"===v){if("true"!==String(process.env.CLIO_ALLOW_CONSOLE_EMAIL||"").trim().toLowerCase())throw Error("email_provider_not_configured");return function({toEmail:e,subject:t,verifyUrl:i,loginUrl:r}){return{provider:"console",status:"simulated",messageId:`console-${Date.now()}`,previewUrl:i,loginUrl:r}}({toEmail:e,subject:p.subject,verifyUrl:u,loginUrl:m})}throw Error("unsupported_email_provider")}e.s(["deliverInviteEmail",()=>n])},70406,(e,t,i)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,i)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,i)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,i)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,i)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,i)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,i)=>{t.exports=e.x("util",()=>require("util"))},66680,(e,t,i)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},2157,(e,t,i)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},50227,(e,t,i)=>{t.exports=e.x("node:path",()=>require("node:path"))},54799,(e,t,i)=>{t.exports=e.x("crypto",()=>require("crypto"))},98189,32307,e=>{"use strict";var t=e.i(89171),i=e.i(59979),r=e.i(81215),n=e.i(28221);let s={SUPER_ADMIN:["*"],GRC:["dashboard:view","employees:view","employees:edit","employees:view:sensitive","lifecycle:view","lifecycle:edit","lifecycle:approve","attendance:view","attendance:edit","attendance:approve","performance:view","performance:edit","performance:approve","templates:view","templates:edit","exports:view","exports:manage","exports:approve","exports:request","activity_log:export","activity_log:view","audit:view","access_management:view","retention_archive:view","retention_archive:manage","incident_management:view","incident_management:edit","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],HR:["dashboard:view","employees:view","employees:edit","employees:view:sensitive","lifecycle:view","lifecycle:edit","lifecycle:approve","attendance:view","attendance:edit","attendance:approve","performance:view","performance:edit","performance:approve","templates:view","templates:edit","exports:view","exports:manage","exports:approve","exports:request","activity_log:export","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],EA:["dashboard:view","employees:view","employees:edit","employees:view:sensitive","lifecycle:view","lifecycle:edit","lifecycle:approve","attendance:view","attendance:edit","attendance:approve","performance:view","performance:edit","performance:approve","templates:view","templates:edit","exports:view","exports:manage","exports:approve","exports:request","activity_log:export","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],EMPLOYEE_L1:["dashboard:view","employees:view","employees:edit:self","attendance:view","attendance:edit:self","performance:view","templates:view","requests:view","requests:create:self","exports:request:self","audit:write:nonsensitive","auth:logout","resource:own"],EMPLOYEE_L2:["dashboard:view","employees:view","employees:edit:self","attendance:view","attendance:edit:self","performance:view","templates:view","requests:view","requests:create:self","exports:request:self","audit:write:nonsensitive","auth:logout","resource:own"],EMPLOYEE_L3:["dashboard:view","employees:view","employees:edit:self","attendance:view","attendance:edit:self","performance:view","templates:view","requests:view","requests:create:self","exports:request:self","audit:write:nonsensitive","auth:logout","resource:own"]},a={dashboard:"dashboard:view",employees:"employees:view","employment-lifecycle":"lifecycle:view",attendance:"attendance:view",performance:"performance:view","activity-log":"activity_log:view",exports:"exports:view",documents:"templates:view","access-management":"access_management:view","retention-archive":"retention_archive:view","incident-management":"incident_management:view",requests:"requests:view",settings:"settings:view","user-management":"user_management:view"};function o(e,t){let i=s[(0,r.normalizeRole)(e)]??[];return i.includes("*")||i.includes(t)}function l(e,t){let i=(0,r.normalizeRole)(e);if(!new Set(n.MODULE_ACCESS[i]??[]).has(t))return!1;let s=a[t];return!s||o(i,s)}function c({role:e,actorIdentifier:t,ownerIdentifier:i,allowRoles:n=["SUPER_ADMIN"]}){let s=(0,r.normalizeRole)(e);if(n.includes(s))return!0;if(!o(s,"resource:own"))return!1;let a=String(t||"").trim().toLowerCase(),l=String(i||"").trim().toLowerCase();return!!a&&!!l&&a===l}function d(e){let t=String(e||"").trim().replace(/^\/+|\/+$/g,"");if(!t)return"dashboard";let i=t.split("/")[0];return a[i]?i:null}e.s(["canAccessModule",()=>l,"canAccessResource",()=>c,"getModuleIdFromPathname",()=>d,"hasPermission",()=>o],32307);var u=e.i(96864),m=e.i(45709);function p(e,i){return{error:t.NextResponse.json({message:i},{status:e})}}async function v(e,{allowedRoles:t,requiredPermissions:n=[],ownerIdentifier:s,ownerBypassRoles:a=["SUPER_ADMIN"],auditModule:l="Authorization",auditAction:d="API access check"}={}){let f=e.cookies.get(i.SESSION_COOKIE_NAME)?.value,_=(0,i.verifySessionToken)(f);if(!_)return await (0,u.recordAuditEvent)({activityName:`${d} denied (no active session)`,status:"Failed",module:l,performedBy:"anonymous@gmail.com",sensitivity:"Sensitive",metadata:{reason:"unauthorized"},request:e}),p(401,"Unauthorized.");let g={..._,role:(0,r.normalizeRole)(_.role)},y=await (0,m.getLoginAccount)(g.email).catch(()=>null);if(!y)return await (0,u.recordAuditEvent)({activityName:`${d} denied (account not found)`,status:"Failed",module:l,performedBy:g.email,sensitivity:"Sensitive",metadata:{reason:"account_not_found"},request:e}),p(401,"Session is no longer valid. Please sign in again.");if("active"!==y.status)return await (0,u.recordAuditEvent)({activityName:`${d} blocked by account status`,status:"Rejected",module:l,performedBy:g.email,sensitivity:"Sensitive",metadata:{reason:"account_not_active",accountStatus:y.status},request:e}),p(403,"Account is not active.");let w=(0,r.normalizeRole)(y.role),h=Number.parseInt(String(y.sessionVersion??""),10)||1,I="SUPER_ADMIN"===w,b=g.role!==w,E=g.sessionVersion!==h;if(E||b&&!I)return await (0,u.recordAuditEvent)({activityName:`${d} denied (stale session)`,status:"Rejected",module:l,performedBy:g.email,sensitivity:"Sensitive",metadata:{reason:E?"session_version_mismatch":"session_role_mismatch",tokenRole:g.role,accountRole:w,tokenSessionVersion:g.sessionVersion,accountSessionVersion:h},request:e}),p(401,"Session expired. Please sign in again.");if(Array.isArray(t)&&t.length>0&&!t.includes(g.role))return await (0,u.recordAuditEvent)({activityName:`${d} blocked by role policy`,status:"Rejected",module:l,performedBy:g.email,sensitivity:"Sensitive",metadata:{role:g.role,allowedRoles:t,reason:"role_not_allowed"},request:e}),p(403,"Forbidden.");if(n.length>0&&!n.every(e=>o(g.role,e)))return await (0,u.recordAuditEvent)({activityName:`${d} blocked by permission policy`,status:"Rejected",module:l,performedBy:g.email,sensitivity:"Sensitive",metadata:{role:g.role,requiredPermissions:n,reason:"missing_permission"},request:e}),p(403,"Forbidden.");if(s){let t=g.email,i="function"==typeof s?await s(g):s;if(!c({role:g.role,actorIdentifier:t,ownerIdentifier:i,allowRoles:a}))return await (0,u.recordAuditEvent)({activityName:`${d} blocked by ownership policy`,status:"Rejected",module:l,performedBy:g.email,sensitivity:"Sensitive",metadata:{role:g.role,ownerIdentifier:i,reason:"ownership_validation_failed"},request:e}),p(403,"Forbidden.")}return{session:g}}e.s(["authorizeApiRequest",()=>v],98189)},44801,e=>{"use strict";function t(e){return String(e??"").trim()}function i(e,{fallbackLabel:r="User",maxTokens:n=3}={}){let s=t(e).toLowerCase(),a=t(r)||"User";if(!s.includes("@"))return a;let o=(s.split("@")[0]||"").split(/[._-]+/g).map(e=>{let i;return(i=t(e).toLowerCase())?`${i.charAt(0).toUpperCase()}${i.slice(1)}`:""}).filter(Boolean).slice(0,Math.max(1,Number.isFinite(n)?n:3));return 0===o.length?a:o.join(" ")}function r({firstName:e,middleName:i,lastName:r,order:n}){let s=t(e),a=t(i),o=t(r);if("last-first"===n){let e=[s,a].filter(Boolean).join(" ");return o?`${o}${e?`, ${e}`:""}`:e}return[s,a,o].filter(Boolean).join(" ")}function n({fallback:e,fallbackEmail:r,fallbackLabel:n}){let s=t(e);if(s)return s;let a=t(r);return a?i(a,{fallbackLabel:n}):t(n)||"User"}function s({firstName:e,middleName:i,lastName:a,suffix:o,fallback:l="",fallbackEmail:c="",fallbackLabel:d="User"}={}){let u=[r({firstName:e,middleName:i,lastName:a,order:"first-last"}),t(o)].filter(Boolean).join(" ").trim();return u||n({fallback:l,fallbackEmail:c,fallbackLabel:d})}function a({firstName:e,middleName:i,lastName:s,suffix:o,fallback:l="",fallbackEmail:c="",fallbackLabel:d="Employee"}={}){let u=[r({firstName:e,middleName:i,lastName:s,order:"last-first"}),t(o)].filter(Boolean).join(" ").trim();return u||n({fallback:l,fallbackEmail:c,fallbackLabel:d})}e.s(["formatEmployeeName",()=>a,"formatNameFromEmail",()=>i,"formatPersonName",()=>s])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__3476a93a._.js.map