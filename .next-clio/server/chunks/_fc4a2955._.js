module.exports=[40831,e=>{"use strict";var t=e.i(47909),r=e.i(74017),i=e.i(96250),a=e.i(59756),o=e.i(61916),n=e.i(74677),l=e.i(69741),s=e.i(16795),c=e.i(87718),d=e.i(95169),u=e.i(47587),p=e.i(66012),m=e.i(70101),y=e.i(26937),f=e.i(10372),h=e.i(93695);e.i(52474);var R=e.i(220),v=e.i(89171),g=e.i(98189),w=e.i(45787),E=e.i(79120);async function A(e){let t=await (0,g.authorizeApiRequest)(e,{requiredPermissions:["lifecycle:view"],auditModule:"Employment Lifecycle",auditAction:"Lifecycle records list request"});if(t.error)return t.error;let{session:r}=t;try{let t=await (0,w.listLifecycleRecordsBackend)(),i=(0,E.normalizeEmail)(e.nextUrl?.searchParams.get("employeeEmail")),a=String(e.nextUrl?.searchParams.get("category")||"").trim().toLowerCase(),o=String(e.nextUrl?.searchParams.get("status")||"").trim().toLowerCase(),n=t.filter(e=>{let t=!i||(0,E.normalizeEmail)(e.employeeEmail)===i,r=!a||String(e.category||"").trim().toLowerCase().includes(a),n=!o||String(e.status||"").trim().toLowerCase().includes(o);return t&&r&&n});return await (0,E.logApiAudit)({request:e,module:"Employment Lifecycle",activityName:"Lifecycle records listed",status:"Completed",sensitivity:"Sensitive",performedBy:r.email,metadata:{resultCount:n.length,hasEmployeeFilter:!!i,hasCategoryFilter:!!a,hasStatusFilter:!!o,viewedRecordRefs:n.slice(0,25).map(e=>({recordId:e.id,recordRef:(0,E.resolveAuditRecordRef)(e,e.id,["workflowId","employeeId","id"]),employeeEmail:e.employeeEmail||"",category:e.category||"",status:e.status||""})),auditNote:`Listed ${n.length} lifecycle workflow record(s) in the current query window.`,nextAction:"No further action required."}}),v.NextResponse.json({records:n})}catch(a){let t=a instanceof Error?a.message:"unknown_error",i=(0,E.mapBackendError)(t,"Unable to load lifecycle records.");return await (0,E.logApiAudit)({request:e,module:"Employment Lifecycle",activityName:"Lifecycle records list failed",status:"Failed",sensitivity:"Sensitive",performedBy:r.email,metadata:{reason:t}}),v.NextResponse.json({message:i.message},{status:i.status})}}async function C(e){let t=await (0,g.authorizeApiRequest)(e,{requiredPermissions:["lifecycle:view"],auditModule:"Employment Lifecycle",auditAction:"Lifecycle record create request"});if(t.error)return t.error;let{session:r}=t;if(!(0,E.canActorEditModule)({role:r.role,editPermission:"lifecycle:edit",isSelfResource:!1}))return await (0,E.logApiAudit)({request:e,module:"Employment Lifecycle",activityName:"Lifecycle record create blocked by permission policy",status:"Rejected",sensitivity:"Sensitive",performedBy:r.email,metadata:{role:r.role}}),v.NextResponse.json({message:"Forbidden."},{status:403});try{let t={...await (0,E.parseJsonBody)(e)};delete t.workflow,delete t.workflowAction,delete t.evidence;let i=await (0,w.createLifecycleRecordBackend)(t,r.email,r.role),a=i?.record||i,o=Array.isArray(i?.effects)?i.effects:[],n=(Array.isArray(a?.evidence)?a.evidence:[]).map((e,t)=>{let r=e&&"object"==typeof e?e:{},i=String(r.name||r.fileName||"").trim(),a=String(r.type||"Lifecycle Evidence").trim(),o=String(r.id||r.recordId||r.storagePath||`${t+1}`).trim();return i||o?{id:o,name:i||"Lifecycle Evidence",type:a||"Lifecycle Evidence"}:null}).filter(Boolean).slice(0,20),l=Object.keys(t||{});return await (0,E.logApiAudit)({request:e,module:"Employment Lifecycle",activityName:"Lifecycle record created",status:"Approved",sensitivity:"Sensitive",performedBy:r.email,metadata:{recordId:a.id,recordRef:(0,E.resolveAuditRecordRef)(a,a.id,["workflowId","employeeId","id"]),employeeEmail:a.employeeEmail||null,category:a.category,status:a.status,resourceType:"Lifecycle Workflow",resourceLabel:`${a.category||"Lifecycle"} - ${a.employeeEmail||"Employee"}`,changedFields:l,changedFieldCount:l.length,accessedDocuments:n,accessedDocumentCount:n.length,effects:o,auditNote:`Created lifecycle workflow with fields: ${(0,E.summarizeAuditFieldList)(l,"No explicit payload fields captured.")}.`,nextAction:"No further action required."}}),v.NextResponse.json({ok:!0,record:a,effects:o},{status:201})}catch(a){let t=a instanceof Error?a.message:"unknown_error",i=(0,E.mapBackendError)(t,"Unable to create lifecycle record.");return await (0,E.logApiAudit)({request:e,module:"Employment Lifecycle",activityName:"Lifecycle record create failed",status:"Failed",sensitivity:"Sensitive",performedBy:r.email,metadata:{reason:t}}),v.NextResponse.json({message:i.message},{status:i.status})}}e.s(["GET",()=>A,"POST",()=>C],27048);var x=e.i(27048);let N=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/hris/lifecycle/route",pathname:"/api/hris/lifecycle",filename:"route",bundlePath:""},distDir:".next-clio",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/hris/lifecycle/route.js",nextConfigOutput:"",userland:x}),{workAsyncStorage:b,workUnitAsyncStorage:S,serverHooks:L}=N;function P(){return(0,i.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:S})}async function k(e,t,i){N.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/hris/lifecycle/route";v=v.replace(/\/index$/,"")||"/";let g=await N.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!g)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:w,params:E,nextConfig:A,parsedUrl:C,isDraftMode:x,prerenderManifest:b,routerServerContext:S,isOnDemandRevalidate:L,revalidateOnlyGenerated:P,resolvedPathname:k,clientReferenceManifest:_,serverActionsManifest:T}=g,q=(0,l.normalizeAppPath)(v),O=!!(b.dynamicRoutes[q]||b.routes[k]),I=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,C,!1):t.end("This page could not be found"),null);if(O&&!x){let e=!!b.routes[k],t=b.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await I();throw new h.NoFallbackError}}let U=null;!O||N.isDev||x||(U="/index"===(U=k)?"/":U);let j=!0===N.isDev||!O,F=O&&!j;T&&_&&(0,n.setManifestsSingleton)({page:v,clientReferenceManifest:_,serverActionsManifest:T});let H=e.method||"GET",B=(0,o.getTracer)(),M=B.getActiveScopeSpan(),D={params:E,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i,a)=>N.onRequestError(e,t,i,a,S)},sharedContext:{buildId:w}},$=new s.NodeNextRequest(e),K=new s.NodeNextResponse(t),z=c.NextRequestAdapter.fromNodeNextRequest($,(0,c.signalFromNodeResponse)(t));try{let n=async e=>N.handle(z,D).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=B.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${H} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${v}`)}),l=!!(0,a.getRequestMeta)(e,"minimalMode"),s=async a=>{var o,s;let c=async({previousCacheEntry:r})=>{try{if(!l&&L&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await n(a);e.fetchMetrics=D.renderOpts.fetchMetrics;let s=D.renderOpts.pendingWaitUntil;s&&i.waitUntil&&(i.waitUntil(s),s=void 0);let c=D.renderOpts.collectedTags;if(!O)return await (0,p.sendResponse)($,K,o,D.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(o.headers);c&&(t[f.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==D.renderOpts.collectedRevalidate&&!(D.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&D.renderOpts.collectedRevalidate,i=void 0===D.renderOpts.collectedExpire||D.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:D.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:L})},!1,S),t}},d=await N.handleResponse({req:e,nextConfig:A,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:L,revalidateOnlyGenerated:P,responseGenerator:c,waitUntil:i.waitUntil,isMinimalMode:l});if(!O)return null;if((null==d||null==(o=d.value)?void 0:o.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(s=d.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",L?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return l&&O||h.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,y.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)($,K,new Response(d.value.body,{headers:h,status:d.value.status||200})),null};M?await s(M):await B.withPropagatedContext(e.headers,()=>B.trace(d.BaseServerSpan.handleRequest,{spanName:`${H} ${v}`,kind:o.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},s))}catch(t){if(t instanceof h.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:L})},!1,S),O)throw t;return await (0,p.sendResponse)($,K,new Response(null,{status:500})),null}}e.s(["handler",()=>k,"patchFetch",()=>P,"routeModule",()=>N,"serverHooks",()=>L,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>S],40831)},11072,e=>{e.v(t=>Promise.all(["server/chunks/src_lib_security-notifications_5f07320b.js","server/chunks/src_lib_security-detection_4bdbe3ad.js"].map(t=>e.l(t))).then(()=>t(74405)))}];

//# sourceMappingURL=_fc4a2955._.js.map