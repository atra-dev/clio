module.exports=[44801,t=>{"use strict";function e(t){return String(t??"").trim()}function r(t,{fallbackLabel:i="User",maxTokens:n=3}={}){let a=e(t).toLowerCase(),o=e(i)||"User";if(!a.includes("@"))return o;let u=(a.split("@")[0]||"").split(/[._-]+/g).map(t=>{let r;return(r=e(t).toLowerCase())?`${r.charAt(0).toUpperCase()}${r.slice(1)}`:""}).filter(Boolean).slice(0,Math.max(1,Number.isFinite(n)?n:3));return 0===u.length?o:u.join(" ")}function i({firstName:t,middleName:r,lastName:i,order:n}){let a=e(t),o=e(r),u=e(i);if("last-first"===n){let t=[a,o].filter(Boolean).join(" ");return u?`${u}${t?`, ${t}`:""}`:t}return[a,o,u].filter(Boolean).join(" ")}function n({fallback:t,fallbackEmail:i,fallbackLabel:n}){let a=e(t);if(a)return a;let o=e(i);return o?r(o,{fallbackLabel:n}):e(n)||"User"}function a({firstName:t,middleName:r,lastName:o,suffix:u,fallback:l="",fallbackEmail:s="",fallbackLabel:c="User"}={}){let f=[i({firstName:t,middleName:r,lastName:o,order:"first-last"}),e(u)].filter(Boolean).join(" ").trim();return f||n({fallback:l,fallbackEmail:s,fallbackLabel:c})}function o({firstName:t,middleName:r,lastName:a,suffix:u,fallback:l="",fallbackEmail:s="",fallbackLabel:c="Employee"}={}){let f=[i({firstName:t,middleName:r,lastName:a,order:"last-first"}),e(u)].filter(Boolean).join(" ").trim();return f||n({fallback:l,fallbackEmail:s,fallbackLabel:c})}t.s(["formatEmployeeName",()=>o,"formatNameFromEmail",()=>r,"formatPersonName",()=>a])},33355,t=>{"use strict";t.i(18097);var e=t.i(19e3),r=t.i(67658),i=t.i(45709);function n(){return new Date().toISOString()}function a(t,e=""){return String(t||"").trim()||e}function o(t,e=!1){if("boolean"==typeof t)return t;if("number"==typeof t)return 0!==t;if("string"==typeof t){let r=t.trim().toLowerCase();if(!r)return e;if(["true","1","yes","on","y"].includes(r))return!0;if(["false","0","no","off","n"].includes(r))return!1}return e}function u(t){return Array.isArray(t)?t:[]}function l(t,e,{min:r=1,max:i=Number.MAX_SAFE_INTEGER}={}){let n=Number.parseInt(String(t||""),10);return Number.isFinite(n)?Math.min(i,Math.max(r,n)):e}function s(t){return String(t||"").trim().toLowerCase()}function c(t){return String(t||"").split(",").map(t=>s(t)).filter(Boolean)}function f(t){return"read"===String(t||"").trim().toLowerCase()?"read":"unread"}function d(){return a(process.env.CLIO_FIRESTORE_NOTIFICATIONS_COLLECTION,"clio_notifications")}function m(){return(0,r.isFirestoreEnabled)()?(0,r.getFirestoreDb)():null}function p(t){return{...t.data()||{},id:t.id,recordId:t.id}}function A(t,e){let r=s(e),i=s(t?.recipientEmail);return o(t?.broadcast,!1)||r&&i&&r===i}function y(t,e){return new Date(e?.createdAt||0).getTime()-new Date(t?.createdAt||0).getTime()}async function g(t){let r=m();if(!r)return null;let i=function(t){var e;let r,i=n(),u=s(t?.recipientEmail),l=o(t?.broadcast,!1);if(!u&&!l)throw Error("invalid_notification_recipient");return{title:a(t?.title,"Security notification"),message:a(t?.message,"A security event requires review."),severity:"critical"===(r=String(t?.severity||"").trim().toLowerCase())?"critical":"high"===r?"high":"low"===r?"low":"medium",type:a(t?.type,"security"),module:a(t?.module,"Incident Management"),actionUrl:a(t?.actionUrl,"/incident-management"),recipientEmail:u,broadcast:l,status:f(t?.status),metadata:(e=t?.metadata)&&"object"==typeof e&&!Array.isArray(e)?e:{},createdAt:a(t?.createdAt,i),updatedAt:a(t?.updatedAt,i),readAt:a(t?.readAt,""),createdBy:s(t?.createdBy)}}(t),u=await (0,e.addDoc)((0,e.collection)(r,d()),i);return{...i,id:u.id,recordId:u.id}}async function w(t){let e=u(t);if(0===e.length)return[];let r=[];for(let t of e){let e=await g(t);e&&r.push(e)}return r}async function I({recipientEmail:t,status:r="all",limit:i=20}={}){let n=m();if(!n)return{records:[],unreadCount:0,totalScoped:0};let a=String(r||"").trim().toLowerCase(),o=l(i,20,{min:1,max:120}),u=Math.max(4*o,100),s=(await (0,e.getDocs)((0,e.query)((0,e.collection)(n,d()),(0,e.orderBy)("createdAt","desc"),(0,e.limit)(u)))).docs.map(p).filter(e=>A(e,t)),c=s.reduce((t,e)=>t+ +("unread"===f(e?.status)),0);return{records:s.filter(t=>"all"===a||!a||f(t?.status)===a).sort(y).slice(0,o),unreadCount:c,totalScoped:s.length}}async function S(t,r){let i=m();if(!i)return null;let o=a(t);if(!o)throw Error("invalid_record_id");let u=(0,e.doc)(i,d(),o),l=await (0,e.getDoc)(u);if(!l.exists())return null;let s=p(l);if(!A(s,r))throw Error("forbidden_notification_access");if("read"===f(s.status))return s;let c={...s,status:"read",readAt:n(),updatedAt:n()};return await (0,e.updateDoc)(u,c),c}async function E({recipientEmail:t,limit:r=120}={}){let i=s(t);if(!i)return{updatedCount:0};let o=m();if(!o)return{updatedCount:0};let u=l(r,120,{min:1,max:300}),{records:c}=await I({recipientEmail:i,status:"unread",limit:u}),f=0;for(let t of c){let r=a(t?.id||t?.recordId);if(!r)continue;let i=(0,e.doc)(o,d(),r);await (0,e.updateDoc)(i,{status:"read",readAt:n(),updatedAt:n()}),f+=1}return{updatedCount:f}}async function C({ownerEmail:t,affectedEmployeeEmail:e,actorEmail:r,includeAffectedEmployee:n=!0,includeActor:a=!1}={}){let o=[s(process.env.CLIO_GRC_ALERT_EMAIL),...c(process.env.GRC_EMAILS),...c(process.env.SUPER_ADMIN_EMAILS),s(t)];n&&o.push(s(e)),a&&o.push(s(r));let l=[];try{let t=await (0,i.listUserAccounts)();l=u(t).filter(t=>s(t?.email)).filter(t=>{var e;return"active"===(e=t?.status,String(e||"").trim().toLowerCase())}).filter(t=>{let e=String(t?.role||"").trim().toUpperCase();return"GRC"===e||"SUPER_ADMIN"===e}).map(t=>s(t?.email))}catch{l=[]}return function(t=[]){return Array.from(new Set(u(t).map(t=>s(t)).filter(Boolean)))}([...o,...l])}t.s(["createInAppNotificationsBulk",()=>w,"listInAppNotifications",()=>I,"markAllInAppNotificationsRead",()=>E,"markInAppNotificationRead",()=>S,"resolveIncidentStakeholderRecipients",()=>C])}];

//# sourceMappingURL=src_lib_23760414._.js.map