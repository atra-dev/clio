{"version":3,"sources":["../../../src/lib/hris-api.js","../../../src/lib/invite-delivery.js","../../../src/lib/api-authorization.js","../../../src/lib/rbac.js","../../../src/lib/name-utils.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { canAccessResource, hasPermission } from \"@/lib/rbac\";\nimport { recordAuditEvent } from \"@/lib/audit-log\";\n\nconst PRIVILEGED_OWNER_BYPASS_ROLES = [\"SUPER_ADMIN\", \"GRC\", \"HR\", \"EA\"];\n\nexport function normalizeEmail(value) {\n  return String(value || \"\").trim().toLowerCase();\n}\n\nexport function maskValue(value, { start = 2, end = 2, fallback = \"Masked\" } = {}) {\n  const raw = String(value || \"\").trim();\n  if (!raw) {\n    return fallback;\n  }\n\n  if (raw.length <= start + end) {\n    return `${raw.slice(0, 1)}***`;\n  }\n\n  return `${raw.slice(0, start)}***${raw.slice(raw.length - end)}`;\n}\n\nexport function isEmployeeRole(role) {\n  return String(role || \"\")\n    .trim()\n    .toUpperCase()\n    .startsWith(\"EMPLOYEE_\");\n}\n\nexport function ensureArray(value) {\n  return Array.isArray(value) ? value : [];\n}\n\nexport function parsePositiveInt(value, fallback, { min = 1, max = 1000 } = {}) {\n  const parsed = Number.parseInt(String(value || \"\"), 10);\n  if (!Number.isFinite(parsed)) {\n    return fallback;\n  }\n  return Math.min(max, Math.max(min, parsed));\n}\n\nexport function paginateRows(rows, { page = 1, pageSize = 20 } = {}) {\n  const safePage = parsePositiveInt(page, 1, { min: 1, max: 100000 });\n  const safePageSize = parsePositiveInt(pageSize, 20, { min: 1, max: 200 });\n  const total = rows.length;\n  const totalPages = Math.max(1, Math.ceil(total / safePageSize));\n  const currentPage = Math.min(safePage, totalPages);\n  const start = (currentPage - 1) * safePageSize;\n  const end = start + safePageSize;\n  const data = rows.slice(start, end);\n\n  return {\n    data,\n    pagination: {\n      page: currentPage,\n      pageSize: safePageSize,\n      total,\n      totalPages,\n    },\n  };\n}\n\nexport async function parseJsonBody(request) {\n  try {\n    const body = await request.json();\n    return body && typeof body === \"object\" ? body : {};\n  } catch {\n    throw new Error(\"invalid_json_body\");\n  }\n}\n\nexport function badRequest(message) {\n  return NextResponse.json({ message }, { status: 400 });\n}\n\nexport function forbidden(message = \"Forbidden.\") {\n  return NextResponse.json({ message }, { status: 403 });\n}\n\nexport function notFound(message = \"Record not found.\") {\n  return NextResponse.json({ message }, { status: 404 });\n}\n\nexport function getSelfRestrictedOwnerEmail({ session, requestedOwnerEmail, fallbackOwnerEmail }) {\n  if (!session || !isEmployeeRole(session.role)) {\n    const requested = normalizeEmail(requestedOwnerEmail || fallbackOwnerEmail);\n    return requested || null;\n  }\n\n  return normalizeEmail(session.email);\n}\n\nexport function canViewSensitiveEmployeeFields(role) {\n  return hasPermission(role, \"employees:view:sensitive\");\n}\n\nexport function sanitizeEmployeeRecordForViewer(record, role) {\n  if (!record || typeof record !== \"object\") {\n    return record;\n  }\n\n  if (canViewSensitiveEmployeeFields(role)) {\n    return record;\n  }\n\n  const maskedGovernmentIds =\n    record.governmentIds && typeof record.governmentIds === \"object\"\n      ? Object.entries(record.governmentIds).reduce((accumulator, [key, value]) => {\n          accumulator[key] = maskValue(value, { start: 2, end: 2 });\n          return accumulator;\n        }, {})\n      : {};\n\n  const payrollInformation =\n    record.payrollInformation && typeof record.payrollInformation === \"object\"\n      ? Object.keys(record.payrollInformation).reduce((accumulator, key) => {\n          accumulator[key] = \"Restricted\";\n          return accumulator;\n        }, {})\n      : {};\n\n  return {\n    ...record,\n    govId: maskValue(record.govId, { start: 2, end: 2 }),\n    governmentIds: maskedGovernmentIds,\n    payrollInformation,\n  };\n}\n\nexport function canActorAccessOwner({\n  session,\n  ownerEmail,\n  ownerBypassRoles = PRIVILEGED_OWNER_BYPASS_ROLES,\n}) {\n  const owner = normalizeEmail(ownerEmail);\n  if (!owner) {\n    return false;\n  }\n\n  return canAccessResource({\n    role: session.role,\n    actorIdentifier: session.email,\n    ownerIdentifier: owner,\n    allowRoles: ownerBypassRoles,\n  });\n}\n\nexport function canActorEditModule({\n  role,\n  editPermission,\n  selfEditPermission,\n  isSelfResource,\n}) {\n  if (hasPermission(role, editPermission)) {\n    return true;\n  }\n\n  if (isSelfResource && selfEditPermission && hasPermission(role, selfEditPermission)) {\n    return true;\n  }\n\n  return false;\n}\n\nexport function mapBackendError(reason, fallbackMessage) {\n  const normalized = String(reason || \"\").trim();\n  switch (normalized) {\n    case \"invalid_json_body\":\n      return { status: 400, message: \"Invalid request payload.\" };\n    case \"invalid_record_id\":\n      return { status: 400, message: \"Invalid record identifier.\" };\n    case \"invalid_employee_email\":\n      return { status: 400, message: \"Employee email is required.\" };\n    case \"employee_account_not_found\":\n      return {\n        status: 409,\n        message: \"No user account found for this employee email. Invite or activate the user account first.\",\n      };\n    case \"invalid_target_role\":\n      return {\n        status: 400,\n        message: \"Target role is required and must be a valid system role.\",\n      };\n    case \"forbidden_target_role\":\n      return {\n        status: 403,\n        message: \"Target role assignment is not allowed by lifecycle permission policy.\",\n      };\n    case \"role_sync_failed\":\n      return {\n        status: 409,\n        message: \"Employee user account was not found. Invite or activate the account before applying role changes.\",\n      };\n    case \"approval_required\":\n      return {\n        status: 409,\n        message: \"Workflow approval chain must be completed before setting this status.\",\n      };\n    case \"invalid_workflow_action\":\n      return {\n        status: 400,\n        message: \"Invalid workflow action payload.\",\n      };\n    case \"invalid_approval_decision\":\n      return {\n        status: 400,\n        message: \"Approval decision must be approve or reject.\",\n      };\n    case \"no_pending_approval_step\":\n      return {\n        status: 409,\n        message: \"No pending approval step remains for this workflow.\",\n      };\n    case \"approval_not_allowed_for_role\":\n      return {\n        status: 403,\n        message: \"Current role is not allowed to approve the active step.\",\n      };\n    case \"invalid_template_name\":\n      return { status: 400, message: \"Template name is required.\" };\n    case \"invalid_export_dataset\":\n      return { status: 400, message: \"Export dataset is required.\" };\n    case \"invalid_incident_title\":\n      return { status: 400, message: \"Incident title is required.\" };\n    case \"invalid_incident_evidence_payload\":\n      return { status: 400, message: \"Incident evidence payload must be a valid document array.\" };\n    case \"invalid_incident_evidence_name\":\n      return { status: 400, message: \"Incident evidence file name is required.\" };\n    case \"invalid_incident_evidence_reference\":\n      return { status: 400, message: \"Incident evidence must include a valid file reference.\" };\n    case \"invalid_incident_evidence_extension\":\n      return { status: 400, message: \"Incident evidence file extension is not allowed.\" };\n    case \"invalid_incident_evidence_content_type\":\n      return { status: 400, message: \"Incident evidence MIME type is not allowed.\" };\n    case \"invalid_incident_evidence_size\":\n      return { status: 400, message: \"Incident evidence file size exceeds the allowed limit.\" };\n    case \"incident_evidence_av_not_configured\":\n      return { status: 503, message: \"Evidence security scan provider is not configured.\" };\n    case \"incident_evidence_av_hook_failed\":\n      return { status: 502, message: \"Evidence security scan failed. Retry after security provider is available.\" };\n    case \"incident_evidence_av_blocked\":\n      return { status: 403, message: \"Evidence file blocked by malware/security policy scan.\" };\n    case \"invalid_reference_kind\":\n      return { status: 400, message: \"Reference type is invalid.\" };\n    case \"invalid_reference_label\":\n      return {\n        status: 400,\n        message: \"Reference label is required and must be within the allowed length.\",\n      };\n    case \"invalid_retention_module\":\n      return {\n        status: 400,\n        message: \"Retention module filter is invalid.\",\n      };\n    case \"invalid_purge_confirmation\":\n      return {\n        status: 400,\n        message: \"Invalid purge confirmation phrase.\",\n      };\n    case \"duplicate_reference_value\":\n      return {\n        status: 409,\n        message: \"Reference value already exists.\",\n      };\n    case \"immutable_reference_item\":\n      return {\n        status: 403,\n        message: \"System reference values cannot be removed.\",\n      };\n    case \"access_revocation_failed\":\n      return {\n        status: 409,\n        message:\n          \"Access revocation could not be confirmed for this employee account. Retry offboarding or review account status.\",\n      };\n    case \"account_activation_failed\":\n      return {\n        status: 409,\n        message: \"Account activation could not be confirmed for this employee account.\",\n      };\n    case \"email_provider_not_configured\":\n      return {\n        status: 502,\n        message: \"Email provider is not configured. Set CLIO_EMAIL_PROVIDER=firebase and NEXT_PUBLIC_FIREBASE_API_KEY.\",\n      };\n    case \"firebase_api_key_not_configured\":\n      return {\n        status: 502,\n        message: \"Firebase API key is not configured. Set NEXT_PUBLIC_FIREBASE_API_KEY.\",\n      };\n    case \"firebase_email_provider_not_enabled\":\n      return {\n        status: 502,\n        message: \"Firebase email-link provider is not enabled. Enable Email link (passwordless sign-in) in Firebase Authentication.\",\n      };\n    case \"firebase_continue_url_invalid\":\n      return {\n        status: 502,\n        message: \"Firebase continue URL is invalid. Check CLIO_APP_BASE_URL / CLIO_INVITE_VERIFY_PATH and authorize the domain in Firebase Authentication.\",\n      };\n    case \"unsupported_email_provider\":\n      return {\n        status: 502,\n        message: \"Unsupported email provider configuration.\",\n      };\n    case \"email_delivery_failed\":\n      return {\n        status: 502,\n        message: \"Unable to deliver invite email.\",\n      };\n    case \"firestore_not_configured\":\n      return {\n        status: 503,\n        message:\n          \"Database is not configured. Set Firebase environment variables and restart the app.\",\n      };\n    default:\n      return { status: 400, message: fallbackMessage || \"Unable to process request.\" };\n  }\n}\n\nfunction normalizeAuditTextValue(value) {\n  return String(value || \"\").trim();\n}\n\nfunction toComparableAuditValue(value) {\n  if (value == null) {\n    return null;\n  }\n  if (Array.isArray(value)) {\n    return value.map((entry) => toComparableAuditValue(entry));\n  }\n  if (typeof value === \"object\") {\n    return Object.keys(value)\n      .sort()\n      .reduce((accumulator, key) => {\n        accumulator[key] = toComparableAuditValue(value[key]);\n        return accumulator;\n      }, {});\n  }\n  if (typeof value === \"string\") {\n    return value.trim();\n  }\n  return value;\n}\n\nexport function areAuditValuesEqual(left, right) {\n  return JSON.stringify(toComparableAuditValue(left)) === JSON.stringify(toComparableAuditValue(right));\n}\n\nexport function resolveAuditChangedFields(previousRecord, nextRecord, candidateFields = []) {\n  const fields = Array.isArray(candidateFields) ? candidateFields : [];\n  return fields.filter((field) => !areAuditValuesEqual(previousRecord?.[field], nextRecord?.[field]));\n}\n\nexport function resolveAuditViewedFields(record, excludeFields = []) {\n  if (!record || typeof record !== \"object\") {\n    return [];\n  }\n  const exclude = new Set(\n    (Array.isArray(excludeFields) ? excludeFields : []).map((field) => normalizeAuditTextValue(field)),\n  );\n  return Object.keys(record)\n    .filter((field) => !exclude.has(field))\n    .sort();\n}\n\nexport function resolveAuditRecordRef(record, fallbackRecordId = \"\", candidateKeys = []) {\n  const keys = Array.isArray(candidateKeys) ? candidateKeys : [];\n  const defaultCandidates = [\n    record?.employeeId,\n    record?.workflowId,\n    record?.lifecycleId,\n    record?.templateId,\n    record?.exportId,\n    record?.id,\n    fallbackRecordId,\n  ];\n  for (const key of keys) {\n    const fromRecord = normalizeAuditTextValue(record?.[key]);\n    if (fromRecord) {\n      return fromRecord;\n    }\n  }\n  for (const candidate of defaultCandidates) {\n    const normalized = normalizeAuditTextValue(candidate);\n    if (normalized) {\n      return normalized;\n    }\n  }\n  return \"N/A\";\n}\n\nexport function summarizeAuditFieldList(fields = [], emptyFallback = \"No field details recorded.\") {\n  const normalized = ensureArray(fields)\n    .map((field) => normalizeAuditTextValue(field))\n    .filter(Boolean);\n  if (normalized.length === 0) {\n    return emptyFallback;\n  }\n  return normalized.join(\", \");\n}\n\nexport async function logApiAudit({\n  request,\n  module,\n  activityName,\n  status = \"Completed\",\n  sensitivity = \"Sensitive\",\n  performedBy = \"system@gmail.com\",\n  metadata,\n}) {\n  const shouldWriteAsync =\n    process.env.CLIO_AUDIT_ASYNC === \"true\" ||\n    (process.env.CLIO_AUDIT_ASYNC !== \"false\" && process.env.NODE_ENV !== \"production\");\n\n  const writePromise = recordAuditEvent({\n    activityName,\n    status,\n    module,\n    performedBy,\n    sensitivity,\n    metadata,\n    request,\n  }).catch(() => null);\n\n  if (shouldWriteAsync) {\n    return;\n  }\n\n  await writePromise;\n}\n","function normalizeEmailProvider(rawValue) {\n  const raw = String(rawValue || \"\")\n    .trim()\n    .toLowerCase();\n  if (!raw) {\n    return \"firebase\";\n  }\n\n  if (raw === \"firebase\" || raw.includes(\"firebase\")) {\n    return \"firebase\";\n  }\n\n  if (raw === \"resend\" || raw.includes(\"resend\")) {\n    return \"resend\";\n  }\n\n  if (raw === \"console\" || raw === \"dev\" || raw.includes(\"console\")) {\n    return \"console\";\n  }\n\n  return raw;\n}\n\nfunction getEmailProvider() {\n  return normalizeEmailProvider(process.env.CLIO_EMAIL_PROVIDER);\n}\n\nfunction isConsoleEmailAllowed() {\n  return String(process.env.CLIO_ALLOW_CONSOLE_EMAIL || \"\")\n    .trim()\n    .toLowerCase() === \"true\";\n}\n\nfunction getAppBaseUrl() {\n  const configured = String(process.env.CLIO_APP_BASE_URL || \"\").trim();\n  if (configured) {\n    return configured.replace(/\\/+$/, \"\");\n  }\n  return \"http://localhost:3000\";\n}\n\nfunction getLoginPath() {\n  const configured = String(process.env.CLIO_LOGIN_PATH || \"\").trim();\n  if (!configured) {\n    return \"/login\";\n  }\n  return configured.startsWith(\"/\") ? configured : `/${configured}`;\n}\n\nfunction getInviteVerifyPath() {\n  const configured = String(process.env.CLIO_INVITE_VERIFY_PATH || \"\").trim();\n  if (!configured) {\n    return \"/verify-invite\";\n  }\n  return configured.startsWith(\"/\") ? configured : `/${configured}`;\n}\n\nfunction buildLoginUrl() {\n  const baseUrl = getAppBaseUrl();\n  return `${baseUrl}${getLoginPath()}`;\n}\n\nfunction buildInviteVerificationUrl(inviteToken) {\n  const baseUrl = getAppBaseUrl();\n  const path = getInviteVerifyPath();\n  const token = String(inviteToken || \"\").trim();\n  if (!token) {\n    throw new Error(\"invalid_invite_token\");\n  }\n  return `${baseUrl}${path}?token=${encodeURIComponent(token)}`;\n}\n\nfunction isDevelopmentPreviewEnabled() {\n  return process.env.NODE_ENV !== \"production\";\n}\n\nfunction buildEmailContent({ role, invitedBy, verifyUrl, loginUrl, expiresAt }) {\n  const expirationDate = new Date(expiresAt);\n  const readableExpiration = Number.isNaN(expirationDate.getTime())\n    ? expiresAt\n    : expirationDate.toLocaleString(\"en-US\", {\n        month: \"short\",\n        day: \"2-digit\",\n        year: \"numeric\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n      });\n\n  const subject = \"You are invited to CLIO HRIS\";\n  const text = [\n    \"You were invited to access CLIO HRIS.\",\n    `Assigned role: ${role}`,\n    `Invited by: ${invitedBy}`,\n    `Verify your email: ${verifyUrl}`,\n    `Sign-in page: ${loginUrl}`,\n    `Invitation expires: ${readableExpiration}`,\n    \"\",\n    \"Step 1: Open the verification link and complete email verification.\",\n    \"Step 2: After verification, sign in using Google with the same invited work email.\",\n    \"Only invited accounts can access the workspace.\",\n  ].join(\"\\n\");\n\n  return {\n    subject,\n    text,\n    html: [\n      \"<p>You were invited to access <strong>CLIO HRIS</strong>.</p>\",\n      `<p><strong>Assigned role:</strong> ${role}<br/>`,\n      `<strong>Invited by:</strong> ${invitedBy}<br/>`,\n      `<strong>Invitation expires:</strong> ${readableExpiration}</p>`,\n      `<p><a href=\"${verifyUrl}\">Verify your email</a></p>`,\n      `<p><a href=\"${loginUrl}\">Open CLIO sign-in</a></p>`,\n      \"<p>After verification, sign in using Google with the same invited work email.</p>\",\n    ].join(\"\"),\n  };\n}\n\nfunction parseFirebaseAuthError(payload) {\n  const code = String(payload?.error?.message || \"\").trim();\n  if (!code) {\n    return \"email_delivery_failed\";\n  }\n  if (code === \"OPERATION_NOT_ALLOWED\") {\n    return \"firebase_email_provider_not_enabled\";\n  }\n  if (code === \"MISSING_CONTINUE_URI\" || code === \"INVALID_CONTINUE_URI\") {\n    return \"firebase_continue_url_invalid\";\n  }\n  if (code === \"INVALID_EMAIL\") {\n    return \"invalid_email\";\n  }\n  if (code === \"PROJECT_NOT_FOUND\" || code === \"API_KEY_INVALID\") {\n    return \"firebase_api_key_not_configured\";\n  }\n  return \"email_delivery_failed\";\n}\n\nasync function sendViaFirebaseAuth({ toEmail, verifyUrl }) {\n  const apiKey = String(process.env.NEXT_PUBLIC_FIREBASE_API_KEY || \"\").trim();\n  if (!apiKey) {\n    throw new Error(\"firebase_api_key_not_configured\");\n  }\n\n  const response = await fetch(`https://identitytoolkit.googleapis.com/v1/accounts:sendOobCode?key=${apiKey}`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({\n      requestType: \"EMAIL_SIGNIN\",\n      email: toEmail,\n      continueUrl: verifyUrl,\n      canHandleCodeInApp: true,\n    }),\n  });\n\n  const payload = await response.json().catch(() => ({}));\n  if (!response.ok) {\n    throw new Error(parseFirebaseAuthError(payload));\n  }\n\n  return {\n    provider: \"firebase\",\n    status: \"sent\",\n    messageId: `firebase-${Date.now()}`,\n  };\n}\n\nasync function sendViaResend({ toEmail, subject, html, text }) {\n  const apiKey = String(process.env.RESEND_API_KEY || \"\").trim();\n  const fromAddress = String(process.env.CLIO_EMAIL_FROM || \"\").trim();\n  if (!apiKey || !fromAddress || !apiKey.startsWith(\"re_\")) {\n    throw new Error(\"email_provider_not_configured\");\n  }\n\n  const response = await fetch(\"https://api.resend.com/emails\", {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: `Bearer ${apiKey}`,\n    },\n    body: JSON.stringify({\n      from: fromAddress,\n      to: [toEmail],\n      subject,\n      html,\n      text,\n    }),\n  });\n\n  if (!response.ok) {\n    const payload = await response.json().catch(() => ({}));\n    const providerMessage =\n      typeof payload?.message === \"string\"\n        ? payload.message\n        : typeof payload?.error?.message === \"string\"\n          ? payload.error.message\n          : \"\";\n    throw new Error(\n      providerMessage ? `email_delivery_failed:${providerMessage}` : \"email_delivery_failed\",\n    );\n  }\n\n  const payload = await response.json().catch(() => ({}));\n  return {\n    provider: \"resend\",\n    status: \"sent\",\n    messageId: typeof payload?.id === \"string\" ? payload.id : `resend-${Date.now()}`,\n  };\n}\n\nfunction sendViaConsole({ toEmail, subject, verifyUrl, loginUrl }) {\n  const messageId = `console-${Date.now()}`;\n  if (isDevelopmentPreviewEnabled()) {\n    console.info(\"[CLIO:InviteEmail]\", {\n      toEmail,\n      subject,\n      verifyUrl,\n      loginUrl,\n      messageId,\n    });\n  }\n\n  return {\n    provider: \"console\",\n    status: \"simulated\",\n    messageId,\n    previewUrl: verifyUrl,\n    loginUrl,\n  };\n}\n\nexport async function deliverInviteEmail({ toEmail, role, invitedBy, expiresAt, inviteToken }) {\n  const verifyUrl = buildInviteVerificationUrl(inviteToken);\n  const loginUrl = buildLoginUrl();\n  const content = buildEmailContent({\n    role,\n    invitedBy,\n    verifyUrl,\n    loginUrl,\n    expiresAt,\n  });\n  const provider = getEmailProvider();\n\n  if (provider === \"firebase\") {\n    return await sendViaFirebaseAuth({\n      toEmail,\n      verifyUrl,\n    });\n  }\n\n  if (provider === \"resend\") {\n    return await sendViaResend({\n      toEmail,\n      subject: content.subject,\n      html: content.html,\n      text: content.text,\n    });\n  }\n\n  if (provider === \"console\") {\n    if (!isConsoleEmailAllowed()) {\n      throw new Error(\"email_provider_not_configured\");\n    }\n\n    return sendViaConsole({\n      toEmail,\n      subject: content.subject,\n      verifyUrl,\n      loginUrl,\n    });\n  }\n\n  throw new Error(\"unsupported_email_provider\");\n}\n","import { NextResponse } from \"next/server\";\nimport { SESSION_COOKIE_NAME, verifySessionToken } from \"@/lib/auth-session\";\nimport { normalizeRole } from \"@/lib/hris\";\nimport { canAccessResource, hasPermission } from \"@/lib/rbac\";\nimport { recordAuditEvent } from \"@/lib/audit-log\";\nimport { getLoginAccount } from \"@/lib/user-accounts\";\n\nfunction deny(status, message) {\n  return { error: NextResponse.json({ message }, { status }) };\n}\n\nexport async function authorizeApiRequest(\n  request,\n  {\n    allowedRoles,\n    requiredPermissions = [],\n    ownerIdentifier,\n    ownerBypassRoles = [\"SUPER_ADMIN\"],\n    auditModule = \"Authorization\",\n    auditAction = \"API access check\",\n  } = {},\n) {\n  const token = request.cookies.get(SESSION_COOKIE_NAME)?.value;\n  const rawSession = verifySessionToken(token);\n\n  if (!rawSession) {\n    await recordAuditEvent({\n      activityName: `${auditAction} denied (no active session)`,\n      status: \"Failed\",\n      module: auditModule,\n      performedBy: \"anonymous@gmail.com\",\n      sensitivity: \"Sensitive\",\n      metadata: {\n        reason: \"unauthorized\",\n      },\n      request,\n    });\n\n    return deny(401, \"Unauthorized.\");\n  }\n\n  const session = {\n    ...rawSession,\n    role: normalizeRole(rawSession.role),\n  };\n\n  const account = await getLoginAccount(session.email).catch(() => null);\n  if (!account) {\n    await recordAuditEvent({\n      activityName: `${auditAction} denied (account not found)`,\n      status: \"Failed\",\n      module: auditModule,\n      performedBy: session.email,\n      sensitivity: \"Sensitive\",\n      metadata: {\n        reason: \"account_not_found\",\n      },\n      request,\n    });\n\n    return deny(401, \"Session is no longer valid. Please sign in again.\");\n  }\n\n  if (account.status !== \"active\") {\n    await recordAuditEvent({\n      activityName: `${auditAction} blocked by account status`,\n      status: \"Rejected\",\n      module: auditModule,\n      performedBy: session.email,\n      sensitivity: \"Sensitive\",\n      metadata: {\n        reason: \"account_not_active\",\n        accountStatus: account.status,\n      },\n      request,\n    });\n\n    return deny(403, \"Account is not active.\");\n  }\n\n  const accountRole = normalizeRole(account.role);\n  const accountSessionVersion = Number.parseInt(String(account.sessionVersion ?? \"\"), 10) || 1;\n  const allowsRoleContextSwitch = accountRole === \"SUPER_ADMIN\";\n  const roleMismatch = session.role !== accountRole;\n  const staleSessionVersion = session.sessionVersion !== accountSessionVersion;\n  if (staleSessionVersion || (roleMismatch && !allowsRoleContextSwitch)) {\n    await recordAuditEvent({\n      activityName: `${auditAction} denied (stale session)`,\n      status: \"Rejected\",\n      module: auditModule,\n      performedBy: session.email,\n      sensitivity: \"Sensitive\",\n      metadata: {\n        reason: staleSessionVersion ? \"session_version_mismatch\" : \"session_role_mismatch\",\n        tokenRole: session.role,\n        accountRole,\n        tokenSessionVersion: session.sessionVersion,\n        accountSessionVersion,\n      },\n      request,\n    });\n\n    return deny(401, \"Session expired. Please sign in again.\");\n  }\n\n  if (Array.isArray(allowedRoles) && allowedRoles.length > 0 && !allowedRoles.includes(session.role)) {\n    await recordAuditEvent({\n      activityName: `${auditAction} blocked by role policy`,\n      status: \"Rejected\",\n      module: auditModule,\n      performedBy: session.email,\n      sensitivity: \"Sensitive\",\n      metadata: {\n        role: session.role,\n        allowedRoles,\n        reason: \"role_not_allowed\",\n      },\n      request,\n    });\n\n    return deny(403, \"Forbidden.\");\n  }\n\n  if (requiredPermissions.length > 0) {\n    const hasAllPermissions = requiredPermissions.every((permission) =>\n      hasPermission(session.role, permission),\n    );\n\n    if (!hasAllPermissions) {\n      await recordAuditEvent({\n        activityName: `${auditAction} blocked by permission policy`,\n        status: \"Rejected\",\n        module: auditModule,\n        performedBy: session.email,\n        sensitivity: \"Sensitive\",\n        metadata: {\n          role: session.role,\n          requiredPermissions,\n          reason: \"missing_permission\",\n        },\n        request,\n      });\n\n      return deny(403, \"Forbidden.\");\n    }\n  }\n\n  if (ownerIdentifier) {\n    const actorEmail = session.email;\n    const ownerEmail = typeof ownerIdentifier === \"function\" ? await ownerIdentifier(session) : ownerIdentifier;\n\n    if (\n      !canAccessResource({\n        role: session.role,\n        actorIdentifier: actorEmail,\n        ownerIdentifier: ownerEmail,\n        allowRoles: ownerBypassRoles,\n      })\n    ) {\n      await recordAuditEvent({\n        activityName: `${auditAction} blocked by ownership policy`,\n        status: \"Rejected\",\n        module: auditModule,\n        performedBy: session.email,\n        sensitivity: \"Sensitive\",\n        metadata: {\n          role: session.role,\n          ownerIdentifier: ownerEmail,\n          reason: \"ownership_validation_failed\",\n        },\n        request,\n      });\n\n      return deny(403, \"Forbidden.\");\n    }\n  }\n\n  return { session };\n}\n\r\n","import { MODULE_ACCESS } from \"@/features/hris/constants\";\nimport { normalizeRole } from \"@/lib/hris\";\n\nconst ROLE_PERMISSIONS = {\n  SUPER_ADMIN: [\"*\"],\n  GRC: [\n    \"dashboard:view\",\n    \"employees:view\",\n    \"employees:edit\",\n    \"employees:view:sensitive\",\n    \"lifecycle:view\",\n    \"lifecycle:edit\",\n    \"lifecycle:approve\",\n    \"attendance:view\",\n    \"attendance:edit\",\n    \"attendance:approve\",\n    \"performance:view\",\n    \"performance:edit\",\n    \"performance:approve\",\n    \"templates:view\",\n    \"templates:edit\",\n    \"exports:view\",\n    \"exports:manage\",\n    \"exports:approve\",\n    \"exports:request\",\n    \"activity_log:export\",\n    \"activity_log:view\",\n    \"audit:view\",\n    \"access_management:view\",\n    \"retention_archive:view\",\n    \"retention_archive:manage\",\n    \"incident_management:view\",\n    \"incident_management:edit\",\n    \"settings:view\",\n    \"audit:write:nonsensitive\",\n    \"auth:logout\",\n    \"resource:own\",\n  ],\n  HR: [\n    \"dashboard:view\",\n    \"employees:view\",\n    \"employees:edit\",\n    \"employees:view:sensitive\",\n    \"lifecycle:view\",\n    \"lifecycle:edit\",\n    \"lifecycle:approve\",\n    \"attendance:view\",\n    \"attendance:edit\",\n    \"attendance:approve\",\n    \"performance:view\",\n    \"performance:edit\",\n    \"performance:approve\",\n    \"templates:view\",\n    \"templates:edit\",\n    \"exports:view\",\n    \"exports:manage\",\n    \"exports:approve\",\n    \"exports:request\",\n    \"activity_log:export\",\n    \"settings:view\",\n    \"audit:write:nonsensitive\",\n    \"auth:logout\",\n    \"resource:own\",\n  ],\n  EA: [\n    \"dashboard:view\",\n    \"employees:view\",\n    \"employees:edit\",\n    \"employees:view:sensitive\",\n    \"lifecycle:view\",\n    \"lifecycle:edit\",\n    \"lifecycle:approve\",\n    \"attendance:view\",\n    \"attendance:edit\",\n    \"attendance:approve\",\n    \"performance:view\",\n    \"performance:edit\",\n    \"performance:approve\",\n    \"templates:view\",\n    \"templates:edit\",\n    \"exports:view\",\n    \"exports:manage\",\n    \"exports:approve\",\n    \"exports:request\",\n    \"activity_log:export\",\n    \"settings:view\",\n    \"audit:write:nonsensitive\",\n    \"auth:logout\",\n    \"resource:own\",\n  ],\n  EMPLOYEE_L1: [\n    \"dashboard:view\",\n    \"employees:view\",\n    \"employees:edit:self\",\n    \"attendance:view\",\n    \"attendance:edit:self\",\n    \"performance:view\",\n    \"templates:view\",\n    \"requests:view\",\n    \"requests:create:self\",\n    \"exports:request:self\",\n    \"audit:write:nonsensitive\",\n    \"auth:logout\",\n    \"resource:own\",\n  ],\n  EMPLOYEE_L2: [\n    \"dashboard:view\",\n    \"employees:view\",\n    \"employees:edit:self\",\n    \"attendance:view\",\n    \"attendance:edit:self\",\n    \"performance:view\",\n    \"templates:view\",\n    \"requests:view\",\n    \"requests:create:self\",\n    \"exports:request:self\",\n    \"audit:write:nonsensitive\",\n    \"auth:logout\",\n    \"resource:own\",\n  ],\n  EMPLOYEE_L3: [\n    \"dashboard:view\",\n    \"employees:view\",\n    \"employees:edit:self\",\n    \"attendance:view\",\n    \"attendance:edit:self\",\n    \"performance:view\",\n    \"templates:view\",\n    \"requests:view\",\n    \"requests:create:self\",\n    \"exports:request:self\",\n    \"audit:write:nonsensitive\",\n    \"auth:logout\",\n    \"resource:own\",\n  ],\n};\n\nconst MODULE_REQUIRED_PERMISSION = {\n  dashboard: \"dashboard:view\",\n  employees: \"employees:view\",\n  \"employment-lifecycle\": \"lifecycle:view\",\n  attendance: \"attendance:view\",\n  performance: \"performance:view\",\n  \"activity-log\": \"activity_log:view\",\n  exports: \"exports:view\",\n  documents: \"templates:view\",\n  \"access-management\": \"access_management:view\",\n  \"retention-archive\": \"retention_archive:view\",\n  \"incident-management\": \"incident_management:view\",\n  requests: \"requests:view\",\n  settings: \"settings:view\",\n  \"user-management\": \"user_management:view\",\n};\n\nconst DEFAULT_ROLE_EMAILS = {\n  SUPER_ADMIN: [],\n  HR: [],\n  GRC: [],\n  EA: [],\n  EMPLOYEE_L1: [],\n  EMPLOYEE_L2: [],\n  EMPLOYEE_L3: [],\n};\n\nfunction parseEnvEmailList(rawValue, fallbackValues = []) {\n  if (typeof rawValue !== \"string\") {\n    return new Set(fallbackValues.map((value) => value.trim().toLowerCase()).filter(Boolean));\n  }\n\n  if (rawValue.trim().length === 0) {\n    return new Set(fallbackValues.map((value) => value.trim().toLowerCase()).filter(Boolean));\n  }\n\n  return new Set(\n    rawValue\n      .split(\",\")\n      .map((item) => item.trim().toLowerCase())\n      .filter(Boolean),\n  );\n}\n\nexport function getPermissionsForRole(role) {\n  const normalized = normalizeRole(role);\n  return ROLE_PERMISSIONS[normalized] ?? [];\n}\n\nexport function hasPermission(role, permission) {\n  const permissions = getPermissionsForRole(role);\n  return permissions.includes(\"*\") || permissions.includes(permission);\n}\n\nexport function canAccessModule(role, moduleId) {\n  const normalized = normalizeRole(role);\n  const allowedModules = new Set(MODULE_ACCESS[normalized] ?? []);\n\n  if (!allowedModules.has(moduleId)) {\n    return false;\n  }\n\n  const requiredPermission = MODULE_REQUIRED_PERMISSION[moduleId];\n  if (!requiredPermission) {\n    return true;\n  }\n\n  return hasPermission(normalized, requiredPermission);\n}\n\nexport function canAccessResource({\n  role,\n  actorIdentifier,\n  ownerIdentifier,\n  allowRoles = [\"SUPER_ADMIN\"],\n}) {\n  const normalized = normalizeRole(role);\n  if (allowRoles.includes(normalized)) {\n    return true;\n  }\n\n  if (!hasPermission(normalized, \"resource:own\")) {\n    return false;\n  }\n\n  const actor = String(actorIdentifier || \"\").trim().toLowerCase();\n  const owner = String(ownerIdentifier || \"\").trim().toLowerCase();\n  if (!actor || !owner) {\n    return false;\n  }\n\n  return actor === owner;\n}\n\nexport function resolveRoleForEmail(email) {\n  const normalizedEmail = String(email || \"\").trim().toLowerCase();\n  if (!normalizedEmail) {\n    return null;\n  }\n\n  const explicitRoleMap = {\n    SUPER_ADMIN: parseEnvEmailList(process.env.SUPER_ADMIN_EMAILS, DEFAULT_ROLE_EMAILS.SUPER_ADMIN),\n    HR: parseEnvEmailList(process.env.HR_EMAILS, DEFAULT_ROLE_EMAILS.HR),\n    GRC: parseEnvEmailList(process.env.GRC_EMAILS, DEFAULT_ROLE_EMAILS.GRC),\n    EA: parseEnvEmailList(process.env.EA_EMAILS, DEFAULT_ROLE_EMAILS.EA),\n    EMPLOYEE_L1: parseEnvEmailList(process.env.EMPLOYEE_L1_EMAILS, DEFAULT_ROLE_EMAILS.EMPLOYEE_L1),\n    EMPLOYEE_L2: parseEnvEmailList(process.env.EMPLOYEE_L2_EMAILS, DEFAULT_ROLE_EMAILS.EMPLOYEE_L2),\n    EMPLOYEE_L3: parseEnvEmailList(process.env.EMPLOYEE_L3_EMAILS, DEFAULT_ROLE_EMAILS.EMPLOYEE_L3),\n  };\n\n  for (const role of [\"SUPER_ADMIN\", \"HR\", \"GRC\", \"EA\", \"EMPLOYEE_L1\", \"EMPLOYEE_L2\", \"EMPLOYEE_L3\"]) {\n    if (explicitRoleMap[role].has(normalizedEmail)) {\n      return role;\n    }\n  }\n\n  return null;\n}\n\nexport function getModuleIdFromPathname(pathname) {\n  const path = String(pathname || \"\")\n    .trim()\n    .replace(/^\\/+|\\/+$/g, \"\");\n\n  if (!path) {\n    return \"dashboard\";\n  }\n\n  const firstSegment = path.split(\"/\")[0];\n  return MODULE_REQUIRED_PERMISSION[firstSegment] ? firstSegment : null;\n}\n","function normalizeNamePart(value) {\n  return String(value ?? \"\").trim();\n}\n\nfunction capitalizeWord(word) {\n  const value = normalizeNamePart(word).toLowerCase();\n  if (!value) {\n    return \"\";\n  }\n  return `${value.charAt(0).toUpperCase()}${value.slice(1)}`;\n}\n\nexport function formatNameFromEmail(email, { fallbackLabel = \"User\", maxTokens = 3 } = {}) {\n  const normalizedEmail = normalizeNamePart(email).toLowerCase();\n  const safeFallback = normalizeNamePart(fallbackLabel) || \"User\";\n  if (!normalizedEmail.includes(\"@\")) {\n    return safeFallback;\n  }\n\n  const localPart = normalizedEmail.split(\"@\")[0] || \"\";\n  const tokens = localPart\n    .split(/[._-]+/g)\n    .map((item) => capitalizeWord(item))\n    .filter(Boolean)\n    .slice(0, Math.max(1, Number.isFinite(maxTokens) ? maxTokens : 3));\n\n  if (tokens.length === 0) {\n    return safeFallback;\n  }\n\n  return tokens.join(\" \");\n}\n\nfunction formatNameBody({ firstName, middleName, lastName, order }) {\n  const normalizedFirstName = normalizeNamePart(firstName);\n  const normalizedMiddleName = normalizeNamePart(middleName);\n  const normalizedLastName = normalizeNamePart(lastName);\n\n  if (order === \"last-first\") {\n    const firstBlock = [normalizedFirstName, normalizedMiddleName].filter(Boolean).join(\" \");\n    if (normalizedLastName) {\n      return `${normalizedLastName}${firstBlock ? `, ${firstBlock}` : \"\"}`;\n    }\n    return firstBlock;\n  }\n\n  return [normalizedFirstName, normalizedMiddleName, normalizedLastName].filter(Boolean).join(\" \");\n}\n\nfunction resolveFallbackName({ fallback, fallbackEmail, fallbackLabel }) {\n  const directFallback = normalizeNamePart(fallback);\n  if (directFallback) {\n    return directFallback;\n  }\n\n  const email = normalizeNamePart(fallbackEmail);\n  if (email) {\n    return formatNameFromEmail(email, { fallbackLabel });\n  }\n\n  return normalizeNamePart(fallbackLabel) || \"User\";\n}\n\nexport function formatPersonName({\n  firstName,\n  middleName,\n  lastName,\n  suffix,\n  fallback = \"\",\n  fallbackEmail = \"\",\n  fallbackLabel = \"User\",\n} = {}) {\n  const body = formatNameBody({\n    firstName,\n    middleName,\n    lastName,\n    order: \"first-last\",\n  });\n  const normalizedSuffix = normalizeNamePart(suffix);\n  const fullName = [body, normalizedSuffix].filter(Boolean).join(\" \").trim();\n  if (fullName) {\n    return fullName;\n  }\n\n  return resolveFallbackName({\n    fallback,\n    fallbackEmail,\n    fallbackLabel,\n  });\n}\n\nexport function formatEmployeeName({\n  firstName,\n  middleName,\n  lastName,\n  suffix,\n  fallback = \"\",\n  fallbackEmail = \"\",\n  fallbackLabel = \"Employee\",\n} = {}) {\n  const body = formatNameBody({\n    firstName,\n    middleName,\n    lastName,\n    order: \"last-first\",\n  });\n  const normalizedSuffix = normalizeNamePart(suffix);\n  const fullName = [body, normalizedSuffix].filter(Boolean).join(\" \").trim();\n  if (fullName) {\n    return fullName;\n  }\n\n  return resolveFallbackName({\n    fallback,\n    fallbackEmail,\n    fallbackLabel,\n  });\n}\n"],"names":[],"mappings":"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"}