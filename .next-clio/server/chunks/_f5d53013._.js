module.exports=[91387,e=>{"use strict";var t=e.i(45709),a=e.i(44801);let r=[],i=0;function n(e){let t=String(e||"").trim().toLowerCase();return t&&t.includes("@")?t:""}async function o(){let e=Date.now();if(e-i<3e4&&Array.isArray(r))return r;let a=await (0,t.listUserAccounts)();return r=Array.isArray(a)?a:[],i=e,r}async function l(e=[]){let t=function(e=[]){let t=new Set;return e.forEach(e=>{let a=n(e);a&&t.add(a)}),t}(e),r=0===t.size,i=new Map;try{(await o()).forEach(e=>{let o=n(e?.email);o&&(r||t.has(o))&&i.set(o,{email:o,name:(0,a.formatPersonName)({firstName:e?.firstName,middleName:e?.middleName,lastName:e?.lastName,fallbackEmail:o,fallbackLabel:"User"}),avatarUrl:"string"==typeof e?.profilePhotoDataUrl?e.profilePhotoDataUrl:null})})}catch{}return t.forEach(e=>{i.has(e)||i.set(e,{email:e,name:(0,a.formatNameFromEmail)(e),avatarUrl:null})}),i}function s(e,t){let r=n(t);if(r&&e instanceof Map){let t=e.get(r);if(t)return t}if(r)return{email:r,name:(0,a.formatNameFromEmail)(r),avatarUrl:null};let i=String(t||"").trim();return i?{email:i,name:i,avatarUrl:null}:{email:"",name:"System",avatarUrl:null}}function d(e,t,{actorKey:a="by"}={}){return Array.isArray(e)?e.map(e=>{let r=s(t,e?.[a]);return{...e,[`${a}Name`]:r.name,[`${a}Email`]:r.email||String(e?.[a]||""),[`${a}Avatar`]:r.avatarUrl}}):[]}function c(e,t="by"){return Array.isArray(e)?e.map(e=>e?.[t]).filter(Boolean):[]}function u(e){if(!e||"object"!=typeof e)return[];let t=[e.createdBy,e.updatedBy];return Array.isArray(e.activityHistory)&&e.activityHistory.forEach(e=>{t.push(e?.by)}),Array.isArray(e.documents)&&e.documents.forEach(e=>{t.push(e?.uploadedBy)}),t.filter(Boolean)}function m(e,t){if(!e||"object"!=typeof e)return e;let a=s(t,e.createdBy),r=s(t,e.updatedBy),i=Array.isArray(e.activityHistory)?e.activityHistory.map(e=>{let a=s(t,e?.by);return{...e,byName:a.name,byEmail:a.email||String(e?.by||""),byAvatar:a.avatarUrl}}):[],n=Array.isArray(e.documents)?e.documents.map(e=>{let a=s(t,e?.uploadedBy);return{...e,uploadedByName:a.name,uploadedByEmail:a.email||String(e?.uploadedBy||""),uploadedByAvatar:a.avatarUrl}}):[];return{...e,createdByName:a.name,createdByEmail:a.email||String(e.createdBy||""),createdByAvatar:a.avatarUrl,updatedByName:r.name,updatedByEmail:r.email||String(e.updatedBy||""),updatedByAvatar:r.avatarUrl,activityHistory:i,documents:n}}function p(e){if(!e||"object"!=typeof e)return[];let t=[e.createdBy,e.updatedBy];return Array.isArray(e.versionHistory)&&e.versionHistory.forEach(e=>{t.push(e?.changedBy)}),Array.isArray(e.modificationLog)&&e.modificationLog.forEach(e=>{t.push(e?.by)}),Array.isArray(e.usageLogs)&&e.usageLogs.forEach(e=>{t.push(e?.by,e?.uploadedBy,e?.performedBy)}),t.filter(Boolean)}function y(e,t){if(!e||"object"!=typeof e)return e;let a=s(t,e.createdBy),r=s(t,e.updatedBy),i=Array.isArray(e.versionHistory)?e.versionHistory.map(e=>{let a=s(t,e?.changedBy);return{...e,changedByName:a.name,changedByEmail:a.email||String(e?.changedBy||""),changedByAvatar:a.avatarUrl}}):[],n=Array.isArray(e.modificationLog)?e.modificationLog.map(e=>{let a=s(t,e?.by);return{...e,byName:a.name,byEmail:a.email||String(e?.by||""),byAvatar:a.avatarUrl}}):[];return{...e,createdByName:a.name,createdByEmail:a.email||String(e.createdBy||""),createdByAvatar:a.avatarUrl,updatedByName:r.name,updatedByEmail:r.email||String(e.updatedBy||""),updatedByAvatar:r.avatarUrl,versionHistory:i,modificationLog:n}}e.s(["collectEmailsFromTrail",()=>c,"collectEmployeeActorValues",()=>u,"collectTemplateActorValues",()=>p,"createActorDirectory",()=>l,"enrichEmployeeRecordActors",()=>m,"enrichTemplateRecordActors",()=>y,"enrichTrailActors",()=>d,"resolveActor",()=>s])},13433,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),i=e.i(59756),n=e.i(61916),o=e.i(74677),l=e.i(69741),s=e.i(16795),d=e.i(87718),c=e.i(95169),u=e.i(47587),m=e.i(66012),p=e.i(70101),y=e.i(26937),f=e.i(10372),h=e.i(93695);e.i(52474);var A=e.i(220),v=e.i(89171),g=e.i(98189),E=e.i(91387),R=e.i(45787),w=e.i(79120);let B=new Set(["date","checkIn","checkOut","status","reason","employee"]);function N(e){let t=String(e||"").trim();if(!t)return null;let a=new Date(t);return Number.isNaN(a.getTime())?null:a}async function b(e){let t=await (0,g.authorizeApiRequest)(e,{requiredPermissions:["attendance:view"],auditModule:"Attendance Management",auditAction:"Attendance records list request"});if(t.error)return t.error;let{session:a}=t;try{let t=e.nextUrl?.searchParams.get("employeeEmail"),r=(0,w.getSelfRestrictedOwnerEmail)({session:a,requestedOwnerEmail:t}),i=String(e.nextUrl?.searchParams.get("status")||"").trim().toLowerCase(),n=N(e.nextUrl?.searchParams.get("dateFrom")),o=N(e.nextUrl?.searchParams.get("dateTo")),l=(await (0,R.listAttendanceLogsBackend)({ownerEmail:r||void 0})).filter(e=>{let t=String(e.status||"").trim().toLowerCase(),a=N(e.date||e.createdAt),r=!i||t.includes(i),l=!n||a&&a.getTime()>=n.getTime(),s=!o||a&&a.getTime()<=o.getTime();return r&&l&&s}),s=[];l.forEach(e=>{s.push(e.createdBy,e.updatedBy,e.approver),s.push(...(0,E.collectEmailsFromTrail)(e.modificationTrail,"by"))});let d=await (0,E.createActorDirectory)(s),c=l.map(e=>{let t=(0,E.resolveActor)(d,e.createdBy),a=(0,E.resolveActor)(d,e.updatedBy),r=(0,E.resolveActor)(d,e.approver);return{...e,createdByName:t.name,createdByEmail:t.email||String(e.createdBy||""),createdByAvatar:t.avatarUrl,updatedByName:a.name,updatedByEmail:a.email||String(e.updatedBy||""),updatedByAvatar:a.avatarUrl,approverName:r.name,approverEmail:r.email||String(e.approver||""),approverAvatar:r.avatarUrl,modificationTrail:(0,E.enrichTrailActors)(e.modificationTrail,d,{actorKey:"by"})}});return await (0,w.logApiAudit)({request:e,module:"Attendance Management",activityName:"Attendance records listed",status:"Completed",sensitivity:"Sensitive",performedBy:a.email,metadata:{resultCount:c.length,ownerFilterApplied:!!r,hasStatusFilter:!!i,hasDateRangeFilter:!!(n||o),viewedRecordRefs:c.slice(0,25).map(e=>({recordId:e.id,recordRef:(0,w.resolveAuditRecordRef)(e,e.id,["employeeId","id"]),employeeEmail:e.employeeEmail||"",date:e.date||"",status:e.status||""})),auditNote:`Listed ${c.length} attendance record(s) in the current query window.`,nextAction:"No further action required."}}),v.NextResponse.json({records:c})}catch(i){let t=i instanceof Error?i.message:"unknown_error",r=(0,w.mapBackendError)(t,"Unable to load attendance records.");return await (0,w.logApiAudit)({request:e,module:"Attendance Management",activityName:"Attendance records list failed",status:"Failed",sensitivity:"Sensitive",performedBy:a.email,metadata:{reason:t}}),v.NextResponse.json({message:r.message},{status:r.status})}}async function S(e){let t=await (0,g.authorizeApiRequest)(e,{requiredPermissions:["attendance:view"],auditModule:"Attendance Management",auditAction:"Attendance log create request"});if(t.error)return t.error;let{session:a}=t;try{let t=await (0,w.parseJsonBody)(e),r=(0,w.normalizeEmail)(t.employeeEmail||a.email),i=(0,w.normalizeEmail)(a.email),n=r===i;if(!(0,w.canActorEditModule)({role:a.role,editPermission:"attendance:edit",selfEditPermission:"attendance:edit:self",isSelfResource:n}))return await (0,w.logApiAudit)({request:e,module:"Attendance Management",activityName:"Attendance log create blocked by permission policy",status:"Rejected",sensitivity:"Sensitive",performedBy:a.email,metadata:{role:a.role,targetEmployeeEmail:r||null}}),v.NextResponse.json({message:"Forbidden."},{status:403});let o=(0,w.canActorEditModule)({role:a.role,editPermission:"attendance:edit",isSelfResource:!1}),l=o?t:t&&"object"==typeof t?Object.entries(t).reduce((e,[t,a])=>(B.has(t)&&(e[t]=a),e),{}):{};if(!o&&0===Object.keys(l).length)return v.NextResponse.json({message:"No allowed attendance fields to update."},{status:400});l.employeeEmail=o?r:i,l.employee||o||(l.employee=a.email);let s=await (0,R.createAttendanceLogBackend)(l,a.email);return await (0,w.logApiAudit)({request:e,module:"Attendance Management",activityName:"Attendance log created",status:"Approved",sensitivity:"Sensitive",performedBy:a.email,metadata:{recordId:s.id,recordRef:(0,w.resolveAuditRecordRef)(s,s.id,["employeeId","id"]),employeeEmail:s.employeeEmail,resourceType:"Attendance Record",resourceLabel:`${s.employee||s.employeeEmail||"Employee"} ${s.date?`- ${s.date}`:""}`.trim(),selfService:!o,changedFields:Object.keys(l||{}),changedFieldCount:Object.keys(l||{}).length,auditNote:`Created attendance record with fields: ${(0,w.summarizeAuditFieldList)(Object.keys(l||{}),"No explicit payload fields captured.")}.`,nextAction:"No further action required."}}),v.NextResponse.json({ok:!0,record:s},{status:201})}catch(i){let t=i instanceof Error?i.message:"unknown_error",r=(0,w.mapBackendError)(t,"Unable to create attendance log.");return await (0,w.logApiAudit)({request:e,module:"Attendance Management",activityName:"Attendance log create failed",status:"Failed",sensitivity:"Sensitive",performedBy:a.email,metadata:{reason:t}}),v.NextResponse.json({message:r.message},{status:r.status})}}e.s(["GET",()=>b,"POST",()=>S],65294);var x=e.i(65294);let U=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/hris/attendance/route",pathname:"/api/hris/attendance",filename:"route",bundlePath:""},distDir:".next-clio",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/hris/attendance/route.js",nextConfigOutput:"",userland:x}),{workAsyncStorage:C,workUnitAsyncStorage:T,serverHooks:P}=U;function k(){return(0,r.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:T})}async function O(e,t,r){U.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/hris/attendance/route";v=v.replace(/\/index$/,"")||"/";let g=await U.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!g)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:E,params:R,nextConfig:w,parsedUrl:B,isDraftMode:N,prerenderManifest:b,routerServerContext:S,isOnDemandRevalidate:x,revalidateOnlyGenerated:C,resolvedPathname:T,clientReferenceManifest:P,serverActionsManifest:k}=g,O=(0,l.normalizeAppPath)(v),_=!!(b.dynamicRoutes[O]||b.routes[T]),j=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,B,!1):t.end("This page could not be found"),null);if(_&&!N){let e=!!b.routes[T],t=b.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await j();throw new h.NoFallbackError}}let H=null;!_||U.isDev||N||(H="/index"===(H=T)?"/":H);let M=!0===U.isDev||!_,q=_&&!M;k&&P&&(0,o.setManifestsSingleton)({page:v,clientReferenceManifest:P,serverActionsManifest:k});let F=e.method||"GET",D=(0,n.getTracer)(),I=D.getActiveScopeSpan(),L={params:R,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,i)=>U.onRequestError(e,t,r,i,S)},sharedContext:{buildId:E}},$=new s.NodeNextRequest(e),K=new s.NodeNextResponse(t),z=d.NextRequestAdapter.fromNodeNextRequest($,(0,d.signalFromNodeResponse)(t));try{let o=async e=>U.handle(z,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=D.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${F} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${v}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),s=async i=>{var n,s;let d=async({previousCacheEntry:a})=>{try{if(!l&&x&&C&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(i);e.fetchMetrics=L.renderOpts.fetchMetrics;let s=L.renderOpts.pendingWaitUntil;s&&r.waitUntil&&(r.waitUntil(s),s=void 0);let d=L.renderOpts.collectedTags;if(!_)return await (0,m.sendResponse)($,K,n,L.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[f.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,r=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:A.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await U.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:x})},!1,S),t}},c=await U.handleResponse({req:e,nextConfig:w,cacheKey:H,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:x,revalidateOnlyGenerated:C,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:l});if(!_)return null;if((null==c||null==(n=c.value)?void 0:n.kind)!==A.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(s=c.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",x?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,p.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&_||h.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,y.getCacheControlHeader)(c.cacheControl)),await (0,m.sendResponse)($,K,new Response(c.value.body,{headers:h,status:c.value.status||200})),null};I?await s(I):await D.withPropagatedContext(e.headers,()=>D.trace(c.BaseServerSpan.handleRequest,{spanName:`${F} ${v}`,kind:n.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},s))}catch(t){if(t instanceof h.NoFallbackError||await U.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:x})},!1,S),_)throw t;return await (0,m.sendResponse)($,K,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>k,"routeModule",()=>U,"serverHooks",()=>P,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>T],13433)},11072,e=>{e.v(t=>Promise.all(["server/chunks/src_lib_security-notifications_5f07320b.js","server/chunks/src_lib_security-detection_4bdbe3ad.js"].map(t=>e.l(t))).then(()=>t(74405)))}];

//# sourceMappingURL=_f5d53013._.js.map