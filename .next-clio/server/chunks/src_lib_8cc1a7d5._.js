module.exports=[35110,e=>{"use strict";function t(){let e=String(process.env.CLIO_APP_BASE_URL||"").trim();return e?e.replace(/\/+$/,""):"http://localhost:3000"}async function r({toEmail:e,verifyUrl:t}){let r=String("AIzaSyC-mWz29cK_wjvDsjhgbwYLAuJeygPohOI").trim();if(!r)throw Error("firebase_api_key_not_configured");let i=await fetch(`https://identitytoolkit.googleapis.com/v1/accounts:sendOobCode?key=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requestType:"EMAIL_SIGNIN",email:e,continueUrl:t,canHandleCodeInApp:!0})}),n=await i.json().catch(()=>({}));if(!i.ok){let e;throw Error((e=String(n?.error?.message||"").trim())?"OPERATION_NOT_ALLOWED"===e?"firebase_email_provider_not_enabled":"MISSING_CONTINUE_URI"===e||"INVALID_CONTINUE_URI"===e?"firebase_continue_url_invalid":"INVALID_EMAIL"===e?"invalid_email":"PROJECT_NOT_FOUND"===e||"API_KEY_INVALID"===e?"firebase_api_key_not_configured":"email_delivery_failed":"email_delivery_failed")}return{provider:"firebase",status:"sent",messageId:`firebase-${Date.now()}`}}async function i({toEmail:e,subject:t,html:r,text:i}){let n=String(process.env.RESEND_API_KEY||"").trim(),o=String(process.env.CLIO_EMAIL_FROM||"").trim();if(!n||!o||!n.startsWith("re_"))throw Error("email_provider_not_configured");let a=await fetch("https://api.resend.com/emails",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({from:o,to:[e],subject:t,html:r,text:i})});if(!a.ok){let e=await a.json().catch(()=>({})),t="string"==typeof e?.message?e.message:"string"==typeof e?.error?.message?e.error.message:"";throw Error(t?`email_delivery_failed:${t}`:"email_delivery_failed")}let s=await a.json().catch(()=>({}));return{provider:"resend",status:"sent",messageId:"string"==typeof s?.id?s.id:`resend-${Date.now()}`}}async function n({toEmail:e,role:n,invitedBy:o,expiresAt:a,inviteToken:s}){let c,l,u,d=function(e){let r,i=t(),n=(r=String(process.env.CLIO_INVITE_VERIFY_PATH||"").trim())?r.startsWith("/")?r:`/${r}`:"/verify-invite",o=String(e||"").trim();if(!o)throw Error("invalid_invite_token");return`${i}${n}?token=${encodeURIComponent(o)}`}(s),f=(l=t(),`${l}${!(u=String(process.env.CLIO_LOGIN_PATH||"").trim())?"/login":u.startsWith("/")?u:`/${u}`}`),p=function({role:e,invitedBy:t,verifyUrl:r,loginUrl:i,expiresAt:n}){let o=new Date(n),a=Number.isNaN(o.getTime())?n:o.toLocaleString("en-US",{month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return{subject:"You are invited to CLIO HRIS",text:`You were invited to access CLIO HRIS.
Assigned role: ${e}
Invited by: ${t}
Verify your email: ${r}
Sign-in page: ${i}
Invitation expires: ${a}

Step 1: Open the verification link and complete email verification.
Step 2: After verification, sign in using Google with the same invited work email.
Only invited accounts can access the workspace.`,html:`<p>You were invited to access <strong>CLIO HRIS</strong>.</p><p><strong>Assigned role:</strong> ${e}<br/><strong>Invited by:</strong> ${t}<br/><strong>Invitation expires:</strong> ${a}</p><p><a href="${r}">Verify your email</a></p><p><a href="${i}">Open CLIO sign-in</a></p><p>After verification, sign in using Google with the same invited work email.</p>`}}({role:n,invitedBy:o,verifyUrl:d,loginUrl:f,expiresAt:a}),m=!(c=String(process.env.CLIO_EMAIL_PROVIDER||"").trim().toLowerCase())||"firebase"===c||c.includes("firebase")?"firebase":"resend"===c||c.includes("resend")?"resend":"console"===c||"dev"===c||c.includes("console")?"console":c;if("firebase"===m)return await r({toEmail:e,verifyUrl:d});if("resend"===m)return await i({toEmail:e,subject:p.subject,html:p.html,text:p.text});if("console"===m){if("true"!==String(process.env.CLIO_ALLOW_CONSOLE_EMAIL||"").trim().toLowerCase())throw Error("email_provider_not_configured");return function({toEmail:e,subject:t,verifyUrl:r,loginUrl:i}){return{provider:"console",status:"simulated",messageId:`console-${Date.now()}`,previewUrl:r,loginUrl:i}}({toEmail:e,subject:p.subject,verifyUrl:d,loginUrl:f})}throw Error("unsupported_email_provider")}e.s(["deliverInviteEmail",()=>n])},33355,e=>{"use strict";e.i(18097);var t=e.i(19e3),r=e.i(67658),i=e.i(45709);function n(){return new Date().toISOString()}function o(e,t=""){return String(e||"").trim()||t}function a(e,t=!1){if("boolean"==typeof e)return e;if("number"==typeof e)return 0!==e;if("string"==typeof e){let r=e.trim().toLowerCase();if(!r)return t;if(["true","1","yes","on","y"].includes(r))return!0;if(["false","0","no","off","n"].includes(r))return!1}return t}function s(e){return Array.isArray(e)?e:[]}function c(e,t,{min:r=1,max:i=Number.MAX_SAFE_INTEGER}={}){let n=Number.parseInt(String(e||""),10);return Number.isFinite(n)?Math.min(i,Math.max(r,n)):t}function l(e){return String(e||"").trim().toLowerCase()}function u(e){return String(e||"").split(",").map(e=>l(e)).filter(Boolean)}function d(e){return"read"===String(e||"").trim().toLowerCase()?"read":"unread"}function f(){return o(process.env.CLIO_FIRESTORE_NOTIFICATIONS_COLLECTION,"clio_notifications")}function p(){return(0,r.isFirestoreEnabled)()?(0,r.getFirestoreDb)():null}function m(e){return{...e.data()||{},id:e.id,recordId:e.id}}function _(e,t){let r=l(t),i=l(e?.recipientEmail);return a(e?.broadcast,!1)||r&&i&&r===i}function g(e,t){return new Date(t?.createdAt||0).getTime()-new Date(e?.createdAt||0).getTime()}async function I(e){let r=p();if(!r)return null;let i=function(e){var t;let r,i=n(),s=l(e?.recipientEmail),c=a(e?.broadcast,!1);if(!s&&!c)throw Error("invalid_notification_recipient");return{title:o(e?.title,"Security notification"),message:o(e?.message,"A security event requires review."),severity:"critical"===(r=String(e?.severity||"").trim().toLowerCase())?"critical":"high"===r?"high":"low"===r?"low":"medium",type:o(e?.type,"security"),module:o(e?.module,"Incident Management"),actionUrl:o(e?.actionUrl,"/incident-management"),recipientEmail:s,broadcast:c,status:d(e?.status),metadata:(t=e?.metadata)&&"object"==typeof t&&!Array.isArray(t)?t:{},createdAt:o(e?.createdAt,i),updatedAt:o(e?.updatedAt,i),readAt:o(e?.readAt,""),createdBy:l(e?.createdBy)}}(e),s=await (0,t.addDoc)((0,t.collection)(r,f()),i);return{...i,id:s.id,recordId:s.id}}async function y(e){let t=s(e);if(0===t.length)return[];let r=[];for(let e of t){let t=await I(e);t&&r.push(t)}return r}async function v({recipientEmail:e,status:r="all",limit:i=20}={}){let n=p();if(!n)return{records:[],unreadCount:0,totalScoped:0};let o=String(r||"").trim().toLowerCase(),a=c(i,20,{min:1,max:120}),s=Math.max(4*a,100),l=(await (0,t.getDocs)((0,t.query)((0,t.collection)(n,f()),(0,t.orderBy)("createdAt","desc"),(0,t.limit)(s)))).docs.map(m).filter(t=>_(t,e)),u=l.reduce((e,t)=>e+ +("unread"===d(t?.status)),0);return{records:l.filter(e=>"all"===o||!o||d(e?.status)===o).sort(g).slice(0,a),unreadCount:u,totalScoped:l.length}}async function A(e,r){let i=p();if(!i)return null;let a=o(e);if(!a)throw Error("invalid_record_id");let s=(0,t.doc)(i,f(),a),c=await (0,t.getDoc)(s);if(!c.exists())return null;let l=m(c);if(!_(l,r))throw Error("forbidden_notification_access");if("read"===d(l.status))return l;let u={...l,status:"read",readAt:n(),updatedAt:n()};return await (0,t.updateDoc)(s,u),u}async function h({recipientEmail:e,limit:r=120}={}){let i=l(e);if(!i)return{updatedCount:0};let a=p();if(!a)return{updatedCount:0};let s=c(r,120,{min:1,max:300}),{records:u}=await v({recipientEmail:i,status:"unread",limit:s}),d=0;for(let e of u){let r=o(e?.id||e?.recordId);if(!r)continue;let i=(0,t.doc)(a,f(),r);await (0,t.updateDoc)(i,{status:"read",readAt:n(),updatedAt:n()}),d+=1}return{updatedCount:d}}async function w({ownerEmail:e,affectedEmployeeEmail:t,actorEmail:r,includeAffectedEmployee:n=!0,includeActor:o=!1}={}){let a=[l(process.env.CLIO_GRC_ALERT_EMAIL),...u(process.env.GRC_EMAILS),...u(process.env.SUPER_ADMIN_EMAILS),l(e)];n&&a.push(l(t)),o&&a.push(l(r));let c=[];try{let e=await (0,i.listUserAccounts)();c=s(e).filter(e=>l(e?.email)).filter(e=>{var t;return"active"===(t=e?.status,String(t||"").trim().toLowerCase())}).filter(e=>{let t=String(e?.role||"").trim().toUpperCase();return"GRC"===t||"SUPER_ADMIN"===t}).map(e=>l(e?.email))}catch{c=[]}return function(e=[]){return Array.from(new Set(s(e).map(e=>l(e)).filter(Boolean)))}([...a,...c])}e.s(["createInAppNotificationsBulk",()=>y,"listInAppNotifications",()=>v,"markAllInAppNotificationsRead",()=>h,"markInAppNotificationRead",()=>A,"resolveIncidentStakeholderRecipients",()=>w])}];

//# sourceMappingURL=src_lib_8cc1a7d5._.js.map