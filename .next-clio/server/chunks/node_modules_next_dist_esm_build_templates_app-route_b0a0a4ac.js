module.exports=[86540,e=>{"use strict";var t=e.i(47909),r=e.i(74017),i=e.i(96250),n=e.i(59756),a=e.i(61916),o=e.i(74677),s=e.i(69741),l=e.i(16795),d=e.i(87718),u=e.i(95169),c=e.i(47587),m=e.i(66012),p=e.i(70101),h=e.i(26937),g=e.i(10372),v=e.i(93695);e.i(52474);var R=e.i(220),y=e.i(89171),f=e.i(98189),A=e.i(45787),N=e.i(79120),S=e.i(32307);let w={due:0,due_soon:1,scheduled:2,no_retention:3};function b(e){return String(e||"").trim().toLowerCase()}function E(e){let t=new Date(e||"").getTime();return Number.isNaN(t)?null:t}function x(e){let t=String(e||"").trim();if(!t)return"";let r=new Date(t);return Number.isNaN(r.getTime())?"":r.toISOString()}function D(e){return w[b(e)]??9}async function T(e){let t=await (0,f.authorizeApiRequest)(e,{requiredPermissions:["retention_archive:view"],auditModule:"Retention & Archive",auditAction:"Retention archive list request"});if(t.error)return t.error;let{session:r}=t,i=b(e.nextUrl?.searchParams.get("module"))||"all",n=b(e.nextUrl?.searchParams.get("status"))||"all",a=b(e.nextUrl?.searchParams.get("view"))||"records",o=String(e.nextUrl?.searchParams.get("q")||"").trim(),s=(0,N.parsePositiveInt)(e.nextUrl?.searchParams.get("dueWithinDays"),30,{min:1,max:365}),l=(0,N.parsePositiveInt)(e.nextUrl?.searchParams.get("page"),1,{min:1,max:1e5}),d=(0,N.parsePositiveInt)(e.nextUrl?.searchParams.get("pageSize"),20,{min:1,max:200}),u=x(e.nextUrl?.searchParams.get("now"));try{let t=await (0,A.listRetentionArchiveSnapshotBackend)({moduleId:i,status:n,queryText:o,dueWithinDays:s,now:u||void 0}),c=[],m={page:l,pageSize:d,total:0,totalPages:1},p=[];if("employee"===a){let e=function(e=[]){let t=new Map;return e.forEach(e=>{let r=b(e?.ownerEmail),i=b(`${e?.title||""}|${e?.subtitle||""}|${e?.moduleId||""}|${e?.recordId||""}`),n=r||i||`group-${Math.random().toString(36).slice(2,10)}`,a=function(e){let t=String(e?.title||"").trim();if("employees"===b(e?.moduleId)&&t)return t;if(t.includes(" - ")){let[e]=t.split(" - ");return String(e||"").trim()||"Employee"}let r=String(e?.subtitle||"").trim();if(r.includes("|")){let[e]=r.split("|"),t=String(e||"").trim();if(t&&t.includes("@"))return"Employee";if(t)return t}return t||"Employee"}(e),o=String(e?.ownerEmail||"").trim().toLowerCase(),s=String(e?.moduleId||"").trim(),l=String(e?.moduleLabel||"").trim()||"Module",d=t.get(n);d||(d={id:n,employeeName:a||"Employee",employeeEmail:o,totalRecords:0,deletionState:String(e?.deletionState||"").trim()||"scheduled",daysToDeletion:Number.isFinite(Number(e?.daysToDeletion))?Number(e.daysToDeletion):null,archivedAt:String(e?.archivedAt||"").trim(),retentionDeleteAt:String(e?.retentionDeleteAt||"").trim(),moduleBreakdown:[],records:[]},t.set(n,d)),o&&!d.employeeEmail&&(d.employeeEmail=o),("Employee"===d.employeeName||!d.employeeName)&&a&&(d.employeeName=a),d.totalRecords+=1,d.records.push({id:String(e?.id||"").trim(),moduleId:String(e?.moduleId||"").trim(),moduleLabel:String(e?.moduleLabel||"").trim()||"Module",recordId:String(e?.recordId||"").trim(),title:String(e?.title||"").trim(),subtitle:String(e?.subtitle||"").trim(),status:String(e?.status||"").trim(),archiveReason:String(e?.archiveReason||"").trim(),archivedAt:String(e?.archivedAt||"").trim(),retentionDeleteAt:String(e?.retentionDeleteAt||"").trim(),deletionState:String(e?.deletionState||"").trim(),daysToDeletion:Number.isFinite(Number(e?.daysToDeletion))?Number(e.daysToDeletion):null,updatedAt:String(e?.updatedAt||"").trim()});let u=D(d.deletionState),c=D(e?.deletionState);c<u?(d.deletionState=String(e?.deletionState||"").trim(),d.daysToDeletion=Number.isFinite(Number(e?.daysToDeletion))?Number(e.daysToDeletion):null):c===u&&Number.isFinite(Number(e?.daysToDeletion))&&(!Number.isFinite(d.daysToDeletion)||Number(e.daysToDeletion)<d.daysToDeletion)&&(d.daysToDeletion=Number(e.daysToDeletion));let m=E(d.archivedAt),p=E(e?.archivedAt);(!Number.isFinite(m)||Number.isFinite(p)&&p<m)&&(d.archivedAt=String(e?.archivedAt||"").trim());let h=E(d.retentionDeleteAt),g=E(e?.retentionDeleteAt);(!Number.isFinite(h)||Number.isFinite(g)&&g<h)&&(d.retentionDeleteAt=String(e?.retentionDeleteAt||"").trim());let v=d.moduleBreakdown.find(e=>e.moduleId===s);v?v.count+=1:d.moduleBreakdown.push({moduleId:s,moduleLabel:l,count:1})}),Array.from(t.values()).map(e=>({...e,moduleBreakdown:[...e.moduleBreakdown].sort((e,t)=>t.count-e.count),records:[...e.records].sort((e,t)=>{let r=D(e.deletionState),i=D(t.deletionState);if(r!==i)return r-i;let n=E(e.retentionDeleteAt),a=E(t.retentionDeleteAt);return Number.isFinite(n)&&Number.isFinite(a)&&n!==a?n-a:Number.isFinite(n)&&!Number.isFinite(a)?-1:!Number.isFinite(n)&&Number.isFinite(a)?1:(E(t.archivedAt)||0)-(E(e.archivedAt)||0)})})).sort((e,t)=>{let r=D(e.deletionState),i=D(t.deletionState);if(r!==i)return r-i;let n=E(e.retentionDeleteAt),a=E(t.retentionDeleteAt);return Number.isFinite(n)&&Number.isFinite(a)&&n!==a?n-a:Number.isFinite(n)&&!Number.isFinite(a)?-1:!Number.isFinite(n)&&Number.isFinite(a)?1:(E(t.archivedAt)||0)-(E(e.archivedAt)||0)})}(t.records),r=(0,N.paginateRows)(e,{page:l,pageSize:d});p=r.data,m=r.pagination}else{let e=(0,N.paginateRows)(t.records,{page:l,pageSize:d});c=e.data,m=e.pagination}return await (0,N.logApiAudit)({request:e,module:"Retention & Archive",activityName:"Retention archive records listed",status:"Completed",sensitivity:"Sensitive",performedBy:r.email,metadata:{resultCount:"employee"===a?p.length:c.length,totalMatched:t.records.length,moduleId:i,status:n,view:a,dueWithinDays:s,hasSearchQuery:!!o}}),y.NextResponse.json({records:c,employeeGroups:p,pagination:m,summary:t.summary,policy:t.policy,view:a})}catch(s){let t=s instanceof Error?s.message:"unknown_error",o=(0,N.mapBackendError)(t,"Unable to load retention archive records.");return await (0,N.logApiAudit)({request:e,module:"Retention & Archive",activityName:"Retention archive list failed",status:"Failed",sensitivity:"Sensitive",performedBy:r.email,metadata:{reason:t,moduleId:i,status:n,view:a}}),y.NextResponse.json({message:o.message},{status:o.status})}}async function C(e){let t=await (0,f.authorizeApiRequest)(e,{requiredPermissions:["retention_archive:view"],auditModule:"Retention & Archive",auditAction:"Retention purge request"});if(t.error)return t.error;let{session:r}=t;if(!(0,S.hasPermission)(r.role,"retention_archive:manage"))return y.NextResponse.json({message:"Forbidden."},{status:403});try{let t=await (0,N.parseJsonBody)(e),i=x(t?.cutoff);if("PURGE ARCHIVED DATA"!==String(t?.confirmation||"").trim().toUpperCase())throw Error("invalid_purge_confirmation");let n=await (0,A.purgeArchivedEmployeeDataBackend)({now:i||void 0});return await (0,N.logApiAudit)({request:e,module:"Retention & Archive",activityName:"Retention purge completed",status:"Approved",sensitivity:"Sensitive",performedBy:r.email,metadata:{cutoff:n.cutoff,deletedByCollection:n.deletedByCollection,deletedUsers:n.deletedUsers}}),y.NextResponse.json({ok:!0,result:n})}catch(n){let t=n instanceof Error?n.message:"unknown_error",i=(0,N.mapBackendError)(t,"Unable to run retention purge.");return await (0,N.logApiAudit)({request:e,module:"Retention & Archive",activityName:"Retention purge failed",status:"Failed",sensitivity:"Sensitive",performedBy:r.email,metadata:{reason:t}}),y.NextResponse.json({message:i.message},{status:i.status})}}e.s(["GET",()=>T,"POST",()=>C],93168);var P=e.i(93168);let F=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/hris/retention/route",pathname:"/api/hris/retention",filename:"route",bundlePath:""},distDir:".next-clio",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/hris/retention/route.js",nextConfigOutput:"",userland:P}),{workAsyncStorage:U,workUnitAsyncStorage:I,serverHooks:_}=F;function k(){return(0,i.patchFetch)({workAsyncStorage:U,workUnitAsyncStorage:I})}async function O(e,t,i){F.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/hris/retention/route";y=y.replace(/\/index$/,"")||"/";let f=await F.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!f)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:A,params:N,nextConfig:S,parsedUrl:w,isDraftMode:b,prerenderManifest:E,routerServerContext:x,isOnDemandRevalidate:D,revalidateOnlyGenerated:T,resolvedPathname:C,clientReferenceManifest:P,serverActionsManifest:U}=f,I=(0,s.normalizeAppPath)(y),_=!!(E.dynamicRoutes[I]||E.routes[C]),k=async()=>((null==x?void 0:x.render404)?await x.render404(e,t,w,!1):t.end("This page could not be found"),null);if(_&&!b){let e=!!E.routes[C],t=E.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await k();throw new v.NoFallbackError}}let O=null;!_||F.isDev||b||(O="/index"===(O=C)?"/":O);let q=!0===F.isDev||!_,B=_&&!q;U&&P&&(0,o.setManifestsSingleton)({page:y,clientReferenceManifest:P,serverActionsManifest:U});let M=e.method||"GET",H=(0,a.getTracer)(),$=H.getActiveScopeSpan(),j={params:N,prerenderManifest:E,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:q,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i,n)=>F.onRequestError(e,t,i,n,x)},sharedContext:{buildId:A}},L=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),G=d.NextRequestAdapter.fromNodeNextRequest(L,(0,d.signalFromNodeResponse)(t));try{let o=async e=>F.handle(G,j).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${M} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${y}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var a,l;let d=async({previousCacheEntry:r})=>{try{if(!s&&D&&T&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await o(n);e.fetchMetrics=j.renderOpts.fetchMetrics;let l=j.renderOpts.pendingWaitUntil;l&&i.waitUntil&&(i.waitUntil(l),l=void 0);let d=j.renderOpts.collectedTags;if(!_)return await (0,m.sendResponse)(L,K,a,j.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(a.headers);d&&(t[g.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==j.renderOpts.collectedRevalidate&&!(j.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&j.renderOpts.collectedRevalidate,i=void 0===j.renderOpts.collectedExpire||j.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:j.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await F.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:D})},!1,x),t}},u=await F.handleResponse({req:e,nextConfig:S,cacheKey:O,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:E,isRoutePPREnabled:!1,isOnDemandRevalidate:D,revalidateOnlyGenerated:T,responseGenerator:d,waitUntil:i.waitUntil,isMinimalMode:s});if(!_)return null;if((null==u||null==(a=u.value)?void 0:a.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",D?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let v=(0,p.fromNodeOutgoingHttpHeaders)(u.value.headers);return s&&_||v.delete(g.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||v.get("Cache-Control")||v.set("Cache-Control",(0,h.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(L,K,new Response(u.value.body,{headers:v,status:u.value.status||200})),null};$?await l($):await H.withPropagatedContext(e.headers,()=>H.trace(u.BaseServerSpan.handleRequest,{spanName:`${M} ${y}`,kind:a.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await F.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:D})},!1,x),_)throw t;return await (0,m.sendResponse)(L,K,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>k,"routeModule",()=>F,"serverHooks",()=>_,"workAsyncStorage",()=>U,"workUnitAsyncStorage",()=>I],86540)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_b0a0a4ac.js.map