module.exports=[70406,(e,t,i)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,i)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,i)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,i)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,i)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,i)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,i)=>{t.exports=e.x("util",()=>require("util"))},66680,(e,t,i)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},2157,(e,t,i)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},50227,(e,t,i)=>{t.exports=e.x("node:path",()=>require("node:path"))},54799,(e,t,i)=>{t.exports=e.x("crypto",()=>require("crypto"))},98189,32307,e=>{"use strict";var t=e.i(89171),i=e.i(59979),r=e.i(81215),n=e.i(28221);let s={SUPER_ADMIN:["*"],GRC:["dashboard:view","employees:view","employees:edit","employees:view:sensitive","lifecycle:view","lifecycle:edit","lifecycle:approve","attendance:view","attendance:edit","attendance:approve","performance:view","performance:edit","performance:approve","templates:view","templates:edit","exports:view","exports:manage","exports:approve","exports:request","activity_log:export","activity_log:view","audit:view","access_management:view","retention_archive:view","retention_archive:manage","incident_management:view","incident_management:edit","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],HR:["dashboard:view","employees:view","employees:edit","employees:view:sensitive","lifecycle:view","lifecycle:edit","lifecycle:approve","attendance:view","attendance:edit","attendance:approve","performance:view","performance:edit","performance:approve","templates:view","templates:edit","exports:view","exports:manage","exports:approve","exports:request","activity_log:export","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],EA:["dashboard:view","employees:view","employees:edit","employees:view:sensitive","lifecycle:view","lifecycle:edit","lifecycle:approve","attendance:view","attendance:edit","attendance:approve","performance:view","performance:edit","performance:approve","templates:view","templates:edit","exports:view","exports:manage","exports:approve","exports:request","activity_log:export","settings:view","audit:write:nonsensitive","auth:logout","resource:own"],EMPLOYEE_L1:["dashboard:view","employees:view","employees:edit:self","attendance:view","attendance:edit:self","performance:view","templates:view","requests:view","requests:create:self","exports:request:self","audit:write:nonsensitive","auth:logout","resource:own"],EMPLOYEE_L2:["dashboard:view","employees:view","employees:edit:self","attendance:view","attendance:edit:self","performance:view","templates:view","requests:view","requests:create:self","exports:request:self","audit:write:nonsensitive","auth:logout","resource:own"],EMPLOYEE_L3:["dashboard:view","employees:view","employees:edit:self","attendance:view","attendance:edit:self","performance:view","templates:view","requests:view","requests:create:self","exports:request:self","audit:write:nonsensitive","auth:logout","resource:own"]},a={dashboard:"dashboard:view",employees:"employees:view","employment-lifecycle":"lifecycle:view",attendance:"attendance:view",performance:"performance:view","activity-log":"activity_log:view",exports:"exports:view",documents:"templates:view","access-management":"access_management:view","retention-archive":"retention_archive:view","incident-management":"incident_management:view",requests:"requests:view",settings:"settings:view","user-management":"user_management:view"};function o(e,t){let i=s[(0,r.normalizeRole)(e)]??[];return i.includes("*")||i.includes(t)}function c(e,t){let i=(0,r.normalizeRole)(e);if(!new Set(n.MODULE_ACCESS[i]??[]).has(t))return!1;let s=a[t];return!s||o(i,s)}function l({role:e,actorIdentifier:t,ownerIdentifier:i,allowRoles:n=["SUPER_ADMIN"]}){let s=(0,r.normalizeRole)(e);if(n.includes(s))return!0;if(!o(s,"resource:own"))return!1;let a=String(t||"").trim().toLowerCase(),c=String(i||"").trim().toLowerCase();return!!a&&!!c&&a===c}function d(e){let t=String(e||"").trim().replace(/^\/+|\/+$/g,"");if(!t)return"dashboard";let i=t.split("/")[0];return a[i]?i:null}e.s(["canAccessModule",()=>c,"canAccessResource",()=>l,"getModuleIdFromPathname",()=>d,"hasPermission",()=>o],32307);var u=e.i(96864),m=e.i(45709);function p(e,i){return{error:t.NextResponse.json({message:i},{status:e})}}async function v(e,{allowedRoles:t,requiredPermissions:n=[],ownerIdentifier:s,ownerBypassRoles:a=["SUPER_ADMIN"],auditModule:c="Authorization",auditAction:d="API access check"}={}){let f=e.cookies.get(i.SESSION_COOKIE_NAME)?.value,_=(0,i.verifySessionToken)(f);if(!_)return await (0,u.recordAuditEvent)({activityName:`${d} denied (no active session)`,status:"Failed",module:c,performedBy:"anonymous@gmail.com",sensitivity:"Sensitive",metadata:{reason:"unauthorized"},request:e}),p(401,"Unauthorized.");let y={..._,role:(0,r.normalizeRole)(_.role)},g=await (0,m.getLoginAccount)(y.email).catch(()=>null);if(!g)return await (0,u.recordAuditEvent)({activityName:`${d} denied (account not found)`,status:"Failed",module:c,performedBy:y.email,sensitivity:"Sensitive",metadata:{reason:"account_not_found"},request:e}),p(401,"Session is no longer valid. Please sign in again.");if("active"!==g.status)return await (0,u.recordAuditEvent)({activityName:`${d} blocked by account status`,status:"Rejected",module:c,performedBy:y.email,sensitivity:"Sensitive",metadata:{reason:"account_not_active",accountStatus:g.status},request:e}),p(403,"Account is not active.");let w=(0,r.normalizeRole)(g.role),h=Number.parseInt(String(g.sessionVersion??""),10)||1,x="SUPER_ADMIN"===w,b=y.role!==w,A=y.sessionVersion!==h;if(A||b&&!x)return await (0,u.recordAuditEvent)({activityName:`${d} denied (stale session)`,status:"Rejected",module:c,performedBy:y.email,sensitivity:"Sensitive",metadata:{reason:A?"session_version_mismatch":"session_role_mismatch",tokenRole:y.role,accountRole:w,tokenSessionVersion:y.sessionVersion,accountSessionVersion:h},request:e}),p(401,"Session expired. Please sign in again.");if(Array.isArray(t)&&t.length>0&&!t.includes(y.role))return await (0,u.recordAuditEvent)({activityName:`${d} blocked by role policy`,status:"Rejected",module:c,performedBy:y.email,sensitivity:"Sensitive",metadata:{role:y.role,allowedRoles:t,reason:"role_not_allowed"},request:e}),p(403,"Forbidden.");if(n.length>0&&!n.every(e=>o(y.role,e)))return await (0,u.recordAuditEvent)({activityName:`${d} blocked by permission policy`,status:"Rejected",module:c,performedBy:y.email,sensitivity:"Sensitive",metadata:{role:y.role,requiredPermissions:n,reason:"missing_permission"},request:e}),p(403,"Forbidden.");if(s){let t=y.email,i="function"==typeof s?await s(y):s;if(!l({role:y.role,actorIdentifier:t,ownerIdentifier:i,allowRoles:a}))return await (0,u.recordAuditEvent)({activityName:`${d} blocked by ownership policy`,status:"Rejected",module:c,performedBy:y.email,sensitivity:"Sensitive",metadata:{role:y.role,ownerIdentifier:i,reason:"ownership_validation_failed"},request:e}),p(403,"Forbidden.")}return{session:y}}e.s(["authorizeApiRequest",()=>v],98189)},79120,e=>{"use strict";var t=e.i(89171),i=e.i(32307),r=e.i(96864);let n=["SUPER_ADMIN","GRC","HR","EA"];function s(e){return String(e||"").trim().toLowerCase()}function a(e,{start:t=2,end:i=2,fallback:r="Masked"}={}){let n=String(e||"").trim();return n?n.length<=t+i?`${n.slice(0,1)}***`:`${n.slice(0,t)}***${n.slice(n.length-i)}`:r}function o(e){return String(e||"").trim().toUpperCase().startsWith("EMPLOYEE_")}function c(e,t,{min:i=1,max:r=1e3}={}){let n=Number.parseInt(String(e||""),10);return Number.isFinite(n)?Math.min(r,Math.max(i,n)):t}function l(e,{page:t=1,pageSize:i=20}={}){let r=c(t,1,{min:1,max:1e5}),n=c(i,20,{min:1,max:200}),s=e.length,a=Math.max(1,Math.ceil(s/n)),o=Math.min(r,a),d=(o-1)*n;return{data:e.slice(d,d+n),pagination:{page:o,pageSize:n,total:s,totalPages:a}}}async function d(e){try{let t=await e.json();return t&&"object"==typeof t?t:{}}catch{throw Error("invalid_json_body")}}function u(e="Record not found."){return t.NextResponse.json({message:e},{status:404})}function m({session:e,requestedOwnerEmail:t,fallbackOwnerEmail:i}){return e&&o(e.role)?s(e.email):s(t||i)||null}function p(e,t){if(!e||"object"!=typeof e||(0,i.hasPermission)(t,"employees:view:sensitive"))return e;let r=e.governmentIds&&"object"==typeof e.governmentIds?Object.entries(e.governmentIds).reduce((e,[t,i])=>(e[t]=a(i,{start:2,end:2}),e),{}):{},n=e.payrollInformation&&"object"==typeof e.payrollInformation?Object.keys(e.payrollInformation).reduce((e,t)=>(e[t]="Restricted",e),{}):{};return{...e,govId:a(e.govId,{start:2,end:2}),governmentIds:r,payrollInformation:n}}function v({session:e,ownerEmail:t,ownerBypassRoles:r=n}){let a=s(t);return!!a&&(0,i.canAccessResource)({role:e.role,actorIdentifier:e.email,ownerIdentifier:a,allowRoles:r})}function f({role:e,editPermission:t,selfEditPermission:r,isSelfResource:n}){return!!((0,i.hasPermission)(e,t)||n&&r&&(0,i.hasPermission)(e,r))}function _(e,t){switch(String(e||"").trim()){case"invalid_json_body":return{status:400,message:"Invalid request payload."};case"invalid_record_id":return{status:400,message:"Invalid record identifier."};case"invalid_employee_email":return{status:400,message:"Employee email is required."};case"employee_account_not_found":return{status:409,message:"No user account found for this employee email. Invite or activate the user account first."};case"invalid_target_role":return{status:400,message:"Target role is required and must be a valid system role."};case"forbidden_target_role":return{status:403,message:"Target role assignment is not allowed by lifecycle permission policy."};case"role_sync_failed":return{status:409,message:"Employee user account was not found. Invite or activate the account before applying role changes."};case"approval_required":return{status:409,message:"Workflow approval chain must be completed before setting this status."};case"invalid_workflow_action":return{status:400,message:"Invalid workflow action payload."};case"invalid_approval_decision":return{status:400,message:"Approval decision must be approve or reject."};case"no_pending_approval_step":return{status:409,message:"No pending approval step remains for this workflow."};case"approval_not_allowed_for_role":return{status:403,message:"Current role is not allowed to approve the active step."};case"invalid_template_name":return{status:400,message:"Template name is required."};case"invalid_export_dataset":return{status:400,message:"Export dataset is required."};case"invalid_incident_title":return{status:400,message:"Incident title is required."};case"invalid_incident_evidence_payload":return{status:400,message:"Incident evidence payload must be a valid document array."};case"invalid_incident_evidence_name":return{status:400,message:"Incident evidence file name is required."};case"invalid_incident_evidence_reference":return{status:400,message:"Incident evidence must include a valid file reference."};case"invalid_incident_evidence_extension":return{status:400,message:"Incident evidence file extension is not allowed."};case"invalid_incident_evidence_content_type":return{status:400,message:"Incident evidence MIME type is not allowed."};case"invalid_incident_evidence_size":return{status:400,message:"Incident evidence file size exceeds the allowed limit."};case"incident_evidence_av_not_configured":return{status:503,message:"Evidence security scan provider is not configured."};case"incident_evidence_av_hook_failed":return{status:502,message:"Evidence security scan failed. Retry after security provider is available."};case"incident_evidence_av_blocked":return{status:403,message:"Evidence file blocked by malware/security policy scan."};case"invalid_reference_kind":return{status:400,message:"Reference type is invalid."};case"invalid_reference_label":return{status:400,message:"Reference label is required and must be within the allowed length."};case"invalid_retention_module":return{status:400,message:"Retention module filter is invalid."};case"invalid_purge_confirmation":return{status:400,message:"Invalid purge confirmation phrase."};case"duplicate_reference_value":return{status:409,message:"Reference value already exists."};case"immutable_reference_item":return{status:403,message:"System reference values cannot be removed."};case"access_revocation_failed":return{status:409,message:"Access revocation could not be confirmed for this employee account. Retry offboarding or review account status."};case"account_activation_failed":return{status:409,message:"Account activation could not be confirmed for this employee account."};case"email_provider_not_configured":return{status:502,message:"Email provider is not configured. Set CLIO_EMAIL_PROVIDER=firebase and NEXT_PUBLIC_FIREBASE_API_KEY."};case"firebase_api_key_not_configured":return{status:502,message:"Firebase API key is not configured. Set NEXT_PUBLIC_FIREBASE_API_KEY."};case"firebase_email_provider_not_enabled":return{status:502,message:"Firebase email-link provider is not enabled. Enable Email link (passwordless sign-in) in Firebase Authentication."};case"firebase_continue_url_invalid":return{status:502,message:"Firebase continue URL is invalid. Check CLIO_APP_BASE_URL / CLIO_INVITE_VERIFY_PATH and authorize the domain in Firebase Authentication."};case"unsupported_email_provider":return{status:502,message:"Unsupported email provider configuration."};case"email_delivery_failed":return{status:502,message:"Unable to deliver invite email."};case"firestore_not_configured":return{status:503,message:"Database is not configured. Set Firebase environment variables and restart the app."};default:return{status:400,message:t||"Unable to process request."}}}function y(e){return String(e||"").trim()}function g(e){return null==e?null:Array.isArray(e)?e.map(e=>g(e)):"object"==typeof e?Object.keys(e).sort().reduce((t,i)=>(t[i]=g(e[i]),t),{}):"string"==typeof e?e.trim():e}function w(e,t,i=[]){return(Array.isArray(i)?i:[]).filter(i=>{var r,n;return r=e?.[i],n=t?.[i],JSON.stringify(g(r))!==JSON.stringify(g(n))})}function h(e,t=[]){if(!e||"object"!=typeof e)return[];let i=new Set((Array.isArray(t)?t:[]).map(e=>y(e)));return Object.keys(e).filter(e=>!i.has(e)).sort()}function x(e,t="",i=[]){let r=Array.isArray(i)?i:[],n=[e?.employeeId,e?.workflowId,e?.lifecycleId,e?.templateId,e?.exportId,e?.id,t];for(let t of r){let i=y(e?.[t]);if(i)return i}for(let e of n){let t=y(e);if(t)return t}return"N/A"}function b(e=[],t="No field details recorded."){let i=(Array.isArray(e)?e:[]).map(e=>y(e)).filter(Boolean);return 0===i.length?t:i.join(", ")}async function A({request:e,module:t,activityName:i,status:n="Completed",sensitivity:s="Sensitive",performedBy:a="system@gmail.com",metadata:o}){let c="true"===process.env.CLIO_AUDIT_ASYNC||"false"!==process.env.CLIO_AUDIT_ASYNC&&!1,l=(0,r.recordAuditEvent)({activityName:i,status:n,module:t,performedBy:a,sensitivity:s,metadata:o,request:e}).catch(()=>null);c||await l}e.s(["canActorAccessOwner",()=>v,"canActorEditModule",()=>f,"getSelfRestrictedOwnerEmail",()=>m,"isEmployeeRole",()=>o,"logApiAudit",()=>A,"mapBackendError",()=>_,"normalizeEmail",()=>s,"notFound",()=>u,"paginateRows",()=>l,"parseJsonBody",()=>d,"parsePositiveInt",()=>c,"resolveAuditChangedFields",()=>w,"resolveAuditRecordRef",()=>x,"resolveAuditViewedFields",()=>h,"sanitizeEmployeeRecordForViewer",()=>p,"summarizeAuditFieldList",()=>b])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__44baabec._.js.map