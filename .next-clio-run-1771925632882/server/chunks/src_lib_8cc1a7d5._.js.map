{"version":3,"sources":["../../../src/lib/invite-delivery.js","../../../src/lib/security-notifications.js"],"sourcesContent":["function normalizeEmailProvider(rawValue) {\n  const raw = String(rawValue || \"\")\n    .trim()\n    .toLowerCase();\n  if (!raw) {\n    return \"firebase\";\n  }\n\n  if (raw === \"firebase\" || raw.includes(\"firebase\")) {\n    return \"firebase\";\n  }\n\n  if (raw === \"resend\" || raw.includes(\"resend\")) {\n    return \"resend\";\n  }\n\n  if (raw === \"console\" || raw === \"dev\" || raw.includes(\"console\")) {\n    return \"console\";\n  }\n\n  return raw;\n}\n\nfunction getEmailProvider() {\n  return normalizeEmailProvider(process.env.CLIO_EMAIL_PROVIDER);\n}\n\nfunction isConsoleEmailAllowed() {\n  return String(process.env.CLIO_ALLOW_CONSOLE_EMAIL || \"\")\n    .trim()\n    .toLowerCase() === \"true\";\n}\n\nfunction getAppBaseUrl() {\n  const configured = String(process.env.CLIO_APP_BASE_URL || \"\").trim();\n  if (configured) {\n    return configured.replace(/\\/+$/, \"\");\n  }\n  return \"http://localhost:3000\";\n}\n\nfunction getLoginPath() {\n  const configured = String(process.env.CLIO_LOGIN_PATH || \"\").trim();\n  if (!configured) {\n    return \"/login\";\n  }\n  return configured.startsWith(\"/\") ? configured : `/${configured}`;\n}\n\nfunction getInviteVerifyPath() {\n  const configured = String(process.env.CLIO_INVITE_VERIFY_PATH || \"\").trim();\n  if (!configured) {\n    return \"/verify-invite\";\n  }\n  return configured.startsWith(\"/\") ? configured : `/${configured}`;\n}\n\nfunction buildLoginUrl() {\n  const baseUrl = getAppBaseUrl();\n  return `${baseUrl}${getLoginPath()}`;\n}\n\nfunction buildInviteVerificationUrl(inviteToken) {\n  const baseUrl = getAppBaseUrl();\n  const path = getInviteVerifyPath();\n  const token = String(inviteToken || \"\").trim();\n  if (!token) {\n    throw new Error(\"invalid_invite_token\");\n  }\n  return `${baseUrl}${path}?token=${encodeURIComponent(token)}`;\n}\n\nfunction isDevelopmentPreviewEnabled() {\n  return process.env.NODE_ENV !== \"production\";\n}\n\nfunction buildEmailContent({ role, invitedBy, verifyUrl, loginUrl, expiresAt }) {\n  const expirationDate = new Date(expiresAt);\n  const readableExpiration = Number.isNaN(expirationDate.getTime())\n    ? expiresAt\n    : expirationDate.toLocaleString(\"en-US\", {\n        month: \"short\",\n        day: \"2-digit\",\n        year: \"numeric\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n      });\n\n  const subject = \"You are invited to CLIO HRIS\";\n  const text = [\n    \"You were invited to access CLIO HRIS.\",\n    `Assigned role: ${role}`,\n    `Invited by: ${invitedBy}`,\n    `Verify your email: ${verifyUrl}`,\n    `Sign-in page: ${loginUrl}`,\n    `Invitation expires: ${readableExpiration}`,\n    \"\",\n    \"Step 1: Open the verification link and complete email verification.\",\n    \"Step 2: After verification, sign in using Google with the same invited work email.\",\n    \"Only invited accounts can access the workspace.\",\n  ].join(\"\\n\");\n\n  return {\n    subject,\n    text,\n    html: [\n      \"<p>You were invited to access <strong>CLIO HRIS</strong>.</p>\",\n      `<p><strong>Assigned role:</strong> ${role}<br/>`,\n      `<strong>Invited by:</strong> ${invitedBy}<br/>`,\n      `<strong>Invitation expires:</strong> ${readableExpiration}</p>`,\n      `<p><a href=\"${verifyUrl}\">Verify your email</a></p>`,\n      `<p><a href=\"${loginUrl}\">Open CLIO sign-in</a></p>`,\n      \"<p>After verification, sign in using Google with the same invited work email.</p>\",\n    ].join(\"\"),\n  };\n}\n\nfunction parseFirebaseAuthError(payload) {\n  const code = String(payload?.error?.message || \"\").trim();\n  if (!code) {\n    return \"email_delivery_failed\";\n  }\n  if (code === \"OPERATION_NOT_ALLOWED\") {\n    return \"firebase_email_provider_not_enabled\";\n  }\n  if (code === \"MISSING_CONTINUE_URI\" || code === \"INVALID_CONTINUE_URI\") {\n    return \"firebase_continue_url_invalid\";\n  }\n  if (code === \"INVALID_EMAIL\") {\n    return \"invalid_email\";\n  }\n  if (code === \"PROJECT_NOT_FOUND\" || code === \"API_KEY_INVALID\") {\n    return \"firebase_api_key_not_configured\";\n  }\n  return \"email_delivery_failed\";\n}\n\nasync function sendViaFirebaseAuth({ toEmail, verifyUrl }) {\n  const apiKey = String(process.env.NEXT_PUBLIC_FIREBASE_API_KEY || \"\").trim();\n  if (!apiKey) {\n    throw new Error(\"firebase_api_key_not_configured\");\n  }\n\n  const response = await fetch(`https://identitytoolkit.googleapis.com/v1/accounts:sendOobCode?key=${apiKey}`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({\n      requestType: \"EMAIL_SIGNIN\",\n      email: toEmail,\n      continueUrl: verifyUrl,\n      canHandleCodeInApp: true,\n    }),\n  });\n\n  const payload = await response.json().catch(() => ({}));\n  if (!response.ok) {\n    throw new Error(parseFirebaseAuthError(payload));\n  }\n\n  return {\n    provider: \"firebase\",\n    status: \"sent\",\n    messageId: `firebase-${Date.now()}`,\n  };\n}\n\nasync function sendViaResend({ toEmail, subject, html, text }) {\n  const apiKey = String(process.env.RESEND_API_KEY || \"\").trim();\n  const fromAddress = String(process.env.CLIO_EMAIL_FROM || \"\").trim();\n  if (!apiKey || !fromAddress || !apiKey.startsWith(\"re_\")) {\n    throw new Error(\"email_provider_not_configured\");\n  }\n\n  const response = await fetch(\"https://api.resend.com/emails\", {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: `Bearer ${apiKey}`,\n    },\n    body: JSON.stringify({\n      from: fromAddress,\n      to: [toEmail],\n      subject,\n      html,\n      text,\n    }),\n  });\n\n  if (!response.ok) {\n    const payload = await response.json().catch(() => ({}));\n    const providerMessage =\n      typeof payload?.message === \"string\"\n        ? payload.message\n        : typeof payload?.error?.message === \"string\"\n          ? payload.error.message\n          : \"\";\n    throw new Error(\n      providerMessage ? `email_delivery_failed:${providerMessage}` : \"email_delivery_failed\",\n    );\n  }\n\n  const payload = await response.json().catch(() => ({}));\n  return {\n    provider: \"resend\",\n    status: \"sent\",\n    messageId: typeof payload?.id === \"string\" ? payload.id : `resend-${Date.now()}`,\n  };\n}\n\nfunction sendViaConsole({ toEmail, subject, verifyUrl, loginUrl }) {\n  const messageId = `console-${Date.now()}`;\n  if (isDevelopmentPreviewEnabled()) {\n    console.info(\"[CLIO:InviteEmail]\", {\n      toEmail,\n      subject,\n      verifyUrl,\n      loginUrl,\n      messageId,\n    });\n  }\n\n  return {\n    provider: \"console\",\n    status: \"simulated\",\n    messageId,\n    previewUrl: verifyUrl,\n    loginUrl,\n  };\n}\n\nexport async function deliverInviteEmail({ toEmail, role, invitedBy, expiresAt, inviteToken }) {\n  const verifyUrl = buildInviteVerificationUrl(inviteToken);\n  const loginUrl = buildLoginUrl();\n  const content = buildEmailContent({\n    role,\n    invitedBy,\n    verifyUrl,\n    loginUrl,\n    expiresAt,\n  });\n  const provider = getEmailProvider();\n\n  if (provider === \"firebase\") {\n    return await sendViaFirebaseAuth({\n      toEmail,\n      verifyUrl,\n    });\n  }\n\n  if (provider === \"resend\") {\n    return await sendViaResend({\n      toEmail,\n      subject: content.subject,\n      html: content.html,\n      text: content.text,\n    });\n  }\n\n  if (provider === \"console\") {\n    if (!isConsoleEmailAllowed()) {\n      throw new Error(\"email_provider_not_configured\");\n    }\n\n    return sendViaConsole({\n      toEmail,\n      subject: content.subject,\n      verifyUrl,\n      loginUrl,\n    });\n  }\n\n  throw new Error(\"unsupported_email_provider\");\n}\n","import {\n  addDoc,\n  collection,\n  doc,\n  getDoc,\n  getDocs,\n  limit as queryLimit,\n  orderBy,\n  query,\n  updateDoc,\n} from \"firebase/firestore/lite\";\nimport { getFirestoreDb, isFirestoreEnabled } from \"@/lib/firebase\";\nimport { listUserAccounts } from \"@/lib/user-accounts\";\n\nconst DEFAULT_LIST_LIMIT = 20;\nconst MAX_LIST_LIMIT = 120;\nconst MAX_READ_ALL_LIMIT = 300;\n\nfunction nowIso() {\n  return new Date().toISOString();\n}\n\nfunction asString(value, fallback = \"\") {\n  const normalized = String(value || \"\").trim();\n  return normalized || fallback;\n}\n\nfunction asBoolean(value, fallback = false) {\n  if (typeof value === \"boolean\") {\n    return value;\n  }\n  if (typeof value === \"number\") {\n    return value !== 0;\n  }\n  if (typeof value === \"string\") {\n    const normalized = value.trim().toLowerCase();\n    if (!normalized) {\n      return fallback;\n    }\n    if ([\"true\", \"1\", \"yes\", \"on\", \"y\"].includes(normalized)) {\n      return true;\n    }\n    if ([\"false\", \"0\", \"no\", \"off\", \"n\"].includes(normalized)) {\n      return false;\n    }\n  }\n  return fallback;\n}\n\nfunction asObject(value) {\n  if (value && typeof value === \"object\" && !Array.isArray(value)) {\n    return value;\n  }\n  return {};\n}\n\nfunction asArray(value) {\n  return Array.isArray(value) ? value : [];\n}\n\nfunction clampInt(value, fallback, { min = 1, max = Number.MAX_SAFE_INTEGER } = {}) {\n  const parsed = Number.parseInt(String(value || \"\"), 10);\n  if (!Number.isFinite(parsed)) {\n    return fallback;\n  }\n  return Math.min(max, Math.max(min, parsed));\n}\n\nfunction normalizeEmail(value) {\n  return String(value || \"\").trim().toLowerCase();\n}\n\nfunction normalizeText(value) {\n  return String(value || \"\").trim().toLowerCase();\n}\n\nfunction parseEmailList(rawValue) {\n  return String(rawValue || \"\")\n    .split(\",\")\n    .map((item) => normalizeEmail(item))\n    .filter(Boolean);\n}\n\nfunction normalizeSeverity(value) {\n  const normalized = String(value || \"\").trim().toLowerCase();\n  if (normalized === \"critical\") return \"critical\";\n  if (normalized === \"high\") return \"high\";\n  if (normalized === \"low\") return \"low\";\n  return \"medium\";\n}\n\nfunction normalizeNotificationStatus(value) {\n  return String(value || \"\").trim().toLowerCase() === \"read\" ? \"read\" : \"unread\";\n}\n\nfunction getNotificationsCollectionName() {\n  return asString(process.env.CLIO_FIRESTORE_NOTIFICATIONS_COLLECTION, \"clio_notifications\");\n}\n\nfunction getFirestoreStore() {\n  if (!isFirestoreEnabled()) {\n    return null;\n  }\n  return getFirestoreDb();\n}\n\nfunction toNotificationRecord(snapshot) {\n  const payload = snapshot.data() || {};\n  return {\n    ...payload,\n    id: snapshot.id,\n    recordId: snapshot.id,\n  };\n}\n\nfunction isVisibleNotification(row, recipientEmail) {\n  const recipient = normalizeEmail(recipientEmail);\n  const owner = normalizeEmail(row?.recipientEmail);\n  const broadcast = asBoolean(row?.broadcast, false);\n  return broadcast || (recipient && owner && recipient === owner);\n}\n\nfunction sortByCreatedDesc(left, right) {\n  return new Date(right?.createdAt || 0).getTime() - new Date(left?.createdAt || 0).getTime();\n}\n\nfunction normalizeNotificationPayload(payload) {\n  const now = nowIso();\n  const recipientEmail = normalizeEmail(payload?.recipientEmail);\n  const broadcast = asBoolean(payload?.broadcast, false);\n  if (!recipientEmail && !broadcast) {\n    throw new Error(\"invalid_notification_recipient\");\n  }\n\n  return {\n    title: asString(payload?.title, \"Security notification\"),\n    message: asString(payload?.message, \"A security event requires review.\"),\n    severity: normalizeSeverity(payload?.severity),\n    type: asString(payload?.type, \"security\"),\n    module: asString(payload?.module, \"Incident Management\"),\n    actionUrl: asString(payload?.actionUrl, \"/incident-management\"),\n    recipientEmail,\n    broadcast,\n    status: normalizeNotificationStatus(payload?.status),\n    metadata: asObject(payload?.metadata),\n    createdAt: asString(payload?.createdAt, now),\n    updatedAt: asString(payload?.updatedAt, now),\n    readAt: asString(payload?.readAt, \"\"),\n    createdBy: normalizeEmail(payload?.createdBy),\n  };\n}\n\nexport async function createInAppNotification(payload) {\n  const db = getFirestoreStore();\n  if (!db) {\n    return null;\n  }\n\n  const normalized = normalizeNotificationPayload(payload);\n  const ref = await addDoc(collection(db, getNotificationsCollectionName()), normalized);\n  return {\n    ...normalized,\n    id: ref.id,\n    recordId: ref.id,\n  };\n}\n\nexport async function createInAppNotificationsBulk(payloads) {\n  const entries = asArray(payloads);\n  if (entries.length === 0) {\n    return [];\n  }\n\n  const created = [];\n  for (const payload of entries) {\n    const result = await createInAppNotification(payload);\n    if (result) {\n      created.push(result);\n    }\n  }\n  return created;\n}\n\nexport async function listInAppNotifications({\n  recipientEmail,\n  status = \"all\",\n  limit = DEFAULT_LIST_LIMIT,\n} = {}) {\n  const db = getFirestoreStore();\n  if (!db) {\n    return {\n      records: [],\n      unreadCount: 0,\n      totalScoped: 0,\n    };\n  }\n\n  const normalizedStatus = String(status || \"\").trim().toLowerCase();\n  const safeLimit = clampInt(limit, DEFAULT_LIST_LIMIT, { min: 1, max: MAX_LIST_LIMIT });\n  const scanLimit = Math.max(safeLimit * 4, 100);\n\n  const snapshot = await getDocs(\n    query(\n      collection(db, getNotificationsCollectionName()),\n      orderBy(\"createdAt\", \"desc\"),\n      queryLimit(scanLimit),\n    ),\n  );\n\n  const scoped = snapshot.docs.map(toNotificationRecord).filter((row) => isVisibleNotification(row, recipientEmail));\n  const unreadCount = scoped.reduce((count, row) => count + (normalizeNotificationStatus(row?.status) === \"unread\" ? 1 : 0), 0);\n\n  const statusFiltered = scoped.filter((row) => {\n    if (normalizedStatus === \"all\" || !normalizedStatus) {\n      return true;\n    }\n    return normalizeNotificationStatus(row?.status) === normalizedStatus;\n  });\n\n  return {\n    records: statusFiltered.sort(sortByCreatedDesc).slice(0, safeLimit),\n    unreadCount,\n    totalScoped: scoped.length,\n  };\n}\n\nexport async function markInAppNotificationRead(recordId, recipientEmail) {\n  const db = getFirestoreStore();\n  if (!db) {\n    return null;\n  }\n\n  const normalizedId = asString(recordId);\n  if (!normalizedId) {\n    throw new Error(\"invalid_record_id\");\n  }\n\n  const ref = doc(db, getNotificationsCollectionName(), normalizedId);\n  const snapshot = await getDoc(ref);\n  if (!snapshot.exists()) {\n    return null;\n  }\n\n  const current = toNotificationRecord(snapshot);\n  if (!isVisibleNotification(current, recipientEmail)) {\n    throw new Error(\"forbidden_notification_access\");\n  }\n\n  if (normalizeNotificationStatus(current.status) === \"read\") {\n    return current;\n  }\n\n  const patched = {\n    ...current,\n    status: \"read\",\n    readAt: nowIso(),\n    updatedAt: nowIso(),\n  };\n  await updateDoc(ref, patched);\n  return patched;\n}\n\nexport async function markAllInAppNotificationsRead({ recipientEmail, limit = 120 } = {}) {\n  const normalizedRecipient = normalizeEmail(recipientEmail);\n  if (!normalizedRecipient) {\n    return {\n      updatedCount: 0,\n    };\n  }\n\n  const db = getFirestoreStore();\n  if (!db) {\n    return {\n      updatedCount: 0,\n    };\n  }\n\n  const safeLimit = clampInt(limit, 120, { min: 1, max: MAX_READ_ALL_LIMIT });\n  const { records } = await listInAppNotifications({\n    recipientEmail: normalizedRecipient,\n    status: \"unread\",\n    limit: safeLimit,\n  });\n\n  let updatedCount = 0;\n  for (const row of records) {\n    const recordId = asString(row?.id || row?.recordId);\n    if (!recordId) {\n      continue;\n    }\n    const ref = doc(db, getNotificationsCollectionName(), recordId);\n    await updateDoc(ref, {\n      status: \"read\",\n      readAt: nowIso(),\n      updatedAt: nowIso(),\n    });\n    updatedCount += 1;\n  }\n\n  return {\n    updatedCount,\n  };\n}\n\nexport function resolveNotificationRecipients(values = []) {\n  return Array.from(\n    new Set(\n      asArray(values)\n        .map((value) => normalizeEmail(value))\n        .filter(Boolean),\n    ),\n  );\n}\n\nexport async function resolveIncidentStakeholderRecipients({\n  ownerEmail,\n  affectedEmployeeEmail,\n  actorEmail,\n  includeAffectedEmployee = true,\n  includeActor = false,\n} = {}) {\n  const baseRecipients = [\n    normalizeEmail(process.env.CLIO_GRC_ALERT_EMAIL),\n    ...parseEmailList(process.env.GRC_EMAILS),\n    ...parseEmailList(process.env.SUPER_ADMIN_EMAILS),\n    normalizeEmail(ownerEmail),\n  ];\n\n  if (includeAffectedEmployee) {\n    baseRecipients.push(normalizeEmail(affectedEmployeeEmail));\n  }\n  if (includeActor) {\n    baseRecipients.push(normalizeEmail(actorEmail));\n  }\n\n  let dynamicRoleRecipients = [];\n  try {\n    const users = await listUserAccounts();\n    dynamicRoleRecipients = asArray(users)\n      .filter((user) => normalizeEmail(user?.email))\n      .filter((user) => normalizeText(user?.status) === \"active\")\n      .filter((user) => {\n        const role = String(user?.role || \"\").trim().toUpperCase();\n        return role === \"GRC\" || role === \"SUPER_ADMIN\";\n      })\n      .map((user) => normalizeEmail(user?.email));\n  } catch {\n    dynamicRoleRecipients = [];\n  }\n\n  return resolveNotificationRecipients([...baseRecipients, ...dynamicRoleRecipients]);\n}\n"],"names":[],"mappings":"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"}