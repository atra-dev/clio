module.exports=[33355,e=>{"use strict";e.i(18097);var t=e.i(19e3),r=e.i(67658),n=e.i(45709);function i(){return new Date().toISOString()}function a(e,t=""){return String(e||"").trim()||t}function o(e,t=!1){if("boolean"==typeof e)return e;if("number"==typeof e)return 0!==e;if("string"==typeof e){let r=e.trim().toLowerCase();if(!r)return t;if(["true","1","yes","on","y"].includes(r))return!0;if(["false","0","no","off","n"].includes(r))return!1}return t}function s(e){return Array.isArray(e)?e:[]}function l(e,t,{min:r=1,max:n=Number.MAX_SAFE_INTEGER}={}){let i=Number.parseInt(String(e||""),10);return Number.isFinite(i)?Math.min(n,Math.max(r,i)):t}function u(e){return String(e||"").trim().toLowerCase()}function c(e){return String(e||"").split(",").map(e=>u(e)).filter(Boolean)}function d(e){return"read"===String(e||"").trim().toLowerCase()?"read":"unread"}function p(){return a(process.env.CLIO_FIRESTORE_NOTIFICATIONS_COLLECTION,"clio_notifications")}function f(){return(0,r.isFirestoreEnabled)()?(0,r.getFirestoreDb)():null}function m(e){return{...e.data()||{},id:e.id,recordId:e.id}}function h(e,t){let r=u(t),n=u(e?.recipientEmail);return o(e?.broadcast,!1)||r&&n&&r===n}function R(e,t){return new Date(t?.createdAt||0).getTime()-new Date(e?.createdAt||0).getTime()}async function E(e){let r=f();if(!r)return null;let n=function(e){var t;let r,n=i(),s=u(e?.recipientEmail),l=o(e?.broadcast,!1);if(!s&&!l)throw Error("invalid_notification_recipient");return{title:a(e?.title,"Security notification"),message:a(e?.message,"A security event requires review."),severity:"critical"===(r=String(e?.severity||"").trim().toLowerCase())?"critical":"high"===r?"high":"low"===r?"low":"medium",type:a(e?.type,"security"),module:a(e?.module,"Incident Management"),actionUrl:a(e?.actionUrl,"/incident-management"),recipientEmail:s,broadcast:l,status:d(e?.status),metadata:(t=e?.metadata)&&"object"==typeof t&&!Array.isArray(t)?t:{},createdAt:a(e?.createdAt,n),updatedAt:a(e?.updatedAt,n),readAt:a(e?.readAt,""),createdBy:u(e?.createdBy)}}(e),s=await (0,t.addDoc)((0,t.collection)(r,p()),n);return{...n,id:s.id,recordId:s.id}}async function A(e){let t=s(e);if(0===t.length)return[];let r=[];for(let e of t){let t=await E(e);t&&r.push(t)}return r}async function g({recipientEmail:e,status:r="all",limit:n=20}={}){let i=f();if(!i)return{records:[],unreadCount:0,totalScoped:0};let a=String(r||"").trim().toLowerCase(),o=l(n,20,{min:1,max:120}),s=Math.max(4*o,100),u=(await (0,t.getDocs)((0,t.query)((0,t.collection)(i,p()),(0,t.orderBy)("createdAt","desc"),(0,t.limit)(s)))).docs.map(m).filter(t=>h(t,e)),c=u.reduce((e,t)=>e+ +("unread"===d(t?.status)),0);return{records:u.filter(e=>"all"===a||!a||d(e?.status)===a).sort(R).slice(0,o),unreadCount:c,totalScoped:u.length}}async function w(e,r){let n=f();if(!n)return null;let o=a(e);if(!o)throw Error("invalid_record_id");let s=(0,t.doc)(n,p(),o),l=await (0,t.getDoc)(s);if(!l.exists())return null;let u=m(l);if(!h(u,r))throw Error("forbidden_notification_access");if("read"===d(u.status))return u;let c={...u,status:"read",readAt:i(),updatedAt:i()};return await (0,t.updateDoc)(s,c),c}async function v({recipientEmail:e,limit:r=120}={}){let n=u(e);if(!n)return{updatedCount:0};let o=f();if(!o)return{updatedCount:0};let s=l(r,120,{min:1,max:300}),{records:c}=await g({recipientEmail:n,status:"unread",limit:s}),d=0;for(let e of c){let r=a(e?.id||e?.recordId);if(!r)continue;let n=(0,t.doc)(o,p(),r);await (0,t.updateDoc)(n,{status:"read",readAt:i(),updatedAt:i()}),d+=1}return{updatedCount:d}}async function y({ownerEmail:e,affectedEmployeeEmail:t,actorEmail:r,includeAffectedEmployee:i=!0,includeActor:a=!1}={}){let o=[u(process.env.CLIO_GRC_ALERT_EMAIL),...c(process.env.GRC_EMAILS),...c(process.env.SUPER_ADMIN_EMAILS),u(e)];i&&o.push(u(t)),a&&o.push(u(r));let l=[];try{let e=await (0,n.listUserAccounts)();l=s(e).filter(e=>u(e?.email)).filter(e=>{var t;return"active"===(t=e?.status,String(t||"").trim().toLowerCase())}).filter(e=>{let t=String(e?.role||"").trim().toUpperCase();return"GRC"===t||"SUPER_ADMIN"===t}).map(e=>u(e?.email))}catch{l=[]}return function(e=[]){return Array.from(new Set(s(e).map(e=>u(e)).filter(Boolean)))}([...o,...l])}e.s(["createInAppNotificationsBulk",()=>A,"listInAppNotifications",()=>g,"markAllInAppNotificationsRead",()=>v,"markInAppNotificationRead",()=>w,"resolveIncidentStakeholderRecipients",()=>y])},49294,e=>{"use strict";var t=e.i(47909),r=e.i(74017),n=e.i(96250),i=e.i(59756),a=e.i(61916),o=e.i(74677),s=e.i(69741),l=e.i(16795),u=e.i(87718),c=e.i(95169),d=e.i(47587),p=e.i(66012),f=e.i(70101),m=e.i(26937),h=e.i(10372),R=e.i(93695);e.i(52474);var E=e.i(220),A=e.i(89171),g=e.i(98189),w=e.i(79120),v=e.i(33355);async function y(e){let t=await (0,g.authorizeApiRequest)(e,{requiredPermissions:["resource:own"],ownerIdentifier:e=>e.email,ownerBypassRoles:["SUPER_ADMIN","GRC","HR","EA","EMPLOYEE_L1","EMPLOYEE_L2","EMPLOYEE_L3"],auditModule:"Notifications",auditAction:"Notification list request"});if(t.error)return t.error;let{session:r}=t,n=String(e.nextUrl?.searchParams.get("status")||"all").trim().toLowerCase(),i=(0,w.parsePositiveInt)(e.nextUrl?.searchParams.get("limit"),20,{min:1,max:120});try{let e=await (0,v.listInAppNotifications)({recipientEmail:r.email,status:n,limit:i});return A.NextResponse.json({records:e.records,unreadCount:Number(e.unreadCount||0),totalScoped:Number(e.totalScoped||0)})}catch(e){return A.NextResponse.json({message:e instanceof Error?e.message:"Unable to load notifications."},{status:400})}}e.s(["GET",()=>y],79208);var C=e.i(79208);let _=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/notifications/route",pathname:"/api/notifications",filename:"route",bundlePath:""},distDir:".next-clio-run-1771925632882",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/notifications/route.js",nextConfigOutput:"",userland:C}),{workAsyncStorage:S,workUnitAsyncStorage:N,serverHooks:I}=_;function b(){return(0,n.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:N})}async function x(e,t,n){_.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let A="/api/notifications/route";A=A.replace(/\/index$/,"")||"/";let g=await _.prepare(e,t,{srcPage:A,multiZoneDraftMode:!1});if(!g)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:w,params:v,nextConfig:y,parsedUrl:C,isDraftMode:S,prerenderManifest:N,routerServerContext:I,isOnDemandRevalidate:b,revalidateOnlyGenerated:x,resolvedPathname:P,clientReferenceManifest:T,serverActionsManifest:O}=g,M=(0,s.normalizeAppPath)(A),L=!!(N.dynamicRoutes[M]||N.routes[P]),U=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,C,!1):t.end("This page could not be found"),null);if(L&&!S){let e=!!N.routes[P],t=N.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await U();throw new R.NoFallbackError}}let D=null;!L||_.isDev||S||(D="/index"===(D=P)?"/":D);let k=!0===_.isDev||!L,q=L&&!k;O&&T&&(0,o.setManifestsSingleton)({page:A,clientReferenceManifest:T,serverActionsManifest:O});let H=e.method||"GET",j=(0,a.getTracer)(),F=j.getActiveScopeSpan(),B={params:v,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n,i)=>_.onRequestError(e,t,n,i,I)},sharedContext:{buildId:w}},G=new l.NodeNextRequest(e),$=new l.NodeNextResponse(t),K=u.NextRequestAdapter.fromNodeNextRequest(G,(0,u.signalFromNodeResponse)(t));try{let o=async e=>_.handle(K,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${H} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${A}`)}),s=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var a,l;let u=async({previousCacheEntry:r})=>{try{if(!s&&b&&x&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await o(i);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let u=B.renderOpts.collectedTags;if(!L)return await (0,p.sendResponse)(G,$,a,B.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[h.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,n=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await _.onRequestError(e,t,{routerKind:"App Router",routePath:A,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:b})},!1,I),t}},c=await _.handleResponse({req:e,nextConfig:y,cacheKey:D,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:b,revalidateOnlyGenerated:x,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:s});if(!L)return null;if((null==c||null==(a=c.value)?void 0:a.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",b?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let R=(0,f.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&L||R.delete(h.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||R.get("Cache-Control")||R.set("Cache-Control",(0,m.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)(G,$,new Response(c.value.body,{headers:R,status:c.value.status||200})),null};F?await l(F):await j.withPropagatedContext(e.headers,()=>j.trace(c.BaseServerSpan.handleRequest,{spanName:`${H} ${A}`,kind:a.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof R.NoFallbackError||await _.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:b})},!1,I),L)throw t;return await (0,p.sendResponse)(G,$,new Response(null,{status:500})),null}}e.s(["handler",()=>x,"patchFetch",()=>b,"routeModule",()=>_,"serverHooks",()=>I,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>N],49294)},11072,e=>{e.v(t=>Promise.all(["server/chunks/src_lib_9a482084._.js","server/chunks/src_lib_hris-backend_4dbd0cdd.js","server/chunks/src_lib_security-detection_4bdbe3ad.js"].map(t=>e.l(t))).then(()=>t(74405)))}];

//# sourceMappingURL=_10b50a37._.js.map