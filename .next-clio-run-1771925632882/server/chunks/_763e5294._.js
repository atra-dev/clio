module.exports=[91387,e=>{"use strict";var t=e.i(45709),a=e.i(44801);let r=[],i=0;function n(e){let t=String(e||"").trim().toLowerCase();return t&&t.includes("@")?t:""}async function o(){let e=Date.now();if(e-i<3e4&&Array.isArray(r))return r;let a=await (0,t.listUserAccounts)();return r=Array.isArray(a)?a:[],i=e,r}async function s(e=[]){let t=function(e=[]){let t=new Set;return e.forEach(e=>{let a=n(e);a&&t.add(a)}),t}(e),r=0===t.size,i=new Map;try{(await o()).forEach(e=>{let o=n(e?.email);o&&(r||t.has(o))&&i.set(o,{email:o,name:(0,a.formatPersonName)({firstName:e?.firstName,middleName:e?.middleName,lastName:e?.lastName,fallbackEmail:o,fallbackLabel:"User"}),avatarUrl:"string"==typeof e?.profilePhotoDataUrl?e.profilePhotoDataUrl:null})})}catch{}return t.forEach(e=>{i.has(e)||i.set(e,{email:e,name:(0,a.formatNameFromEmail)(e),avatarUrl:null})}),i}function l(e,t){let r=n(t);if(r&&e instanceof Map){let t=e.get(r);if(t)return t}if(r)return{email:r,name:(0,a.formatNameFromEmail)(r),avatarUrl:null};let i=String(t||"").trim();return i?{email:i,name:i,avatarUrl:null}:{email:"",name:"System",avatarUrl:null}}function d(e,t,{actorKey:a="by"}={}){return Array.isArray(e)?e.map(e=>{let r=l(t,e?.[a]);return{...e,[`${a}Name`]:r.name,[`${a}Email`]:r.email||String(e?.[a]||""),[`${a}Avatar`]:r.avatarUrl}}):[]}function u(e,t="by"){return Array.isArray(e)?e.map(e=>e?.[t]).filter(Boolean):[]}function c(e){if(!e||"object"!=typeof e)return[];let t=[e.createdBy,e.updatedBy];return Array.isArray(e.activityHistory)&&e.activityHistory.forEach(e=>{t.push(e?.by)}),Array.isArray(e.documents)&&e.documents.forEach(e=>{t.push(e?.uploadedBy)}),t.filter(Boolean)}function m(e,t){if(!e||"object"!=typeof e)return e;let a=l(t,e.createdBy),r=l(t,e.updatedBy),i=Array.isArray(e.activityHistory)?e.activityHistory.map(e=>{let a=l(t,e?.by);return{...e,byName:a.name,byEmail:a.email||String(e?.by||""),byAvatar:a.avatarUrl}}):[],n=Array.isArray(e.documents)?e.documents.map(e=>{let a=l(t,e?.uploadedBy);return{...e,uploadedByName:a.name,uploadedByEmail:a.email||String(e?.uploadedBy||""),uploadedByAvatar:a.avatarUrl}}):[];return{...e,createdByName:a.name,createdByEmail:a.email||String(e.createdBy||""),createdByAvatar:a.avatarUrl,updatedByName:r.name,updatedByEmail:r.email||String(e.updatedBy||""),updatedByAvatar:r.avatarUrl,activityHistory:i,documents:n}}function p(e){if(!e||"object"!=typeof e)return[];let t=[e.createdBy,e.updatedBy];return Array.isArray(e.versionHistory)&&e.versionHistory.forEach(e=>{t.push(e?.changedBy)}),Array.isArray(e.modificationLog)&&e.modificationLog.forEach(e=>{t.push(e?.by)}),Array.isArray(e.usageLogs)&&e.usageLogs.forEach(e=>{t.push(e?.by,e?.uploadedBy,e?.performedBy)}),t.filter(Boolean)}function y(e,t){if(!e||"object"!=typeof e)return e;let a=l(t,e.createdBy),r=l(t,e.updatedBy),i=Array.isArray(e.versionHistory)?e.versionHistory.map(e=>{let a=l(t,e?.changedBy);return{...e,changedByName:a.name,changedByEmail:a.email||String(e?.changedBy||""),changedByAvatar:a.avatarUrl}}):[],n=Array.isArray(e.modificationLog)?e.modificationLog.map(e=>{let a=l(t,e?.by);return{...e,byName:a.name,byEmail:a.email||String(e?.by||""),byAvatar:a.avatarUrl}}):[];return{...e,createdByName:a.name,createdByEmail:a.email||String(e.createdBy||""),createdByAvatar:a.avatarUrl,updatedByName:r.name,updatedByEmail:r.email||String(e.updatedBy||""),updatedByAvatar:r.avatarUrl,versionHistory:i,modificationLog:n}}e.s(["collectEmailsFromTrail",()=>u,"collectEmployeeActorValues",()=>c,"collectTemplateActorValues",()=>p,"createActorDirectory",()=>s,"enrichEmployeeRecordActors",()=>m,"enrichTemplateRecordActors",()=>y,"enrichTrailActors",()=>d,"resolveActor",()=>l])},69861,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),i=e.i(59756),n=e.i(61916),o=e.i(74677),s=e.i(69741),l=e.i(16795),d=e.i(87718),u=e.i(95169),c=e.i(47587),m=e.i(66012),p=e.i(70101),y=e.i(26937),v=e.i(10372),f=e.i(93695);e.i(52474);var h=e.i(220),A=e.i(89171),g=e.i(98189),E=e.i(91387),R=e.i(45787),w=e.i(79120);let B=new Set(["leaveType","startDate","endDate","reason","employee"]);async function b(e){let t=await (0,g.authorizeApiRequest)(e,{requiredPermissions:["attendance:view"],auditModule:"Attendance Management",auditAction:"Leave requests list request"});if(t.error)return t.error;let{session:a}=t;try{let t=e.nextUrl?.searchParams.get("employeeEmail"),r=(0,w.getSelfRestrictedOwnerEmail)({session:a,requestedOwnerEmail:t}),i=String(e.nextUrl?.searchParams.get("status")||"").trim().toLowerCase(),n=(await (0,R.listLeaveRequestsBackend)({ownerEmail:r||void 0})).filter(e=>!i||String(e.status||"").trim().toLowerCase().includes(i)),o=[];n.forEach(e=>{o.push(e.approver,e.createdBy,e.updatedBy),o.push(...(0,E.collectEmailsFromTrail)(e.modificationTrail,"by"))});let s=await (0,E.createActorDirectory)(o),l=n.map(e=>{let t=(0,E.resolveActor)(s,e.approver),a=(0,E.resolveActor)(s,e.createdBy),r=(0,E.resolveActor)(s,e.updatedBy);return{...e,approverName:t.name,approverEmail:t.email||String(e.approver||""),approverAvatar:t.avatarUrl,createdByName:a.name,createdByEmail:a.email||String(e.createdBy||""),createdByAvatar:a.avatarUrl,updatedByName:r.name,updatedByEmail:r.email||String(e.updatedBy||""),updatedByAvatar:r.avatarUrl,modificationTrail:(0,E.enrichTrailActors)(e.modificationTrail,s,{actorKey:"by"})}});return await (0,w.logApiAudit)({request:e,module:"Attendance Management",activityName:"Leave requests listed",status:"Completed",sensitivity:"Sensitive",performedBy:a.email,metadata:{resultCount:l.length,ownerFilterApplied:!!r,hasStatusFilter:!!i,viewedRecordRefs:l.slice(0,25).map(e=>({recordId:e.id,recordRef:(0,w.resolveAuditRecordRef)(e,e.id,["employeeId","id"]),employeeEmail:e.employeeEmail||"",leaveType:e.leaveType||"",status:e.status||""})),auditNote:`Listed ${l.length} leave request record(s) in the current query window.`,nextAction:"No further action required."}}),A.NextResponse.json({records:l})}catch(i){let t=i instanceof Error?i.message:"unknown_error",r=(0,w.mapBackendError)(t,"Unable to load leave requests.");return await (0,w.logApiAudit)({request:e,module:"Attendance Management",activityName:"Leave requests list failed",status:"Failed",sensitivity:"Sensitive",performedBy:a.email,metadata:{reason:t}}),A.NextResponse.json({message:r.message},{status:r.status})}}async function N(e){let t=await (0,g.authorizeApiRequest)(e,{requiredPermissions:["attendance:view"],auditModule:"Attendance Management",auditAction:"Leave request create request"});if(t.error)return t.error;let{session:a}=t;try{let t=await (0,w.parseJsonBody)(e),r=(0,w.normalizeEmail)(t.employeeEmail||a.email),i=(0,w.normalizeEmail)(a.email),n=r===i;if(!(0,w.canActorEditModule)({role:a.role,editPermission:"attendance:edit",selfEditPermission:"requests:create:self",isSelfResource:n}))return await (0,w.logApiAudit)({request:e,module:"Attendance Management",activityName:"Leave request create blocked by permission policy",status:"Rejected",sensitivity:"Sensitive",performedBy:a.email,metadata:{role:a.role,targetEmployeeEmail:r||null}}),A.NextResponse.json({message:"Forbidden."},{status:403});let o=(0,w.canActorEditModule)({role:a.role,editPermission:"attendance:edit",isSelfResource:!1}),s=o?t:t&&"object"==typeof t?Object.entries(t).reduce((e,[t,a])=>(B.has(t)&&(e[t]=a),e),{}):{};if(!o&&0===Object.keys(s).length)return A.NextResponse.json({message:"No allowed leave request fields to update."},{status:400});s.employeeEmail=o?r:i,s.employee||o||(s.employee=a.email),s.status||(s.status="Pending");let l=await (0,R.createLeaveRequestBackend)(s,a.email);return await (0,w.logApiAudit)({request:e,module:"Attendance Management",activityName:"Leave request created",status:"Approved",sensitivity:"Sensitive",performedBy:a.email,metadata:{recordId:l.id,recordRef:(0,w.resolveAuditRecordRef)(l,l.id,["employeeId","id"]),employeeEmail:l.employeeEmail,leaveType:l.leaveType,status:l.status,selfService:!o,resourceType:"Leave Request",resourceLabel:`${l.employee||l.employeeEmail||"Employee"} ${l.leaveType?`- ${l.leaveType}`:""}`.trim(),changedFields:Object.keys(s||{}),changedFieldCount:Object.keys(s||{}).length,auditNote:`Created leave request with fields: ${(0,w.summarizeAuditFieldList)(Object.keys(s||{}),"No explicit payload fields captured.")}.`,nextAction:"No further action required."}}),A.NextResponse.json({ok:!0,record:l},{status:201})}catch(i){let t=i instanceof Error?i.message:"unknown_error",r=(0,w.mapBackendError)(t,"Unable to create leave request.");return await (0,w.logApiAudit)({request:e,module:"Attendance Management",activityName:"Leave request create failed",status:"Failed",sensitivity:"Sensitive",performedBy:a.email,metadata:{reason:t}}),A.NextResponse.json({message:r.message},{status:r.status})}}e.s(["GET",()=>b,"POST",()=>N],64809);var S=e.i(64809);let q=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/hris/attendance/leave-requests/route",pathname:"/api/hris/attendance/leave-requests",filename:"route",bundlePath:""},distDir:".next-clio-run-1771925632882",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/hris/attendance/leave-requests/route.js",nextConfigOutput:"",userland:S}),{workAsyncStorage:T,workUnitAsyncStorage:x,serverHooks:C}=q;function U(){return(0,r.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:x})}async function P(e,t,r){q.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let A="/api/hris/attendance/leave-requests/route";A=A.replace(/\/index$/,"")||"/";let g=await q.prepare(e,t,{srcPage:A,multiZoneDraftMode:!1});if(!g)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:E,params:R,nextConfig:w,parsedUrl:B,isDraftMode:b,prerenderManifest:N,routerServerContext:S,isOnDemandRevalidate:T,revalidateOnlyGenerated:x,resolvedPathname:C,clientReferenceManifest:U,serverActionsManifest:P}=g,k=(0,s.normalizeAppPath)(A),L=!!(N.dynamicRoutes[k]||N.routes[C]),O=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,B,!1):t.end("This page could not be found"),null);if(L&&!b){let e=!!N.routes[C],t=N.dynamicRoutes[k];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await O();throw new f.NoFallbackError}}let _=null;!L||q.isDev||b||(_="/index"===(_=C)?"/":_);let j=!0===q.isDev||!L,H=L&&!j;P&&U&&(0,o.setManifestsSingleton)({page:A,clientReferenceManifest:U,serverActionsManifest:P});let M=e.method||"GET",D=(0,n.getTracer)(),F=D.getActiveScopeSpan(),I={params:R,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,i)=>q.onRequestError(e,t,r,i,S)},sharedContext:{buildId:E}},$=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),z=d.NextRequestAdapter.fromNodeNextRequest($,(0,d.signalFromNodeResponse)(t));try{let o=async e=>q.handle(z,I).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=D.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${M} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${A}`)}),s=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var n,l;let d=async({previousCacheEntry:a})=>{try{if(!s&&T&&x&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(i);e.fetchMetrics=I.renderOpts.fetchMetrics;let l=I.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let d=I.renderOpts.collectedTags;if(!L)return await (0,m.sendResponse)($,K,n,I.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[v.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==I.renderOpts.collectedRevalidate&&!(I.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&I.renderOpts.collectedRevalidate,r=void 0===I.renderOpts.collectedExpire||I.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:I.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await q.onRequestError(e,t,{routerKind:"App Router",routePath:A,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:T})},!1,S),t}},u=await q.handleResponse({req:e,nextConfig:w,cacheKey:_,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:x,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:s});if(!L)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",T?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,p.fromNodeOutgoingHttpHeaders)(u.value.headers);return s&&L||f.delete(v.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,y.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)($,K,new Response(u.value.body,{headers:f,status:u.value.status||200})),null};F?await l(F):await D.withPropagatedContext(e.headers,()=>D.trace(u.BaseServerSpan.handleRequest,{spanName:`${M} ${A}`,kind:n.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await q.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:T})},!1,S),L)throw t;return await (0,m.sendResponse)($,K,new Response(null,{status:500})),null}}e.s(["handler",()=>P,"patchFetch",()=>U,"routeModule",()=>q,"serverHooks",()=>C,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>x],69861)},11072,e=>{e.v(t=>Promise.all(["server/chunks/src_lib_security-notifications_5f07320b.js","server/chunks/src_lib_security-detection_4bdbe3ad.js"].map(t=>e.l(t))).then(()=>t(74405)))}];

//# sourceMappingURL=_763e5294._.js.map