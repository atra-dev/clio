module.exports=[91387,e=>{"use strict";var t=e.i(45709),a=e.i(44801);let r=[],i=0;function o(e){let t=String(e||"").trim().toLowerCase();return t&&t.includes("@")?t:""}async function n(){let e=Date.now();if(e-i<3e4&&Array.isArray(r))return r;let a=await (0,t.listUserAccounts)();return r=Array.isArray(a)?a:[],i=e,r}async function s(e=[]){let t=function(e=[]){let t=new Set;return e.forEach(e=>{let a=o(e);a&&t.add(a)}),t}(e),r=0===t.size,i=new Map;try{(await n()).forEach(e=>{let n=o(e?.email);n&&(r||t.has(n))&&i.set(n,{email:n,name:(0,a.formatPersonName)({firstName:e?.firstName,middleName:e?.middleName,lastName:e?.lastName,fallbackEmail:n,fallbackLabel:"User"}),avatarUrl:"string"==typeof e?.profilePhotoDataUrl?e.profilePhotoDataUrl:null})})}catch{}return t.forEach(e=>{i.has(e)||i.set(e,{email:e,name:(0,a.formatNameFromEmail)(e),avatarUrl:null})}),i}function l(e,t){let r=o(t);if(r&&e instanceof Map){let t=e.get(r);if(t)return t}if(r)return{email:r,name:(0,a.formatNameFromEmail)(r),avatarUrl:null};let i=String(t||"").trim();return i?{email:i,name:i,avatarUrl:null}:{email:"",name:"System",avatarUrl:null}}function d(e,t,{actorKey:a="by"}={}){return Array.isArray(e)?e.map(e=>{let r=l(t,e?.[a]);return{...e,[`${a}Name`]:r.name,[`${a}Email`]:r.email||String(e?.[a]||""),[`${a}Avatar`]:r.avatarUrl}}):[]}function u(e,t="by"){return Array.isArray(e)?e.map(e=>e?.[t]).filter(Boolean):[]}function c(e){if(!e||"object"!=typeof e)return[];let t=[e.createdBy,e.updatedBy];return Array.isArray(e.activityHistory)&&e.activityHistory.forEach(e=>{t.push(e?.by)}),Array.isArray(e.documents)&&e.documents.forEach(e=>{t.push(e?.uploadedBy)}),t.filter(Boolean)}function p(e,t){if(!e||"object"!=typeof e)return e;let a=l(t,e.createdBy),r=l(t,e.updatedBy),i=Array.isArray(e.activityHistory)?e.activityHistory.map(e=>{let a=l(t,e?.by);return{...e,byName:a.name,byEmail:a.email||String(e?.by||""),byAvatar:a.avatarUrl}}):[],o=Array.isArray(e.documents)?e.documents.map(e=>{let a=l(t,e?.uploadedBy);return{...e,uploadedByName:a.name,uploadedByEmail:a.email||String(e?.uploadedBy||""),uploadedByAvatar:a.avatarUrl}}):[];return{...e,createdByName:a.name,createdByEmail:a.email||String(e.createdBy||""),createdByAvatar:a.avatarUrl,updatedByName:r.name,updatedByEmail:r.email||String(e.updatedBy||""),updatedByAvatar:r.avatarUrl,activityHistory:i,documents:o}}function m(e){if(!e||"object"!=typeof e)return[];let t=[e.createdBy,e.updatedBy];return Array.isArray(e.versionHistory)&&e.versionHistory.forEach(e=>{t.push(e?.changedBy)}),Array.isArray(e.modificationLog)&&e.modificationLog.forEach(e=>{t.push(e?.by)}),Array.isArray(e.usageLogs)&&e.usageLogs.forEach(e=>{t.push(e?.by,e?.uploadedBy,e?.performedBy)}),t.filter(Boolean)}function y(e,t){if(!e||"object"!=typeof e)return e;let a=l(t,e.createdBy),r=l(t,e.updatedBy),i=Array.isArray(e.versionHistory)?e.versionHistory.map(e=>{let a=l(t,e?.changedBy);return{...e,changedByName:a.name,changedByEmail:a.email||String(e?.changedBy||""),changedByAvatar:a.avatarUrl}}):[],o=Array.isArray(e.modificationLog)?e.modificationLog.map(e=>{let a=l(t,e?.by);return{...e,byName:a.name,byEmail:a.email||String(e?.by||""),byAvatar:a.avatarUrl}}):[];return{...e,createdByName:a.name,createdByEmail:a.email||String(e.createdBy||""),createdByAvatar:a.avatarUrl,updatedByName:r.name,updatedByEmail:r.email||String(e.updatedBy||""),updatedByAvatar:r.avatarUrl,versionHistory:i,modificationLog:o}}e.s(["collectEmailsFromTrail",()=>u,"collectEmployeeActorValues",()=>c,"collectTemplateActorValues",()=>m,"createActorDirectory",()=>s,"enrichEmployeeRecordActors",()=>p,"enrichTemplateRecordActors",()=>y,"enrichTrailActors",()=>d,"resolveActor",()=>l])},1520,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),i=e.i(59756),o=e.i(61916),n=e.i(74677),s=e.i(69741),l=e.i(16795),d=e.i(87718),u=e.i(95169),c=e.i(47587),p=e.i(66012),m=e.i(70101),y=e.i(26937),f=e.i(10372),v=e.i(93695);e.i(52474);var h=e.i(220),A=e.i(89171),R=e.i(98189),g=e.i(91387),E=e.i(45787),w=e.i(79120);async function N(e){let t=await e;return"string"==typeof t?.recordId?t.recordId:""}async function T(e,{params:t}){let a=await (0,R.authorizeApiRequest)(e,{requiredPermissions:["templates:view"],auditModule:"Template Repository",auditAction:"Template view request"});if(a.error)return a.error;let{session:r}=a,i=await N(t);try{let t=await (0,E.getDocumentTemplateBackend)(i);if(!t)return A.NextResponse.json({message:"Record not found."},{status:404});let a=(0,w.isEmployeeRole)(r.role);if(a&&"active"!==String(t.status||"").trim().toLowerCase())return A.NextResponse.json({message:"Record not found."},{status:404});let o=a?t&&"object"==typeof t?{id:t.id,templateName:t.templateName,category:t.category,classification:t.classification,version:t.version,status:t.status,contentRef:t.contentRef||"",updatedAt:t.updatedAt||null}:null:t;if(!a){let e=await (0,g.createActorDirectory)((0,g.collectTemplateActorValues)(o));o=(0,g.enrichTemplateRecordActors)(o,e)}return await (0,w.logApiAudit)({request:e,module:"Template Repository",activityName:"Template viewed",status:"Completed",sensitivity:a?"Non-sensitive":"Sensitive",performedBy:r.email,metadata:{recordId:i,templateName:t.templateName||null,employeeScope:a}}),A.NextResponse.json({record:o})}catch(o){let t=o instanceof Error?o.message:"unknown_error",a=(0,w.mapBackendError)(t,"Unable to load template.");return await (0,w.logApiAudit)({request:e,module:"Template Repository",activityName:"Template view failed",status:"Failed",sensitivity:"Sensitive",performedBy:r.email,metadata:{recordId:i,reason:t}}),A.NextResponse.json({message:a.message},{status:a.status})}}async function B(e,{params:t}){let a=await (0,R.authorizeApiRequest)(e,{requiredPermissions:["templates:view"],auditModule:"Template Repository",auditAction:"Template update request"});if(a.error)return a.error;let{session:r}=a,i=await N(t);if(!(0,w.canActorEditModule)({role:r.role,editPermission:"templates:edit",isSelfResource:!1}))return await (0,w.logApiAudit)({request:e,module:"Template Repository",activityName:"Template update blocked by permission policy",status:"Rejected",sensitivity:"Sensitive",performedBy:r.email,metadata:{recordId:i,role:r.role}}),A.NextResponse.json({message:"Forbidden."},{status:403});try{let t=await (0,w.parseJsonBody)(e),a=await (0,E.updateDocumentTemplateBackend)(i,t,r.email);if(!a)return A.NextResponse.json({message:"Record not found."},{status:404});await (0,w.logApiAudit)({request:e,module:"Template Repository",activityName:"Template updated",status:"Approved",sensitivity:"Sensitive",performedBy:r.email,metadata:{recordId:i,templateName:a.templateName||null,version:a.version||null,updatedFields:Object.keys(t||{})}});let o=await (0,g.createActorDirectory)((0,g.collectTemplateActorValues)(a));return A.NextResponse.json({ok:!0,record:(0,g.enrichTemplateRecordActors)(a,o)})}catch(o){let t=o instanceof Error?o.message:"unknown_error",a=(0,w.mapBackendError)(t,"Unable to update template.");return await (0,w.logApiAudit)({request:e,module:"Template Repository",activityName:"Template update failed",status:"Failed",sensitivity:"Sensitive",performedBy:r.email,metadata:{recordId:i,reason:t}}),A.NextResponse.json({message:a.message},{status:a.status})}}async function b(e,{params:t}){let a=await (0,R.authorizeApiRequest)(e,{requiredPermissions:["templates:view"],auditModule:"Template Repository",auditAction:"Template archive request"});if(a.error)return a.error;let{session:r}=a,i=await N(t);if(!(0,w.canActorEditModule)({role:r.role,editPermission:"templates:edit",isSelfResource:!1}))return await (0,w.logApiAudit)({request:e,module:"Template Repository",activityName:"Template archive blocked by permission policy",status:"Rejected",sensitivity:"Sensitive",performedBy:r.email,metadata:{recordId:i,role:r.role}}),A.NextResponse.json({message:"Forbidden."},{status:403});try{let t=await (0,E.deleteDocumentTemplateBackend)(i,r.email);if(!t)return A.NextResponse.json({message:"Record not found."},{status:404});await (0,w.logApiAudit)({request:e,module:"Template Repository",activityName:"Template archived",status:"Approved",sensitivity:"Sensitive",performedBy:r.email,metadata:{recordId:i,templateName:t.templateName||null,status:t.status||null}});let a=await (0,g.createActorDirectory)((0,g.collectTemplateActorValues)(t));return A.NextResponse.json({ok:!0,record:(0,g.enrichTemplateRecordActors)(t,a)})}catch(o){let t=o instanceof Error?o.message:"unknown_error",a=(0,w.mapBackendError)(t,"Unable to archive template.");return await (0,w.logApiAudit)({request:e,module:"Template Repository",activityName:"Template archive failed",status:"Failed",sensitivity:"Sensitive",performedBy:r.email,metadata:{recordId:i,reason:t}}),A.NextResponse.json({message:a.message},{status:a.status})}}e.s(["DELETE",()=>b,"GET",()=>T,"PATCH",()=>B],82804);var S=e.i(82804);let x=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/hris/templates/[recordId]/route",pathname:"/api/hris/templates/[recordId]",filename:"route",bundlePath:""},distDir:".next-clio-run-1771925632882",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/hris/templates/[recordId]/route.js",nextConfigOutput:"",userland:S}),{workAsyncStorage:C,workUnitAsyncStorage:U,serverHooks:P}=x;function k(){return(0,r.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:U})}async function j(e,t,r){x.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let A="/api/hris/templates/[recordId]/route";A=A.replace(/\/index$/,"")||"/";let R=await x.prepare(e,t,{srcPage:A,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:g,params:E,nextConfig:w,parsedUrl:N,isDraftMode:T,prerenderManifest:B,routerServerContext:b,isOnDemandRevalidate:S,revalidateOnlyGenerated:C,resolvedPathname:U,clientReferenceManifest:P,serverActionsManifest:k}=R,j=(0,s.normalizeAppPath)(A),_=!!(B.dynamicRoutes[j]||B.routes[U]),H=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,N,!1):t.end("This page could not be found"),null);if(_&&!T){let e=!!B.routes[U],t=B.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await H();throw new v.NoFallbackError}}let D=null;!_||x.isDev||T||(D="/index"===(D=U)?"/":D);let q=!0===x.isDev||!_,O=_&&!q;k&&P&&(0,n.setManifestsSingleton)({page:A,clientReferenceManifest:P,serverActionsManifest:k});let I=e.method||"GET",M=(0,o.getTracer)(),F=M.getActiveScopeSpan(),L={params:E,prerenderManifest:B,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:q,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,i)=>x.onRequestError(e,t,r,i,b)},sharedContext:{buildId:g}},$=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),V=d.NextRequestAdapter.fromNodeNextRequest($,(0,d.signalFromNodeResponse)(t));try{let n=async e=>x.handle(V,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=M.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${I} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${I} ${A}`)}),s=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var o,l;let d=async({previousCacheEntry:a})=>{try{if(!s&&S&&C&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await n(i);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let d=L.renderOpts.collectedTags;if(!_)return await (0,p.sendResponse)($,K,o,L.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[f.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,r=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:A,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:S})},!1,b),t}},u=await x.handleResponse({req:e,nextConfig:w,cacheKey:D,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:B,isRoutePPREnabled:!1,isOnDemandRevalidate:S,revalidateOnlyGenerated:C,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:s});if(!_)return null;if((null==u||null==(o=u.value)?void 0:o.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",S?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),T&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let v=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return s&&_||v.delete(f.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||v.get("Cache-Control")||v.set("Cache-Control",(0,y.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)($,K,new Response(u.value.body,{headers:v,status:u.value.status||200})),null};F?await l(F):await M.withPropagatedContext(e.headers,()=>M.trace(u.BaseServerSpan.handleRequest,{spanName:`${I} ${A}`,kind:o.SpanKind.SERVER,attributes:{"http.method":I,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:S})},!1,b),_)throw t;return await (0,p.sendResponse)($,K,new Response(null,{status:500})),null}}e.s(["handler",()=>j,"patchFetch",()=>k,"routeModule",()=>x,"serverHooks",()=>P,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>U],1520)},11072,e=>{e.v(t=>Promise.all(["server/chunks/src_lib_security-notifications_5f07320b.js","server/chunks/src_lib_security-detection_4bdbe3ad.js"].map(t=>e.l(t))).then(()=>t(74405)))}];

//# sourceMappingURL=_3344cf14._.js.map