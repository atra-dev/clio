module.exports=[33355,e=>{"use strict";e.i(18097);var t=e.i(19e3),r=e.i(67658),n=e.i(45709);function a(){return new Date().toISOString()}function i(e,t=""){return String(e||"").trim()||t}function o(e,t=!1){if("boolean"==typeof e)return e;if("number"==typeof e)return 0!==e;if("string"==typeof e){let r=e.trim().toLowerCase();if(!r)return t;if(["true","1","yes","on","y"].includes(r))return!0;if(["false","0","no","off","n"].includes(r))return!1}return t}function s(e){return Array.isArray(e)?e:[]}function l(e,t,{min:r=1,max:n=Number.MAX_SAFE_INTEGER}={}){let a=Number.parseInt(String(e||""),10);return Number.isFinite(a)?Math.min(n,Math.max(r,a)):t}function u(e){return String(e||"").trim().toLowerCase()}function d(e){return String(e||"").split(",").map(e=>u(e)).filter(Boolean)}function c(e){return"read"===String(e||"").trim().toLowerCase()?"read":"unread"}function p(){return i(process.env.CLIO_FIRESTORE_NOTIFICATIONS_COLLECTION,"clio_notifications")}function f(){return(0,r.isFirestoreEnabled)()?(0,r.getFirestoreDb)():null}function m(e){return{...e.data()||{},id:e.id,recordId:e.id}}function h(e,t){let r=u(t),n=u(e?.recipientEmail);return o(e?.broadcast,!1)||r&&n&&r===n}function R(e,t){return new Date(t?.createdAt||0).getTime()-new Date(e?.createdAt||0).getTime()}async function E(e){let r=f();if(!r)return null;let n=function(e){var t;let r,n=a(),s=u(e?.recipientEmail),l=o(e?.broadcast,!1);if(!s&&!l)throw Error("invalid_notification_recipient");return{title:i(e?.title,"Security notification"),message:i(e?.message,"A security event requires review."),severity:"critical"===(r=String(e?.severity||"").trim().toLowerCase())?"critical":"high"===r?"high":"low"===r?"low":"medium",type:i(e?.type,"security"),module:i(e?.module,"Incident Management"),actionUrl:i(e?.actionUrl,"/incident-management"),recipientEmail:s,broadcast:l,status:c(e?.status),metadata:(t=e?.metadata)&&"object"==typeof t&&!Array.isArray(t)?t:{},createdAt:i(e?.createdAt,n),updatedAt:i(e?.updatedAt,n),readAt:i(e?.readAt,""),createdBy:u(e?.createdBy)}}(e),s=await (0,t.addDoc)((0,t.collection)(r,p()),n);return{...n,id:s.id,recordId:s.id}}async function A(e){let t=s(e);if(0===t.length)return[];let r=[];for(let e of t){let t=await E(e);t&&r.push(t)}return r}async function w({recipientEmail:e,status:r="all",limit:n=20}={}){let a=f();if(!a)return{records:[],unreadCount:0,totalScoped:0};let i=String(r||"").trim().toLowerCase(),o=l(n,20,{min:1,max:120}),s=Math.max(4*o,100),u=(await (0,t.getDocs)((0,t.query)((0,t.collection)(a,p()),(0,t.orderBy)("createdAt","desc"),(0,t.limit)(s)))).docs.map(m).filter(t=>h(t,e)),d=u.reduce((e,t)=>e+ +("unread"===c(t?.status)),0);return{records:u.filter(e=>"all"===i||!i||c(e?.status)===i).sort(R).slice(0,o),unreadCount:d,totalScoped:u.length}}async function v(e,r){let n=f();if(!n)return null;let o=i(e);if(!o)throw Error("invalid_record_id");let s=(0,t.doc)(n,p(),o),l=await (0,t.getDoc)(s);if(!l.exists())return null;let u=m(l);if(!h(u,r))throw Error("forbidden_notification_access");if("read"===c(u.status))return u;let d={...u,status:"read",readAt:a(),updatedAt:a()};return await (0,t.updateDoc)(s,d),d}async function g({recipientEmail:e,limit:r=120}={}){let n=u(e);if(!n)return{updatedCount:0};let o=f();if(!o)return{updatedCount:0};let s=l(r,120,{min:1,max:300}),{records:d}=await w({recipientEmail:n,status:"unread",limit:s}),c=0;for(let e of d){let r=i(e?.id||e?.recordId);if(!r)continue;let n=(0,t.doc)(o,p(),r);await (0,t.updateDoc)(n,{status:"read",readAt:a(),updatedAt:a()}),c+=1}return{updatedCount:c}}async function y({ownerEmail:e,affectedEmployeeEmail:t,actorEmail:r,includeAffectedEmployee:a=!0,includeActor:i=!1}={}){let o=[u(process.env.CLIO_GRC_ALERT_EMAIL),...d(process.env.GRC_EMAILS),...d(process.env.SUPER_ADMIN_EMAILS),u(e)];a&&o.push(u(t)),i&&o.push(u(r));let l=[];try{let e=await (0,n.listUserAccounts)();l=s(e).filter(e=>u(e?.email)).filter(e=>{var t;return"active"===(t=e?.status,String(t||"").trim().toLowerCase())}).filter(e=>{let t=String(e?.role||"").trim().toUpperCase();return"GRC"===t||"SUPER_ADMIN"===t}).map(e=>u(e?.email))}catch{l=[]}return function(e=[]){return Array.from(new Set(s(e).map(e=>u(e)).filter(Boolean)))}([...o,...l])}e.s(["createInAppNotificationsBulk",()=>A,"listInAppNotifications",()=>w,"markAllInAppNotificationsRead",()=>g,"markInAppNotificationRead",()=>v,"resolveIncidentStakeholderRecipients",()=>y])},43462,e=>{"use strict";var t=e.i(47909),r=e.i(74017),n=e.i(96250),a=e.i(59756),i=e.i(61916),o=e.i(74677),s=e.i(69741),l=e.i(16795),u=e.i(87718),d=e.i(95169),c=e.i(47587),p=e.i(66012),f=e.i(70101),m=e.i(26937),h=e.i(10372),R=e.i(93695);e.i(52474);var E=e.i(220),A=e.i(89171),w=e.i(98189),v=e.i(79120),g=e.i(33355);async function y(e){let t=await (0,w.authorizeApiRequest)(e,{requiredPermissions:["resource:own"],ownerIdentifier:e=>e.email,ownerBypassRoles:["SUPER_ADMIN","GRC","HR","EA","EMPLOYEE_L1","EMPLOYEE_L2","EMPLOYEE_L3"],auditModule:"Notifications",auditAction:"Notification mark-all-read request"});if(t.error)return t.error;let{session:r}=t;try{let t=await e.json().catch(()=>({})),n=(0,v.parsePositiveInt)(t?.limit,120,{min:1,max:300}),a=await (0,g.markAllInAppNotificationsRead)({recipientEmail:r.email,limit:n});return A.NextResponse.json({ok:!0,updatedCount:Number(a?.updatedCount||0)})}catch{return A.NextResponse.json({message:"Unable to mark notifications as read."},{status:400})}}e.s(["POST",()=>y],92400);var C=e.i(92400);let _=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/notifications/read-all/route",pathname:"/api/notifications/read-all",filename:"route",bundlePath:""},distDir:".next-clio-run-1771925632882",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/notifications/read-all/route.js",nextConfigOutput:"",userland:C}),{workAsyncStorage:S,workUnitAsyncStorage:I,serverHooks:N}=_;function b(){return(0,n.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:I})}async function x(e,t,n){_.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let A="/api/notifications/read-all/route";A=A.replace(/\/index$/,"")||"/";let w=await _.prepare(e,t,{srcPage:A,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:v,params:g,nextConfig:y,parsedUrl:C,isDraftMode:S,prerenderManifest:I,routerServerContext:N,isOnDemandRevalidate:b,revalidateOnlyGenerated:x,resolvedPathname:O,clientReferenceManifest:P,serverActionsManifest:T}=w,M=(0,s.normalizeAppPath)(A),k=!!(I.dynamicRoutes[M]||I.routes[O]),D=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,C,!1):t.end("This page could not be found"),null);if(k&&!S){let e=!!I.routes[O],t=I.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await D();throw new R.NoFallbackError}}let L=null;!k||_.isDev||S||(L="/index"===(L=O)?"/":L);let U=!0===_.isDev||!k,q=k&&!U;T&&P&&(0,o.setManifestsSingleton)({page:A,clientReferenceManifest:P,serverActionsManifest:T});let H=e.method||"GET",j=(0,i.getTracer)(),F=j.getActiveScopeSpan(),B={params:g,prerenderManifest:I,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n,a)=>_.onRequestError(e,t,n,a,N)},sharedContext:{buildId:v}},$=new l.NodeNextRequest(e),G=new l.NodeNextResponse(t),K=u.NextRequestAdapter.fromNodeNextRequest($,(0,u.signalFromNodeResponse)(t));try{let o=async e=>_.handle(K,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${H} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${A}`)}),s=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var i,l;let u=async({previousCacheEntry:r})=>{try{if(!s&&b&&x&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await o(a);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let u=B.renderOpts.collectedTags;if(!k)return await (0,p.sendResponse)($,G,i,B.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(i.headers);u&&(t[h.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,n=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await _.onRequestError(e,t,{routerKind:"App Router",routePath:A,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:b})},!1,N),t}},d=await _.handleResponse({req:e,nextConfig:y,cacheKey:L,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:I,isRoutePPREnabled:!1,isOnDemandRevalidate:b,revalidateOnlyGenerated:x,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:s});if(!k)return null;if((null==d||null==(i=d.value)?void 0:i.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",b?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let R=(0,f.fromNodeOutgoingHttpHeaders)(d.value.headers);return s&&k||R.delete(h.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||R.get("Cache-Control")||R.set("Cache-Control",(0,m.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)($,G,new Response(d.value.body,{headers:R,status:d.value.status||200})),null};F?await l(F):await j.withPropagatedContext(e.headers,()=>j.trace(d.BaseServerSpan.handleRequest,{spanName:`${H} ${A}`,kind:i.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof R.NoFallbackError||await _.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:b})},!1,N),k)throw t;return await (0,p.sendResponse)($,G,new Response(null,{status:500})),null}}e.s(["handler",()=>x,"patchFetch",()=>b,"routeModule",()=>_,"serverHooks",()=>N,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>I],43462)},11072,e=>{e.v(t=>Promise.all(["server/chunks/src_lib_9a482084._.js","server/chunks/src_lib_hris-backend_4dbd0cdd.js","server/chunks/src_lib_security-detection_4bdbe3ad.js"].map(t=>e.l(t))).then(()=>t(74405)))}];

//# sourceMappingURL=_04601f3f._.js.map