module.exports=[91387,e=>{"use strict";var t=e.i(45709),r=e.i(44801);let a=[],i=0;function o(e){let t=String(e||"").trim().toLowerCase();return t&&t.includes("@")?t:""}async function n(){let e=Date.now();if(e-i<3e4&&Array.isArray(a))return a;let r=await (0,t.listUserAccounts)();return a=Array.isArray(r)?r:[],i=e,a}async function s(e=[]){let t=function(e=[]){let t=new Set;return e.forEach(e=>{let r=o(e);r&&t.add(r)}),t}(e),a=0===t.size,i=new Map;try{(await n()).forEach(e=>{let n=o(e?.email);n&&(a||t.has(n))&&i.set(n,{email:n,name:(0,r.formatPersonName)({firstName:e?.firstName,middleName:e?.middleName,lastName:e?.lastName,fallbackEmail:n,fallbackLabel:"User"}),avatarUrl:"string"==typeof e?.profilePhotoDataUrl?e.profilePhotoDataUrl:null})})}catch{}return t.forEach(e=>{i.has(e)||i.set(e,{email:e,name:(0,r.formatNameFromEmail)(e),avatarUrl:null})}),i}function l(e,t){let a=o(t);if(a&&e instanceof Map){let t=e.get(a);if(t)return t}if(a)return{email:a,name:(0,r.formatNameFromEmail)(a),avatarUrl:null};let i=String(t||"").trim();return i?{email:i,name:i,avatarUrl:null}:{email:"",name:"System",avatarUrl:null}}function d(e,t,{actorKey:r="by"}={}){return Array.isArray(e)?e.map(e=>{let a=l(t,e?.[r]);return{...e,[`${r}Name`]:a.name,[`${r}Email`]:a.email||String(e?.[r]||""),[`${r}Avatar`]:a.avatarUrl}}):[]}function c(e,t="by"){return Array.isArray(e)?e.map(e=>e?.[t]).filter(Boolean):[]}function u(e){if(!e||"object"!=typeof e)return[];let t=[e.createdBy,e.updatedBy];return Array.isArray(e.activityHistory)&&e.activityHistory.forEach(e=>{t.push(e?.by)}),Array.isArray(e.documents)&&e.documents.forEach(e=>{t.push(e?.uploadedBy)}),t.filter(Boolean)}function m(e,t){if(!e||"object"!=typeof e)return e;let r=l(t,e.createdBy),a=l(t,e.updatedBy),i=Array.isArray(e.activityHistory)?e.activityHistory.map(e=>{let r=l(t,e?.by);return{...e,byName:r.name,byEmail:r.email||String(e?.by||""),byAvatar:r.avatarUrl}}):[],o=Array.isArray(e.documents)?e.documents.map(e=>{let r=l(t,e?.uploadedBy);return{...e,uploadedByName:r.name,uploadedByEmail:r.email||String(e?.uploadedBy||""),uploadedByAvatar:r.avatarUrl}}):[];return{...e,createdByName:r.name,createdByEmail:r.email||String(e.createdBy||""),createdByAvatar:r.avatarUrl,updatedByName:a.name,updatedByEmail:a.email||String(e.updatedBy||""),updatedByAvatar:a.avatarUrl,activityHistory:i,documents:o}}function p(e){if(!e||"object"!=typeof e)return[];let t=[e.createdBy,e.updatedBy];return Array.isArray(e.versionHistory)&&e.versionHistory.forEach(e=>{t.push(e?.changedBy)}),Array.isArray(e.modificationLog)&&e.modificationLog.forEach(e=>{t.push(e?.by)}),Array.isArray(e.usageLogs)&&e.usageLogs.forEach(e=>{t.push(e?.by,e?.uploadedBy,e?.performedBy)}),t.filter(Boolean)}function y(e,t){if(!e||"object"!=typeof e)return e;let r=l(t,e.createdBy),a=l(t,e.updatedBy),i=Array.isArray(e.versionHistory)?e.versionHistory.map(e=>{let r=l(t,e?.changedBy);return{...e,changedByName:r.name,changedByEmail:r.email||String(e?.changedBy||""),changedByAvatar:r.avatarUrl}}):[],o=Array.isArray(e.modificationLog)?e.modificationLog.map(e=>{let r=l(t,e?.by);return{...e,byName:r.name,byEmail:r.email||String(e?.by||""),byAvatar:r.avatarUrl}}):[];return{...e,createdByName:r.name,createdByEmail:r.email||String(e.createdBy||""),createdByAvatar:r.avatarUrl,updatedByName:a.name,updatedByEmail:a.email||String(e.updatedBy||""),updatedByAvatar:a.avatarUrl,versionHistory:i,modificationLog:o}}e.s(["collectEmailsFromTrail",()=>c,"collectEmployeeActorValues",()=>u,"collectTemplateActorValues",()=>p,"createActorDirectory",()=>s,"enrichEmployeeRecordActors",()=>m,"enrichTemplateRecordActors",()=>y,"enrichTrailActors",()=>d,"resolveActor",()=>l])},54981,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),i=e.i(59756),o=e.i(61916),n=e.i(74677),s=e.i(69741),l=e.i(16795),d=e.i(87718),c=e.i(95169),u=e.i(47587),m=e.i(66012),p=e.i(70101),y=e.i(26937),f=e.i(10372),h=e.i(93695);e.i(52474);var v=e.i(220),g=e.i(89171),E=e.i(98189),A=e.i(91387),R=e.i(45787),w=e.i(79120);function N(e){return String(e??"").trim()}async function B(e){let t=await (0,E.authorizeApiRequest)(e,{requiredPermissions:["employees:view"],auditModule:"Employee Records",auditAction:"Employee records list request"});if(t.error)return t.error;let{session:r}=t;try{var a;let t,i=e.nextUrl?.searchParams.get("ownerEmail"),o=String(e.nextUrl?.searchParams.get("q")||"").trim().toLowerCase(),n=String(e.nextUrl?.searchParams.get("status")||"").trim().toLowerCase(),s=String(e.nextUrl?.searchParams.get("role")||"").trim().toLowerCase(),l=(a=e.nextUrl?.searchParams.get("includeDocuments"),t=String(a||"").trim().toLowerCase(),"1"===t||"true"===t||"yes"===t),d=e.nextUrl?.searchParams.get("page"),c=e.nextUrl?.searchParams.get("pageSize"),u=(0,w.getSelfRestrictedOwnerEmail)({session:r,requestedOwnerEmail:i}),m=(await (0,R.listEmployeeRecordsBackend)({ownerEmail:u||void 0,includeDocuments:l})).filter(e=>{let t=!n||String(e.status||"").trim().toLowerCase().includes(n),r=!s||String(e.role||"").trim().toLowerCase().includes(s),a=!o||[e.employeeId,e.name,e.email,e.role,e.employmentStatus].map(e=>String(e||"").trim().toLowerCase()).join(" ").includes(o);return t&&r&&a}),{data:p,pagination:y}=(0,w.paginateRows)(m,{page:d,pageSize:c}),f=p.map(e=>(0,w.sanitizeEmployeeRecordForViewer)(e,r.role)),h=f.flatMap(e=>(0,A.collectEmployeeActorValues)(e)),v=await (0,A.createActorDirectory)(h),E=f.map(e=>(0,A.enrichEmployeeRecordActors)(e,v));return await (0,w.logApiAudit)({request:e,module:"Employee Records",activityName:"Employee records listed",status:"Completed",sensitivity:"Sensitive",performedBy:r.email,metadata:{resultCount:E.length,totalMatched:m.length,ownerFilterApplied:!!u,hasSearchQuery:!!o,hasStatusFilter:!!n,viewedRecordRefs:E.slice(0,25).map(e=>({recordId:e.id,employeeId:e.employeeId||"",employeeEmail:e.email||""})),auditNote:`Listed ${E.length} employee record(s) in current page window.`,nextAction:"No further action required."}}),g.NextResponse.json({records:E,pagination:y})}catch(i){let t=i instanceof Error?i.message:"unknown_error",a=(0,w.mapBackendError)(t,"Unable to load employee records.");return await (0,w.logApiAudit)({request:e,module:"Employee Records",activityName:"Employee records list failed",status:"Failed",sensitivity:"Sensitive",performedBy:r.email,metadata:{reason:t}}),g.NextResponse.json({message:a.message},{status:a.status})}}async function S(e){let t=await (0,E.authorizeApiRequest)(e,{requiredPermissions:["employees:view"],auditModule:"Employee Records",auditAction:"Employee record create request"});if(t.error)return t.error;let{session:r}=t,a=(0,w.canActorEditModule)({role:r.role,editPermission:"employees:edit",selfEditPermission:"employees:edit:self",isSelfResource:!0}),i=(0,w.canActorEditModule)({role:r.role,editPermission:"employees:edit",isSelfResource:!1});if(!a)return await (0,w.logApiAudit)({request:e,module:"Employee Records",activityName:"Employee record create blocked by permission policy",status:"Rejected",sensitivity:"Sensitive",performedBy:r.email,metadata:{role:r.role}}),g.NextResponse.json({message:"Forbidden."},{status:403});try{let t=await (0,w.parseJsonBody)(e),a=t;if(!i){var o,n;if(!(o=t,n=r.email,a={email:String(n||"").trim().toLowerCase(),role:"EMPLOYEE_L1",status:"Active",employmentStatus:"Active Employee",firstName:N(o?.firstName),middleName:N(o?.middleName),lastName:N(o?.lastName),suffix:N(o?.suffix),contact:N(o?.contact),address:N(o?.address),emergencyContact:N(o?.emergencyContact)}).firstName||!a.lastName)return g.NextResponse.json({message:"First name and last name are required."},{status:400});if((await (0,R.listEmployeeRecordsBackend)({ownerEmail:r.email})).length>0)return g.NextResponse.json({message:"Your employee record already exists."},{status:409})}let s=await (0,R.createEmployeeRecordBackend)(a,r.email);return await (0,w.logApiAudit)({request:e,module:"Employee Records",activityName:"Employee record created",status:"Approved",sensitivity:"Sensitive",performedBy:r.email,metadata:{recordId:s.id,employeeEmail:s.email,classification:s.classification||"Restricted PII",selfServiceCreate:!i}}),g.NextResponse.json({ok:!0,record:(0,w.sanitizeEmployeeRecordForViewer)(s,r.role)},{status:201})}catch(i){let t=i instanceof Error?i.message:"unknown_error",a=(0,w.mapBackendError)(t,"Unable to create employee record.");return await (0,w.logApiAudit)({request:e,module:"Employee Records",activityName:"Employee record create failed",status:"Failed",sensitivity:"Sensitive",performedBy:r.email,metadata:{reason:t}}),g.NextResponse.json({message:a.message},{status:a.status})}}e.s(["GET",()=>B,"POST",()=>S],48441);var b=e.i(48441);let x=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/hris/employees/route",pathname:"/api/hris/employees",filename:"route",bundlePath:""},distDir:".next-clio-run-1771925632882",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/hris/employees/route.js",nextConfigOutput:"",userland:b}),{workAsyncStorage:C,workUnitAsyncStorage:U,serverHooks:P}=x;function T(){return(0,a.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:U})}async function _(e,t,a){x.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let g="/api/hris/employees/route";g=g.replace(/\/index$/,"")||"/";let E=await x.prepare(e,t,{srcPage:g,multiZoneDraftMode:!1});if(!E)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:A,params:R,nextConfig:w,parsedUrl:N,isDraftMode:B,prerenderManifest:S,routerServerContext:b,isOnDemandRevalidate:C,revalidateOnlyGenerated:U,resolvedPathname:P,clientReferenceManifest:T,serverActionsManifest:_}=E,k=(0,s.normalizeAppPath)(g),H=!!(S.dynamicRoutes[k]||S.routes[P]),L=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,N,!1):t.end("This page could not be found"),null);if(H&&!B){let e=!!S.routes[P],t=S.dynamicRoutes[k];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await L();throw new h.NoFallbackError}}let O=null;!H||x.isDev||B||(O="/index"===(O=P)?"/":O);let j=!0===x.isDev||!H,q=H&&!j;_&&T&&(0,n.setManifestsSingleton)({page:g,clientReferenceManifest:T,serverActionsManifest:_});let I=e.method||"GET",M=(0,o.getTracer)(),D=M.getActiveScopeSpan(),F={params:R,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,i)=>x.onRequestError(e,t,a,i,b)},sharedContext:{buildId:A}},$=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),V=d.NextRequestAdapter.fromNodeNextRequest($,(0,d.signalFromNodeResponse)(t));try{let n=async e=>x.handle(V,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=M.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${I} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${I} ${g}`)}),s=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var o,l;let d=async({previousCacheEntry:r})=>{try{if(!s&&C&&U&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await n(i);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=F.renderOpts.collectedTags;if(!H)return await (0,m.sendResponse)($,K,o,F.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[f.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,a=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:g,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:C})},!1,b),t}},c=await x.handleResponse({req:e,nextConfig:w,cacheKey:O,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:U,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:s});if(!H)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",C?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),B&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,p.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&H||h.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,y.getCacheControlHeader)(c.cacheControl)),await (0,m.sendResponse)($,K,new Response(c.value.body,{headers:h,status:c.value.status||200})),null};D?await l(D):await M.withPropagatedContext(e.headers,()=>M.trace(c.BaseServerSpan.handleRequest,{spanName:`${I} ${g}`,kind:o.SpanKind.SERVER,attributes:{"http.method":I,"http.target":e.url}},l))}catch(t){if(t instanceof h.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:C})},!1,b),H)throw t;return await (0,m.sendResponse)($,K,new Response(null,{status:500})),null}}e.s(["handler",()=>_,"patchFetch",()=>T,"routeModule",()=>x,"serverHooks",()=>P,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>U],54981)},11072,e=>{e.v(t=>Promise.all(["server/chunks/src_lib_security-notifications_5f07320b.js","server/chunks/src_lib_security-detection_4bdbe3ad.js"].map(t=>e.l(t))).then(()=>t(74405)))}];

//# sourceMappingURL=_c080a2b1._.js.map