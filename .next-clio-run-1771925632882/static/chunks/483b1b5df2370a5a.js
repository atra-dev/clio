(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,38418,e=>{"use strict";var t=e.i(43476),s=e.i(932),a=e.i(80064);function l(e){let l,i,r,n=(0,s.c)(10),{title:d,subtitle:o,className:c,children:m,action:u}=e;return n[0]!==c?(l=(0,a.cn)("rounded-2xl border border-slate-200 bg-white p-5 shadow-[0_12px_30px_-24px_rgba(15,23,42,0.55)]",c),n[0]=c,n[1]=l):l=n[1],n[2]!==u||n[3]!==o||n[4]!==d?(i=(d||o||u)&&(0,t.jsxs)("header",{className:"mb-4 flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[d&&(0,t.jsx)("h2",{className:"text-base font-semibold text-slate-900",children:d}),o&&(0,t.jsx)("p",{className:"text-sm text-slate-600",children:o})]}),u]}),n[2]=u,n[3]=o,n[4]=d,n[5]=i):i=n[5],n[6]!==m||n[7]!==l||n[8]!==i?(r=(0,t.jsxs)("section",{className:l,children:[i,m]}),n[6]=m,n[7]=l,n[8]=i,n[9]=r):r=n[9],r}e.s(["default",()=>l])},66082,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(38418),l=e.i(75686);let i="EMPLOYEE_L1",r=new Set(["EMPLOYEE","EMPLOYEE_L1","EMPLOYEE_L2","EMPLOYEE_L3"]),n=new Set(["SUPER_ADMIN","GRC","HR","EA",i]),d=new Map(l.ROLES.map(e=>[e.id,e.label]));function o(e){let t=String(e||"").trim().toUpperCase();return r.has(t)?i:t}let c=(()=>{let e=new Map;for(let t of l.ROLES){let s=o(t.id);!n.has(s)||e.has(s)||e.set(s,{id:s,label:s===i?"Employee":t.label})}return Array.from(e.values())})(),m={email:"",role:"HR"};function u(e){if(!e)return"-";let t=new Date(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("en-US",{month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)}function x(e){let t=o(e);return t===i?"Employee":d.get(t)||e}function p(){let[e,l]=(0,s.useState)([]),[i,r]=(0,s.useState)({}),[n,d]=(0,s.useState)(!0),[p,h]=(0,s.useState)(!1),[b,y]=(0,s.useState)(""),[f,g]=(0,s.useState)(""),[j,N]=(0,s.useState)(""),[v,w]=(0,s.useState)(""),[E,S]=(0,s.useState)(null),[k,C]=(0,s.useState)(m),A=(0,s.useCallback)(async()=>{N("");try{let e=await fetch("/api/admin/users",{method:"GET"});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.message||"Unable to load user directory.")}let t=await e.json(),s=Array.isArray(t.users)?t.users:[];l(s),r(s.reduce((e,t)=>(e[t.id]=o(t.role),e),{}))}catch(e){N(e.message||"Unable to load user directory.")}finally{d(!1)}},[]);(0,s.useEffect)(()=>{A()},[A]);let U=e=>t=>{C(s=>({...s,[e]:t.target.value}))},R=async e=>{e.preventDefault(),h(!0),N(""),w(""),S(null);try{let e=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.message||"Unable to send invitation.")}let t=await e.json(),s="string"==typeof t?.delivery?.status?t.delivery.status:"",a="string"==typeof t?.warning?t.warning:"";"failed"===s?w(a||`Invite created for ${t.user.email}. Email delivery failed.`):w(`Invitation email with verification link sent to ${t.user.email}.`),S(t.invite||null),C(m),await A()}catch(e){N(e.message||"Unable to send invitation.")}finally{h(!1)}},L=async e=>{y(e.id),N(""),w("");try{var t;let s=await fetch(`/api/admin/users/${encodeURIComponent(e.id)}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:(t=e.status,"active"===t?"disabled":"active")})});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.message||"Unable to update account status.")}let a=await s.json();l(e=>e.map(e=>e.id===a.user.id?a.user:e)),w(`Account status updated: ${a.user.email} is ${a.user.status}.`)}catch(e){N(e.message||"Unable to update account status.")}finally{y("")}},T=async e=>{let t=o(i[e.id]||e.role),s=o(e.role);if(t&&t!==s){g(e.id),N(""),w("");try{let s=await fetch(`/api/admin/users/${encodeURIComponent(e.id)}/role`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:t})});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.message||"Unable to update user role.")}let a=await s.json();l(e=>e.map(e=>e.id===a.user.id?a.user:e)),r(e=>({...e,[a.user.id]:o(a.user.role)})),w(`Role updated: ${a.user.email} is now ${x(a.user.role)}.`)}catch(e){N(e.message||"Unable to update user role.")}finally{g("")}}},O=(0,s.useMemo)(()=>[...e].sort((e,t)=>new Date(t.updatedAt||t.invitedAt).getTime()-new Date(e.updatedAt||e.invitedAt).getTime()),[e]);return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(a.default,{title:"Invite User",subtitle:"No sign-up form. Invited users must verify email from the invite link before Google sign-in.",children:[(0,t.jsxs)("form",{className:"grid gap-3 sm:grid-cols-[minmax(0,1fr)_180px_auto]",onSubmit:R,children:[(0,t.jsxs)("label",{className:"space-y-1",children:[(0,t.jsx)("span",{className:"text-xs font-medium uppercase tracking-[0.08em] text-slate-600",children:"Work Email"}),(0,t.jsx)("input",{type:"email",required:!0,value:k.email,onChange:U("email"),placeholder:"employee@gmail.com",className:"h-10 w-full rounded-lg border border-slate-300 bg-white px-3 text-sm text-slate-900 placeholder:text-slate-400 focus:border-sky-400 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"space-y-1",children:[(0,t.jsx)("span",{className:"text-xs font-medium uppercase tracking-[0.08em] text-slate-600",children:"Role"}),(0,t.jsx)("select",{value:k.role,onChange:U("role"),className:"h-10 w-full rounded-lg border border-slate-300 bg-white px-3 text-sm text-slate-900 focus:border-sky-400 focus:outline-none",children:c.map(e=>(0,t.jsx)("option",{value:e.id,children:e.label},e.id))})]}),(0,t.jsx)("button",{type:"submit",disabled:p,className:"mt-6 inline-flex h-10 items-center justify-center rounded-lg bg-sky-600 px-4 text-sm font-semibold text-white transition hover:bg-sky-700 disabled:cursor-not-allowed disabled:opacity-70",children:p?"Sending...":"Send invite"})]}),E?(0,t.jsxs)("div",{className:"mt-4 rounded-xl border border-sky-200 bg-sky-50 px-4 py-3 text-xs text-sky-800",children:[(0,t.jsx)("p",{className:"font-semibold",children:"Invite recorded"}),(0,t.jsxs)("p",{className:"mt-1",children:["Invite ID: ",E.id||"-"]}),(0,t.jsxs)("p",{className:"mt-1",children:["Expires: ",u(E.expiresAt)]})]}):null,j?(0,t.jsx)("p",{className:"mt-4 rounded-lg border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:j}):null,v?(0,t.jsx)("p",{className:"mt-4 rounded-lg border border-emerald-200 bg-emerald-50 px-3 py-2 text-xs text-emerald-700",children:v}):null]}),(0,t.jsx)(a.default,{title:"User Directory",subtitle:"Review account states and manage access by role.",children:n?(0,t.jsx)("p",{className:"text-sm text-slate-600",children:"Loading user accounts..."}):(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full text-left text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b border-slate-200 text-xs uppercase tracking-[0.1em] text-slate-500",children:[(0,t.jsx)("th",{className:"px-2 py-3 font-medium",children:"Email"}),(0,t.jsx)("th",{className:"px-2 py-3 font-medium",children:"Role"}),(0,t.jsx)("th",{className:"px-2 py-3 font-medium",children:"Status"}),(0,t.jsx)("th",{className:"px-2 py-3 font-medium",children:"Invited"}),(0,t.jsx)("th",{className:"px-2 py-3 font-medium",children:"Last Login"}),(0,t.jsx)("th",{className:"px-2 py-3 font-medium",children:"Change Role"}),(0,t.jsx)("th",{className:"px-2 py-3 font-medium text-right",children:"Action"})]})}),(0,t.jsx)("tbody",{children:O.map(e=>{var s;let a;return(0,t.jsxs)("tr",{className:"border-b border-slate-100 text-slate-700 last:border-b-0",children:[(0,t.jsxs)("td",{className:"px-2 py-3",children:[(0,t.jsx)("p",{className:"font-medium text-slate-900",children:e.email}),(0,t.jsxs)("p",{className:"text-xs text-slate-500",children:["By: ",e.invitedBy]})]}),(0,t.jsx)("td",{className:"px-2 py-3",children:x(e.role)}),(0,t.jsx)("td",{className:"px-2 py-3",children:(0,t.jsx)("span",{className:`rounded-md px-2 py-1 text-xs font-semibold ${"active"===(s=e.status)?"bg-emerald-100 text-emerald-700":"disabled"===s?"bg-rose-100 text-rose-700":"bg-amber-100 text-amber-700"}`,children:e.status})}),(0,t.jsx)("td",{className:"px-2 py-3 text-xs text-slate-600",children:u(e.invitedAt)}),(0,t.jsx)("td",{className:"px-2 py-3 text-xs text-slate-600",children:u(e.lastLoginAt)}),(0,t.jsx)("td",{className:"px-2 py-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("select",{value:o(i[e.id]||e.role),onChange:(a=e.id,e=>{let t=o(e.target.value);r(e=>({...e,[a]:t}))}),disabled:f===e.id,className:"h-8 min-w-[132px] rounded-lg border border-slate-300 bg-white px-2 text-xs text-slate-900 focus:border-sky-400 focus:outline-none disabled:opacity-70",children:c.map(e=>(0,t.jsx)("option",{value:e.id,children:e.label},e.id))}),(0,t.jsx)("button",{type:"button",onClick:()=>T(e),disabled:f===e.id||!i[e.id]||o(i[e.id])===o(e.role),className:"rounded-lg border border-sky-300 bg-sky-50 px-2.5 py-1.5 text-xs font-medium text-sky-700 transition hover:bg-sky-100 disabled:cursor-not-allowed disabled:opacity-70",children:f===e.id?"Saving...":"Change Role"})]})}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)("button",{type:"button",onClick:()=>L(e),disabled:b===e.id||f===e.id,className:"rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 transition hover:bg-slate-100 disabled:cursor-not-allowed disabled:opacity-70",children:b===e.id?"Updating...":"active"===e.status?"Disable":"Open account"})})]},e.id)})})]})})})]})}e.s(["default",()=>p])}]);